import{jsxs,jsx,Fragment}from"react/jsx-runtime";import{useRef,useState,useEffect}from"react";import{C as CfgValue,Z as ZolkName,c as containsNumber,i as idxTHAP,v as vi2en,w as withReactContent,S as Swal}from"./OUD-67i2.js";import{A as AREA_NAME,z as CHI_3HH,L as LTHG_HH,C as CAN,b as CHI,B as CHI_HH,D as THAP,g as HH_THAP,h as CAN_HH,i as CAN_AD,d as SM,t as STARSTRONG,u as STAR_SIGN,v as CR_TS,F as FAILURE6,E as STARLOOP1,H as HH,c as ADTN,S as SKB,T as TKN,J as TKN_MONTH,y as TKN_PN,K as TSNAME,M as LTHG_NA,G as GETHOA}from"./BKLYWFN1.js";import Konva from"konva/lib/Core.js";import{Arrow}from"konva/lib/shapes/Arrow.js";import{Circle}from"konva/lib/shapes/Circle.js";import{Line}from"konva/lib/shapes/Line.js";import{Rect}from"konva/lib/shapes/Rect.js";import{Text}from"konva/lib/shapes/Text.js";import dayjs from"dayjs";import Konva$1 from"konva/lib/_CoreInternals.js";import Konva$2 from"konva";const rectCache=new Rect({x:0,y:0,width:100,height:100,hitStrokeWidth:0,shadowForStrokeEnabled:!1});rectCache.cache();const lineCache=new Line({points:[0,0,-100,-100],stroke:"#fff",strokeWidth:1.5,opacity:1});lineCache.cache();const cricleCache=new Circle({x:-100,y:-100,radius:10,fill:"#000",stroke:"#000",strokeWidth:.2,opacity:.4,perfectDrawEnabled:!0,hitStrokeWidth:0,shadowForStrokeEnabled:!1,width:100,height:100});cricleCache.cache();let textCache=new Text({x:500,y:500,text:"",fontStyle:"normal",fontSize:14,fontFamily:"Arial",fill:"#000",strokeWidth:0,perfectDrawEnabled:!0,textDecoration:"",shadowColor:"black",shadowBlur:0,shadowOffset:{x:0,y:0},shadowOpacity:0,hitStrokeWidth:0,shadowForStrokeEnabled:!1,width:10,height:10});textCache.cache(),textCache=textCache.clone({width:"auto",height:"auto"});const arrowCache=new Arrow({x:0,y:0,points:[0,0,250,250],pointerLength:12,pointerWidth:6,fill:"black",stroke:"black",strokeWidth:2.5,opacity:1,perfectDrawEnabled:!0,lineJoin:"round",hitStrokeWidth:0,shadowForStrokeEnabled:!1,width:5,height:5});function drawText(t,o,e,n,i=!0){let a={x:500,y:500,text:"",fontStyle:"normal",fontSize:o,fontFamily:e,fill:"#000",strokeWidth:0,perfectDrawEnabled:!0,textDecoration:"",shadowColor:"black",shadowBlur:0,shadowOffset:{x:0,y:0},shadowOpacity:0,hitStrokeWidth:0,shadowForStrokeEnabled:!1};a={...a,...t};const r=textCache.clone(a);return i&&void 0!==n&&(n.add(r),null!==r&&r.moveToTop()),r}function drawHoaTienThien(t,o,e,n,i,a,r,l,s,c){const d=o[e];let f=!1;const h={fontSize:l+2,shadowEnabled:!0,shadowOpacity:0,shadowForStrokeEnabled:!0,align:"left",perfectDrawEnabled:!0,fontStyle:"bold"};h.x=i,h.y=a+7;let x,y=0;const u=["A","B","C","D"];for(let o=0;o<=3;o+=1){if(d[o]===n){f=!0;const e=c[o],n=s[o],i={x:h.x,y:h.y,radius:8.5,fill:e,stroke:n,strokeWidth:1.5,opacity:.7,hitStrokeWidth:0,shadowForStrokeEnabled:!1};h.text=`${u[o]}`,h.fill=s[o],x=drawText(h,l+2,r,t,!1),x.x(x.x()-4.7),x.y(x.y()-6),h.x+=y,h.y+=0;const a=cricleCache.clone(i);t.add(a),t.add(x),0===y&&(y=x.getTextWidth()+13)}}return f}function drawTuHoa(t,o,e,n,i,a,r,l,s,c,d,f,h,x){let y=!1;const u=o[e.cn].indexOf(s);if(u>=0){y=!0;const o=e.ci,c={opacity:.8,points:[r,l,r,l],fill:f[Number(u)],stroke:f[Number(u)],strokeWidth:1.5,pointerLength:15,pointerWidth:8},d=c.points,p=-1!==e.sb.indexOf(s),b=11===o||0===o||1===o||2===o,S=5===o||6===o||7===o||8===o,m=3===o||4===o,g=9===o||10===o,w=h[e.ci],C=e.cno.filter((t=>t===e.ci)).length,T=63===s&&1===C,H=4===x.cfg[CfgValue.typeLs]||5===x.cfg[CfgValue.typeLs];if(b||S){let t=0;const e=Number(x.ars[o].zolk[0][ZolkName.currentLoc]),r=Number(x.ars[o].zolk[3][ZolkName.currentKi]);t=r>9||e>9?13:r>0||e>0?5:0,t=1===x.cfg[CfgValue.locKiToanDo]?t:0,d[0]=n.x+(p?i/2+(b?t:0):i/2-(T?23:2===C?10:6))-15*w,d[1]=d[1]+(p?6:3),d[2]=d[0],d[3]=S?5:b?n.y+a+23:d[3]}m&&(d[0]=n.x+(p||H?45:10),d[1]=d[1]+(p?6:5),d[2]=5,d[3]=d[1]),g&&(d[0]=n.x+i/2+(p?35:H?45:-15),d[1]=d[1]+(p?6:5),d[2]=n.x+i+23,d[3]=d[1]),t.add(arrowCache.clone(c))}return y}function drawHoaDaiVan(t,o,e,n,i,a,r,l,s,c){if(r.cfg[CfgValue.showHoaIcon]<1)return!1;let d=!1;const f=o[r.ars[r.dvidx].cn].indexOf(a);return f>=0&&(d=!0,t.add(rectCache.clone({x:n,y:i,width:9,height:9,fill:c[Number(f)],stroke:c[Number(f)],strokeWidth:0,draggable:!1,opacity:.8,perfectDrawEnabled:!0,cornerRadius:0,hitStrokeWidth:0,shadowForStrokeEnabled:!1})),t.add(drawText({text:"2",x:n+1.8,y:i+.5,fontSize:l-4,fill:"#fff",shadowBlur:0,shadowOpacity:1,opacity:.9},l,s,t))),d}function drawHoaLuuNien(t,o,e,n,i,a,r,l,s,c){if(r.cfg[CfgValue.showHoaIcon]<2)return!1;const d=i+4.3;let f=!1;const h=o[r.dtv.bs.y[0]].indexOf(a);return h>=0&&(f=!0,t.add(cricleCache.clone({x:n+2.8,y:d,radius:5,fill:c[h],strokeWidth:0,opacity:.8,hitStrokeWidth:0,shadowForStrokeEnabled:!1})),t.add(drawText({text:"3",x:Number(n+1),y:Number(d-3.8),fontSize:Number(l-4),fill:"#fff",shadowBlur:0,shadowOpacity:1,opacity:.9},l,s,t))),f}function drawHoaCanThang(t,o,e,n,i,a,r,l,s,c){if(r.cfg[CfgValue.showHoaIcon]<3)return!1;const d=i+4.1;let f=!1;const h=o[r.dtv.bs.m[0]].indexOf(a);return h>=0&&(f=!0,t.add(cricleCache.clone({x:n+2.8,y:d,radius:5,fill:c[h],strokeWidth:0,opacity:.8,hitStrokeWidth:0,shadowForStrokeEnabled:!1})),t.add(drawText({text:"4",x:Number(n+.7),y:Number(d-3.8),fontSize:Number(l-4),fill:"#fff",shadowBlur:0,shadowOpacity:1,opacity:.9},l,s,t))),f}function drawHoaCanNgay(t,o,e,n,i,a,r,l,s,c){if(r.cfg[CfgValue.showHoaIcon]<4)return!1;const d=i+4.1;let f=!1;const h=o[r.dtv.bs.d[0]].indexOf(a);return h>=0&&(f=!0,t.add(cricleCache.clone({x:n+2.8,y:d,radius:5,fill:c[h],strokeWidth:0,opacity:.8,hitStrokeWidth:0,shadowForStrokeEnabled:!1})),t.add(drawText({text:"5",x:Number(n+.7),y:Number(d-3.8),fontSize:Number(l-4),fill:"#fff",shadowBlur:0,shadowOpacity:1,opacity:.9},l,s,t))),f}function ZoneBase(t){const{color:o,colorHoa:e,colorHoaFill:n,fontPhuTinh:i,idx:a,cung:r,fontDV:l,fontFamilySet:s,typeLs:c,pos:d,hafWSquare:f,padContentTop:h,padContentBottom:x,padContent:y,wSquare:u,hSquare:p,cfgLs:b}=t,{ls:S}=t,m=new Konva.Group({});function g(t,o,e=.2,n=0){const i=rectCache.clone({x:t.x()-n/2-2,y:t.y()-n/2-1.8,fill:o,width:t.width()+n+4,height:t.height()+n,perfectDrawEnabled:!0,strokeWidth:0,opacity:e,cornerRadius:4,hitStrokeWidth:0,shadowForStrokeEnabled:!1});return m.add(i),null!==i&&i.moveToTop(),null!==t&&t.moveToTop(),i}function w(t,o){return THAP[HH_THAP[CAN_HH[t]][CAN_HH[o]][function(t,o){return CAN_AD[t]===CAN_AD[o]?1:0}(t,o)]]}return function(){let t=AREA_NAME[r.ai];if(t=`${AREA_NAME[r.ai]}`,3===c){drawText({text:r.dv.toString(),fill:"#000",x:-1e4,y:-1e4,fontStyle:"bold"},l,s,m,!1).destroy()}let e=S.at===a?`${t}(T)`:t;4!==c&&5!==c||(e=t);const n={text:e,fill:"#000",x:Number(d.x)+f,y:Number(d.y)+h,fontStyle:"bold",align:"left"},i=drawText(n,l-1,s,m);if(i.x(i.x()-i.getTextWidth()/2),m.add(textCache.clone({x:i.x()-14,y:i.y()-.3,text:"▲",fontStyle:"normal",fontSize:l-1,fontFamily:"Arial",fill:o[CHI_3HH[a]],perfectDrawEnabled:!0,opacity:2===CHI_3HH[a]?.8:.6,hitStrokeWidth:0,shadowForStrokeEnabled:!1})),0===r.ai||4===r.ai||r.ai,0===r.ai){const t=rectCache.clone({x:d.x+1,y:d.y+1,width:u-1,height:p-1,fill:"#f0e9de",hitStrokeWidth:0,shadowForStrokeEnabled:!1,opacity:.6});m.add(t)}S.am===a&&g(i,n.fill,.3),n.text=r.dv,n.fill=o[LTHG_HH[r.na]];const x=drawText(n,l-1,s,m);x.x(i.x()+i.width()+5);const y=g(x,o[LTHG_HH[r.na]],.1);let b=!1;if(r.cn===S.dtb.bs.y[0]&&0!==a&&1!==a&&(n.fontStyle="bold",n.text=`${n.text}`,b=!0),b){n.fill="#555",n.text="☸",n.x=i.x()+i.getTextWidth()+2,n.y=i.y(),n.fontSize=l-2,n.shadowBlur=0,n.shadowEnabled=!1;const t=drawText(n,l,s,m);x.x(t.x()+t.getTextWidth()+2),y.x(x.x()-2)}}(),1===Number(b[CfgValue.rotateZone])&&function(){if(3===c)return;const t={text:`${AREA_NAME[r.aid]}2`,fill:"#555",x:d.x+y,y:d.y+h,fontStyle:"bold",opacity:.8,fontSize:l-2},o=drawText(t,l-3,s,m);r.dvc&&g(o,t.fill,.2)}(),function(){if(4!==c)return;let t=21;1===b[CfgValue.batTuCung]&&1==b[CfgValue.showSun]&&(t=33),0===Number(b[CfgValue.showSun])&&0===b[CfgValue.batTuCung]&&(t=12),0===b[CfgValue.isNapAmCung]&&(t=2);let o=!1;if(r.ci===S.ars[S.am].cno[0]){o=!0;const i=18,a=18,r=rectCache.clone({x:d.x+y,y:d.y+x-t-4,width:15,height:15,fill:n[0],stroke:e[0],strokeWidth:1,opacity:.7,hitStrokeWidth:0,shadowForStrokeEnabled:!1,cornerRadius:2});m.add(r);const c=drawText({text:"A",fill:e[0],x:r.x(),y:r.y(),fontSize:l-2},l-2,s,m);c.x(r.x()+i/2-c.getTextWidth()/2-1),c.y(r.y()+a/2-c.getTextWidth()/2-1.3)}if(r.ci===S.ars[S.am].cno[3]){const i=18,a=18,r=rectCache.clone({x:d.x+y,y:d.y+x-t-4,width:15,height:15,fill:n[3],stroke:e[3],strokeWidth:1,opacity:.7,hitStrokeWidth:0,shadowForStrokeEnabled:!1,cornerRadius:2});m.add(r);const c=drawText({text:"D",fill:e[3],x:r.x(),y:r.y(),fontSize:l-2},l-2,s,m);c.x(r.x()+i/2-c.getTextWidth()/2-1),c.y(r.y()+a/2-c.getTextWidth()/2-1.3),o&&(r.x(r.x()+18),c.x(c.x()+18))}}(),function(){if(3===c)return;const t=drawText({text:`${AREA_NAME[r.ail??0]}3`,fill:"#888",x:d.x+u-y,y:d.y+h,fontStyle:"bold",opacity:1},l-2,s,m);if(t.absolutePosition({x:t.x()-t.getTextWidth(),y:d.y+h}),0===b[CfgValue.rotateZone]&&t.destroy(),4!==c){const e=drawText({text:`${CAN[r.lmpt[2]].charAt(0)} T${r.lmpt[0]}`,fill:o[LTHG_HH[r.lmpt[4]]],x:d.x+u-y,y:t.y()+16.5,fontSize:1===b[CfgValue.rotateZone]?l-3:l-1,opacity:1},l,s,m);e.x(e.x()-e.getTextWidth()),0===b[CfgValue.rotateZone]?e.y(e.y()-16.5):(0===r.ail&&g(t,"#444"),S.dtv.ln.m===r.lmpt[0]&&g(e,"#555"))}}(),function(){const t=`${CAN[r.cn].charAt(0)}.${CHI[r.ci]}`,e=1===b[CfgValue.rotateZone]?l-3:l-1;let n=h;1===Number(b[CfgValue.rotateZone])&&(n=h+16);const i=drawText({text:t,fill:o[LTHG_HH[r.na]],x:-1e3,y:-1e3,fontSize:e},l,s,m,!1),a={text:t,fill:o[LTHG_HH[r.na]],x:d.x+y,y:d.y+n,fontSize:e};3===c&&(a.y=d.y+y),drawText(a,e,s,m),i.destroy()}(),function(){let t={},e=21;if(1===b[CfgValue.batTuCung]&&1==b[CfgValue.showSun]&&(e=33),0===Number(b[CfgValue.showSun])&&0===b[CfgValue.batTuCung]&&(e=12),0===b[CfgValue.isNapAmCung]&&(e=2),4!==c&&5!==c){t={text:`V${r.lmnp[0]}`,fill:"#444",x:d.x+y-2,y:d.y+x-e,fontSize:l-2};const n=drawText(t,l,s,m);t={},t.x=d.x+y,t.y=d.y+x-e,t.text=`${CHI[r.lynp].toUpperCase()}`,t.fill=o[CHI_HH[r.lynp]],t.align="left",t.fontSize=l-3,t.fontStyle="bold";const i=drawText(t,l,s,m);S.dtv.bs.y[1]===r.lynp&&g(i,t.fill),n.x(i.x()+i.getTextWidth()+2),S.dtv.ln.m===r.lmnp[0]&&g(n,"#555")}const n=(r.lmpt[1][0]-1+2)%12,i=S.ars[n],a=drawText({text:`${CAN[i.lmpt[2]].charAt(0)}.${CHI[i.lmpt[3]]} P${r.lmpt[1][0]}`,fill:o[LTHG_HH[i.lmpt[4]]],x:d.x+u-y,y:d.y+x-e,fontSize:l-2,opacity:1},l,s,m);a.x(a.x()-a.getTextWidth()),S.dtv.ln.m===r.lmpt[1][0]&&g(a,"#555")}(),1===Number(b[CfgValue.isNapAmCung])&&function(){let t=d.y+x;4!==c&&5!==c||(t=d.y+x+7);const e={text:"",fill:o[4],x:d.x+y,y:t,fontSize:i-6,opacity:.7};r.ys.forEach((n=>{const i=e;i.text=n[1],i.fill=o[LTHG_HH[n[2]]];const r=drawText(i,l,s,m);n[1]===S.dtv.sn.y&&1===Number(b[CfgValue.showSun])&&g(r,i.fill,.2);const c=r.x()+r.getTextWidth()+4.5;i.text=`${CAN[n[3]].charAt(0)}`,i.x=r.x(),i.y=r.y()-9;const f=drawText(i,l,s,m);i.text=`.${n[0]}`,i.x=f.x()+f.getTextWidth();const h=drawText(i,l,s,m);if(n[1]===S.dtv.sn.y&&1===Number(b[CfgValue.showSun])&&(g(f,f.fill(),.2),g(h,h.fill(),.2)),0===Number(b[CfgValue.showSun])&&(r.destroy(),f.y(i.y+10),h.y(f.y()),n[1]===S.dtv.sn.y&&(g(f,f.fill(),.2),g(h,h.fill(),.2))),1===b[CfgValue.batTuCung]){const t=w(S.dtb.bs.d[0],n[3]);i.text="Thương"===t?"Thg":t,i.fill="#444",i.x=r.x(),1===b[CfgValue.showSun]?i.y=r.y()-20:i.y=r.y()-10,drawText(i,l,s,m)}let x=S.cid;if(S.yeo>=S.cid)for(let t=0;t<120&&!(x+10>=S.yeo+1);t+=10)x+=10;S.yeo>=S.cid&&n[0]>=x&&n[0]<x+10&&m.add(textCache.clone({x:f.x()+3,y:3===a||4===a||9===a||10===a?d.y+p-5:d.y+p-5.5,text:"▲",fontStyle:"normal",fontSize:l-5,fontFamily:"Arial",fill:"#555",perfectDrawEnabled:!0,opacity:1,hitStrokeWidth:0,shadowForStrokeEnabled:!1})),i.align="left",i.x=c,i.y=t}))}(),t.layer.add(m),t.layer}function ZoneBigStar(t){const{ls:o,color:e,colorHoa:n,colorHoaFill:i,fontPhuTinh:a,cung:r,fontDV:l,fontFamilySet:s,typeLs:c,pos:d,hafWSquare:f,fontChinhTinh:h,hSquare:x,wSquare:y,canHoa:u,thdraw:p}=t,b=new Konva.Group({});function S(t,o=!0){let e={x:500,y:500,text:"",fontStyle:"normal",fontSize:l,fontFamily:s,fill:"#000",strokeWidth:0,perfectDrawEnabled:!0,textDecoration:"",shadowColor:"#fff",shadowBlur:0,shadowOffset:{x:0,y:0},shadowOpacity:0,hitStrokeWidth:0,shadowForStrokeEnabled:!1};e={...e,...t};const n=textCache.clone(e);return o&&b.add(n),n}return function(){const t=d.x;let m=d.y+38,g=17;const w={fontSize:h,fontStyle:"normal"};4!==c&&5!==c||(g=25,w.fontSize=h+4,m=d.y+70);const C=void 0!==r.tu||void 0!==r.tu;for(let T=0;T<r.sb.length;T+=1){const H=r.sb[T],N=SM[H];if(N.name.length>0){w.text=N.name.toUpperCase(),w.fill=e[N.hh],w.fontStyle="bold";const k=S(w,!1);if(w.x=t+f-k.getTextWidth()/2,w.y=m,4===c){const t={...w,fontSize:h-6,fontStyle:"normal"};if(t.x=w.x,t.y=w.y-9,r.stlk.length>0&&void 0!==r.stlk[H]){const o=r.stlk[H];t.text=`${o[0]}A`,t.fill=n[0];const e=S(t);t.text=`${o[1]}D`,t.fill=n[3];const i=S(t),a=e.getTextWidth()+i.getTextWidth()+4;e.x(d.x+f-a/2),i.x(e.x()+e.getTextWidth()+4),0===o[0]&&e.destroy(),0===o[1]&&(i.destroy(),o[0]>0&&e.x(e.x()+e.getTextWidth()+4))}}const W=N.lvl;let v=!1,A="";void 0!==W&&Object.entries(W).forEach((([t,o],e)=>{Number(t)!==r.ci+1||"M"!==o&&"V"!==o||(v=!0,A=o),Number(t)===r.ci+1&&"H"===o&&(A=o),Number(t)===r.ci+1&&(A=o)}));4!==c&&5!==c&&(v&&!C)&&(w.shadowColor=e[N.hh],w.shadowBlur=0,w.shadowOpacity=0,w.shadowOffset={x:0,y:0});let $=S(w);if(4!==c&&5!==c&&A.length>0&&S({text:`(${A})`,fill:e[N.hh],fontSize:a-6,x:w.x+$.getTextWidth()+1,y:w.y-1,fontStyle:w.fontStyle}),3!==c&&void 0!==N.nn){const t=w.x-11,c=w.y;drawHoaTienThien(b,u,o.dtb.bs.y[0],r.sb[T],t,c,s,l,n,i);const f=$.x()+$.getTextWidth();drawTuHoa(b,u,r,d,y,x,$.x(),$.y(),r.sb[T],l,s,n,p,o)&&(p[r.ci]+=1);const h=f+14,m=$.y()+1.5,g=drawHoaDaiVan(b,u,r,h,m,r.sb[T],o,l,s,n),C=g?h+12:h,H=drawHoaLuuNien(b,u,r,C,m,r.sb[T],o,l,s,n),k=H?C+10:g?h+12:h,W=drawHoaCanThang(b,u,r,k,m,r.sb[T],o,l,s,n);drawHoaCanNgay(b,u,r,W?k+10:H?C+10:g?h+12:h,m,r.sb[T],o,l,s,n),S({text:""+(N.nn[1]>0?"+":"-"),fill:e[N.hh],fontSize:a-3,x:$.x()+$.getTextWidth()+4,y:$.y()+5,fontStyle:w.fontStyle})}$=textCache.clone({}),m+=g}}}(),t.layer.add(b),t.layer}function ZoneFly(t){const{colorHoaFill60:o,fontPhuTinh:e,idx:n,cung:i,fontDV:a,fontFamilySet:r,typeLs:l,pos:s,hafWSquare:c,hafHSquare:d,colorHoa:f,padContent:h,xBox12:x,yBox34:y,yBox14:u,yBox12:p,xBox34:b,xBox14:S,getGradient:m,typePhiHoa:g,ls:w,countHt:C}=t,T=new Konva.Group({});function H(){const t=[],o=17;return t[0]=[{pos:[x+c,y,S+c,u]},{pos:[S+c,y,x+c,u]},{pos:[S,y,b,u]},{pos:[S,p+d,b,u+d]},{pos:[S,u+d,b,p+d]},{pos:[S,u,b,y]},{pos:[S+c,u,x+c,y]},{pos:[x+c,u,S+c,y]},{pos:[b,u,S,y]},{pos:[b,u+d,S,p+d]},{pos:[b,p+d,S,u+d]},{pos:[b,y,S,u]}],t[1]=[{pos:[t[0][0].pos[0]-o,t[0][0].pos[1],t[0][0].pos[2]+o,t[0][0].pos[3]]},{pos:[t[0][1].pos[0]-o,t[0][1].pos[1],t[0][1].pos[2]+o,t[0][1].pos[3]]},{pos:[t[0][2].pos[0]-o,t[0][2].pos[1],t[0][2].pos[2]+o,t[0][2].pos[3]]},{pos:[t[0][3].pos[0],t[0][3].pos[1]-o,t[0][3].pos[2],t[0][3].pos[3]+o]},{pos:[t[0][4].pos[0],t[0][4].pos[1]-o,t[0][4].pos[2],t[0][4].pos[3]+o]},{pos:[t[0][5].pos[0],t[0][5].pos[1]-o,t[0][5].pos[2],t[0][5].pos[3]+o]},{pos:[t[0][6].pos[0]+o,t[0][6].pos[1],t[0][6].pos[2]-o,t[0][6].pos[3]]},{pos:[t[0][7].pos[0]+o,t[0][7].pos[1],t[0][7].pos[2]-o,t[0][7].pos[3]]},{pos:[t[0][8].pos[0]+o,t[0][8].pos[1],t[0][8].pos[2]-o,t[0][8].pos[3]]},{pos:[t[0][9].pos[0],t[0][9].pos[1]+o,t[0][9].pos[2],t[0][9].pos[3]-o]},{pos:[t[0][10].pos[0],t[0][10].pos[1]+o,t[0][10].pos[2],t[0][10].pos[3]-o]},{pos:[t[0][11].pos[0],t[0][11].pos[1]+o,t[0][11].pos[2],t[0][11].pos[3]-o]}],t[2]=[{pos:[t[0][0].pos[0]+o,t[0][0].pos[1],t[0][0].pos[2]-o,t[0][0].pos[3]]},{pos:[t[0][1].pos[0]+o,t[0][1].pos[1],t[0][1].pos[2]-o,t[0][1].pos[3]]},{pos:[t[0][2].pos[0],t[0][2].pos[1]+o,t[0][2].pos[2],t[0][2].pos[3]-o]},{pos:[t[0][3].pos[0],t[0][3].pos[1]+o,t[0][3].pos[2],t[0][3].pos[3]-o]},{pos:[t[0][4].pos[0],t[0][4].pos[1]+o,t[0][4].pos[2],t[0][4].pos[3]-o]},{pos:[t[0][5].pos[0]-o,t[0][5].pos[1],t[0][5].pos[2]+o,t[0][5].pos[3]]},{pos:[t[0][6].pos[0]-o,t[0][6].pos[1],t[0][6].pos[2]+o,t[0][6].pos[3]]},{pos:[t[0][7].pos[0]-o,t[0][7].pos[1],t[0][7].pos[2]+o,t[0][7].pos[3]]},{pos:[t[0][8].pos[0],t[0][8].pos[1]-o,t[0][8].pos[2],t[0][8].pos[3]+o]},{pos:[t[0][9].pos[0],t[0][9].pos[1]-o,t[0][9].pos[2],t[0][9].pos[3]+o]},{pos:[t[0][10].pos[0],t[0][10].pos[1]-o,t[0][10].pos[2],t[0][10].pos[3]+o]},{pos:[t[0][11].pos[0]+o,t[0][11].pos[1],t[0][11].pos[2]-o,t[0][11].pos[3]]}],t[3]=[{pos:[t[0][0].pos[0]-34,t[0][0].pos[1],t[0][0].pos[2]+34,t[0][0].pos[3]]},{pos:[t[0][1].pos[0]-34,t[0][1].pos[1],t[0][1].pos[2]+34,t[0][1].pos[3]]},{pos:[t[0][2].pos[0]-34,t[0][2].pos[1],t[0][2].pos[2]+34,t[0][2].pos[3]]},{pos:[t[0][3].pos[0],t[0][3].pos[1]-34,t[0][3].pos[2],t[0][3].pos[3]+34]},{pos:[t[0][4].pos[0],t[0][4].pos[1]-34,t[0][4].pos[2],t[0][4].pos[3]+34]},{pos:[t[0][5].pos[0],t[0][5].pos[1]-34,t[0][5].pos[2],t[0][5].pos[3]+34]},{pos:[t[0][6].pos[0]+34,t[0][6].pos[1],t[0][6].pos[2]-34,t[0][6].pos[3]]},{pos:[t[0][7].pos[0]+34,t[0][7].pos[1],t[0][7].pos[2]-34,t[0][7].pos[3]]},{pos:[t[0][8].pos[0]+34,t[0][8].pos[1],t[0][8].pos[2]-34,t[0][8].pos[3]]},{pos:[t[0][9].pos[0],t[0][9].pos[1]+34,t[0][9].pos[2],t[0][9].pos[3]-34]},{pos:[t[0][10].pos[0],t[0][10].pos[1]+34,t[0][10].pos[2],t[0][10].pos[3]-34]},{pos:[t[0][11].pos[0],t[0][11].pos[1]+34,t[0][11].pos[2],t[0][11].pos[3]-34]}],t}function N(t){const o=[!0,!1];return[o[0],o[1],o[0],o[0],o[0],o[1],o[1],o[0],o[0],o[1],o[1],o[1]][w.ars[t].ai]}function k(t){return function(t){let o=Number(t);return o>11&&(o-=12),o}(t+6)}function W(t,o,e=!1){const i=[[],[],[],[],[],[]];if(n===t||t===k(n))return[-2e3,-2e3,-2e3,-2e3,-2e3,-2e3];const a=H(),r=a[0][n],l=a[3][t];i[0]=r.pos[0],i[1]=r.pos[1],i[4]=l.pos[0],i[5]=l.pos[1],6!==t&&7!==t||(i[4]+=15);const s=(i[4]-i[0])/2,c=(i[5]-i[1])/2,d=i[0]+s,f=i[1]+c,h=[];return h[0]=[[-2e3,-2e3],[d,f-30],[d-10,f-50],[d+10,f-30],[d+30,f-30],[d+30,f-50],[d-10,f-80],[d-50,f],[d-40,f-30],[d-30,f-15],[d-10,f-15],[d,f-30]],h[1]=[[d,f-25],[-2e3,-2e3],[d,f-30],[d+15,f-15],[d+30,f-10],[d+30,f-30],[d+30,f],[d-10,f-80],[d-50,f-50],[d-30,f-30],[d-10,f-40],[d-10,f-40]],h[2]=[[d,f-45],[d,f-25],[-2e3,-2e3],[d+20,f],[d+30,f-10],[d+80,f],[d+40,f-40],[d+10,f+75],[d-10,f-80],[d-10,f-50],[d-30,f-30],[d,f-80]],h[3]=[[d+15,f-40],[d+20,f-20],[d+30,f],[-2e3,-2e3],[d+30,f-10],[d+40,f-10],[d+40,f-10],[d+10,f+60],[d+30,f+50],[d-10,f-80],[d,f-30],[d+30,f-35]],h[4]=[[d+30,f-30],[d+25,f-10],[d+40,f+20],[d+30,f],[-2e3,-2e3],[d+30,f],[d+15,f+15],[d+10,f+35],[d+20,f+50],[d,f+40],[d-10,f-80],[d-10,f-80]],h[5]=[[d+40,f-10],[d+25,f-5],[d+80,f],[d+50,f-5],[d+20,f-10],[-2e3,-2e3],[d,f+25],[d+10,f+30],[d,f+80],[d+10,f+50],[d-30,f+40],[d-10,f-80]],h[6]=[[d-30,f-30],[d+30,f],[d+30,f+20],[d+30,f+25],[d+20,f+20],[d-10,f+25],[-2e3,-2e3],[d,f+25],[d-10,f+40],[d-10,f+30],[d-40,f+40],[d-50,f+40]],h[7]=[[d-30,f-30],[d-30,f-30],[d+40,f+20],[d+40,f+40],[d+10,f+30],[d+10,f+40],[d+10,f+25],[-2e3,-2e3],[d,f+25],[d-20,f+20],[d-30,f-10],[d-35,f]],h[8]=[[d-30,f-30],[d-50,f-10],[d-40,f-20],[d+20,f+60],[d-10,f+40],[d+10,f+80],[d,f+30],[d,f+20],[-2e3,-2e3],[d-25,f],[d-40,f],[d-50,f-10]],h[9]=[[d-30,f-30],[d-30,f-30],[d-20,f-90],[d-40,f-20],[d,f+60],[d-10,f+40],[d-10,f+40],[d-15,f+15],[d-25,f-10],[-2e3,-2e3],[d-30,f-10],[d-50,f-10]],h[10]=[[d-20,f-20],[d-10,f-35],[d-5,f-40],[d,f-50],[d-10,f-80],[d-30,f+40],[d-10,f+40],[d-25,f+10],[d-60,f],[d-30,f-10],[-2e3,-2e3],[d-25,f]],h[11]=[[d,f-25],[d-30,f-30],[d,f-80],[d+10,f-50],[d+30,f-30],[d-10,f-80],[d-50,f-20],[d-25,f+5],[d-80,f],[d-40,f-10],[d-20,f],[-2e3,-2e3]],i[2]=h[n][t][0],i[3]=h[n][t][1],e&&(i[2]=i[2]+Math.floor(30*Math.random())+10,i[3]=i[3]+Math.floor(30*Math.random())+10),i}function v(t){const o=f[3],e=i.cno[3],n={fill:o,stroke:o,pointerLength:11,pointerWidth:4,tension:.5,opacity:.5,strokeWidth:1,dash:[8,4]};n.points=W(e),N(e)&&(n.strokeWidth=1.7,n.opacity=.7),4!==l&&5!==l||(n.opacity=.7,n.strokeWidth=1.5,N(e)&&(n.opacity=.9,n.strokeWidth=2)),n.stroke=m(n.points,o,o),T.add(arrowCache.clone(n))}return 3!==l&&(function(){const t={text:"T.HÓA",fill:f[3],x:s.x,y:s.y+h+a+2.7,fontSize:e-4,opacity:.7,fontStyle:"normal"},o=[],l=[];let d=0;for(let l=0;l<=3;l+=1)t.text=`${x=AREA_NAME[w.ars[i.cno[l]].ai].toLowerCase(),x.charAt(0).toUpperCase()+x.slice(1)}`,t.fill=f[l],t.fontStyle=N(i.cno[l])?"bold":"normal",t.opacity=.8,o[l]=drawText(t,a,r,T),t.x=t.x+o[l].getTextWidth()+2.3,d=d+o[l].getTextWidth()+2.3,i.cno[l]===n&&(o[l].text("✱"),o[l].fontSize(e-3));var x;let y=s.x+c-d/2+4;for(let i=0;i<=3;i+=1)o[i].absolutePosition({x:y,y:t.y}),y=o[i].x()+o[i].getTextWidth()+2.3,1===w.cfg[CfgValue.tuanHoanZone]&&w.loopPT[i].forEach(((t,c)=>{if(t.includes(n)){const t={text:["⇄","⇅","⟳","⟲","⇊"][c],fill:f[i],x:o[i].x()+o[i].getTextWidth()/2-3.5,y:s.y+h+a+(0===c?10:12),fontSize:e-5,opacity:1,fontStyle:"normal"};void 0===l[i]&&(l[i]=[]),l[i][c]=drawText(t,a,r,T)}}))}(),1===w.cfg[CfgValue.locKiToanDo]&&function(){const t=i.zolk[0][ZolkName.currentLoc],o=i.zolk[3][ZolkName.currentKi];let h=null,x=null,y=null;const u="∞",p={text:"",fill:"",x:s.x+c,y:s.y+2*d-48,fontSize:4===l?e+2:e-2,opacity:4===l?1:.8,fontStyle:"bold"},b=4===l||5===l?"A":"",S=4===l||5===l?"D":"";if(t>0)if(containsNumber(w.loopLP[0],n))if(0===i.zolk[0][ZolkName.locKeep])p.text=t.toString()+b+u,p.fill=f[0],h=drawText(p,a,r,T),h.x(h.x()-h.getTextWidth()/2);else{const o=t-i.zolk[0][ZolkName.locKeep];p.text=o>0?i.zolk[0][ZolkName.locKeep].toString()+b:t.toString()+b,p.fill=f[0],h=drawText(p,a,r,T),h.x(h.x()-h.getTextWidth()/2),o>0&&(p.text=o+u,x=drawText(p,a,r,T),x.x(x.x()-x.getTextWidth()/2))}else p.text=t.toString()+b,p.fill=f[0],h=drawText(p,a,r,T),h.x(h.x()-h.getTextWidth()/2);else containsNumber(w.loopLP[0],n)&&0===t&&(p.text=u,p.fill=f[0],p.fontSize=e,h=drawText(p,a,r,T),h.x(h.x()-h.getTextWidth()/2));o>0||containsNumber(w.loopLP[3],n)?(h&&h.y(h.y()-15),x&&x.y(x.y()-30)):x&&x.y(x.y()-15),o>0?(p.text=o.toString()+S+(containsNumber(w.loopLP[3],n)?u:""),p.fill=f[3],y=drawText(p,a,r,T),y.x(y.x()-y.getTextWidth()/2)):containsNumber(w.loopLP[3],n)&&0===o&&(p.text=u,p.fill=f[3],p.fontSize=e,y=drawText(p,a,r,T),y.x(y.x()-y.getTextWidth()/2)),h&&T.add(h),x&&T.add(x),y&&T.add(y),h&&h.moveToTop(),x&&x.moveToTop(),y&&y.moveToTop()}(),0!==l&&1!==l&&4!==l&&6!==l&&8!==l||function(t){const e=f[t],n=i.cno[t];let a=!1;0!==t&&3!==t||(a=1===i.zolk[t][0===t?ZolkName.isMoveLoc:3===t?ZolkName.isMoveKi:3]);const r=[7,3],s={fill:e,stroke:e,pointerLength:11,pointerWidth:5,tension:.6,opacity:.6,strokeWidth:.4};switch(t){case 0:case 1:case 2:a&&v()}if(n<0||n===i.ci)return;s.points=W(n);const c=i.cno[3];3!==t&&n===c&&(s.points=W(n,0,!0));const d=N(n),h=a&&3===t;d&&(s.strokeWidth=1.5,s.opacity=.7),h&&(s.dash=r,s.opacity=.8,s.strokeWidth=2),h&&d&&(s.opacity=.9),4!==l&&5!==l||(s.strokeWidth=1.7,s.opacity=s.opacity+.2),s.stroke=m(s.points,e,o[t]),T.add(arrowCache.clone(s))}(g),function(){const t=H();for(let o=0;o<=3;o+=1){const e=k(n),a=i.cno[o]===e,r=1===i.zolk[0][ZolkName.isMoveLoc],s=1===i.zolk[3][ZolkName.isMoveKi];if(a&&4!==l||4===l&&g===o&&a||1===l&&g===o&&a||8===l&&g===o&&a||a&&r&&3===o&&1!==g&&2!==g){const i=C[e]??0,a=C[n]??0;let c=a;i>a&&(C[n]=i,c=i);const d=t[c][n];if(g===o||1!==l&&8!==l||r&&3===o){const t=f[o],e={opacity:.8,points:d.pos,fill:t,stroke:t,strokeWidth:2.5,pointerLength:20,pointerWidth:8};!(s&&3===g||r&&0===g&&3===o)||0!==l&&1!==l&&4!==l&&8!==l||3!==o||(e.dash=[12,3]),4===l&&(e.strokeWidth=3),T.add(arrowCache.clone(e))}C[n]=c+1,C[e]=C[n]}}}()),t.layer.add(T),t.layer}function ZoneSmallStar(t){const{ls:o,color:e,colorHoa:n,colorHoaFill:i,fontChinhTinh:a,fontPhuTinh:r,cung:l,fontDV:s,fontFamilySet:c,typeLs:d,pos:f,padContentBottom:h,padContent:x,wSquare:y,hafWSquare:u,hSquare:p,cfgLs:b,canHoa:S,thdraw:m}=t,g=new Konva.Group({});function w(t,o=!0){let e={x:500,y:500,text:"",fontStyle:"normal",fontSize:s,fontFamily:c,fill:"#000",shadowForStrokeEnabled:!1,strokeWidth:0,perfectDrawEnabled:!0,textDecoration:"",shadowColor:"black",shadowBlur:0,shadowOffset:{x:0,y:0},shadowOpacity:0};e={...e,...t};const n=textCache.clone(e);return o&&g.add(n),n}function C(t,h,x,C,T=!1,H=r){if(4===d||5===d)return 1===x.zone&&0===C?function(t,r,h){if(![60,61,62,63].includes(h.id-1))return r;const x={fontSize:a+4,fontStyle:"normal"};x.x=t+u,x.y=r,x.text=h.name.toUpperCase(),x.fill=e[h.hh],x.fontStyle="bold";let b=w(x),C=b.y();b.x(b.x()-b.getTextWidth()/2);const T=h.id-1;if(4===d){let t={...x,fontSize:a-6,fontStyle:"normal"};if(t.x=x.x,t.y=x.y-9,l.stlk.length>0&&void 0!==l.stlk[T]){const o=l.stlk[T];t.text=`${o[0]}A`,t.fill=n[0];const e=w(t);t.text=`${o[1]}D`,t.fill=n[3];const i=w(t),a=e.getTextWidth()+i.getTextWidth()+4;e.x(f.x+u-a/2),i.x(e.x()+e.getTextWidth()+4),0===o[0]&&e.destroy(),0===o[1]&&(i.destroy(),o[0]>0&&e.x(e.x()+e.getTextWidth()+4))}}if([60,61,62,63].indexOf(T)>-1){const t=b.x()-11,e=b.y();drawHoaTienThien(g,S,o.dtb.bs.y[0],T,t,e,c,s,n,i);const a=b.x()+b.getTextWidth()+5,r=b.y()-.5;drawTuHoa(g,S,l,f,y,p,a,r,T,s,c,n,m,o)&&(m[l.ci]+=1);const d=b.x()+b.getTextWidth()+3,h=b.y()+4,x=drawHoaDaiVan(g,S,l,d,h,T,o,s,c,n)?d+12:d,u=drawHoaLuuNien(g,S,l,x,h,T,o,s,c,n);drawHoaCanThang(g,S,l,u?x+10:x+3,h,T,o,s,c,n)}return C+25}(t,h,x):h;const N=C>0,k=x.id-1,W=b[CfgValue.showHideStar];if(W>0&&!N){if(1===W&&!STARSTRONG.includes(k))return h;if(2===W&&!STARSTRONG.includes(k)&&!STAR_SIGN.includes(k))return h;if(3===W&&!STARSTRONG.includes(k)&&!STAR_SIGN.includes(k)&&!CR_TS.includes(k))return h;if(!(4!==W||STARSTRONG.includes(k)||STAR_SIGN.includes(k)||CR_TS.includes(k)||FAILURE6.includes(k)))return h}const v=H-1;if([64,65,66,67].includes(k)&&N)return h;const A=void 0!==x.cir,$=x.iptt,E={text:x.name,x:t,y:h,fontSize:H-1,fill:e[x.hh],width:A&&"vts"===x.cir?y:"auto",opacity:1,align:"center",shadowEnabled:!1,shadowOpacity:0,shadowForStrokeEnabled:!1,textDecoration:""};Number(b[CfgValue.shortStar]),N?(E.fontStyle="italic",E.opacity=.9):(1===Number(b[CfgValue.shortStar])&&(E.text=x.sht),$?(E.fontStyle="bold",E.shadowColor=e[x.hh],E.shadowBlur=0,E.shadowOffset={x:0,y:0},E.shadowOpacity=.8):(E.shadowOpacity=0,E.fontStyle="normal",E.textDecoration="",A&&("vbs"===x.cir||x.cir)));const B=w(E,!1);T&&(E.x=t-B.getTextWidth());const z=void 0!==l.tu||void 0!==l.tr,L=x.lvl;let V="",D=0,_=!1;void 0!==L&&Object.entries(L).forEach((([t,o],e)=>{Number(t)===l.ci+1&&(V=o,D=5.5,_=!0)})),void 0===x.lvl||"Đ"!==V||z||N||(E.shadowColor=e[x.hh],E.shadowBlur=0,E.shadowOffset={x:0,y:0},E.shadowOpacity=.8,w(E)),x.lvl;let R=w(E);if(C>0){let t={...E};switch(C){case 1:t.text="◆";break;case 2:t.text="◇";break;case 3:t.text="T."}t.fontSize=t.fontSize-2,2===x.typ?(R.x(R.x()-7),t.x=R.x()+R.getTextWidth()-.2,t.y=R.y()+1):(R.x(R.x()+8),t.x=R.x()-9.5,t.y=R.y()+1),t.fill="#888",w(t)}const F=x.id-1;if(!N&&[60,61,62,63].indexOf(F)>-1&&3!==d){D=0===D?D+3:D;let t=R.x()+R.getTextWidth()+D+9,e=R.y()-1;const a=drawHoaTienThien(g,S,o.dtb.bs.y[0],F,t,e,c,s,n,i),r=R.x()+R.getTextWidth()+D+(a?22:5),d=R.y()+1;drawTuHoa(g,S,l,f,y,p,r,d,F,s,c,n,m,o)&&(m[l.ci]+=1);const h=R.x()+R.getTextWidth()+D+(a?20:2),x=R.y()+2,u=drawHoaDaiVan(g,S,l,h,x,F,o,s,c,n),b=u?h+12:h,w=drawHoaLuuNien(g,S,l,b,x,F,o,s,c,n),C=w?b+11:u?h+12:h,T=drawHoaCanThang(g,S,l,C,x,F,o,s,c,n);drawHoaCanNgay(g,S,l,T?C+11:w?b+11:u?h+12:h,x,F,o,s,c,n)}return _&&!N&&(E.x+=R.getTextWidth(),E.y-=1,E.text=V,E.fontSize=r-6,E.fontStyle="normal",E.opacity=1,E.shadowOpacity=0,w(E)),B.destroy(),h+v}function T(t,e,n,i,a,r=0){const l=[27,56,57,58,59,62,63];let s=1===b[CfgValue.dvStar],c=b[CfgValue.currentStar];for(let d=0;d<t.length;d+=1){if(r>0){let e=!1;!o.istc&&s&&l.includes(t[d])&&(e=!0);let n=o.istc?[...STARLOOP1,58,59,62,63]:STARLOOP1;if(n=1===c?n:2===c?[...n,25,37,82,83,85,86]:[],n.length>0&&!n.includes(t[d])&&(e=!0),!o.istc&&[62,63].includes(t[d])&&(e=!0),e)continue}if(0===Number(b[CfgValue.isADSat])&&(123===t[d]||124===t[d]||125===t[d]))continue;const f=SM[t[d]];void 0!==f.cir&&"vts"===f.cir||(1===f.typ&&(n=C(e,n,f,r)),2===f.typ&&(a=C(i,a,f,r,!0)))}return[n,a]}return function(){let t=f.x+x,e=f.y+73,n=e;const i=f.x+y-x-2;let a=n;if(4===d||5===d){let o=l.sb.length;const n=25,i=f.y+70,r=[i,i+n,i+2*n];t=f.x,e=r[o],a=e}const r=f.x;let s=f.y+h-21;if(1===b[CfgValue.batTuCung]&&1===b[CfgValue.showSun]&&(s=f.y+h-35),0===b[CfgValue.batTuCung]&&0===b[CfgValue.showSun]&&(s=f.y+h-10),4!==d&&5!==d)for(let t=0;t<l.ss.length;t+=1){const o=SM[l.ss[t]];void 0!==o.cir&&"vts"===o.cir&&(s=C(r,s,o,0,!1,13))}const c=T(l.ss,t,e,i,a,0);let u=c;1===b[CfgValue.dvStar]&&o.istc&&(u=T(l.sv,t,c[0],i,c[1],1)),b[CfgValue.currentStar]>0&&T(l.sy,t,u[0],i,u[1],2)}(),t.layer.add(g),t.layer}function Earth(t){let o=t.layer;const e=new Konva.Group({}),n=[{x:Number(t.xBox12),y:Number(t.yBox34)},{x:Number(t.xBox14),y:Number(t.yBox34)},{x:Number(t.xBox),y:Number(t.yBox34)},{x:Number(t.xBox),y:Number(t.yBox12)},{x:Number(t.xBox),y:Number(t.yBox14)},{x:Number(t.xBox),y:Number(t.yBox)},{x:Number(t.xBox14),y:Number(t.yBox)},{x:Number(t.xBox12),y:Number(t.yBox)},{x:Number(t.xBox34),y:Number(t.yBox)},{x:Number(t.xBox34),y:Number(t.yBox14)},{x:Number(t.xBox34),y:Number(t.yBox12)},{x:Number(t.xBox34),y:Number(t.yBox34)}];let i,a;const r=[0,0,0,0,0,0,0,0,0,0,0,0,0],l=[0,0,0,0,0,0,0,0,0,0,0,0,0];for(let e=0;e<12;e+=1){i=n[e],a={idx:Number(e),cung:t.ls.ars[e],pos:i,thdraw:l},o=ZoneBase({...a,...t}),o=ZoneBigStar({...a,...t}),o=ZoneSmallStar({...a,...t});o=ZoneFly({...{countHt:r},...a,...t})}function s(o,n,i,a,r="#fff",l="#666",s=!1){let c=s?50:43;n>0&&(c=s?33:17);const d={x:Number(i[0])-c/2+(n>0?35:0),y:Number(i[1])-4.5,text:o,fill:r,width:c,align:"center",fontSize:9,perfectDrawEnabled:!0,opacity:1,shadowColor:"#000",shadowBlur:0,shadowOpacity:0,shadowOffset:{x:0,y:0}},f=drawText(d,t.fontDV,t.fontFamilySet,e),h=rectCache.clone({x:f.x()-5,y:f.y()-0,fill:l,width:f.width()+10,height:f.height()+0,perfectDrawEnabled:!0,strokeWidth:0,opacity:1,cornerRadius:6,stroke:"#222",hitStrokeWidth:0,shadowForStrokeEnabled:!1});e.add(h),null!==h&&h.moveToTop(),null!==f&&f.moveToTop(),6!=a&&0!=a||(0!==n||s||(f.absolutePosition({x:d.x+17,y:d.y+18}),h.absolutePosition({x:f.x(),y:f.y()+5})),0===n&&s&&(f.absolutePosition({x:d.x+21,y:d.y+18}),h.absolutePosition({x:f.x(),y:f.y()+5})),2!==n||s||(f.absolutePosition({x:d.x-31,y:d.y-50}),h.absolutePosition({x:f.x(),y:f.y()+5})),2===n&&s&&(f.absolutePosition({x:d.x-23,y:d.y-50}),h.absolutePosition({x:f.x(),y:f.y()+5})),f.rotation(-90),h.rotation(-90))}return 5!==t.typeLs&&6!==t.typeLs&&function(){const i=t.ls.ttr[0],a=t.ls.ttr[2];if(0!==i.length||0!==a.length){const r=[[n[0].x,n[0].y+t.hafHSquare],[n[2].x+t.hafWSquare,n[2].y],[n[4].x+t.hafWSquare,n[4].y],[n[7].x,n[7].y+t.hafHSquare],[n[9].x+t.hafWSquare,n[9].y],[n[11].x+t.hafWSquare,n[11].y]];if(0!==i.length){const t=i[0],o=i[1];t[0]===o[0]?s("Tuần-Triệt",0,r[t[0]/2],o[0],"#fff","#111",!0):(s("Tuần",0,r[t[0]/2],t[0],"#fff","#777",!1),s("Triệt",0,r[o[0]/2],o[0],"#fff","#333",!1))}if(0!==a.length&&1===t.ls.cfg[CfgValue.lnTuTr]){const t=a[0],o=a[1];t[0]===o[0]?s("⊙-⊠",2,r[t[0]/2],o[0],"#fff","rgba(17, 17, 17, 1)",!0):(s("⊙",2,r[t[0]/2],t[0],"#fff","rgba(119, 119, 119, 1)",!1),s("⊠",2,r[o[0]/2],o[0],"#fff","rgba(51, 51, 51, 1)",!1))}o.add(e)}}(),o}function LinesBorder(t){const{ls:o,xBox:e,borderOutWith:n,hafBorderOut:i,yBox:a,xBox14:r,yBox14:l,xBox12:s,yBox12:c,xBox34:d,yBox34:f,xBox4:h,yBox4:x,hafBorderIn:y,borderInnerWith:u}=t;return function(){const t=["#000000","#000000","#000000"][o.cfg[CfgValue.tcpb]];return[{points:[r+y,a-y,r+y,x+i],color:t,strokeWidth:u},{points:[s+y,a-y,s+y,l+y],color:t,strokeWidth:u},{points:[s+y,f+y,s+y,x+i],color:t,strokeWidth:u},{points:[d+y,a-y,d+y,x+i],color:t,strokeWidth:u},{points:[e,l+y,h+i,l+y],color:t,strokeWidth:u},{points:[e,c+y,r+y,c+y],color:t,strokeWidth:u},{points:[d+y,c+y,h+i,c+y],color:t,strokeWidth:u},{points:[e,f+y,h+i,f+y],color:t,strokeWidth:u}].concat([{points:[e-i,a-i,s+y,a-i],color:t,strokeWidth:n},{points:[s,a-i,d+y,a-i],color:t,strokeWidth:n},{points:[d+y,a-i,h+i,a-i],color:t,strokeWidth:n},{points:[h+i,a-i,h+i,c+y],color:t,strokeWidth:n},{points:[h+i,c+y,h+i,f+y],color:t,strokeWidth:n},{points:[h+i,f+y,h+i,x+i],color:t,strokeWidth:n},{points:[h+i,x+i,s+y,x+i],color:t,strokeWidth:n},{points:[s,x+i,r+y,x+i],color:t,strokeWidth:n},{points:[r+y,x+i,e-i,x+i],color:t,strokeWidth:n},{points:[e-i,x+i,e-i,c+y],color:t,strokeWidth:n},{points:[e-i,c+y,e-i,l+y],color:t,strokeWidth:n},{points:[e-i,l+y,e-i,a-i],color:t,strokeWidth:n}])}().forEach((o=>{t.layer.add(lineCache.clone({points:o.points,stroke:o.color,strokeWidth:1.5,opacity:1}))})),t.layer}function Sky(t){const{wSquare:o,xBox12:e,xBox14:n,yBox14:i,yBox34:a,borderInnerWith:r,ls:l,fontCenter:s,fontFamilySet:c,color:d,fontDV:f,cfgLs:h}=t,x=new Konva$1.Group({}),y=1===Number(h[CfgValue.batTuCenter]);function u(t){let o={x:500,y:500,text:"",fontStyle:"normal",fontSize:f,fontFamily:c,fill:"#000",strokeWidth:0,textDecoration:"",shadowColor:"black",shadowBlur:0,shadowOffset:{x:0,y:0},shadowOpacity:0,hitStrokeWidth:0,shadowForStrokeEnabled:!1,perfectDrawEnabled:!0};o={...o,...t};const e=textCache.clone(o);return x.add(e),e}function p(t){return u({...t,fontStyle:"normal",width:2*o+r,align:"center"})}function b(t,e,n,i){return function(t,e,n,i){const a=o/2-2.5,r=o/10,c=a+t,f={x:t,y:e,fill:"rgba(0, 0, 0, 0.07)",width:a,height:y?2.1*a:1.35*a,perfectDrawEnabled:!0,strokeWidth:1,opacity:1,cornerRadius:6,hitStrokeWidth:1,shadowForStrokeEnabled:!1},h=rectCache.clone(f);x.add(h),u({text:CAN_AD[n.cn]>0?"+":"-",x:h.x(),y:h.y()+2,fill:"#777",fontSize:s+1,width:a,align:"center",fontStyle:"normal",fontFamily:"Arial"});const p=u({text:`${i}`,x:h.x(),y:h.y()+r,fontSize:s,width:a,align:"center",fontStyle:"bold"});let b=p.x(),S=p.y();if(y){const t=u({text:`${-1===n.cht?"Nhật chủ":THAP[n.cht]}`,x:p.x(),y:p.y()+r+3,fontSize:s,width:a,align:"center"});b=t.x(),S=t.y()}const m=u({text:`${CAN[n.cn].toUpperCase()}`,x:b,y:S+r+6,fill:d[CAN_HH[n.cn]],fontSize:s+1,fontStyle:"bold",width:a,align:"center"}),g=u({text:`${CHI[n.ci].toUpperCase()}`,x:m.x(),y:m.y()+r,fill:d[CHI_HH[n.ci]],fontSize:s+1,fontStyle:"bold",width:a,align:"center"});if(b=g.x(),S=g.y(),y){const t=a/n.ctg.length,o=s-2;let e=0,i=g.y();n.ctg.forEach((n=>{const a=u({text:`${CAN[n]}`,x:0===e?g.x():e,y:g.y()+r,fill:d[CAN_HH[n]],fontSize:o,width:t,align:"center"}),c=THAP[idxTHAP(l.dtb.bs.d[0],n)],f=t-2,h=u({text:c,x:a.x(),y:a.y()+r+2,fontSize:s-2,width:"Thương"===c?f+8:f,align:"center",fill:"#000"});e=a.x()+t,i=h.y()}));const c=r+3,f=u({text:`${TSNAME[n.ts]}`,x:g.x(),y:i+c,fontSize:s-2,width:a,align:"center"});b=f.x(),S=f.y()}const w=r+5,C=s-2;return u({text:`${LTHG_NA[n.na]}`,x:b,y:S+w,fill:d[LTHG_HH[n.na]],fontSize:C,width:a,align:"center"}),c}(t,e,n,1===h[CfgValue.showSun]?i:"")}return function(){if(void 0===l)return[];x.destroyChildren(),u({text:`Ver ${t.version}`,x:n+10,y:a-48,fill:"#000",align:"center",width:2*o-20,fontSize:s-4,opacity:.3,fontVariant:"normal"}),function(){const t="VGluaE1lbmhEby5jb20=";u({text:(()=>{try{return window.atob(t)}catch{return""}})(),x:n,y:a-36,fill:"#b06200",align:"center",width:2*o,fontSize:s-1,opacity:.8,fontVariant:"normal"})}(),function(){const t="TG_FpIHPz";let e=`${String.fromCharCode(76)}oại ${String.fromCharCode(108)}á số ${h[CfgValue.typeLs]+1}`;if([6,7,8].includes(h[CfgValue.typeLs])){const o=["1","2","3"];e+=` - ${t.substring(0,3)}${o[h[CfgValue.tcpb]]}`}u({text:e+` - ${String.fromCharCode(67)}an ${String.fromCharCode(72)}óa `+(l.cfg[CfgValue.lsCanType]+1)+` - ${String.fromCharCode(108)}ập ${String.fromCharCode(108)}úc ${dayjs().format("YYYY/MM/DD HH:mm")}`,x:n,y:a-20,fill:"#000",align:"center",width:2*o,fontSize:s-2,opacity:.8,fontVariant:"normal"})}();const c=s-1;let f=AREA_NAME[l.ars[l.at].ai];f=f.charAt(0)+f.slice(1).toLowerCase();const S=l.dtv.bs,m=s-1.5;var g,w,C;!function(t,o,n){t.forEach(((t,i)=>{!function(t,o,n){let i=0;t.forEach((t=>{i+=function({text:t,fontSize:o,fontStyle:e}){return textCache.clone({text:t,fontSize:o,fontStyle:e}).width()}({...t,fontSize:n})+3}));let a=e-i/2;t.forEach(((t,e)=>{const{txt:i,width:r}=function({text:t,y:o,fontSize:e,fontStyle:n,fill:i}){const a=u({text:t,y:o,fontSize:e,fontStyle:n,fill:i});return{txt:a,width:a.getTextWidth()}}({...t,y:o,fontSize:n});i.x(a),a+=r+3}))}(t,o[i],n)}))}([[{text:`${l.adye>0?"Dương":"Âm"} ${l.sx>0?"Nam":"Nữ"}`,fontStyle:"normal"},{text:`${l.yeo} tuổi`,fontStyle:"bold",align:"center"},{text:"âm lịch",fontStyle:"normal"},{text:"giờ",fontStyle:"normal"},{text:`${CHI[l.dtb.bs.h[1]]}`,fontStyle:"bold"},{text:"ngày",fontStyle:"normal"},{text:`${l.dtb.ln.d}`,fontStyle:"bold"},{text:"tháng",fontStyle:"normal"},{text:`${l.dtb.ln.m}`,fontStyle:"bold"},{text:"năm",fontStyle:"normal"},{text:CAN[l.dtb.bs.y[0]],fontStyle:"bold",fill:d[CAN_HH[l.dtb.bs.y[0]]]},{text:CHI[l.dtb.bs.y[1]],fontStyle:"bold",fill:d[CHI_HH[l.dtb.bs.y[1]]]}],[{text:"Mệnh",fontStyle:"normal"},{text:HH[LTHG_HH[l.dtb.bs.y[2]]],fontStyle:"bold",fill:d[LTHG_HH[l.dtb.bs.y[2]]]},{text:"cục"},{text:HH[l.cid],fontStyle:"bold",fill:d[l.cid]},{text:`- ${l.ad>0?ADTN[1]:ADTN[0]} - ${SKB[l.sks]}`}],[{text:"Thân cư",fontStyle:"normal"},{text:`${f}`,fontStyle:"bold"},{text:"- Mệnh chủ"},{text:SM[l.mctc[0]].name,fontStyle:"bold",fill:d[SM[l.mctc[0]].hh]},{text:"- Thân chủ"},{text:SM[l.mctc[1]].name,fontStyle:"bold",fill:d[SM[l.mctc[1]].hh]}],[{text:"Năm xem "+l.dtv.sn.y+" ÂL: ",x:n+10,fontSize:m},{text:`${CAN[S.y[0]]} ${CHI[S.y[1]]} - `,fill:d[LTHG_HH[S.y[2]]],fontSize:m},{text:`${CAN[S.m[0]]} ${CHI[S.m[1]]}(${l.dtv.ln.m}) - `,fill:d[LTHG_HH[S.m[2]]],fontSize:m},{text:`${CAN[S.d[0]]} ${CHI[S.d[1]]}(${l.dtv.ln.d}) - `,fill:d[LTHG_HH[S.d[2]]],fontSize:m},{text:`${CAN[S.h[0]]} ${CHI[S.h[1]]}`,fill:d[LTHG_HH[S.h[2]]],fontSize:m}]],(g=i+15,w=16,C=4,Array.from({length:C},((t,o)=>g+o*w))),c),function(){const{dtb:t,tutru:e}=l,a=t.tki,c=p({text:`Tứ Trụ - Sinh vào tiết ${TKN[a[0]]}`,x:n,y:i+95,fontSize:s});a[1]&&p({text:`Tháng ${TKN_MONTH[a[0]]}tk từ ${TKN[TKN_PN[a[0]][0]]} (${1===h[CfgValue.showSun]?dayjs(a[3]).format("YYYY/MM/DD HH:mm"):dayjs(a[3]).format("----/MM/DD HH:mm")}) đến ${TKN[TKN_PN[a[0]][1]]} (${1===h[CfgValue.showSun]?dayjs(a[4]).format("YYYY/MM/DD HH:mm"):dayjs(a[4]).format("----/MM/DD HH:mm")})`,x:n,y:c.y()+16,fontSize:s-3});const f=b(n+3,c.y()+33,e.cot[0],`${t.sn.y}`),S=t.ln.mt===t.ln.m?"("+t.ln.mt+")":"("+t.ln.m+")("+t.ln.mt+"tk)",m=b(f+3,c.y()+33,e.cot[1],`${t.sn.m} ${S}`),g=b(m+3,c.y()+33,e.cot[2],`${t.sn.d} (${t.ln.d})`);if(b(g+3,c.y()+33,e.cot[3],`${t.sn.h}h${t.sn.i}`),y){const t=l.tutru.dvt,e=u({text:`${t[0]?"Thuận":"Nghịch"} đến tk cách ${t[1]} ngày ${t[2]} giờ quy đổi thành ${t[3]} năm ${t[4]} tháng ${t[5]} ngày`,x:n,y:c.y()+235,fontStyle:"normal",width:2*o+r,align:"center",fontSize:s-2.5}),i=15,a=l.tutru.dv,f=34;let y=0;a.forEach(((t,o)=>{const a=dayjs.unix(t[2]),r=l.yeo>=a.year()-l.dtb.sn.y+1&&l.yeo<=a.year()-l.dtb.sn.y+10,c={x:0===y?n+3:y,y:e.y()+i,fill:r?"rgba(255, 224, 191, 0.7)":"rgba(0, 0, 0, 0.07)",width:f,height:75,perfectDrawEnabled:!0,strokeWidth:1,opacity:1,cornerRadius:6,hitStrokeWidth:1,shadowForStrokeEnabled:!1};x.add(rectCache.clone(c));const p=u({text:`${THAP[idxTHAP(l.dtb.bs.d[0],t[0])]}`,x:0===y?n+3:y,y:e.y()+i+5,fill:"#333",fontSize:s-4,width:f,align:"center"}),b=u({text:`${CAN[t[0]]}`,x:0===y?n+3:y,y:p.y()+i,fill:d[CAN_HH[t[0]]],fontSize:s-2,width:f,align:"center"}),S=u({text:`${CHI[t[1]]}`,x:b.x(),y:b.y()+i,fill:d[CHI_HH[t[1]]],fontSize:s-2,width:f,align:"center"});let m=`${a.year()-l.dtb.sn.y+1}-${a.year()-l.dtb.sn.y+10}t${1===h[CfgValue.showSun]?" "+a.format("YYYY"):""}`;0===o&&(m=`${a.year()-l.dtb.sn.y+1}t${1===h[CfgValue.showSun]?" "+a.format("DD/MM   YYYY"):""}`),u({text:`${m}`,x:b.x(),y:S.y()+i+2,fill:"#333",fontSize:s-5,width:f,align:"center"}),y=b.x()+f+3.5}))}}()}(),t.layer.add(x),t.layer}arrowCache.cache();const MySwal=withReactContent(Swal),HoroscopeClient=t=>{const o=t.ls,e=o.cfg,n=75*(o.css<=11?0:o.css-11),i=960+n,a=e[CfgValue.typeLs],r=e[CfgValue.typePhiHoa],l=185.5,s=i/4,c=i+2+1+1,d=["","","#031640","#067b11","#8b8380","#e39e25","#cf233b"],f=["","","#123e65","#04973c","#919191","#e39e25","#e73827"];let h=5;4!==a&&5!==a||(h=8);const x=["rgb(3 140 0)","rgb(110 8 136)","rgb(14 124 202)","rgb(217 4 4)"],y=["rgb(3 140 0 / 75%)","rgb(110 8 136 / 75%)","rgb(14 124 202 / 75%)","rgb(217 4 4 / 75%)"],u=["rgba(114,250,112,0.9)","rgba(227,100,255,0.9)","rgba(77,182,255,0.9)","rgba(246,66,66,0.9)"],p=["rgba(114,250,112,0.5)","rgba(227,100,255,0.5)","rgba(77,182,255,0.5)","rgba(246,66,66,0.5)"],b="Roboto Slab",S=54,m=s/2;let g=1,w=g+l,C=w+1+l,T=C+1+l,H=T+1+l,N=1,k=N+s,W=k+1+s,v=W+1+s,A=v+1+s;g+=27,w+=27,C+=27,T+=27,H+=27,N+=27,k+=27,W+=27,v+=27,A+=27;const $=s-2.3*h,E=h;function B(t,o,e="#dcd3aaa8"){if("undefined"!=typeof window){const n=window.document.createElement("canvas").getContext("2d"),i=void 0!==t[4]?t[4]:t[2],a=void 0!==t[5]?t[5]:t[3],r=n.createLinearGradient(t[0],t[1],i,a);return r.addColorStop(0,e),r.addColorStop(1,o),r}return o}const z=useRef(null);let L;const[V,D]=useState(!1),[_,R]=useState(!1);function F(t){let e="VCD";return o.ars[t].sb.length>0&&(e="",o.ars[t].sb.forEach((t=>{e.length>0&&(e+="-"),e+=SM[t].sht}))),vi2en(e)}useEffect((()=>{if("undefined"!=typeof window)try{L&&L.destroy(),z.current&&z.current.destroy();if(!document.getElementById("cv"))return void console.error("Container not found");const n=new Konva$2.Stage({container:"cv",width:800,height:c+S,fill:"#fefefe",font:b});z.current=n,L=new Konva$2.Layer;const V=GETHOA(e[CfgValue.lsCanType]);L.add(rectCache.clone({x:0,y:0,width:800,height:c+S,hitStrokeWidth:0,shadowForStrokeEnabled:!1,fillRadialGradientStartPoint:{x:C,y:W},fillRadialGradientStartRadius:0,fillRadialGradientEndPoint:{x:C,y:W},fillRadialGradientEndRadius:1e3,fillRadialGradientColorStops:[0,"#FFF",1,"#ddd"]})),L.add(rectCache.clone({x:w+1,y:k+1,width:372,height:2*s+1,fillRadialGradientStartPoint:{x:w,y:k},fillRadialGradientStartRadius:0,fillRadialGradientEndPoint:{x:w,y:k},fillRadialGradientEndRadius:555,fillRadialGradientColorStops:[0,"#fff",1,"#ddd"],hitStrokeWidth:0,shadowForStrokeEnabled:!1})),L=LinesBorder({ls:o,layer:L,lsWidth:742,lsHeight:i,xBox:g,borderOutWith:1,hafBorderOut:.5,yBox:N,xBox12:C,yBox12:W,xBox14:w,yBox14:k,xBox34:T,yBox34:v,xBox4:H,yBox4:A,hafBorderIn:.5,borderInnerWith:1,bColor:f}),L=Earth({layer:L,bColor:f,colorHoaStart:y,colorHoa:x,colorHoaFill:u,colorHoaFill60:p,color:d,xBox12:C,yBox34:v,xBox14:w,xBox:g,yBox12:W,yBox14:k,yBox:N,xBox4:H,yBox4:A,xBox34:T,ls:o,hafWSquare:92.75,hafHSquare:m,fontFamilySet:b,borderOutWith:1,hafBorderOut:.5,fontDV:13,padContentBottom:$,padContentTop:E,padContent:h,wSquare:l,hSquare:s,fontPhuTinh:14,fontChinhTinh:15,getGradient:B,typePhiHoa:r,typeLs:a,cfgLs:e,canHoa:V}),L=Sky({layer:L,wSquare:l,xBox12:C,xBox14:w,yBox14:k,yBox34:v,borderInnerWith:1,ls:o,fontCenter:12,hafWSquare:92.75,fontFamilySet:b,color:d,fontDV:13,cfgLs:e,getGradient:B,version:t.version}),L.add(rectCache.clone({x:0,y:c+S,width:800,height:c+S,fill:"rgb(233 233 233)"})),n.add(L),R(!0),D(!0)}catch(t){console.error("Error initializing stage:",t),D(!1),R(!1)}return()=>{L&&L.destroy(),z.current&&(z.current.destroy(),z.current=null),D(!1),R(!1)}}),[t.ls]),useEffect((()=>{0!==t.fnDownloadCall&&G(),0!==t.fnCopyLs&&j()}),[t.fnDownloadCall,t.fnCopyLs]);const M=()=>{const t=AREA_NAME[o.ars[o.at].ai],e=o.dtv.bs;return jsxs("div",{className:"text-[14px] [&_div]:mb-1",children:[jsxs("div",{children:["Thời gian sinh dương lịch:"," ",jsxs("b",{children:[o.dtb.sn.d,"/",o.dtb.sn.m,"/",o.dtb.sn.y," lúc ",o.dtb.sn.h,"h",o.dtb.sn.m]})]}),jsxs("div",{children:[jsx("b",{children:`${o.adye>0?"Dương":"Âm"} ${o.sx>0?"Nam":"Nữ"}`})," tuổi âm lịch ",jsxs("b",{children:[o.yeo," tuổi"]})]}),jsxs("div",{children:["Âm lịch giờ ",jsx("b",{children:CHI[o.dtb.bs.h[1]]})," ngày ",jsx("b",{children:o.dtb.ln.d})," tháng ",jsx("b",{children:o.dtb.ln.m})," năm"," ",jsxs("b",{className:`color${LTHG_HH[o.dtb.bs.y[2]]}`,children:[CAN[o.dtb.bs.y[0]]," ",CHI[o.dtb.bs.y[1]]]})]}),jsxs("div",{children:["Mệnh ",jsxs("b",{className:`color${LTHG_HH[o.dtb.bs.y[2]]}`,children:[" ",HH[LTHG_HH[o.dtb.bs.y[2]]]]})," cục"," ",jsx("b",{className:`color${o.cid}`,children:HH[o.cid]})," - ",`${o.ad>0?ADTN[1]:ADTN[0]} - ${SKB[o.sks]}`," "]}),jsxs("div",{children:["Thân cư ",jsx("b",{children:t.charAt(0)+t.slice(1).toLowerCase()})," - Mệnh chủ"," ",jsx("b",{className:`color${SM[o.mctc[0]].hh}`,children:SM[o.mctc[0]].name})," - Thân chủ"," ",jsx("b",{className:`color${SM[o.mctc[1]].hh}`,children:SM[o.mctc[1]].name})," "]}),jsxs("div",{className:"!text-[12px] !mt-3",children:["Năm xem ",jsx("b",{children:o.dtv.sn.y})," ÂL:"," ",jsxs("span",{className:`color${LTHG_HH[e.y[2]]}`,children:[CAN[e.y[0]]," ",CHI[e.y[1]]]})," ","-"," ",jsxs("span",{className:`color${LTHG_HH[e.m[2]]}`,children:[CAN[e.m[0]]," ",CHI[e.m[1]],"(",o.dtv.ln.m,")"]})," ","-"," ",jsxs("span",{className:`color${LTHG_HH[e.d[2]]}`,children:[CAN[e.d[0]]," ",CHI[e.d[1]],"(",o.dtv.ln.d,")"]})," ","-"," ",jsxs("span",{className:`color${LTHG_HH[e.h[2]]}`,children:[CAN[e.h[0]]," ",CHI[e.h[1]]]})]})]})},j=async()=>{try{if(!z.current)throw new Error("Stage chưa được khởi tạo");if(!_||!V)throw new Error("Lá số đang được tải, vui lòng đợi trong giây lát");if(!document.getElementById("cv"))throw new Error("Không tìm thấy container chứa lá số");let t;await new Promise((t=>setTimeout(t,500)));let o=0;const e=3;for(;!t&&o<e;)try{t=z.current.toDataURL({pixelRatio:2,quality:1,mimeType:"image/png"})}catch(t){if(console.error(`Attempt ${o+1} failed:`,t),o++,o===e)throw new Error("Không thể tạo ảnh từ lá số sau nhiều lần thử");await new Promise((t=>setTimeout(t,300)))}const n=await fetch(t),i=await n.blob();await navigator.clipboard.write([new ClipboardItem({[i.type]:i})]),MySwal.fire({title:"Thông báo",html:jsxs("div",{children:[jsx("div",{children:"Tinh Mệnh Đồ đã copy xong:"}),jsxs("div",{className:"text-orange-600",children:["Check lại thông tin ",jsx("b",{children:"1 lần nữa"})," cho dù bạn đã chắc chắn."]}),jsx("br",{}),jsx("div",{children:M()}),jsx("br",{})]}),icon:"success"})}catch(t){console.error("Error copying image:",t),MySwal.fire({title:"Lỗi",text:t instanceof Error?t.message:"Có lỗi xảy ra khi copy lá số",icon:"error"})}},G=()=>{try{if(!z.current||!V)throw new Error("Vui lòng đợi lá số được tải xong");const t=o.am,e=F(t),n=o.at,i=F(n);!function(t,o){if("undefined"!=typeof window){const e=window.document.createElement("a");e.download=o,e.href=t,window.document.body.appendChild(e),e.click(),window.document.body.removeChild(e)}}(z.current.toDataURL({pixelRatio:2,quality:100}),`${1===o.sx?"nam":"nu"}-Menh-${e}-${vi2en(CHI[t])}-Than-${i}-${vi2en(CHI[n])}--${o.dtb.sn.y}.${o.dtb.sn.m}.${o.dtb.sn.d}-${o.dtb.sn.h}h.${o.dtb.sn.m}-TinhMenhDo.com-${Math.floor(1e4*Math.random())}.png`)}catch(t){console.error("Error exporting image:",t),MySwal.fire({title:"Lỗi",text:t instanceof Error?t.message:"Có lỗi xảy ra khi lưu lá số",icon:"error"})}},[O,I]=useState(!0);return useEffect((()=>{"undefined"!=typeof window&&O&&I(!1)})),jsxs(Fragment,{children:[jsx("div",{id:"cv",className:"flex justify-center"}),jsx("div",{className:"absolute top-0 left-0 hidden size-full max-lg:block"})]})};export{HoroscopeClient as default};