import{h as LTHG,i as CAN,f as CHI,A as AREA_NAME,j as TH,k as LTHG_HH,C as CfgValue,l as CHI_AD,m as StlkName,Z as ZolkName,n as hoa2IchingIdx,x as xtngl,c as configDefault,o as CAN_HOA,p as buildDateInfo,G as GETHOA,q as StarToHoaCan,r as StarUseHoa,S as SM,s as STARSTRONG,t as STAR_SIGN,u as CR_TS,F as FAILURE6,v as idxTHAP,w as CHI_CAN,y as idxTSTutru}from"./BTmqhfbS.js";import dayjs from"dayjs";import{c as convertSolar2Lunar}from"./B6-Txaf5.js";class CalculationHelper{jumpDown(s){return(s+11)%12}jumpUp(s){return(s+1)%12}idxAfterMove(s,t,i=!0){let h=i?this.jumpDown(s):this.jumpUp(s);for(let s=1;s<=t;s++)h=i?this.jumpUp(h):this.jumpDown(h);return h}canJumpDown(s){return(s-1+10)%10}canJumpUp(s){return(s+1)%10}}const CIRCLE_LENGTH=12,TRUONG_SINH_START=40,BAC_SI_START=28,THAI_TUE_START=15,MT_TRUONG=new Map([[2,8],[3,11],[4,5],[5,8],[6,2]]),MT_BS=new Map([[0,8],[1,9],[2,11],[3,0],[4,2],[5,3],[6,5],[7,6],[8,5],[9,6]]);class CirclePlacer{hsc;constructor(s){this.hsc=s}fillGrowCircle(){let s=MT_TRUONG.get(this.hsc.cid)??0,t=40;for(let i=0;i<12;i+=1)this.hsc.addStar(s,t,PrefixArea.SmallStar),s=this.hsc.jumbByYinBoyYanGirl(s),t+=1}fillDoctorCircle(s,t){let i=MT_BS.get(s)??0,h=28;for(let s=0;s<12;s+=1)this.hsc.addStar(i,h,t),28===h&&this.hsc.addStar(i,27,t),i=this.hsc.jumbByYinBoyYanGirl(i),h+=1}fillKingCircle(s,t){let i=s,h=15;for(let s=0;s<12;s+=1)this.hsc.addStar(i,h,t),16===h&&this.hsc.addStar(i,14,t),i=this.hsc.jumbUp(i),h+=1}fillCircleSmallTime(){this.setAilPositions(),this.setMonthCanChi(),this.setLuuNguyetPositions(),this.setLuuNienPositions(),this.setLuuNguyetNPPositions()}setAilPositions(){const{dtv:s,ars:t,aIdx:i}=this.hsc;let h=s.bs.y[1],a=0;for(let s=0;s<12;s+=1)t[h].ail=a,i[`ail${a}`]=h,a=this.hsc.jumbDown(a),h=this.hsc.jumbUp(h)}setMonthCanChi(){const{dtv:s,ars:t}=this.hsc;let i=2,h=this.getNguHoDon(s.bs.y[0]);for(let s=0;s<12;s+=1)t[i].lmpt=[s+1,0,h,i,LTHG.indexOf(`${CAN[h]} ${CHI[i]}`)],h=this.hsc.canJumpUp(h),i=this.hsc.jumbUp(i)}setLuuNguyetPositions(){const{dtv:s,dtb:t,ars:i,aIdx:h}=this.hsc;let a=s.bs.y[1];a=this.hsc.idxAfterMove(a,t.ln.m,!1),a=this.hsc.idxAfterMove(a,t.ln.h+1,!0);for(let s=0;s<12;s+=1)i[a].lmpt[1]=[s+1,s],h[`lmpt${s}`]=a,a=this.hsc.jumbUp(a)}setLuuNienPositions(){const{dtv:s,dtb:t,ars:i,aIdx:h}=this.hsc,a=s.bs.y[1];let e={8:10,0:10,4:10,2:4,6:4,10:4,5:7,9:7,1:7,11:1,3:1,7:1}[t.bs.y[1]],r=t.bs.y[1];const c=this.hsc.sx>0;for(let s=0;s<12;s+=1)a===r&&(h.lynpc=e),i[e].lynp=r,r=this.hsc.jumbUp(r),e=c?this.hsc.jumbUp(e):this.hsc.jumbDown(e)}setLuuNguyetNPPositions(){const{dtv:s,dtb:t,ars:i,aIdx:h}=this.hsc;let a=h.lynpc;a=this.hsc.idxAfterMove(a,t.ln.m,!1),a=this.hsc.idxAfterMove(a,t.ln.h+1,!0);let e=this.getNguHoDon(s.bs.y[0]),r=2;for(let t=0;t<12;t+=1)i[a].lmnp=[t+1,e,r,LTHG.indexOf(`${CAN[e]} ${CHI[r]}`)],s.ln.m-1===t&&(h.lmnpc=a),a=this.hsc.jumbUp(a),e=this.hsc.canJumpUp(e),r=this.hsc.jumbUp(r)}getNguHoDon(s){return{4:6,5:8,6:0,7:2,8:4,9:6,0:8,1:0,2:2,3:4}[s]}fillCircleBigTime(){const{ars:s,aIdx:t}=this.hsc;let i=t.am;const h=this.hsc.cid;let a=this.hsc.cid;for(let e=0;e<12;e+=1){s[i].dv=a;const e=a,r=i;i=this.hsc.jumbByYinBoyYanGirl(i),a+=10,this.hsc.yeo>=e&&this.hsc.yeo<a&&(s[r].dvc=!0,this.hsc.dvidx=r),this.hsc.yeo<=h&&(s[t.am].dvc=!0,this.hsc.dvidx=t.am)}let e=this.hsc.dvidx,r=0;for(let i=0;i<AREA_NAME.length;i+=1)s[e].aid=r,t[`aid${r}`]=e,r=this.hsc.jumbDown(r),e=this.hsc.jumbUp(e)}}class StarPlacer{hsc;constructor(s){this.hsc=s}fillBigStar(){const s=[0,1,2,3,4,5];let t=0,i=0;for(let h=0;h<s.length;h+=1)if((this.hsc.dtb.ln.d+h)%this.hsc.cid==0){t=(this.hsc.dtb.ln.d+h)/this.hsc.cid,i=h;break}let h=this.hsc.idxAfterMove(2,t);h=this.hsc.idxAfterMove(h,i+1,i%2==0);const a=(s,t,i)=>{let h=s;return t.forEach((s=>{Number(s)>=0&&this.hsc.addStar(h,Number(s),PrefixArea.BigStar),h=i(h)})),h};a(h,[0,1,-1,2,3,4,-1,-1,5,-1,-1,-1],this.hsc.jumbDown.bind(this.hsc)),a({0:4,1:3,2:2,3:1,4:0,5:11,6:10,7:9,8:8,9:7,10:6,11:5}[h],[6,7,8,9,10,11,12,-1,-1,-1,13],this.hsc.jumbUp.bind(this.hsc))}fillSixAssassin(s,t){if(this.hsc.addStar(this.hsc.jumbUp(s),56,t),this.hsc.addStar(this.hsc.jumbDown(s),57,t),t!==PrefixArea.SmallStar)return;this.hsc.addStar(this.hsc.idxAfterMove(11,this.hsc.dtb.ln.h+1,!1),52,PrefixArea.SmallStar),this.hsc.addStar(this.hsc.idxAfterMove(11,this.hsc.dtb.ln.h+1,!0),53,PrefixArea.SmallStar);let i={2:1,6:1,10:1,8:2,0:2,4:2,5:3,9:3,1:3,11:9,3:9,7:9}[this.hsc.dtb.bs.y[1]],h={2:3,6:3,10:3,8:10,0:10,4:10,5:10,9:10,1:10,11:10,3:10,7:10}[this.hsc.dtb.bs.y[1]];this.hsc.istc?(i=this.hsc.idxAfterMove(i,this.hsc.dtb.ln.h+1,!0),h=this.hsc.idxAfterMove(h,this.hsc.dtb.ln.h+1,!0)):(i=this.hsc.idxAfterMove(i,this.hsc.dtb.ln.h+1,this.hsc.sx===this.hsc.adye),h=this.hsc.idxAfterMove(h,this.hsc.dtb.ln.h+1,!(this.hsc.sx===this.hsc.adye))),this.hsc.addStar(i,54,PrefixArea.SmallStar),this.hsc.addStar(h,55,PrefixArea.SmallStar)}fillSixBuffer(s,t,i=0){if(this.hsc.addStar({4:1,5:0,6:11,7:11,8:1,9:0,0:6,1:6,2:3,3:3}[s],58,t),this.hsc.addStar({4:7,5:8,6:9,7:9,8:7,9:8,0:2,1:2,2:5,3:5}[s],59,t),t!==PrefixArea.SmallStar){const i={0:[5,9],1:[6,8],2:[8,6],3:[9,5],4:[8,6],5:[9,5],6:[11,3],7:[0,2],8:[2,0],9:[3,11]};return this.hsc.addStar(i[s][0],62,t),void this.hsc.addStar(i[s][1],63,t)}const h=this.hsc.idxAfterMove(10,i+1,!1),a=this.hsc.idxAfterMove(4,i+1,!0);this.hsc.addStar(h,62,t),this.hsc.addStar(a,63,t);const e=this.hsc.idxAfterMove(4,this.hsc.dtb.ln.m,!0),r=this.hsc.idxAfterMove(10,this.hsc.dtb.ln.m,!1);this.hsc.addStar(e,60,t),this.hsc.addStar(r,61,t)}fillBig4(s,t){const i=this.hsc.HOA[s];this.hsc.addStar(this.hsc.aIdx[`s${i[TH.L]}`],64,t),this.hsc.addStar(this.hsc.aIdx[`s${i[TH.Q]}`],65,t),this.hsc.addStar(this.hsc.aIdx[`s${i[TH.Z]}`],66,t),this.hsc.addStar(this.hsc.aIdx[`s${i[TH.K]}`],67,t)}fillTuanTriet(s,t,i=PrefixArea.SmallStar){const h={4:[8,9],5:[6,7],6:[4,5],7:[2,3],8:[0,1],9:[8,9],0:[6,7],1:[4,5],2:[2,3],3:[0,1]};let a=s,e=t;for(let s=0;s<10&&4!==a;s+=1)a=this.hsc.canJumpDown(a),e=this.hsc.jumbDown(e);const r={0:[10,11],10:[8,9],8:[6,7],6:[4,5],4:[2,3],2:[0,1]}[e],c=[];c[0]=[r[0],r[1]],this.hsc.aIdx.tu=r,c[1]=h[s],this.hsc.aIdx.tr=h[s];const o=i===PrefixArea.SmallStar?0:i===PrefixArea.TenYearStar?1:2;this.hsc.ttr[o]=c}fillDargon(s=this.hsc.dtb.bs.y[1],t=PrefixArea.SmallStar){this.hsc.addStar(this.hsc.idxAfterMove(4,s+1,!0),76,t),this.hsc.addStar(this.hsc.idxAfterMove(10,s+1,!1),77,t);this.hsc.addStar({5:1,9:1,1:1,11:7,3:7,7:7,2:10,6:10,10:10,8:4,0:4,4:4}[s],78,t)}fillTangMaKhocHu(s,t){const i={5:11,9:11,1:11,11:5,3:5,7:5,2:8,6:8,10:8,8:2,0:2,4:2}[s];this.hsc.addStar(i,79,t);const h=this.hsc.idxAfterMove(6,s+1,!1);this.hsc.addStar(h,80,t);const a=this.hsc.idxAfterMove(6,s+1,!0);this.hsc.addStar(a,81,t)}fillHinhRieuHaSatToai(s=this.hsc.dtb.bs.y[0],t=this.hsc.dtb.bs.y[1],i=PrefixArea.SmallStar){this.hsc.addStar({4:9,5:10,6:7,7:8,8:5,9:6,0:4,1:3,2:11,3:2}[s],90,i);this.hsc.addStar({5:2,9:2,1:2,11:8,3:8,7:8,2:11,6:11,10:11,8:5,0:5,4:5}[t],91,i);const h={0:5,6:5,3:5,9:5,2:9,8:9,5:9,11:9,4:1,10:1,1:1,7:1}[t];if(this.hsc.addStar(h,92,i),i!==PrefixArea.SmallStar)return;this.hsc.addStar(this.hsc.idxAfterMove(9,this.hsc.dtb.ln.m,!0),87,PrefixArea.SmallStar);const a=this.hsc.idxAfterMove(1,this.hsc.dtb.ln.m,!0);this.hsc.addStar(a,88,PrefixArea.SmallStar),this.hsc.addStar(a,89,PrefixArea.SmallStar)}fillDaoHongHiCoQua(s,t){const i={5:6,9:6,1:6,11:0,3:0,7:0,2:3,6:3,10:3,8:9,0:9,4:9}[s];this.hsc.addStar(i,82,t);const h=this.hsc.idxAfterMove(3,s+1,!1);this.hsc.addStar(h,83,t);const a=this.hsc.idxAfterMove(h,7,!0);if(this.hsc.addStar(a,84,t),t!==PrefixArea.SmallStar)return;const e={11:[2,10],0:[2,10],1:[2,10],2:[5,1],3:[5,1],4:[5,1],5:[8,4],6:[8,4],7:[8,4],8:[11,7],9:[11,7],10:[11,7]},r=e[s][0];this.hsc.addStar(r,85,t);const c=e[s][1];this.hsc.addStar(c,86,t)}fillThaiCaoAnDuong(){const s=this.hsc.idxAfterMove(6,this.hsc.dtb.ln.h+1,!0);this.hsc.addStar(s,72,PrefixArea.SmallStar);const t=this.hsc.idxAfterMove(2,this.hsc.dtb.ln.h+1,!0);this.hsc.addStar(t,73,PrefixArea.SmallStar);const i=this.hsc.idxAfterMove(this.hsc.aIdx.s27,9,!0),h=this.hsc.idxAfterMove(this.hsc.aIdx.s27,8,!1);this.hsc.addStar(i,74,PrefixArea.SmallStar),this.hsc.addStar(h,75,PrefixArea.SmallStar)}fillQuangQuyThaiToa(){const s=this.hsc.dtb.ln.d;this.hsc.addStar(this.hsc.jumbDown(this.hsc.idxAfterMove(this.hsc.aIdx.s62,s,!0)),68,PrefixArea.SmallStar),this.hsc.addStar(this.hsc.jumbUp(this.hsc.idxAfterMove(this.hsc.aIdx.s63,s,!1)),69,PrefixArea.SmallStar),this.hsc.addStar(this.hsc.idxAfterMove(this.hsc.aIdx.s60,s,!0),70,PrefixArea.SmallStar),this.hsc.addStar(this.hsc.idxAfterMove(this.hsc.aIdx.s61,s,!1),71,PrefixArea.SmallStar)}fillQuanPhucNienTru(s,t){const i={4:[7,9,5,5],5:[4,8,6,6],6:[5,0,8,0],7:[2,11,9,5],8:[3,3,8,6],9:[9,2,9,8],0:[11,6,11,2],1:[9,5,0,6],2:[10,6,2,9],3:[6,5,3,10]},h=i[s][0],a=i[s][1],e=i[s][2],r=i[s][3];this.hsc.addStar(h,93,t),this.hsc.addStar(a,94,t),this.hsc.addStar(e,95,t),this.hsc.addStar(r,96,t)}fillThienNguyetDiaThanTaiTho(){this.hsc.istc||this.hsc.addStar(this.hsc.aIdx.s77,101,PrefixArea.SmallStar);const s=this.hsc.idxAfterMove(7,this.hsc.dtb.ln.m,!0);this.hsc.addStar(s,100,PrefixArea.SmallStar);const t=this.hsc.idxAfterMove(8,this.hsc.dtb.ln.m,!0);this.hsc.addStar(t,99,PrefixArea.SmallStar);const i=this.hsc.idxAfterMove(9,this.hsc.dtb.bs.y[1]+1,!0);this.hsc.addStar(i,97,PrefixArea.SmallStar);const h=this.hsc.idxAfterMove(5,this.hsc.dtb.bs.y[1]+1,!0);this.hsc.addStar(h,98,PrefixArea.SmallStar);const a=this.hsc.idxAfterMove(this.hsc.aIdx.am,this.hsc.dtb.bs.y[1]+1,!0);this.hsc.addStar(a,102,PrefixArea.SmallStar);const e=this.hsc.idxAfterMove(this.hsc.aIdx.at,this.hsc.dtb.bs.y[1]+1,!0);this.hsc.addStar(e,103,PrefixArea.SmallStar)}fillDauThuongSuLaVong(){let s=this.hsc.idxAfterMove(this.hsc.aIdx.s15,this.hsc.dtb.ln.m,!1);s=this.hsc.idxAfterMove(s,this.hsc.dtb.ln.h+1,!0),this.hsc.addStar(s,104,PrefixArea.SmallStar),this.hsc.addStar(this.hsc.aIdx.ai5,106,PrefixArea.SmallStar),this.hsc.addStar(this.hsc.aIdx.ai7,105,PrefixArea.SmallStar),this.hsc.addStar(4,107,PrefixArea.SmallStar),this.hsc.addStar(10,108,PrefixArea.SmallStar);const t={1:[2,6,9,10],2:[0,8,7,0],3:[10,10,5,2],4:[8,0,3,4],5:[6,2,1,6],6:[4,4,11,8],7:[2,6,9,10],8:[0,8,7,0],9:[10,10,5,2],10:[8,0,3,4],11:[6,2,1,6],12:[4,4,11,8]};this.hsc.addStar(t[this.hsc.dtb.ln.m][0],122,PrefixArea.SmallStar),this.hsc.addStar(t[this.hsc.dtb.ln.m][1],123,PrefixArea.SmallStar),this.hsc.addStar(t[this.hsc.dtb.ln.m][2],124,PrefixArea.SmallStar),this.hsc.addStar(t[this.hsc.dtb.ln.m][3],125,PrefixArea.SmallStar)}fillTuViTrungChauPhai(){const s=this.hsc.idxAfterMove(10,this.hsc.dtb.bs.y[1]+1,!1);this.hsc.addStar(s,118,PrefixArea.SmallStar);const t={1:8,2:8,3:10,4:10,5:0,6:0,7:2,8:2,9:4,10:4,11:6,12:6}[this.hsc.dtb.ln.m];this.hsc.addStar(t,119,PrefixArea.SmallStar);const i={1:5,5:5,9:5,2:8,6:8,10:8,3:2,7:2,11:2,4:11,8:11,12:11}[this.hsc.dtb.ln.m];this.hsc.addStar(i,120,PrefixArea.SmallStar);const h={1:10,2:5,3:4,4:2,5:7,6:3,7:11,8:7,9:2,10:6,11:10,12:2}[this.hsc.dtb.ln.m];this.hsc.addStar(h,121,PrefixArea.SmallStar);let a={8:0,0:0,4:0,2:6,6:6,10:6,11:3,3:3,7:3,5:9,9:9,1:9}[this.hsc.dtb.bs.y[1]];const e=[109,110,111,112,-1,-1,113,114,115,-1,116,117];for(let s=0;s<e.length;s+=1)e[s]>0&&this.hsc.addStar(a,e[s],PrefixArea.SmallStar),a=this.hsc.jumbUp(a)}}class ZoneBuilder{hsc;constructor(s){this.hsc=s}buildZoneName(){let s=this.hsc.idxAfterMove(2,this.hsc.dtb.ln.m);const t=this.hsc.idxAfterMove(s,this.hsc.dtb.ln.h+1);this.hsc.aIdx.at=t,s=this.hsc.idxAfterMove(s,this.hsc.dtb.ln.h+1,!1),this.hsc.aIdx.am=s;let i=0;for(let t=0;t<12;t+=1){const t={ai:i,ci:s,cn:-1,na:-1,sb:[],ss:[],sv:[],sy:[],sm:[],sd:[],lmnp:[],lynp:0,lmpt:[],aid:0,dv:0,cni:[[],[],[],[]],cnw:[[],[],[],[]],cno:[],th1:[[0,0,0],[],[],[0,0]],ys:[],que:[],stlk:[],zolk:[]};this.hsc.ars[s]=t,this.hsc.aIdx[`ai${i}`]=s,i=this.hsc.jumbDown(i),s=this.hsc.jumbUp(s)}let h=0,a=2;for(;h<12;){const s=this.hsc.dtb.m12[h][0];this.hsc.ars[a].cn=s,this.hsc.ars[a].na=LTHG.indexOf(`${CAN[s]} ${CHI[a]}`),h+=1,a=this.hsc.jumbUp(a)}this.hsc.am=this.hsc.aIdx.am,this.hsc.at=this.hsc.aIdx.at,this.hsc.cid=LTHG_HH[this.hsc.ars[this.hsc.aIdx.am].na],1===this.hsc.cfg[CfgValue.tcpb]&&(this.hsc.cid=LTHG_HH[this.hsc.ars[this.hsc.aIdx.at].na]),2===this.hsc.cfg[CfgValue.tcpb]&&(this.hsc.cid=LTHG_HH[this.hsc.ars[this.hsc.aIdx.ai10].na]),this.hsc.adme=CHI_AD[this.hsc.ars[this.hsc.aIdx.am].ci];const e=1===this.hsc.adme?1:-1;this.hsc.adye=CHI_AD[this.hsc.dtb.bs.y[1]],this.hsc.adyetk=CHI_AD[this.hsc.dtb.tk.y[1]];const r=1===this.hsc.adye?1:-1;this.hsc.ad=e*r>0?1:0}fillBaseMenhThan(){this.hsc.mctc={0:[8,55],1:[9,10],2:[27,11],3:[63,4],4:[5,62],5:[3,1],6:[13,54],7:[3,10],8:[5,11],9:[63,4],10:[27,62],11:[9,1]}[this.hsc.dtb.bs.y[1]]}fillPhiHoa(){for(let s=0;s<=11;s+=1){const t=this.hsc.HOA[this.hsc.ars[s].cn];this.hsc.ars[s].cno=[this.hsc.aIdx[`s${t[TH.L]}`],this.hsc.aIdx[`s${t[TH.Q]}`],this.hsc.aIdx[`s${t[TH.Z]}`],this.hsc.aIdx[`s${t[TH.K]}`]];for(let t=0;t<=11;t+=1){const i=this.hsc.HOA[this.hsc.ars[t].cn];for(let h=0;h<4;h+=1)this.hsc.aIdx[`s${i[h]}`]===s&&(this.hsc.ars[s].cni[h].push(t),this.hsc.ars[s].cnw[h].push(i[h]))}}this.setLocKiStatic();const s=[[],[],[],[],[],[],[],[],[],[],[],[]],t=[[],[],[],[],[],[],[],[],[],[],[],[]],i=[[[],[],[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[],[],[]]];for(let h=0;h<12;h+=1){this.hsc.countLoop=0,this.countMoveKi(h),this.hsc.countLoop=0,this.countMoveLoc(h),this.hsc.countLoop=0;const a=this.checkTuanHoan(3,h);this.checkPeriodicRepetition(a)&&(s[h]=this.getUniquePeriodicElements(a)),this.hsc.countLoop=0;const e=this.checkTuanHoan(0,h);this.checkPeriodicRepetition(e)&&(t[h]=this.getUniquePeriodicElements(e));for(let s=0;s<4;s++){this.hsc.countLoop=0;const t=this.checkTuanHoanPT(s,h);this.checkPeriodicRepetition(t)&&(i[s][h]=this.getUniquePeriodicElements(t))}}this.hsc.loopLP[TH.L]=this.getUniqueRepresentatives(t),this.hsc.loopLP[TH.K]=this.getUniqueRepresentatives(s);for(let s=0;s<4;s++)this.hsc.loopPT[s]=this.getUniqueRepresentatives(i[s]);this.hsc.loopLP[TH.L].length>0&&this.hsc.loopLP[TH.L].forEach(((s,t)=>{s.length>0&&!this.isTuanHoanLocLuongPhai(s)&&(this.hsc.loopLP[TH.L][t]=[])})),this.addBatQuai()}isTuanHoanLocLuongPhai(s){let t=!0;return s.forEach(((i,h)=>{const a=i;let e=h+1;e>s.length-1&&(e=0);const r=s[e];if(this.hsc.ars[a].cno[TH.K]!==r)return t=!1,!1;const c=this.hsc.HOA[this.hsc.ars[a].cn][3];return 0===this.hsc.ars[r].stlk[c][StlkName.isMoveLoc]?(t=!1,!1):void 0})),t}arraysEqual(s,t){return JSON.stringify(s)===JSON.stringify(t)}rotateArray(s,t){return[...s.slice(t,s.length),...s.slice(0,t)]}getUniqueRepresentatives(s){const t=[],i=Array(s.length).fill(!1);for(let h=0;h<s.length;h++){if(i[h]||0===s[h].length)continue;const a=s[h];i[h]=!0;for(let t=h+1;t<s.length;t++)if(0!==s[t].length)for(let h=0;h<s[t].length;h++)if(this.arraysEqual(this.rotateArray(s[t],h),a)){i[t]=!0;break}t.push(a)}return t}listStarHoaInZone(s){const t=[],i=this.hsc.ars[s],h=i.ss.filter((s=>[60,61,62,63].includes(s)));return i.sb.concat(h).forEach((s=>{this.hsc.str2u.includes(s)&&t.push({ids:s,vl:this.hsc.str2hc[s]})})),t}isNienLoc(s){return this.hsc.aIdx.s64===s}isNienKi(s){return this.hsc.aIdx.s67===s}isMenhLocNienLoc(s){const t=this.hsc.aIdx.s64,i=this.hsc.ars[this.hsc.am].cno[TH.L];return t===s||i===s}isMenhKiNienKi(s){const t=this.hsc.aIdx.s67,i=this.hsc.ars[this.hsc.am].cno[TH.K];return t===s||i===s}isMenhKi(s){return this.hsc.ars[this.hsc.am].cno[TH.K]===s}setLocKiStatic(){for(let s=0;s<12;s+=1){let t=0,i=0,h=0;t+=this.isNienLoc(s)?1:0,h+=this.isNienKi(s)?1:0;let a=this.isMenhLocNienLoc(s)?1:0,e=this.isMenhLocNienLoc(s)?1:0,r=this.isMenhKiNienKi(s)?1:0;const c=this.hsc.ars[s].cno[TH.K]===s,o=this.hsc.ars[s].cno[TH.L]===s,n=this.listStarHoaInZone(s);n.length<=0?(this.hsc.ars[s].zolk[TH.L]=[0,-1,0,0,0,0],this.hsc.ars[s].zolk[TH.K]=[0,-1,0]):(n.forEach((a=>{const e=this.hsc.ars[s].cnw,r=e[TH.L].filter((s=>s===a.ids)).length,o=e[TH.K].filter((s=>s===a.ids)).length;if(r>0||o>0){let e=0;this.hsc.ars[s].stlk[a.ids]=[0,0,0,0,0,0,0],this.hsc.ars[s].stlk[a.ids][StlkName.numLoc]=r,this.hsc.ars[s].stlk[a.ids][StlkName.numKi]=o,this.hsc.ars[s].stlk[a.ids][StlkName.currentLoc]=r,this.hsc.ars[s].stlk[a.ids][StlkName.isMoveLoc]=c?0:r>=2?1:0,this.hsc.ars[s].stlk[a.ids][StlkName.isMoveKi]=c?0:o>=2?1:0,this.hsc.ars[s].stlk[a.ids][StlkName.isTruyLoc]=0,this.hsc.ars[s].stlk[a.ids][StlkName.isTruyKi]=0,e=c?r:r>=2?0:r,i+=e,t+=r,h+=o}})),a=o?1:a,e=o?1:e,a=this.checkMoveLoc(a,t,s),e=this.checkMoveAll(e,s,a),r=this.checkMoveKi(r,h),a=c?0:a,e=c?0:e,r=c?0:r,this.updateZoneLocKi(s,a,t,i,e,r,h))}this.truyLocKi(),this.countKiStatic()}checkMoveLoc(s,t,i){if(0===s){const h=this.hsc.ars[i].stlk.some((s=>1===s[StlkName.isMoveLoc]));s=t>=2&&h?1:s}return s}checkMoveAll(s,t,i){return 0===s&&1===this.hsc.ars[t].stlk.length&&1===i&&(s=1),s}checkMoveKi(s,t){return 0===s&&t>=2?1:s}updateZoneLocKi(s,t,i,h,a,e,r){this.hsc.ars[s].zolk[TH.L]=[0,0,0,0,0,0,0],this.hsc.ars[s].zolk[TH.L][ZolkName.isMoveLoc]=t,this.hsc.ars[s].zolk[TH.L][ZolkName.totalLoc]=i,this.hsc.ars[s].zolk[TH.L][ZolkName.currentLoc]=i,this.hsc.ars[s].zolk[TH.L][ZolkName.isMoveAllLoc]=a,this.hsc.ars[s].zolk[TH.L][ZolkName.locKeep]=1===a?0:h,this.hsc.ars[s].zolk[TH.L][ZolkName.isMoveNienLoc]=this.isNienLoc(s)?1:0,this.hsc.ars[s].zolk[TH.K]=[0,0,0,0,0,0,0],this.hsc.ars[s].zolk[TH.K][ZolkName.isMoveKi]=e,this.hsc.ars[s].zolk[TH.K][ZolkName.totalKi]=r,this.hsc.ars[s].zolk[TH.K][ZolkName.currentKi]=0}checkZoneTruyLoc(s){const t=this.hsc.ars[s].cno[TH.K]===s;if(!t){const t=this.hsc.ars[s].zolk[TH.L][ZolkName.isMoveAllLoc];let i=0;this.hsc.ars[s].stlk.forEach(((h,a)=>{1===t&&h[StlkName.currentLoc]>0&&0===h[StlkName.isMoveLoc]?(this.hsc.ars[s].stlk[a][StlkName.isMoveLoc]=1,this.hsc.ars[s].zolk[TH.L][ZolkName.isMoveLoc]=1):h[StlkName.currentLoc]>0&&0===h[StlkName.isMoveLoc]&&h[StlkName.numKi]>0&&h[StlkName.numLoc]>0&&this.hsc.ars[s].cni[3].forEach(((t,i)=>{if(this.hsc.ars[s].cnw[3][i]===a){this.hsc.ars[t].zolk[TH.L][ZolkName.isMoveLoc]>0&&(this.hsc.ars[s].zolk[TH.L][ZolkName.isMoveLoc]=1,this.hsc.ars[s].stlk[a][StlkName.isMoveLoc]=1,this.hsc.ars[s].stlk[a][StlkName.isTruyLoc]=1)}})),i+=h[StlkName.currentLoc]})),this.hsc.ars[s].zolk[TH.L][ZolkName.currentLoc]=i}t||1!==this.hsc.ars[s].stlk.length||1!==this.hsc.ars[s].zolk[TH.L][ZolkName.isMoveLoc]||(this.hsc.ars[s].zolk[TH.L][ZolkName.isMoveAllLoc]=1)}checkZoneTruyKi(s){const t=this.hsc.ars[s].cno[TH.K]===s;let i=0;this.hsc.ars[s].cni[TH.K].forEach((s=>{1!==this.hsc.ars[s].zolk[TH.K][ZolkName.isMoveKi]||t||(i+=1)})),1!==this.hsc.ars[s].zolk[TH.K][ZolkName.isMoveKi]||i!==this.hsc.ars[s].cni[TH.K].length||this.isMenhKiNienKi(s)||(this.hsc.ars[s].zolk[TH.K][ZolkName.isMoveKi]=0),0===this.hsc.ars[s].zolk[TH.K][ZolkName.isMoveKi]&&this.hsc.ars[s].cni[TH.K].length>1&&i<this.hsc.ars[s].cni[TH.K].length&&!t&&(this.hsc.ars[s].zolk[TH.K][ZolkName.isMoveKi]=1)}truyLocKi(){for(let s=0;s<12;s+=1)this.checkZoneTruyLoc(s),this.checkZoneTruyKi(s)}countKiStatic(){for(let s=0;s<12;s++){let t=0;this.isNienKi(s)&&t++,this.hsc.ars[s].cni[TH.K].forEach((i=>{(0===this.hsc.ars[i].zolk[TH.K][ZolkName.isMoveKi]||this.isMenhKi(s)&&1===this.hsc.ars[i].zolk[TH.K][ZolkName.isMoveKi])&&t++})),this.hsc.ars[s].zolk[TH.K][ZolkName.currentKi]=t}}countMoveKi(s){if(this.hsc.countLoop>=11)return;const t=this.hsc.ars[s].zolk[TH.K];if(this.hsc.ars[s].cno[TH.K]!==s&&-1!==t[ZolkName.totalKi]&&(this.hsc.countLoop+=1,this.isZoneMove2(s))){const i=this.hsc.ars[s].cno[TH.K],h=this.hsc.ars[i].zolk[TH.K],a=t[ZolkName.currentKi],e=h[ZolkName.currentKi];h[ZolkName.currentKi]=e+a,t[ZolkName.currentKi]=0,this.isZoneMove2(i)&&this.countMoveKi(i)}}countMoveLoc(s){if(this.hsc.countLoop>=11)return;const t=this.hsc.ars[s].zolk[TH.L];if(-1===t[ZolkName.totalLoc])return;if(this.hsc.ars[s].cno[TH.K]===s)return;this.hsc.countLoop+=1;const i=this.hsc.ars[s].stlk;let h=0;i.forEach(((i,a)=>{const e=i[StlkName.currentLoc],r=i[StlkName.isMoveLoc];(1===t[ZolkName.isMoveAllLoc]&&e>0||e>0&&1===r)&&(h+=e,t[ZolkName.currentLoc]-=e,this.hsc.ars[s].stlk[a][StlkName.currentLoc]=0)})),this.isNienLoc(s)&&1===t[ZolkName.isMoveNienLoc]&&(h+=1,t[ZolkName.isMoveNienLoc]=0);const a=this.hsc.ars[s].cno[TH.K],e=this.hsc.ars[s].cn,r=this.hsc.HOA[e][TH.K],c=this.hsc.ars[a].zolk[TH.L],o=this.hsc.ars[a].stlk[r];c[ZolkName.currentLoc]+=h,o[StlkName.currentLoc]+=h,this.checkZoneTruyLoc(a),this.isZoneMove2(a,0)&&this.countMoveLoc(a)}checkTuanHoan(s,t,i=[]){let h=i;if(this.hsc.countLoop>=24)return h;if(this.hsc.countLoop+=1,this.isZoneMove2(t,s)){h.push(t);const i=this.hsc.ars[t].cno[TH.K];this.isZoneMove2(i,s)?h=this.checkTuanHoan(s,i,h):h.push(i)}return h}checkTuanHoanPT(s,t,i=[]){let h=i;if(this.hsc.countLoop>=12||this.hsc.ars[t].cno[s]===t)return h;this.hsc.countLoop+=1,h.push(t);const a=this.hsc.ars[t].cno[s];return a===t?(h.push(t),h):(h=this.checkTuanHoanPT(s,a,h),h)}isZoneMove2(s,t=3){return 0===t?1===this.hsc.ars[s].zolk[TH.L][ZolkName.isMoveLoc]:1===this.hsc.ars[s].zolk[TH.K][ZolkName.isMoveKi]}checkPeriodicRepetition(s){const t=s.length;for(let i=1;i<=t/2;i++){let h=!0;for(let a=0;a<t;a++)if(s[a]!==s[a%i]){h=!1;break}if(h)return!0}return!1}getUniquePeriodicElements(s){for(let t=1;t<=s.length/2;t++){const i=s.slice(0,t),h=Array(Math.ceil(s.length/t)).fill(i).flat().slice(0,s.length);if(JSON.stringify(h)===JSON.stringify(s))return[...new Set(i)]}return[]}isExitQueByCung(s,t){const i=this.hsc.ars[s].que;let h=!1;return i.forEach((s=>{if(t===s[0])return h=!0,h})),h}addBatQuai(){const s=[this.hsc.aIdx.s64,this.hsc.aIdx.s65,this.hsc.aIdx.s66,this.hsc.aIdx.s67];for(let t=0;t<4;t+=1){const i=t,h=s[t],a=this.hsc.ars[h];a.cno.forEach(((s,e)=>{if(s===h){const s=e;a.cni.forEach(((a,r)=>{for(let c=0;c<a.length;c+=1){const o=a[c];if(o===h&&r===e)continue;const n=hoa2IchingIdx([i,s,r]);this.isExitQueByCung(o,n)||this.hsc.ars[o].que.push([n,[t,e,r],[h,h,o]])}}))}}));const e=xtngl[h].x;a.cno.forEach(((s,r)=>{if(s===e){const s=r;this.hsc.ars[e].cni.forEach(((a,c)=>{for(let o=0;o<a.length;o+=1){const n=a[o];if(n===h&&c===r)continue;const l=hoa2IchingIdx([i,s,c]);this.isExitQueByCung(n,l)||this.hsc.ars[n].que.push([l,[t,r,c],[h,e,n]])}})),a.cni.forEach(((a,e)=>{for(let c=0;c<a.length;c+=1){const o=a[c];if(o===h)continue;const n=hoa2IchingIdx([i,s,e]);this.isExitQueByCung(o,n)||this.hsc.ars[o].que.push([n,[t,r,e],[h,h,o]])}}))}}));this.hsc.ars[e].cno.forEach(((s,r)=>{if(s===h){const s=r;this.hsc.ars[e].cni.forEach(((a,c)=>{for(let o=0;o<a.length;o+=1){const n=a[o],l=hoa2IchingIdx([i,s,c]);this.isExitQueByCung(n,l)||this.hsc.ars[n].que.push([l,[t,r,c],[h,e,n]])}})),a.cni.forEach(((a,c)=>{for(let o=0;o<a.length;o+=1){const n=a[o];if(n===e&&c===r)continue;if(n===h)continue;const l=hoa2IchingIdx([i,s,c]);this.isExitQueByCung(n,l)||this.hsc.ars[n].que.push([l,[t,r,c],[h,h,n]])}}))}}))}}}var PrefixArea=(s=>(s.BigStar="sb",s.SmallStar="ss",s.YearStar="sy",s.MonthStar="sm",s.DayStar="sd",s.TenYearStar="sv",s))(PrefixArea||{});class HoroscopeBuild{search;cid=2;at=1;am=1;yeo=1;dtb;dtv;dtc;aIdx={};adye=1;adyetk=1;adme=1;ad=1;sx=1;ttr={0:[],1:[],2:[]};ars=[];sks=5;istc=!1;tpCan=0;cfg=[...configDefault];dvidx=0;idxCheckZone=0;mctc=[];cach={};rad=0;tutru={cot:[{cht:-1,cn:-1,ci:-1,ctg:[],pht:[],tsctg:[],ts:-1,na:-1},{cht:-1,cn:-1,ci:-1,ctg:[],pht:[],tsctg:[],ts:-1,na:-1},{cht:-1,cn:-1,ci:-1,ctg:[],pht:[],tsctg:[],ts:-1,na:-1},{cht:-1,cn:-1,ci:-1,ctg:[],pht:[],tsctg:[],ts:-1,na:-1}],dv:[],dvt:[]};starPlacer;circlePlacer;zoneBuilder;calculationHelper;arrIdxChuyenLoc=[];str2hc={};str2u=[];arrCkZone=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]];loopLP=[[],[],[],[]];loopPT=[[],[],[],[]];countLoop=0;HOA=CAN_HOA;numberStarCol1=[0,0,0,0,0,0,0,0,0,0,0,0];numberStarCol2=[0,0,0,0,0,0,0,0,0,0,0,0];css=0;constructor(s){s&&s.cfg&&Object.assign(this.cfg,s.cfg);const t=dayjs(),i=convertSolar2Lunar(t.year(),t.month()+1,t.date(),t.hour(),t.minute());this.dtc=buildDateInfo(i);const h=convertSolar2Lunar(s.born.year(),s.born.month()+1,s.born.date(),s.born.hour(),s.born.minute());this.dtb=buildDateInfo(h),this.dtv=this.dtc,void 0!==s.view&&(this.dtv=buildDateInfo(convertSolar2Lunar(s.view.year(),s.view.month()+1,s.view.date(),s.view.hour(),s.view.minute()))),this.yeo=this.dtv.sn.y-this.dtb.sn.y+1,this.sx=s.sex,this.istc=[6,7,8].includes(this.cfg[CfgValue.typeLs]),this.HOA=GETHOA(this.cfg[CfgValue.lsCanType]),this.istc||(this.cfg[CfgValue.tcpb]=0),this.str2hc=StarToHoaCan(this.HOA),this.str2u=StarUseHoa(this.HOA),this.starPlacer=new StarPlacer(this),this.circlePlacer=new CirclePlacer(this),this.zoneBuilder=new ZoneBuilder(this),this.calculationHelper=new CalculationHelper,this.initializeHoroscope()}removePrivateProperties(){delete this.starPlacer,delete this.circlePlacer,delete this.zoneBuilder,delete this.calculationHelper,this.arrIdxChuyenLoc=[],this.str2hc={},this.str2u=[],this.arrCkZone=[],this.countLoop=0,this.HOA={},this.numberStarCol1=[],this.numberStarCol2=[],this.idxCheckZone=0,this.tpCan=0,this.adyetk=1,delete this.dtc}initializeHoroscope(){this.zoneBuilder.buildZoneName(),this.starPlacer.fillBigStar();const s=this.dtb.bs.y[0];this.starPlacer.fillSixAssassin([8,9,11,0,2,3,5,6,5,6][s],"ss"),this.starPlacer.fillSixBuffer(this.dtb.bs.y[0],"ss",this.dtb.ln.h),this.starPlacer.fillBig4(this.dtb.bs.y[0],"ss"),this.circlePlacer.fillKingCircle(this.dtb.bs.y[1],"ss"),this.circlePlacer.fillDoctorCircle(this.dtb.bs.y[0],"ss"),this.circlePlacer.fillGrowCircle(),this.starPlacer.fillTuanTriet(this.dtb.bs.y[0],this.dtb.bs.y[1]),this.starPlacer.fillQuangQuyThaiToa(),this.starPlacer.fillThaiCaoAnDuong(),this.starPlacer.fillDargon(),this.starPlacer.fillTangMaKhocHu(this.dtb.bs.y[1],"ss"),this.starPlacer.fillHinhRieuHaSatToai(),this.starPlacer.fillDaoHongHiCoQua(this.dtb.bs.y[1],"ss"),this.starPlacer.fillQuanPhucNienTru(this.dtb.bs.y[0],"ss"),this.starPlacer.fillThienNguyetDiaThanTaiTho(),this.starPlacer.fillDauThuongSuLaVong(),this.skyAreaSK(),this.istc&&this.starPlacer.fillTuViTrungChauPhai(),this.circlePlacer.fillCircleBigTime(),this.circlePlacer.fillCircleSmallTime(),this.fillStarRepeatByLoop(),this.addAgeToAreas(),this.zoneBuilder.fillBaseMenhThan(),this.zoneBuilder.fillPhiHoa(),this.tuTruBuildBigTime(),this.tuTruBuildCot(0,this.dtb.tk.y,this.dtb.tk.d),this.tuTruBuildCot(1,this.dtb.tk.m,this.dtb.tk.d),this.tuTruBuildCot(2,this.dtb.tk.d,this.dtb.tk.d,!0),this.tuTruBuildCot(3,this.dtb.tk.h,this.dtb.tk.d),this.css=Math.max(Math.max(...this.numberStarCol1),Math.max(...this.numberStarCol2))}addStar(s,t,i){if("sb"!==i&&"ss"!==i&&void 0!==SM[t][`is${i}`]&&!1===SM[t][`is${i}`])return;this.ars[s][i].push(t);const h=this.ars[s][i];switch(h.sort(((s,t)=>1===SM[s].zone&&1!==SM[t].zone||3===SM[s].zone&&1!==SM[t].zone&&3!==SM[t].zone?-1:1)),this.ars[s][i]=h,i){case"sb":case"ss":this.aIdx[`s${t}`]=s;break;default:this.aIdx[`${i}${t}`]=s}const a="sb"!==i&&"ss"!==i;if(("ss"===i||"sv"===i&&1===this.cfg[CfgValue.dvStar]&&![64,65,66,67].includes(t)||"sy"===i&&this.cfg[CfgValue.currentStar]>0&&![64,65,66,67].includes(t))&&t>13){const h=SM[t];if(void 0===h.cir||"vts"!==h.cir){const e=this.cfg[CfgValue.showHideStar];if(e>0&&!a){if(1===e&&!STARSTRONG.includes(t))return;if(2===e&&!STARSTRONG.includes(t)&&!STAR_SIGN.includes(t))return;if(3===e&&!STARSTRONG.includes(t)&&!STAR_SIGN.includes(t)&&!CR_TS.includes(t))return;if(!(4!==e||STARSTRONG.includes(t)||STAR_SIGN.includes(t)||CR_TS.includes(t)||FAILURE6.includes(t)))return}const r=1===this.cfg[CfgValue.dvStar],c=this.cfg[CfgValue.currentStar]>0;if("sv"===i&&!r||"sy"===i&&!c)return;1===h.typ&&(this.numberStarCol1[s]+=1),2===h.typ&&(this.numberStarCol2[s]+=1)}}}jumbDown(s){return this.calculationHelper.jumpDown(s)}jumbUp(s){return this.calculationHelper.jumpUp(s)}jumbByYinBoyYanGirl(s){return this.sx===this.adye?this.jumbUp(s):this.jumbDown(s)}jumbByYinBoyYanGirlTietKhi(s){return this.sx===this.adyetk?this.jumbUp(s):this.jumbDown(s)}idxAfterMove(s,t,i=!0){return this.calculationHelper.idxAfterMove(s,t,i)}canJumpDown(s){return this.calculationHelper.canJumpDown(s)}canJumpUp(s){return this.calculationHelper.canJumpUp(s)}canJumbByYinBoyYanGirl(s){return this.sx===this.adye?this.canJumpUp(s):this.canJumpDown(s)}canJumbByYinBoyYanGirlTietKhi(s){return this.sx===this.adyetk?this.canJumpUp(s):this.canJumpDown(s)}skyAreaSK(){this.sks={2:{2:5,3:4,4:3,6:6,5:7},3:{3:5,6:4,2:3,5:6,4:7},4:{4:5,2:4,5:3,3:6,6:7},5:{5:5,4:4,6:3,2:6,3:7},6:{6:5,5:4,3:3,4:6,2:7}}[LTHG_HH[this.dtb.bs.y[2]]][LTHG_HH[this.ars[this.aIdx.am].na]]}fillStarRepeatByLoop(){const s=this.aIdx[`aid${this.idxCheckZone}`],t=this.ars[s].cn;this.addStar([8,9,11,0,2,3,5,6,5,6][t],27,"sv"),this.starPlacer.fillSixAssassin(this.aIdx.sv27,"sv"),this.starPlacer.fillSixBuffer(t,"sv"),this.starPlacer.fillBig4(t,"sv"),this.circlePlacer.fillKingCircle(this.dtv.bs.y[1],"sy"),this.circlePlacer.fillDoctorCircle(this.dtv.bs.y[0],"sy"),this.starPlacer.fillSixAssassin(this.aIdx.sy27,"sy"),this.starPlacer.fillSixBuffer(this.dtv.bs.y[0],"sy"),this.starPlacer.fillBig4(this.dtv.bs.y[0],"sy"),this.starPlacer.fillTangMaKhocHu(this.dtv.bs.y[1],"sy"),this.starPlacer.fillHinhRieuHaSatToai(this.dtv.bs.y[0],this.dtv.bs.y[1],"sy"),this.starPlacer.fillDaoHongHiCoQua(this.dtv.bs.y[1],"sy"),this.starPlacer.fillDargon(this.dtv.bs.y[1],"sy"),this.starPlacer.fillTuanTriet(this.dtv.bs.y[0],this.dtv.bs.y[1],"sy")}addAgeToAreas(){let s=this.dtb.bs.y[1],t=0;for(let i=1;i<=84;i+=1){const i=t+this.dtb.ln.y;if(i>2099)break;const h=buildDateInfo(convertSolar2Lunar(i,6,6,6,6));this.ars[s].ys.push([t+1,i,h.bs.y[2],h.bs.y[0]]),s=this.jumbUp(s),t+=1}}tuTruBuildBigTime(){const s=dayjs(this.dtb.sn.y+"-"+this.dtb.sn.m+"-"+this.dtb.sn.d+" "+this.dtb.sn.h+":"+this.dtb.sn.i),t=this.dtb.tki,i=this.sx===this.adyetk;let h,a;i?(h=dayjs(t[4]),a=h.diff(s,"day",!0)):(h=dayjs(t[3]),a=s.diff(h,"day",!0));const e=Number(a.toFixed(10)),r=Math.floor(e),c=24*(e-r),o=Math.ceil(c),n=e/3,l=Math.floor(n),d=365*(n-l)/30,u=Math.floor(d),S=30*(d-u),f=Math.floor(S);let m=s.add(l,"year").add(u,"month").add(f,"day"),x=this.dtb.tk.m[0],T=this.dtb.tk.m[1];for(let s=0;s<10;s++)x=this.canJumbByYinBoyYanGirlTietKhi(x),T=this.jumbByYinBoyYanGirlTietKhi(T),this.tutru.dv.push([x,T,m.unix()]),m=m.add(10,"year");this.tutru.dvt=[i,r,o,l,u,f]}tuTruBuildCot(s,t,i,h=!1){const a=i[0];this.tutru.cot[s].cht=h?-1:idxTHAP(a,t[0]),this.tutru.cot[s].cn=t[0],this.tutru.cot[s].ci=t[1];const e=CHI_CAN[t[1]];this.tutru.cot[s].ctg=e;const r=[];e.forEach(((s,t)=>{r[t]=idxTHAP(a,s)})),this.tutru.cot[s].pht=r,this.tutru.cot[s].ts=idxTSTutru(i[0],t[1]),this.tutru.cot[s].na=t[2]}}class HoroHelp{ls;aIdx;mIdx;diaban;constructor(s){this.ls=s,this.diaban=s.ars,this.aIdx=s.aIdx,this.mIdx=s.am}tuChinh(s){return[s,xtngl[s].x,xtngl[s].t[0],xtngl[s].t[1]]}tamPhuong(s){return[s,xtngl[s].t[0],xtngl[s].t[1]]}xungChieu(s){return[xtngl[s].x]}giapCung(s){return[xtngl[s].g[0],xtngl[s].g[1]]}isGiap(s,t){return this.giapCung(t).includes(this.aIdx[`s${s}`])}isXung(s,t){return this.xungChieu(t).includes(this.aIdx[`s${s}`])}isStar4(s,t){return this.tuChinh(t).includes(this.aIdx[`s${s}`])}isStar3(s,t){return this.tamPhuong(t).includes(this.aIdx[`s${s}`])}isStar(s,t){return this.aIdx[`s${s}`]===t}isKo(s,t=0){return 3===t?this.isStar3(52,s):4===t?this.isStar4(52,s):this.isStar(52,s)}isKiep(s,t=0){return 3===t?this.isStar3(53,s):4===t?this.isStar4(53,s):this.isStar(53,s)}isKoKiep(s,t=0){return this.isKo(s,t)||this.isKiep(s,t)}isHoa(s,t=0){return 3===t?this.isStar3(54,s):4===t?this.isStar4(54,s):this.isStar(54,s)}isLinh(s,t=0){return 3===t?this.isStar3(55,s):4===t?this.isStar4(55,s):this.isStar(55,s)}isHoaLinh(s,t=0){return this.isHoa(s,t)||this.isLinh(s,t)}isKinh(s,t=0){return 3===t?this.isStar3(56,s):4===t?this.isStar4(56,s):this.isStar(56,s)}isDa(s,t=0){return 3===t?this.isStar3(57,s):4===t?this.isStar4(57,s):this.isStar(57,s)}isKinhDa(s,t=0){return this.isKinh(s,t)||this.isDa(s,t)}isLucSatTinh(s,t=0){return this.isKoKiep(s,t)||this.isKinhDa(s,t)||this.isHoaLinh(s,t)}isKhoi(s,t=0){return 3===t?this.isStar3(58,s):4===t?this.isStar4(58,s):this.isStar(58,s)}isViet(s,t=0){return 3===t?this.isStar3(59,s):4===t?this.isStar4(59,s):this.isStar(59,s)}isKhoiViet(s,t=0){return this.isKhoi(s,t)||this.isViet(s,t)}isTa(s,t=0){return 3===t?this.isStar3(60,s):4===t?this.isStar4(60,s):this.isStar(60,s)}isHuu(s,t=0){return 3===t?this.isStar3(61,s):4===t?this.isStar4(61,s):this.isStar(61,s)}isTaHuu(s,t=0){return this.isTa(s,t)||this.isHuu(s,t)}isXuong(s,t=0){return 3===t?this.isStar3(62,s):4===t?this.isStar4(62,s):this.isStar(62,s)}isKhuc(s,t=0){return 3===t?this.isStar3(63,s):4===t?this.isStar4(63,s):this.isStar(63,s)}isXuongKhuc(s,t=0){return this.isXuong(s,t)||this.isKhuc(s,t)}isGiapKhoi(s){return this.isGiap(58,s)}isGiapViet(s){return this.isGiap(59,s)}isGiapTa(s){return this.isGiap(60,s)}isGiapHuu(s){return this.isGiap(61,s)}isGiapXuong(s){return this.isGiap(62,s)}isGiapKhuc(s){return this.isGiap(63,s)}isTangTueDieu(s){return this.isStar(17,s)||this.isStar(21,s)||this.isStar(25,s)}isThaiTueCircle(s){return this.isStar(15,s)||this.isStar(23,s)||this.isStar(19,s)}isLocTonCircle(s){return this.isStar(27,s)||this.isStar(32,s)||this.isStar(74,s)}isTruongSinhCircle(s){return this.isStar(40,s)||this.isStar(44,s)||this.isStar(48,s)}isTuanChieu(s){return this.isTuan(this.xungChieu(s)[0])}isTrietChieu(s){return this.isTriet(this.xungChieu(s)[0])}isTuan(s){return this.ls.ttr[0].includes(s)}isTriet(s){return this.ls.ttr[1].includes(s)}}let horoHelp;function checkCachCuc(s){const t=s.am,i=s.ars[t];if(horoHelp.isStar3(0,t)&&[0,2,4,6,8,10].includes(t))return 2;if(horoHelp.isStar3(12,t)&&horoHelp.isStar3(13,t)&&horoHelp.isStar3(8,t))return 3;if(0===i.sb.length)return 4;if(horoHelp.isStar4(2,t)||horoHelp.isStar4(7,t))return 5;return[5,9,1,11,3,7].includes(t)&&horoHelp.isStar3(6,t)&&horoHelp.isStar3(10,t)?6:horoHelp.isStar3(1,t)&&horoHelp.isStar3(4,t)&&horoHelp.isStar3(9,t)?7:1}async function getInfoCach(s){const t=checkCachCuc(s),i={};return i.name={1:"Mặc định",2:"Tử Phủ Vũ Tướng",3:"Sát Phá Tham",4:"Vô Chính Diệu",5:"Nhật Nguyệt",6:"Phủ Tướng",7:"Cơ Đồng Cự"}[t],i.good=[],i.bad=[],i}function buildLsData(s,t=new Date,i=1,h=[...configDefault]){const a=h,e=new HoroscopeBuild({sex:i,born:dayjs(s),view:dayjs(t),cfg:a});return delete e.starPlacer,delete e.circlePlacer,delete e.zoneBuilder,delete e.calculationHelper,delete e.arrIdxChuyenLoc,delete e.str2hc,delete e.str2u,delete e.arrCkZone,delete e.countLoop,delete e.HOA,delete e.numberStarCol1,delete e.numberStarCol2,delete e.idxCheckZone,delete e.tpCan,delete e.adyetk,delete e.dtc,e}async function getLsDataServer(s,t=new Date,i=1,h=[...configDefault]){const a=buildLsData(s,t,i,h);try{horoHelp=new HoroHelp(a),a.cach.base=await getInfoCach(a)}catch(s){a.cach.base={}}return a}async function getHoroDataServerFromApi(s,t=new Date,i=1,h=[...configDefault]){return await getLsDataServer(s,t,i,h)}export{getHoroDataServerFromApi as g};