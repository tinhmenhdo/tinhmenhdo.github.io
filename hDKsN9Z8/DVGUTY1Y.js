import{j as l}from"./D_zvdyIk.js";import{r as p,R as B}from"./C0L9AvQN.js";import{K as T}from"./CM1J0RNE.js";import{I as X,a as V}from"./D57xKbYi.js";import"./Cpj98o6Y.js";const J=e=>{const t=Array(3).fill(null).map((()=>(()=>{const e=new Uint8Array(1);return crypto.getRandomValues(e),e[0]<128?"N":"S"})())).filter((e=>"N"===e)).length;let n;return n=3===t?"laoAm":0===t?"laoDuong":2===t?"thieuDuong":"thieuAm",{type:n,vi_tri:e,isYang:0===t||2===t}},Z=e=>{const t=[...e].sort(((e,t)=>e.vi_tri-t.vi_tri)).reverse().map((e=>e.isYang?"1":"0")).join("");return V.findIndex((e=>e===t))},tt=e=>{if(!e.some((e=>"laoAm"===e.type||"laoDuong"===e.type)))return null;const t=e.map((e=>({type:"laoAm"===e.type?"thieuDuong":"laoDuong"===e.type?"thieuAm":e.type,vi_tri:e.vi_tri,isYang:"laoAm"===e.type||"laoDuong"!==e.type&&e.isYang}))),n=Z(t);return-1===n?null:{queIcon:X[n][0],queTen:X[n][1],queMeaning:X[n][2]}},et=()=>{const e=Array(6).fill(null).map(((e,t)=>J(6-t))),t=Z(e),n=tt(e),a=e.filter((e=>"laoAm"===e.type||"laoDuong"===e.type)).sort(((e,t)=>t.vi_tri-e.vi_tri)),s=[...e].sort(((e,t)=>t.vi_tri-e.vi_tri));return{queIcon:X[t][0],queTen:X[t][1],queMeaning:X[t][2],haoResults:s,haoDong:a,queBien:n,queGocIndex:t}},nt=()=>{const[e,t]=p.useState({width:typeof window<"u"?window.innerWidth:0,height:typeof window<"u"?window.innerHeight:0});return p.useEffect((()=>{const e=()=>{t({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),e},O={CANVAS_WIDTH:850,CANVAS_HEIGHT:850,BASE_RADIUS_RATIO:.4,CIRCLE_RATIOS:{OUTER_MOST:1.12,OUTER:.95,HAO_6:.77,HAO_5:.685,HAO_4:.602,HAO_3:.52,HAO_2:.44,HAO_1:.36,INNER:.2},HAO_CONFIG:{CIRCLES:{HAO_6:{LINE_COLOR:"#000",LINE_WIDTH:1.5,DASH:[]},HAO_5:{LINE_COLOR:"#000",LINE_WIDTH:1.2,DASH:[]},HAO_4:{LINE_COLOR:"#000",LINE_WIDTH:1,DASH:[]},HAO_3:{LINE_COLOR:"#000",LINE_WIDTH:.8,DASH:[]},HAO_2:{LINE_COLOR:"#000",LINE_WIDTH:.6,DASH:[]},HAO_1:{LINE_COLOR:"#000",LINE_WIDTH:.5,DASH:[]}},ARC_CONFIG:{ANGLE_SPAN:5.625,HAO_6:{LAO_AM:{FILL:"#444",TEXT_COLOR:"white"},THIEU_DUONG:{FILL:"#f5f5f5",TEXT_COLOR:"transparent"},LAO_DUONG:{FILL:"#fff",TEXT_COLOR:"black"},THIEU_AM:{FILL:"#e0e0e0",TEXT_COLOR:"transparent"}},HAO_5:{LAO_AM:{FILL:"#444",TEXT_COLOR:"white"},THIEU_DUONG:{FILL:"#f5f5f5",TEXT_COLOR:"transparent"},LAO_DUONG:{FILL:"#fff",TEXT_COLOR:"black"},THIEU_AM:{FILL:"#e0e0e0",TEXT_COLOR:"transparent"}},HAO_4:{LAO_AM:{FILL:"#444",TEXT_COLOR:"white"},THIEU_DUONG:{FILL:"#f5f5f5",TEXT_COLOR:"transparent"},LAO_DUONG:{FILL:"#fff",TEXT_COLOR:"black"},THIEU_AM:{FILL:"#e0e0e0",TEXT_COLOR:"transparent"}},HAO_3:{LAO_AM:{FILL:"#444",TEXT_COLOR:"white"},THIEU_DUONG:{FILL:"#f5f5f5",TEXT_COLOR:"transparent"},LAO_DUONG:{FILL:"#fff",TEXT_COLOR:"black"},THIEU_AM:{FILL:"#e0e0e0",TEXT_COLOR:"transparent"}},HAO_2:{LAO_AM:{FILL:"#444",TEXT_COLOR:"white"},THIEU_DUONG:{FILL:"#f5f5f5",TEXT_COLOR:"transparent"},LAO_DUONG:{FILL:"#fff",TEXT_COLOR:"black"},THIEU_AM:{FILL:"#e0e0e0",TEXT_COLOR:"transparent"}},HAO_1:{LAO_AM:{FILL:"#444",TEXT_COLOR:"white"},THIEU_DUONG:{FILL:"#f5f5f5",TEXT_COLOR:"transparent"},LAO_DUONG:{FILL:"#fff",TEXT_COLOR:"black"},THIEU_AM:{FILL:"#e0e0e0",TEXT_COLOR:"transparent"}}},TEXT_CONFIG:{FONT_SIZE:{HAO_6:13,HAO_5:12,HAO_4:11,HAO_3:10,HAO_2:9,HAO_1:8},FONT_FAMILY:"Arial",OFFSET_RATIO:1/3},SPACING:{ANGLE_OFFSET:0,ROTATION_OFFSET:90}},TEXT_POSITIONS:{OUTER_HEXAGRAM:1.05,OUTER_NUMBER:.99,HEXAGRAM:.88,NUMBER:.81},FONT_SIZES:{OUTER_HEXAGRAM:31,OUTER_NUMBER:15,INNER_HEXAGRAM:27,INNER_NUMBER:14,HAO_NUMBER:12},ARROW:{LENGTH:.8,POINTER_LENGTH:21,POINTER_WIDTH:7,STROKE_WIDTH:2}},Y={SEGMENTS:64,ANGLE_PER_SEGMENT:5.625,HALF_SEGMENT:2.8125,BASE_ROTATIONS:10,BASE_ANGLE:3600,EXTRA_ROTATION:360,TYPE_POSITIONS:{laoAm:1,thieuDuong:2,laoDuong:3,thieuAm:4},HAO_1_BASE_POSITION:0},z=e=>{let t;return t=e<640?Math.min(e-32,400):e<1024?Math.min(e-64,600):850,{width:t,height:t}},$=e=>{const t=e/850;return{OUTER_HEXAGRAM:Math.max(20,Math.floor(31*t)),OUTER_NUMBER:Math.max(12,Math.floor(15*t)),INNER_HEXAGRAM:Math.max(18,Math.floor(27*t)),INNER_NUMBER:Math.max(10,Math.floor(14*t)),HAO_NUMBER:Math.max(8,Math.floor(12*t))}},Q=e=>3600+(360-(5.625*e+2.8125)),ot=(e,t=!1,n=0)=>{const a=Y.ANGLE_PER_SEGMENT,s=4*Math.floor(n/4)*a;let i;switch(e){case"laoAm":i=0;break;case"thieuDuong":i=1;break;case"laoDuong":i=2;break;case"thieuAm":i=3}const r=s+i*a+a/2-a,o="laoAm"===e||"laoDuong"===e?Y.EXTRA_ROTATION:0,l=r+(t?-o:o);let O;O=t?-3600+l:3600+l;return{position:n,angle:r,extraAngle:o,targetRotation:O,normalizedAngle:(l%360+360)%360,isReverse:t}},st=({centerX:e,centerY:t,baseRadius:n,fontSizes:a})=>{const s=new T.Group({x:e,y:t,offset:{x:0,y:0},rotation:0}),i=new T.Circle({radius:n*O.CIRCLE_RATIOS.OUTER,stroke:"#000",strokeWidth:1});s.add(i);for(let e=0;e<64;e++){const t=5.625*e*Math.PI/180,a=Math.cos(t)*n*O.CIRCLE_RATIOS.OUTER,i=Math.sin(t)*n*O.CIRCLE_RATIOS.OUTER,r=Math.cos(t)*n*O.CIRCLE_RATIOS.HAO_6,o=Math.sin(t)*n*O.CIRCLE_RATIOS.HAO_6,l=new T.Line({points:[a,i,r,o],stroke:"#000",strokeWidth:1});s.add(l)}return X.map(((e,t)=>({symbol:e[0],number:t+1}))).forEach(((e,t)=>{const i=(5.625*t-90+2.8125)*Math.PI/180,r=(5.625*t-90+2.8125)*Math.PI/180,o=n*O.TEXT_POSITIONS.HEXAGRAM,l=Math.cos(i)*o,c=Math.sin(i)*o,_=n*O.TEXT_POSITIONS.NUMBER,A=Math.cos(r)*_,h=Math.sin(r)*_,E=new T.Group({x:l,y:c,rotation:5.625*t+2.8125}),d=new T.Text({text:e.symbol,fontSize:a.INNER_HEXAGRAM,fontFamily:"Arial",fill:"black",align:"center",offsetX:a.INNER_HEXAGRAM/2,offsetY:a.INNER_HEXAGRAM/2}),I=new T.Group({x:A,y:h,rotation:5.625*t+2.8125}),R=new T.Text({text:e.number.toString(),fontSize:a.INNER_NUMBER,fontFamily:"Arial",fill:"black",align:"center",offsetX:a.INNER_NUMBER/2,offsetY:a.INNER_NUMBER/2});E.add(d),I.add(R),s.add(E,I)})),s},at=({centerX:e,centerY:t,baseRadius:n,fontSizes:a})=>{const s=new T.Group({x:e,y:t,offset:{x:0,y:0},rotation:0}),i=new T.Circle({radius:n*O.CIRCLE_RATIOS.OUTER_MOST,stroke:"#000",strokeWidth:1});s.add(i);for(let e=0;e<64;e++){const t=5.625*e*Math.PI/180,a=Math.cos(t)*n*O.CIRCLE_RATIOS.OUTER_MOST,i=Math.sin(t)*n*O.CIRCLE_RATIOS.OUTER_MOST,r=Math.cos(t)*n*O.CIRCLE_RATIOS.OUTER,o=Math.sin(t)*n*O.CIRCLE_RATIOS.OUTER,l=new T.Line({points:[a,i,r,o],stroke:"#000",strokeWidth:1});s.add(l)}return X.map(((e,t)=>({symbol:e[0],number:t+1}))).forEach(((e,t)=>{const i=(5.625*t-90+2.8125)*Math.PI/180,r=(5.625*t-90+2.8125)*Math.PI/180,o=n*O.TEXT_POSITIONS.OUTER_HEXAGRAM,l=Math.cos(i)*o,c=Math.sin(i)*o,_=n*O.TEXT_POSITIONS.OUTER_NUMBER,A=Math.cos(r)*_,h=Math.sin(r)*_,E=new T.Group({x:l,y:c,rotation:5.625*t+2.8125}),d=new T.Text({text:e.symbol,fontSize:a.OUTER_HEXAGRAM,fontFamily:"Arial",fill:"black",align:"center",offsetX:a.OUTER_HEXAGRAM/2,offsetY:a.OUTER_HEXAGRAM/2}),I=new T.Group({x:A,y:h,rotation:5.625*t+2.8125}),R=new T.Text({text:e.number.toString(),fontSize:a.OUTER_NUMBER,fontFamily:"Arial",fill:"black",align:"center",offsetX:a.OUTER_NUMBER/2,offsetY:a.OUTER_NUMBER/2});E.add(d),I.add(R),s.add(E,I)})),s},rt=({centerX:e,centerY:t,baseRadius:n,haoNumber:a})=>{const s=new T.Group,i=O.CIRCLE_RATIOS[`HAO_${a}`],r=O.HAO_CONFIG.CIRCLES[`HAO_${a}`],o=a>1?O.CIRCLE_RATIOS["HAO_"+(a-1)]:O.CIRCLE_RATIOS.INNER;for(let e=0;e<64;e++){const t=5.625*e;let r,l=!1;switch(e%4){case 0:r=O.HAO_CONFIG.ARC_CONFIG[`HAO_${a}`].LAO_AM,l=!0;break;case 1:r=O.HAO_CONFIG.ARC_CONFIG[`HAO_${a}`].THIEU_DUONG;break;case 2:r=O.HAO_CONFIG.ARC_CONFIG[`HAO_${a}`].LAO_DUONG,l=!0;break;case 3:r=O.HAO_CONFIG.ARC_CONFIG[`HAO_${a}`].THIEU_AM}const c=new T.Arc({innerRadius:n*o+1,outerRadius:n*i,angle:O.HAO_CONFIG.ARC_CONFIG.ANGLE_SPAN,rotation:t,fill:r.FILL});if(s.add(c),l){const e=1===a?n*(.85*i+.15*o):n*(i+o)/2,l=new T.Group({x:Math.cos((t+2.8125)*Math.PI/180)*e,y:Math.sin((t+2.8125)*Math.PI/180)*e,rotation:t+O.HAO_CONFIG.SPACING.ROTATION_OFFSET}),c=new T.Text({text:a.toString(),fontSize:O.HAO_CONFIG.TEXT_CONFIG.FONT_SIZE[`HAO_${a}`],fontFamily:O.HAO_CONFIG.TEXT_CONFIG.FONT_FAMILY,fill:r.TEXT_COLOR,align:"center",verticalAlign:"middle",x:-O.HAO_CONFIG.TEXT_CONFIG.FONT_SIZE[`HAO_${a}`]*O.HAO_CONFIG.TEXT_CONFIG.OFFSET_RATIO,y:-O.HAO_CONFIG.TEXT_CONFIG.FONT_SIZE[`HAO_${a}`]*O.HAO_CONFIG.TEXT_CONFIG.OFFSET_RATIO});l.add(c),s.add(l)}}if(a>1)for(let e=0;e<64;e++){const t=5.625*e*Math.PI/180,a=Math.cos(t)*n*i,r=Math.sin(t)*n*i,l=Math.cos(t)*n*o,O=Math.sin(t)*n*o,c=new T.Line({points:[a,r,l,O],stroke:"#000",strokeWidth:.5});s.add(c)}else{const e=O.CIRCLE_RATIOS.INNER;for(let t=0;t<64;t++){const a=5.625*t*Math.PI/180,r=Math.cos(a)*n*i,o=Math.sin(a)*n*i,l=Math.cos(a)*n*e,O=Math.sin(a)*n*e,c=new T.Line({points:[r,o,l,O],stroke:"#000",strokeWidth:.5});s.add(c)}}const l=new T.Circle({radius:n*i,stroke:r.LINE_COLOR,strokeWidth:r.LINE_WIDTH,dash:r.DASH,listening:!1});return s.add(l),s},it=(e,t,n,a=6e3,s)=>{const{wheelGroup:i,trigramGroup:r,outerWheelGroup:o,layer:l}=e;i.cache(),r.cache(),o.cache();const O=i.rotation();let c=0,T=O,_=0,A=0;const h=3600,E=e=>{o.opacity(e)},d=o.opacity()??1;E(d);const I=null!==n?n:0;let R,u=0,N=null;const f=e=>1-Math.pow(1-e,4),m=e=>{N||(N=e);const O=e-N,L=Math.min(O/a,1),x=e-c;let M;if(c=e,L<.4)M=h;else if(L<.8){M=h*(1-f((L-.4)/.4))}else{const e=t-T,n=f(1-(L-.8)/.2);M=e/a*1e3*n*5}const C=f(L);_=_*(1-.02*C)+M*(.02*C);let p;if(T+=_*x/1e3,i.rotation(T),r.rotation(-T),L<.4)p=-h;else if(L<.8){p=-h*(1-f((L-.4)/.4))}else{const e=I-u,t=f(1-(L-.8)/.2);p=e/a*1e3*t*3}A=A*(1-.02*C)+p*(.02*C);if(u+=A*x/1e3,o.rotation(u),L>.4)if(null===n){const e=Math.min((L-.4)/.4,1),t=f(e);E(Math.max(0,d*(1-t)))}else{const e=Math.min((L-.4)/.4,1),t=f(e);E(Math.min(1,d+t))}if(l.batchDraw(),L<1)R=requestAnimationFrame(m);else{const e=t-T,n=I-u;Math.abs(e)>.01||Math.abs(n)>.01?(T+=.1*e,u+=.1*n,i.rotation(T),r.rotation(-T),o.rotation(u),l.batchDraw(),R=requestAnimationFrame(m)):(i.clearCache(),r.clearCache(),o.clearCache(),s())}};return R=requestAnimationFrame(m),{stop:()=>{R&&(cancelAnimationFrame(R),i.clearCache(),r.clearCache(),o.clearCache())}}},K=(e,t)=>Math.random()*(t-e)+e,ct=(e,t,n,a=K(4500,5500))=>{const s=n.type,i=n.viTri??n.vi_tri??0,r=i%2==0,o=ot(s,r,i);let l=0,O=e.rotation(),c=0;const _=K(2800,3200),A=o.targetRotation,h=new T.Animation((n=>{if(!n)return;const s=Math.min(n.time/a,1),i=n.time-l;let T;if(l=n.time,s<.3){const e=s/.3;T=_*Math.pow(e,2)}else if(s<.7)T=_;else{const e=(s-.7)/.3,t=1-Math.pow(1-e,3);T=_*(1-t)}c=.95*c+.05*T;const E=c*i/1e3;O+=r?-E:E;const d=(O%360+360)%360;if(e.rotation(d),s>=.95){const t=A-O;if(Math.abs(t)<.1){const t=o.normalizedAngle,n=Math.min((s-.95)/.05,1),a=O*(1-n)+t*n;e.rotation(a),s>=.999&&(e.rotation(t),h.stop())}else{const n=.15*Math.pow(1-20*(1-s),3);O+=t*n;const a=(O%360+360)%360;e.rotation(a)}}t.batchDraw()}),t);return h},lt=({showResult:e,isSpinning:t,result:n})=>l.jsx("div",{className:"w-full mt-8 md:mt-16",children:l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-center min-h-[400px] bg-white rounded-lg shadow-lg",children:[l.jsx("div",{className:"border-r border-gray-300 p-8",children:l.jsx("div",{className:"min-h-[400px]",children:e&&n?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"text-xl mb-4",children:"Quẻ Chủ"}),l.jsxs("div",{className:"text-lg mb-2 text-blue-600",children:["Quẻ số ",n.queGocIndex+1]}),l.jsx("div",{className:"text-7xl mb-4",children:n.queIcon}),l.jsx("div",{className:"text-2xl font-bold mb-4",children:n.queTen}),l.jsx("div",{className:"text-base",children:n.queMeaning})]}):l.jsx("div",{className:"text-xl text-gray-500",children:t?"Đang xoay...":"Chưa có kết quả"})})}),l.jsx("div",{className:"p-8",children:l.jsxs("div",{className:"min-h-[400px]",children:[l.jsx("div",{className:"text-xl mb-6",children:"Hào Động"}),e&&n&&n.haoDong.length>0?n.haoDong.map((e=>l.jsxs("div",{className:"text-lg mb-2 text-left w-52 mx-auto",children:[l.jsxs("span",{className:"w-14 inline-block mr-2",children:["Hào ",e.vi_tri," :"]}),"laoAm"===e.type?l.jsx("span",{className:"text-black-500",children:"Âm Động"}):l.jsx("span",{className:"text-red-700",children:"Dương Động"})]},e.vi_tri))):l.jsx("div",{className:"text-lg text-gray-500",children:t?"Đang xoay...":"Không có hào động"})]})}),l.jsx("div",{className:"border-l border-gray-300 p-8",children:l.jsx("div",{className:"min-h-[400px]",children:e&&n?.queBien?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"text-xl mb-4",children:"Quẻ Biến"}),l.jsxs("div",{className:"text-lg mb-2 text-blue-600",children:["Quẻ số ",X.findIndex((e=>e[0]===n.queBien?.queIcon))+1]}),l.jsx("div",{className:"text-7xl mb-4",children:n.queBien.queIcon}),l.jsx("div",{className:"text-2xl font-bold mb-4",children:n.queBien.queTen}),l.jsx("div",{className:"text-base",children:n.queBien.queMeaning})]}):l.jsx("div",{className:"text-lg text-gray-500",children:t?"Đang xoay...":"Không có quẻ biến"})})})]})}),Tt=()=>{const e=p.useRef(null),{width:t}=nt(),[n,a]=p.useState(z(t)),[s,i]=p.useState($(n.width)),[r,o]=p.useState(!1),[c,_]=p.useState(null),[A,h]=p.useState(null),[E,d]=p.useState(null),[I,R]=p.useState(null),[u,N]=p.useState(!1),[f,m]=p.useState(null),L=p.useRef([]),x=p.useRef([]),M=p.useRef(null);return B.useEffect((()=>{const e=z(t);a(e),i($(e.width))}),[t]),B.useEffect((()=>{if(!e.current)return;L.current=[],x.current=[];const t=n.width,a=n.height,i=t/2,r=a/2,o=t*O.BASE_RADIUS_RATIO,l=new T.Stage({container:"canvas-container",width:t,height:a}),c=new T.Layer,A=new T.Arrow({points:[i,r,i,r-o*O.ARROW.LENGTH],pointerLength:O.ARROW.POINTER_LENGTH,pointerWidth:O.ARROW.POINTER_WIDTH,fill:"#FF0000",stroke:"#FF0000",strokeWidth:O.ARROW.STROKE_WIDTH,opacity:.7,listening:!1});c.add(A);const E=st({centerX:i,centerY:r,baseRadius:o,fontSizes:s});for(let e=1;e<=6;e++){const t=new T.Group({x:i,y:r}),n=rt({centerX:i,centerY:r,baseRadius:o,haoNumber:e});t.add(n),c.add(t),L.current.push(t),x.current.push(n)}const I=new T.Circle({x:i,y:r,radius:o*O.CIRCLE_RATIOS.INNER,stroke:"#000",strokeWidth:1,listening:!1});M.current=I,c.add(I);const R=at({centerX:i,centerY:r,baseRadius:o,fontSizes:s});return c.add(E),c.add(R),A.remove(),c.add(A),l.add(c),_(l),d(c),h(E),m(R),()=>{l.destroy()}}),[n,s]),l.jsx("div",{className:"flex flex-col items-center min-h-screen",children:l.jsxs("div",{className:"w-full max-w-[1200px] min-h-[calc(100vh-4rem)] flex flex-col items-center justify-start p-4 md:p-8",children:[l.jsxs("div",{className:"relative",style:{width:n.width,height:n.height},children:[l.jsx("div",{ref:e,id:"canvas-container",className:"w-full h-full bg-white rounded-lg shadow-lg"}),l.jsx("button",{onClick:()=>{if(r||!A||!E||!f)return;o(!0),N(!1);const e=et(),t=Q(e.queGocIndex),n=e.queBien?Q(X.findIndex((t=>t[0]===e.queBien?.queIcon))):null;(e=>{const t=x.current;t&&t.length&&E&&e.map((e=>({type:e.type||"không động",viTri:e.viTri||e.vi_tri}))).forEach((e=>{const n=Number(e.viTri)-1,a=t[n];a&&ct(a,E,e).start()}))})(e.haoResults),it({wheelGroup:A,trigramGroup:new T.Group,outerWheelGroup:f,layer:E},t,n,6e3,(()=>{o(!1),setTimeout((()=>{N(!0)}),10)}))&&R(e)},disabled:r,className:"absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 w-32 h-32 md:w-48 md:h-48 rounded-full border-2 border-gray-300 shadow-lg flex items-center justify-center transition-all disabled:cursor-not-allowed "+(r?"bg-black":"bg-white hover:bg-gray-50"),children:l.jsx("span",{className:"font-bold text-xl md:text-2xl "+(r?"text-white":"text-gray-800"),children:"XOAY"})})]}),l.jsx(lt,{showResult:u,isSpinning:r,result:I})]})})};export{Tt as default};