import{j as e}from"./Bq1fMrfD.js";import{r as t,a as n,b as a,K as r,c as i,d as l,C as s,L as o,T as c,A as u}from"./D6P7Yd2x.js";import{r as d,R as React}from"./Ct-_TUOu.js";import{I as h,a as m}from"./BrmUfImj.js";var f=t(),O=n(),_=a();function I(e){const t=[...e].sort(((e,t)=>e.vi_tri-t.vi_tri)).reverse().map((e=>e.isYang?"1":"0")).join("");return m.findIndex((e=>e===t))}const A={BASE_RADIUS_RATIO:.44,CIRCLE_RATIOS:{OUTER_MOST:1.12,OUTER:.95,HAO_6:.77,HAO_5:.685,HAO_4:.602,HAO_3:.52,HAO_2:.44,HAO_1:.36,INNER:.28},HAO_CONFIG:{CIRCLES:{HAO_6:{LINE_COLOR:"#000",LINE_WIDTH:1.5,DASH:[]},HAO_5:{LINE_COLOR:"#000",LINE_WIDTH:1.2,DASH:[]},HAO_4:{LINE_COLOR:"#000",LINE_WIDTH:1,DASH:[]},HAO_3:{LINE_COLOR:"#000",LINE_WIDTH:.8,DASH:[]},HAO_2:{LINE_COLOR:"#000",LINE_WIDTH:.6,DASH:[]},HAO_1:{LINE_COLOR:"#000",LINE_WIDTH:.5,DASH:[]}},ARC_CONFIG:{ANGLE_SPAN:5.625,HAO_6:{LAO_AM:{FILL:"#000",TEXT_COLOR:"white"},THIEU_DUONG:{FILL:"#f5f5f5",TEXT_COLOR:"transparent"},LAO_DUONG:{FILL:"#fff",TEXT_COLOR:"black"},THIEU_AM:{FILL:"#e0e0e0",TEXT_COLOR:"transparent"}},HAO_5:{LAO_AM:{FILL:"#000",TEXT_COLOR:"white"},THIEU_DUONG:{FILL:"#f5f5f5",TEXT_COLOR:"transparent"},LAO_DUONG:{FILL:"#fff",TEXT_COLOR:"black"},THIEU_AM:{FILL:"#e0e0e0",TEXT_COLOR:"transparent"}},HAO_4:{LAO_AM:{FILL:"#000",TEXT_COLOR:"white"},THIEU_DUONG:{FILL:"#f5f5f5",TEXT_COLOR:"transparent"},LAO_DUONG:{FILL:"#fff",TEXT_COLOR:"black"},THIEU_AM:{FILL:"#e0e0e0",TEXT_COLOR:"transparent"}},HAO_3:{LAO_AM:{FILL:"#000",TEXT_COLOR:"white"},THIEU_DUONG:{FILL:"#f5f5f5",TEXT_COLOR:"transparent"},LAO_DUONG:{FILL:"#fff",TEXT_COLOR:"black"},THIEU_AM:{FILL:"#e0e0e0",TEXT_COLOR:"transparent"}},HAO_2:{LAO_AM:{FILL:"#000",TEXT_COLOR:"white"},THIEU_DUONG:{FILL:"#f5f5f5",TEXT_COLOR:"transparent"},LAO_DUONG:{FILL:"#fff",TEXT_COLOR:"black"},THIEU_AM:{FILL:"#e0e0e0",TEXT_COLOR:"transparent"}},HAO_1:{LAO_AM:{FILL:"#000",TEXT_COLOR:"white"},THIEU_DUONG:{FILL:"#f5f5f5",TEXT_COLOR:"transparent"},LAO_DUONG:{FILL:"#fff",TEXT_COLOR:"black"},THIEU_AM:{FILL:"#e0e0e0",TEXT_COLOR:"transparent"}}},TEXT_CONFIG:{FONT_SIZE:{HAO_6:13,HAO_5:12,HAO_4:11,HAO_3:10,HAO_2:9,HAO_1:8},FONT_FAMILY:"Arial",OFFSET_RATIO:1/3},SPACING:{ROTATION_OFFSET:90}},TEXT_POSITIONS:{OUTER_HEXAGRAM:1.05,OUTER_NUMBER:.985,HEXAGRAM:.88,NUMBER:.81},ARROW:{LENGTH:.8,POINTER_LENGTH:21,POINTER_WIDTH:7,STROKE_WIDTH:2}};function x(e){let t;return t=e<640?Math.min(e-32,400):e<1024?Math.min(e-64,600):850,{width:t,height:t}}function T(e){const t=e/850;return{OUTER_HEXAGRAM:Math.max(20,Math.floor(31*t)),OUTER_NUMBER:Math.max(12,Math.floor(15*t)),INNER_HEXAGRAM:Math.max(18,Math.floor(27*t)),INNER_NUMBER:Math.max(10,Math.floor(14*t)),HAO_NUMBER:Math.max(8,Math.floor(12*t))}}function R(e){return 360-(5.625*e+2.8125)+3600}const E=e=>1-Math.pow(1-e,4);function p(e,t){return e.find(t)}function g(e,t,n){const a=r.Util.getRGB(e),i=r.Util.getRGB(t);return`rgb(${Math.round(a.r+n*(i.r-a.r))},${Math.round(a.g+n*(i.g-a.g))},${Math.round(a.b+n*(i.b-a.b))})`}function N(e,t,n){const a=1234.56789*n;return e+(t-e)*((Math.sin(a)+1)/2)}const b=e=>1-Math.pow(1-e,4);var w=i();function C(e,t){return e.findOne(`.${t}`)}function L(e,t,n){const a=r.Util.getRGB(e),i=r.Util.getRGB(t);return`rgb(${Math.round(a.r+n*(i.r-a.r))},${Math.round(a.g+n*(i.g-a.g))},${Math.round(a.b+n*(i.b-a.b))})`}var y=l();function M({baseRadius:e,haoNumber:t}){const n=new r.Group,a=A.CIRCLE_RATIOS[`HAO_${t}`],i=A.HAO_CONFIG.CIRCLES[`HAO_${t}`],l=t>1?A.CIRCLE_RATIOS["HAO_"+(t-1)]:A.CIRCLE_RATIOS.INNER;for(let i=0;i<64;i++){const s=i%4,o=5.625*i,c=new y.Arc({innerRadius:e*l+1,outerRadius:e*a,angle:A.HAO_CONFIG.ARC_CONFIG.ANGLE_SPAN,rotation:o,clockwise:!1,perfectDrawEnabled:!1,listening:!1}),d=new r.Group,u=new r.Text({text:t.toString(),fontSize:A.HAO_CONFIG.TEXT_CONFIG.FONT_SIZE[`HAO_${t}`],fontFamily:A.HAO_CONFIG.TEXT_CONFIG.FONT_FAMILY,align:"center",verticalAlign:"middle",x:-A.HAO_CONFIG.TEXT_CONFIG.FONT_SIZE[`HAO_${t}`]*A.HAO_CONFIG.TEXT_CONFIG.OFFSET_RATIO,y:-A.HAO_CONFIG.TEXT_CONFIG.FONT_SIZE[`HAO_${t}`]*A.HAO_CONFIG.TEXT_CONFIG.OFFSET_RATIO,perfectDrawEnabled:!1,listening:!1});let h=A.HAO_CONFIG.ARC_CONFIG[`HAO_${t}`].THIEU_AM,m=!1;switch(s){case 0:h=A.HAO_CONFIG.ARC_CONFIG[`HAO_${t}`].LAO_AM,c.fill(h.FILL),c.name(`lao-am-arc-${i} lao-am-arc`),m=!0;break;case 1:h=A.HAO_CONFIG.ARC_CONFIG[`HAO_${t}`].THIEU_DUONG,c.fill(h.FILL);break;case 2:h=A.HAO_CONFIG.ARC_CONFIG[`HAO_${t}`].LAO_DUONG,c.fill(h.FILL),c.name(`lao-duong-arc-${i} lao-duong-arc`),m=!0;break;case 3:h=A.HAO_CONFIG.ARC_CONFIG[`HAO_${t}`].THIEU_AM,c.fill(h.FILL);break;default:h=A.HAO_CONFIG.ARC_CONFIG[`HAO_${t}`].THIEU_AM}if(n.add(c),m){const t=e*(a+l)/2;d.position({x:Math.cos((o+2.8125)*Math.PI/180)*t,y:Math.sin((o+2.8125)*Math.PI/180)*t}),d.rotation(o+A.HAO_CONFIG.SPACING.ROTATION_OFFSET),u.fill(h.TEXT_COLOR),0===s&&u.name(`lao-am-text-${i}`),2===s&&u.name(`lao-duong-text-${i}`),d.add(u),n.add(d)}}if(t>1)for(let t=0;t<64;t++){const i=5.625*t*Math.PI/180,s=Math.cos(i)*e*a,o=Math.sin(i)*e*a,c=Math.cos(i)*e*l,d=Math.sin(i)*e*l,u=new r.Line({points:[s,o,c,d],stroke:"#000",strokeWidth:.5,perfectDrawEnabled:!1,listening:!1});n.add(u)}else{const t=A.CIRCLE_RATIOS.INNER;for(let i=0;i<64;i++){const l=5.625*i*Math.PI/180,s=Math.cos(l)*e*a,o=Math.sin(l)*e*a,c=Math.cos(l)*e*t,d=Math.sin(l)*e*t,u=new r.Line({points:[s,o,c,d],stroke:"#000",strokeWidth:.5,perfectDrawEnabled:!1,listening:!1});n.add(u)}}const o=new s.Circle({radius:e*a,stroke:i.LINE_COLOR,strokeWidth:i.LINE_WIDTH,dash:i.DASH,listening:!1});return n.add(o),n}const H=({title:t,content:n,btnId:a,onCopy:r})=>e.jsx("div",{className:"mt-4 md:mt-6",children:e.jsxs("div",{className:"rounded-md border-[0.5px] border-gray-300 bg-gray-100 dark:bg-gray-950",children:[e.jsxs("div",{className:"flex h-9 items-center justify-between rounded-t-md bg-gray-200 px-4 py-2 font-sans text-xs text-black/85 select-none dark:bg-gray-800",children:[e.jsx("span",{children:t}),e.jsxs("button",{className:"flex items-center gap-1",onClick:()=>r(n,a),children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:20,height:20,fill:"none",viewBox:"0 0 24 24",className:"icon-sm",children:e.jsx("path",{fill:"currentColor",fillRule:"evenodd",d:"M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z",clipRule:"evenodd"})}),e.jsx("span",{id:a,className:"cursor-pointer pl-2 font-sans text-sm",children:"Click Copy - Lấy Text"})]})]}),e.jsx("div",{children:e.jsx("textarea",{className:"h-[120px] w-full resize-none overflow-y-auto border-none bg-gray-100 p-4 text-left font-mono text-xs leading-normal text-gray-600 focus:bg-yellow-100 focus:outline-hidden md:h-[140px] dark:bg-gray-900 dark:text-gray-400 dark:focus:bg-yellow-900",readOnly:!0,value:n})})]})}),k=({showResult:t,isSpinning:n,result:a})=>{const[r,i]=d.useState("");return d.useEffect((()=>{if(t&&a){let e="";if(e+="=== QUẺ CHỦ ===\n",e+=`Quẻ số: ${a.queGocIndex+1}\n`,e+=`Tên quẻ: ${a.queTen}\n`,e+=`Biểu tượng: ${a.queIcon}\n`,e+=`Ý nghĩa: ${a.queMeaning}\n\n`,e+="=== HÀO ĐỘNG ===\n",a.haoDong.length>0?a.haoDong.forEach((t=>{const n="laoAm"===t.type?"Âm Động":"Dương Động";e+=`Hào ${t.vi_tri}: ${n}\n`})):e+="Không có hào động\n",e+="\n",e+="=== QUẺ BIẾN ===\n",a.queBien){const t=h.findIndex((e=>e[0]===a.queBien?.queIcon));e+=`Quẻ số: ${t+1}\n`,e+=`Tên quẻ: ${a.queBien.queTen}\n`,e+=`Biểu tượng: ${a.queBien.queIcon}\n`,e+=`Ý nghĩa: ${a.queBien.queMeaning}\n`}else e+="Không có quẻ biến\n";i(e)}else i("")}),[t,a]),e.jsxs("div",{className:"mt-4 w-full md:mt-8",children:[e.jsxs("div",{className:"grid min-h-[250px] grid-cols-1 gap-2 rounded-lg bg-white text-center shadow-lg md:min-h-[400px] md:grid-cols-3 md:gap-4 dark:bg-gray-800",children:[e.jsx("div",{className:"border-b border-gray-300 p-4 md:border-r md:border-b-0 md:p-8",children:e.jsx("div",{className:"min-h-[200px] md:min-h-[400px]",children:t&&a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-2 text-lg md:mb-4 md:text-xl",children:"Quẻ Chủ"}),e.jsxs("div",{className:"mb-2 text-base text-blue-600 md:text-lg",children:["Quẻ số ",a.queGocIndex+1]}),e.jsx("div",{className:"mb-2 text-4xl md:mb-4 md:text-7xl",children:a.queIcon}),e.jsx("div",{className:"mb-2 text-lg font-bold md:mb-4 md:text-2xl",children:a.queTen}),e.jsx("div",{className:"px-2 text-sm md:px-0 md:text-base",children:a.queMeaning})]}):e.jsx("div",{className:"text-lg text-gray-500 md:text-xl",children:n?"Đang xoay...":"Chưa có kết quả"})})}),e.jsx("div",{className:"border-b p-4 md:border-b-0 md:p-8",children:e.jsxs("div",{className:"min-h-[120px] md:min-h-[400px]",children:[e.jsx("div",{className:"mb-3 text-lg md:mb-6 md:text-xl",children:"Hào Động"}),t&&a&&a.haoDong.length>0?e.jsx("div",{className:"space-y-1 md:space-y-2",children:a.haoDong.map((t=>e.jsxs("div",{className:"mx-auto max-w-[200px] text-left text-base md:w-52 md:text-lg",children:[e.jsxs("span",{className:"mr-2 inline-block w-12 text-sm md:w-14 md:text-base",children:["Hào ",t.vi_tri,":"]}),"laoAm"===t.type?e.jsx("span",{className:"text-sm text-gray-700 md:text-base",children:"Âm Động"}):e.jsx("span",{className:"text-sm text-red-700 md:text-base",children:"Dương Động"})]},t.vi_tri)))}):e.jsx("div",{className:"text-base text-gray-500 md:text-lg",children:n?"Đang xoay...":"Không có hào động"})]})}),e.jsx("div",{className:"border-gray-300 p-4 md:border-l md:p-8",children:e.jsx("div",{className:"min-h-[200px] md:min-h-[400px]",children:t&&a?.queBien?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-2 text-lg md:mb-4 md:text-xl",children:"Quẻ Biến"}),e.jsxs("div",{className:"mb-2 text-base text-blue-600 md:text-lg",children:["Quẻ số ",h.findIndex((e=>e[0]===a.queBien?.queIcon))+1]}),e.jsx("div",{className:"mb-2 text-4xl md:mb-4 md:text-7xl",children:a.queBien.queIcon}),e.jsx("div",{className:"mb-2 text-lg font-bold md:mb-4 md:text-2xl",children:a.queBien.queTen}),e.jsx("div",{className:"px-2 text-sm md:px-0 md:text-base",children:a.queBien.queMeaning})]}):e.jsx("div",{className:"text-base text-gray-500 md:text-lg",children:n?"Đang xoay...":"Không có quẻ biến"})})})]}),t&&a&&e.jsx(H,{title:"Kết quả Gieo Quẻ dùng cho AI",content:r,btnId:"btnCopyResult",onCopy:(e,t)=>{const n=document.getElementById(t);if(!n)return;const a=n.textContent;navigator.clipboard.writeText(e).then((()=>{n.textContent="Đã copy",setTimeout((()=>{n.textContent=a}),2e3)}))}})]})},F=()=>{const t=d.useRef(null),{width:n}=function(){const[e,t]=d.useState({width:850,height:850});return d.useEffect((()=>{if("undefined"==typeof window)return;const e=()=>{t({width:window.innerWidth,height:window.innerHeight})};e();const n=function(e){let t=null;return(...n)=>{null!==t&&(clearTimeout(t),t=null),t=setTimeout((()=>e(...n)),250)}}(e);return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)}),[]),e}(),[a,i]=d.useState(x(n)),[l,m]=d.useState(T(a.width)),[H,F]=d.useState(!1),[G,v]=d.useState(null),[S,U]=d.useState(null),[D,B]=d.useState(null),[X,j]=d.useState(null),[W,q]=d.useState(!1),[$,P]=d.useState(null),z=d.useRef([]),Y=d.useRef([]),Q=d.useRef(null),K=d.useRef([]),Z=d.useRef(null),V=d.useRef(null),J=d.useRef(null),ee=d.useCallback((e=>{const t=Y.current;t&&t.length&&D&&(K.current.forEach((e=>{e&&e.stop&&e.stop()})),K.current=[],e.map((e=>({type:e.type||"không động",viTri:e.viTri||e.vi_tri}))).sort(((e,t)=>Number(e.viTri)-Number(t.viTri))).forEach(((e,n)=>{const a=Number(e.viTri)-1,i=t[a];i&&setTimeout((()=>{const t=function(e,t,n,a=N(5900,6100,n.viTri||n.vi_tri||0)){const i=n.type,l=n.viTri??n.vi_tri??0,s=l%2==0,o=function(e,t=!1,n=0){const a=5.625,r=4*Math.floor(n/4)*a;let i;switch(e){case"laoAm":i=0;break;case"thieuDuong":i=1;break;case"laoDuong":i=2;break;case"thieuAm":i=3}const l=r+i*a+2.8125-a,s="laoAm"===e||"laoDuong"===e?360:0,o=l+(t?-s:s);let c;return c=t?-3600+o:3600+o,{position:n,angle:l,extraAngle:s,targetRotation:c,normalizedAngle:(o%360+360)%360,isReverse:t}}(i,s,l),{normalizedAngle:c}=o;let d=0,u=e.rotation(),h=0;const m=N(2800,3200,l+100),f=p(e,".lao-am-arc"),O=p(e,".lao-duong-arc"),A=new r.Animation((n=>{if(!n)return;const r=Math.min(n.time/a,1),i=n.time-d;d=n.time;const l=n.time%2400/1200;let o=l>1?2-l:l;o=Math.max(0,Math.min(1,o));const _=g("black","white",o),I=g("white","black",o);if(f.forEach((e=>e.fill(_))),O.forEach((e=>e.fill(I))),!(i<8&&r<1)){if(r<1){let t;t=r<.4?m:m*E(1-(r-.4)/.6);const n=E(r);h=h*(1-.015*n)+t*(.015*n);const a=h*i/1e3;u+=s?-a:a;const l=(u%360+360)%360;e.rotation(l)}else{const t=c-u;Math.abs(t)>.5?(u+=.15*t,e.rotation(u)):(e.rotation(c),f.forEach((e=>e.fill("black"))),O.forEach((e=>e.fill("white"))),A.stop())}t.batchDraw()}}),t);return A}(i,D,e);K.current.push(t),t.start()}),150*n)})))}),[D]),te=d.useCallback((()=>{if(H||!S||!D||!$||!V.current)return;F(!0),q(!1),Z.current&&Z.current.stop(),J.current&&J.current.stop(),K.current.forEach((e=>e.stop())),K.current=[],V.current.rotation(0);const e=function(e,t,n=180){let a=null,r=null;return{start:()=>{a&&a.stop(),r&&r.stop(),e.rotation(0),a=new w.Animation((t=>{if(!t)return;const a=t.timeDiff*n/1e3;e.rotate(a);const r=t.time%2400/1200,i=r>1?2-r:r,l={yin:C(e,"yinArc"),yang:C(e,"yangArc"),smallBlack:C(e,"smallBlackCircle"),smallWhite:C(e,"smallWhiteCircle"),upperBlack:C(e,"upperBlackCircle"),lowerWhite:C(e,"lowerWhiteCircle")};l.yin&&l.yang&&l.smallBlack&&l.smallWhite&&l.upperBlack&&l.lowerWhite&&(l.yin.fill(L("black","white",i)),l.yang.fill(L("white","black",i)),l.smallBlack.fill(L("black","white",i)),l.smallWhite.fill(L("white","black",i)),l.upperBlack.fill(L("black","white",i)),l.lowerWhite.fill(L("white","black",i)))}),t),a.start()},stop:()=>{a&&a.stop();const n=e.rotation(),i=360*Math.ceil(n/360);if(i-n<1)return void e.rotation(0);const l={yin:C(e,"yinArc"),yang:C(e,"yangArc"),smallBlack:C(e,"smallBlackCircle"),smallWhite:C(e,"smallWhiteCircle"),upperBlack:C(e,"upperBlackCircle"),lowerWhite:C(e,"lowerWhiteCircle")},s={yin:l.yin?.fill()||"black",yang:l.yang?.fill()||"white",smallBlack:l.smallBlack?.fill()||"black",smallWhite:l.smallWhite?.fill()||"white",upperBlack:l.upperBlack?.fill()||"black",lowerWhite:l.lowerWhite?.fill()||"white"};r=new w.Animation((a=>{if(!a||a.time>=1500)return e.rotation(0),l.yin&&l.yin.fill("black"),l.yang&&l.yang.fill("white"),l.smallBlack&&l.smallBlack.fill("black"),l.smallWhite&&l.smallWhite.fill("white"),l.upperBlack&&l.upperBlack.fill("black"),l.lowerWhite&&l.lowerWhite.fill("white"),t.batchDraw(),void r?.stop();const o=(e=>1-Math.pow(1-e,4))(a.time/1500),c=n+(i-n)*o;e.rotation(c),l.yin&&l.yin.fill(L(s.yin,"black",o)),l.yang&&l.yang.fill(L(s.yang,"white",o)),l.smallBlack&&l.smallBlack.fill(L(s.smallBlack,"black",o)),l.smallWhite&&l.smallWhite.fill(L(s.smallWhite,"white",o)),l.upperBlack&&l.upperBlack.fill(L(s.upperBlack,"black",o)),l.lowerWhite&&l.lowerWhite.fill(L(s.lowerWhite,"white",o)),t.batchDraw()}),t),r.start()}}}(V.current,D);e.start(),J.current=e,setTimeout((()=>{const e=function(){const e=Array.from({length:6}).fill(null).map(((e,t)=>function(e){const t=Array.from({length:3}).fill(null).map((()=>(()=>{const e=new Uint8Array(1);return crypto.getRandomValues(e),e[0]<128?"N":"S"})())).filter((e=>"N"===e)).length;let n;return n=3===t?"laoAm":0===t?"laoDuong":2===t?"thieuDuong":"thieuAm",{type:n,vi_tri:e,isYang:0===t||2===t}}(6-t))),t=I(e),n=function(e){if(!e.some((e=>"laoAm"===e.type||"laoDuong"===e.type)))return null;const t=I(e.map((e=>({type:"laoAm"===e.type?"thieuDuong":"laoDuong"===e.type?"thieuAm":e.type,vi_tri:e.vi_tri,isYang:"laoAm"===e.type||"laoDuong"!==e.type&&e.isYang}))));return-1===t?null:{queIcon:h[t][0],queTen:h[t][1],queMeaning:h[t][2]}}(e),a=e.filter((e=>"laoAm"===e.type||"laoDuong"===e.type)).sort(((e,t)=>t.vi_tri-e.vi_tri)),r=[...e].sort(((e,t)=>t.vi_tri-e.vi_tri));return{queIcon:h[t][0],queTen:h[t][1],queMeaning:h[t][2],haoResults:r,haoDong:a,queBien:n,queGocIndex:t}}();ee(e.haoResults);const t=150*e.haoResults.length;setTimeout((()=>{const t=R(e.queGocIndex),n=e.queBien?R(h.findIndex((t=>t[0]===e.queBien?.queIcon))):null,a=function(e,t,n,a=6e3,r){const{wheelGroup:i,trigramGroup:l,outerWheelGroup:s,layer:o}=e;i.cache(),l.cache(),s.cache();const c=i.rotation();let d=0,u=c,h=0,m=0,f=!1;const O=e=>{Math.abs(s.opacity()-e)>.001&&s.opacity(e)},A=s.opacity()??1;O(A);const _=null!==n?n:0;let I,x=0,T=null;const R=e=>{T||(T=e);const c=e-T,E=Math.min(c/a,1),p=e-d;if(d=e,p<8&&E<1)return void(I=requestAnimationFrame(R));let g;g=E<.4?3600:3600*b(1-(E-.4)/.6);const N=b(E);h=h*(1-.015*N)+g*(.015*N),u+=h*p/1e3,i.rotation(u),l.rotation(-u);const C=Math.max(0,c-350);if(C>0){const e=Math.min(C/(a-350),1),t=b(e);let r;if(r=e<.4?-3600:-3600*b(1-(e-.4)/.6),m=m*(1-.015*t)+r*(.015*t),x+=m*p/1e3,s.rotation(x),e>.4)if(null===n){const t=Math.min((e-.4)/.4,1),n=b(t);O(Math.max(0,A*(1-n)))}else{const t=Math.min((e-.4)/.4,1),n=b(t);O(Math.min(1,A+n))}}if(!f&&Math.abs(h)<60&&Math.abs(m)<60&&E>.92&&(f=!0,setTimeout((()=>{r()}),100)),o.batchDraw(),E<1)I=requestAnimationFrame(R);else{const e=t-u,n=_-x;Math.abs(e)>.1||Math.abs(n)>.1?(u+=.2*e,x+=.2*n,i.rotation(u),l.rotation(-u),s.rotation(x),o.batchDraw(),I=requestAnimationFrame(R)):(i.rotation(t),l.rotation(-t),s.rotation(_),i.clearCache(),l.clearCache(),s.clearCache(),f||r())}};return I=requestAnimationFrame(R),{stop:()=>{I&&(cancelAnimationFrame(I),i.clearCache(),l.clearCache(),s.clearCache())}}}({wheelGroup:S,trigramGroup:new f.Group,outerWheelGroup:$,layer:D},t,n,6e3,(()=>{F(!1),j(e),q(!0),J.current&&J.current.stop()}));Z.current=a}),t+150)}),200)}),[H,S,D,$,ee]);return React.useEffect((()=>{if("undefined"==typeof window)return;const e=x(n);i(e),m(T(e.width))}),[n]),React.useEffect((()=>{if("undefined"==typeof window)return;if(!t.current)return;z.current=[],Y.current=[],K.current.forEach((e=>{e&&e.stop&&e.stop()})),K.current=[];const e=a.width,n=a.height,r=e/2,i=n/2,d=e*A.BASE_RADIUS_RATIO,m=new _.Stage({container:"canvas-container",width:e,height:n,pixelRatio:1}),I=new O.Layer,x=new O.Layer,T=i-d*A.CIRCLE_RATIOS.INNER,R=new u.Arrow({points:[r,T,r,i-d*A.ARROW.LENGTH],pointerLength:A.ARROW.POINTER_LENGTH,pointerWidth:A.ARROW.POINTER_WIDTH,fill:"#FF0000",stroke:"#FF0000",strokeWidth:A.ARROW.STROKE_WIDTH,opacity:.5,listening:!1});I.add(R);const E=function({centerX:e,centerY:t,baseRadius:n,fontSizes:a}){const r=new f.Group({x:e,y:t,offset:{x:0,y:0},rotation:0}),i=new s.Circle({radius:n*A.CIRCLE_RATIOS.OUTER,stroke:"#000",strokeWidth:1});r.add(i);for(let e=0;e<64;e++){const t=5.625*e*Math.PI/180,a=Math.cos(t)*n*A.CIRCLE_RATIOS.OUTER,i=Math.sin(t)*n*A.CIRCLE_RATIOS.OUTER,l=Math.cos(t)*n*A.CIRCLE_RATIOS.HAO_6,s=Math.sin(t)*n*A.CIRCLE_RATIOS.HAO_6,c=new o.Line({points:[a,i,l,s],stroke:"#000",strokeWidth:1,perfectDrawEnabled:!1,listening:!1});r.add(c)}return h.map(((e,t)=>({symbol:e[0],number:t+1}))).forEach(((e,t)=>{const i=(5.625*t-90+2.8125)*Math.PI/180,l=(5.625*t-90+2.8125)*Math.PI/180,s=n*A.TEXT_POSITIONS.HEXAGRAM,o=Math.cos(i)*s,d=Math.sin(i)*s,u=n*A.TEXT_POSITIONS.NUMBER,h=Math.cos(l)*u,m=Math.sin(l)*u,O=new f.Group({x:o,y:d,rotation:5.625*t+2.8125}),_=new c.Text({text:e.symbol,fontSize:a.INNER_HEXAGRAM,fontFamily:"Arial",fill:"black",align:"center",offsetX:a.INNER_HEXAGRAM/2,offsetY:a.INNER_HEXAGRAM/2,perfectDrawEnabled:!1,listening:!1}),I=new f.Group({x:h,y:m,rotation:5.625*t+2.8125}),x=new c.Text({text:e.number.toString(),fontSize:a.INNER_NUMBER,fontFamily:"Arial",fill:"black",align:"center",offsetX:a.INNER_NUMBER/2,offsetY:a.INNER_NUMBER/2,perfectDrawEnabled:!1,listening:!1});O.add(_),I.add(x),r.add(O,I)})),r}({centerX:r,centerY:i,baseRadius:d,fontSizes:l});for(let e=1;e<=6;e++){const t=new f.Group({x:r,y:i}),n=M({baseRadius:d,haoNumber:e});t.add(n),x.add(t),z.current.push(t),Y.current.push(n)}const p=new s.Circle({x:r,y:i,radius:d*A.CIRCLE_RATIOS.INNER,stroke:"#000",strokeWidth:1,listening:!1});Q.current=p,x.add(p);const g=function({x:e,y:t,radius:n}){const a=new f.Group({x:e,y:t}),r=new y.Arc({x:0,y:0,innerRadius:0,outerRadius:n,angle:180,rotation:-90,fill:"black",name:"yinArc"}),i=new y.Arc({x:0,y:0,innerRadius:0,outerRadius:n,angle:180,rotation:90,fill:"white",name:"yangArc"}),l=new s.Circle({x:0,y:-n/2,radius:n/6,fill:"black",name:"smallBlackCircle"}),o=new s.Circle({x:0,y:n/2,radius:n/6,fill:"white",name:"smallWhiteCircle"}),c=new s.Circle({x:0,y:-n/2,radius:n/2,fill:"white",name:"lowerWhiteCircle"}),d=new s.Circle({x:0,y:n/2,radius:n/2,fill:"black",name:"upperBlackCircle"});return a.add(r,i,d,c,l,o),a}({x:r,y:i,radius:d*A.CIRCLE_RATIOS.INNER});V.current=g,x.add(g);const N=function({centerX:e,centerY:t,baseRadius:n,fontSizes:a}){const r=new f.Group({x:e,y:t,offset:{x:0,y:0},rotation:0}),i=new s.Circle({radius:n*A.CIRCLE_RATIOS.OUTER_MOST,stroke:"#000",strokeWidth:1});r.add(i);for(let e=0;e<64;e++){const t=5.625*e*Math.PI/180,a=Math.cos(t)*n*A.CIRCLE_RATIOS.OUTER_MOST,i=Math.sin(t)*n*A.CIRCLE_RATIOS.OUTER_MOST,l=Math.cos(t)*n*A.CIRCLE_RATIOS.OUTER,s=Math.sin(t)*n*A.CIRCLE_RATIOS.OUTER,c=new o.Line({points:[a,i,l,s],stroke:"#000",strokeWidth:1,perfectDrawEnabled:!1,listening:!1});r.add(c)}return h.map(((e,t)=>({symbol:e[0],number:t+1}))).forEach(((e,t)=>{const i=(5.625*t-90+2.8125)*Math.PI/180,l=(5.625*t-90+2.8125)*Math.PI/180,s=n*A.TEXT_POSITIONS.OUTER_HEXAGRAM,o=Math.cos(i)*s,d=Math.sin(i)*s,u=n*A.TEXT_POSITIONS.OUTER_NUMBER,h=Math.cos(l)*u,m=Math.sin(l)*u,O=new f.Group({x:o,y:d,rotation:5.625*t+2.8125}),_=new c.Text({text:e.symbol,fontSize:a.OUTER_HEXAGRAM,fontFamily:"Arial",fill:"black",align:"center",offsetX:a.OUTER_HEXAGRAM/2,offsetY:a.OUTER_HEXAGRAM/2,perfectDrawEnabled:!1,listening:!1}),I=new f.Group({x:h,y:m,rotation:5.625*t+2.8125}),x=new c.Text({text:e.number.toString(),fontSize:a.OUTER_NUMBER,fontFamily:"Arial",fill:"black",align:"center",offsetX:a.OUTER_NUMBER/2,offsetY:a.OUTER_NUMBER/2,perfectDrawEnabled:!1,listening:!1});O.add(_),I.add(x),r.add(O,I)})),r}({centerX:r,centerY:i,baseRadius:d,fontSizes:l});return x.add(E),x.add(N),m.add(I,x),v(m),B(x),U(E),P(N),()=>{K.current.forEach((e=>{e&&e.stop&&e.stop()})),K.current=[],Z.current&&Z.current.stop(),Z.current=null,J.current&&J.current.stop(),J.current=null,m.destroy()}}),[a,l]),e.jsx("div",{className:"flex min-h-screen flex-col items-center",children:e.jsxs("div",{className:"flex min-h-[calc(100vh-4rem)] w-full max-w-[1200px] flex-col items-center justify-start p-4 max-md:p-0 md:p-8",children:[e.jsxs("div",{className:"relative",style:{width:a.width,height:a.height},children:[e.jsx("div",{ref:t,id:"canvas-container",className:"relative h-full w-full rounded-lg bg-white [&>canvas]:absolute [&>canvas]:top-0 [&>canvas]:left-0"}),e.jsx("button",{onClick:te,disabled:H,className:"absolute top-1/2 left-1/2 z-10 flex h-32 w-32 -translate-x-1/2 -translate-y-1/2 transform items-center justify-center rounded-full border-2 border-gray-300 opacity-0 shadow-lg transition-all disabled:cursor-not-allowed max-md:size-20 md:h-48 md:w-48 "+(H?"bg-black":"cursor-pointer bg-white hover:bg-gray-50"),children:e.jsx("span",{className:"text-lg font-bold md:text-2xl "+(H?"text-white":"text-gray-800"),children:"XOAY"})})]}),e.jsx(k,{showResult:W,isSpinning:H,result:X})]})})};export{F as default};