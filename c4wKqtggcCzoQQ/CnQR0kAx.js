import{j as e}from"./Bq1fMrfD.js";import{r as a}from"./Ct-_TUOu.js";let t=!1;async function n(){try{if("caches"in window){const e=await caches.keys();await Promise.all(e.map((e=>caches.delete(e))))}if("localStorage"in window&&localStorage.clear(),"sessionStorage"in window&&sessionStorage.clear(),"indexedDB"in window&&window.indexedDB.databases)try{const e=await window.indexedDB.databases();await Promise.all(e.map((e=>new Promise(((t,a)=>{const n=indexedDB.deleteDatabase(e.name);n.onsuccess=()=>{t()},n.onerror=t=>{a(new Error(`Failed to delete DB: ${e.name}`))}})))))}catch(e){}return navigator.serviceWorker&&navigator.serviceWorker.controller&&await fetch("/",{headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}}),!0}catch(e){return!1}}async function o(){if("serviceWorker"in navigator)try{const e=await navigator.serviceWorker.getRegistrations();await Promise.all(e.map((e=>e.unregister())))}catch(e){}}function r(){const[r,i]=a.useState(!1);async function s(){await async function(){if(t)return!0;try{const e=await fetch(`/version.json?nocache=${Date.now()}`);if(!e.ok)return!1;const a=await e.json();return!!a.version&&"1757908350390"!==a.version&&(t=!0,!0)}catch(e){return!1}}()&&(i(!0),await Promise.all([n(),o()]))}return a.useEffect((()=>{const e=setTimeout((()=>{s();const e=setInterval((()=>{s()}),3e5);return()=>{clearInterval(e)}}),1e3);return()=>{clearTimeout(e)}}),[]),r?e.jsxs("div",{className:"fixed right-4 bottom-4 z-50 rounded-lg bg-yellow-600/70 px-4 py-2 text-white shadow-lg",children:[e.jsx("p",{className:"mb-2",children:"Phiên bản mới đã sẵn sàng!"}),e.jsx("button",{onClick:function(){!async function(){try{await Promise.all([n(),o()]),window.location.href=`/?refresh=${Date.now()}`}catch(e){window.location.reload()}}()},className:"mx-auto rounded bg-white px-3 py-1 font-medium text-green-700 transition-colors hover:bg-blue-50",children:"Cập nhật ngay"})]}):null}export{r as default};