import{escape}from"html-escaper";import{Traverse}from"neotraverse/modern";import pLimit from"p-limit";import{z}from"zod";import{b as removeBase,i as isRemotePath,p as prependForwardSlash}from"./U63mA12D.js";import{V as VALID_INPUT_FORMATS,e as cleanSlug,P as POST_PERMALINK_PATTERN,t as trimSlash,A as APP_BLOG,C as CATEGORY_BASE,T as TAG_BASE,B as BLOG_BASE}from"./D6HlL8Bp.js";import{A as AstroError,U as UnknownContentCollectionError,c as createComponent,R as RenderUndefinedEntryError,u as unescapeHTML,a as renderTemplate,g as renderUniqueStylesheet,h as renderScriptElement,i as createHeadAndContent,r as renderComponent}from"./C7fEv_-K.js";import"kleur/colors";import*as devalue from"devalue";const CONTENT_IMAGE_FLAG="astroContentImageFlag",IMAGE_IMPORT_PREFIX="__ASTRO_IMAGE_";function imageSrcToImportId(t,e){if(t=removeBase(t,"__ASTRO_IMAGE_"),isRemotePath(t))return;const o=t.split(".").at(-1)?.toLowerCase();if(!o||!VALID_INPUT_FORMATS.includes(o))return;const a=new URLSearchParams(CONTENT_IMAGE_FLAG);return e&&a.set("importer",e),`${t}?${a.toString()}`}class ImmutableDataStore{_collections=new Map;constructor(){this._collections=new Map}get(t,e){return this._collections.get(t)?.get(String(e))}entries(t){return[...(this._collections.get(t)??new Map).entries()]}values(t){return[...(this._collections.get(t)??new Map).values()]}keys(t){return[...(this._collections.get(t)??new Map).keys()]}has(t,e){const o=this._collections.get(t);return!!o&&o.has(String(e))}hasCollection(t){return this._collections.has(t)}collections(){return this._collections}static async fromModule(){try{const t=await import("./DCCH1Jkc.js");if(t.default instanceof Map)return ImmutableDataStore.fromMap(t.default);const e=devalue.unflatten(t.default);return ImmutableDataStore.fromMap(e)}catch{}return new ImmutableDataStore}static async fromMap(t){const e=new ImmutableDataStore;return e._collections=t,e}}function dataStoreSingleton(){let t;return{get:async()=>(t||(t=ImmutableDataStore.fromModule()),t),set:e=>{t=e}}}const globalDataStore=dataStoreSingleton(),__vite_import_meta_env__={ASSETS_PREFIX:void 0,BASE_URL:"/",BUILD_VERSION:"1757908350390",DEV:!1,MODE:"production",PROD:!0,SITE:"https://tinhmenhdo.com",SSR:!0};function createCollectionToGlobResultMap({globResult:t,contentDir:e}){const o={};for(const a in t){const n=a.replace(new RegExp(`^${e}`),"").split("/");if(n.length<=1)continue;const r=n[0];o[r]??={},o[r][a]=t[a]}return o}function createGetCollection({contentCollectionToEntryMap:t,dataCollectionToEntryMap:e,getRenderEntryImport:o,cacheEntriesByCollection:a,liveCollections:n}){return async function(r,s){if(r in n)throw new AstroError({...UnknownContentCollectionError,message:`Collection "${r}" is a live collection. Use getLiveCollection() instead of getCollection().`});const i="function"==typeof s,l=await globalDataStore.get();let c;if(r in t)c="content";else{if(!(r in e)){if(l.hasCollection(r)){const{default:t}=await import("./DBGgdkn5.js"),e=[];for(const o of l.values(r)){const a=updateImageReferencesInData(o.data,o.filePath,t);let n={...o,data:a,collection:r};n.legacyId&&(n=emulateLegacyEntry(n)),i&&!s(n)||e.push(n)}return e}return console.warn(`The collection ${JSON.stringify(r)} does not exist or is empty. Please check your content config file for errors.`),[]}c="data"}const g=Object.values("content"===c?t[r]:e[r]);let p=[];if(!Object.assign(__vite_import_meta_env__,{_:process.env._})?.DEV&&a.has(r))p=a.get(r);else{const t=pLimit(10);p=await Promise.all(g.map((e=>t((async()=>{const t=await e();return"content"===c?{id:t.id,slug:t.slug,body:t.body,collection:t.collection,data:t.data,render:async()=>render({collection:t.collection,id:t.id,renderEntryImport:await o(r,t.slug)})}:{id:t.id,collection:t.collection,data:t.data}}))))),a.set(r,p)}return i?p.filter(s):p.slice()}}function emulateLegacyEntry({legacyId:t,...e}){const o={...e,id:t,slug:e.id};return{...o,render:()=>renderEntry(o)}}z.object({tags:z.array(z.string()).optional(),maxAge:z.number().optional(),lastModified:z.date().optional()});const CONTENT_LAYER_IMAGE_REGEX=/__ASTRO_IMAGE_="([^"]+)"/g;async function updateImageReferencesInBody(t,e){const{default:o}=await import("./DBGgdkn5.js"),a=new Map,{getImage:n}=await import("./D0fbzody.js").then((t=>t._));for(const[r,s]of t.matchAll(CONTENT_LAYER_IMAGE_REGEX))try{const t=JSON.parse(s.replaceAll("&#x22;",'"'));let r;if(URL.canParse(t.src))r=await n(t);else{const s=imageSrcToImportId(t.src,e),i=o.get(s);if(!s||a.has(s)||!i)continue;r=await n({...t,src:i})}a.set(s,r)}catch{throw new Error(`Failed to parse image reference: ${s}`)}return t.replaceAll(CONTENT_LAYER_IMAGE_REGEX,((t,e)=>{const o=a.get(e);if(!o)return t;const{index:n,...r}=o.attributes;return Object.entries({...r,src:o.src,srcset:o.srcSet.attribute,...Object.assign(__vite_import_meta_env__,{_:process.env._}).DEV?{"data-image-component":"true"}:{}}).map((([t,e])=>e?`${t}="${escape(e)}"`:"")).join(" ")}))}function updateImageReferencesInData(t,e,o){return new Traverse(t).map((function(t,a){if("string"==typeof a&&a.startsWith("__ASTRO_IMAGE_")){const n=a.replace("__ASTRO_IMAGE_",""),r=imageSrcToImportId(n,e);if(!r)return void t.update(n);const s=o?.get(r);s?t.update(s):t.update(n)}}))}async function renderEntry(t){if(!t)throw new AstroError(RenderUndefinedEntryError);if("render"in t&&!("legacyId"in t))return t.render();if(t.deferredRender)try{const{default:e}=await import("./Oq6nGnVq.js"),o=e.get(t.filePath);return render({collection:"",id:t.id,renderEntryImport:o})}catch(t){console.error(t)}const e=t?.rendered?.metadata?.imagePaths?.length&&t.filePath?await updateImageReferencesInBody(t.rendered.html,t.filePath):t?.rendered?.html;return{Content:createComponent((()=>renderTemplate`${unescapeHTML(e)}`)),headings:t?.rendered?.metadata?.headings??[],remarkPluginFrontmatter:t?.rendered?.metadata?.frontmatter??{}}}async function render({collection:t,id:e,renderEntryImport:o}){const a=new AstroError({...UnknownContentCollectionError,message:`Unexpected error while rendering ${String(t)} â†’ ${String(e)}.`});if("function"!=typeof o)throw a;const n=await o();if(null==n||"object"!=typeof n)throw a;const{default:r}=n;if(isPropagatedAssetsModule(r)){const{collectedStyles:t,collectedLinks:o,collectedScripts:n,getMod:s}=r;if("function"!=typeof s)throw a;const i=await s();if(null==i||"object"!=typeof i)throw a;return{Content:createComponent({factory(a,r,s){let l="",c="",g="";Array.isArray(t)&&(l=t.map((t=>renderUniqueStylesheet(a,{type:"inline",content:t}))).join("")),Array.isArray(o)&&(c=o.map((t=>renderUniqueStylesheet(a,{type:"external",src:prependForwardSlash(t)}))).join("")),Array.isArray(n)&&(g=n.map((t=>renderScriptElement(t))).join(""));let p=r;return e.endsWith("mdx")&&(p={components:i.components??{},...r}),createHeadAndContent(unescapeHTML(l+c+g),renderTemplate`${renderComponent(a,"Content",i.Content,p,s)}`)},propagation:"self"}),headings:i.getHeadings?.()??[],remarkPluginFrontmatter:i.frontmatter??{}}}if(n.Content&&"function"==typeof n.Content)return{Content:n.Content,headings:n.getHeadings?.()??[],remarkPluginFrontmatter:n.frontmatter??{}};throw a}function isPropagatedAssetsModule(t){return"object"==typeof t&&null!=t&&"__astroPropagation"in t}const liveCollections={},contentDir="/src/content/",contentEntryGlob="",contentCollectionToEntryMap=createCollectionToGlobResultMap({globResult:"",contentDir:contentDir}),dataEntryGlob="",dataCollectionToEntryMap=createCollectionToGlobResultMap({globResult:"",contentDir:contentDir});createCollectionToGlobResultMap({globResult:{..."",...""},contentDir:contentDir});let lookupMap={};function createGlobLookup(t){return async(e,o)=>{const a=lookupMap[e]?.entries[o];if(a)return t[e][a]}}lookupMap={},new Set(Object.keys(lookupMap));const renderEntryGlob="",collectionToRenderEntryMap=createCollectionToGlobResultMap({globResult:"",contentDir:contentDir}),cacheEntriesByCollection=new Map,getCollection=createGetCollection({contentCollectionToEntryMap:contentCollectionToEntryMap,dataCollectionToEntryMap:dataCollectionToEntryMap,getRenderEntryImport:createGlobLookup(collectionToRenderEntryMap),cacheEntriesByCollection:cacheEntriesByCollection,liveCollections:liveCollections}),generatePermalink=async({id:t,slug:e,publishDate:o,category:a})=>{const n=String(o.getFullYear()).padStart(4,"0"),r=String(o.getMonth()+1).padStart(2,"0"),s=String(o.getDate()).padStart(2,"0"),i=String(o.getHours()).padStart(2,"0"),l=String(o.getMinutes()).padStart(2,"0"),c=String(o.getSeconds()).padStart(2,"0");return POST_PERMALINK_PATTERN.replace("%slug%",e).replace("%id%",t).replace("%category%",a||"").replace("%year%",n).replace("%month%",r).replace("%day%",s).replace("%hour%",i).replace("%minute%",l).replace("%second%",c).split("/").map((t=>trimSlash(t))).filter((t=>!!t)).join("/")},getNormalizedPost=async t=>{const{id:e,data:o}=t,{Content:a,remarkPluginFrontmatter:n}=await renderEntry(t),{publishDate:r=new Date,updateDate:s,title:i,excerpt:l,image:c,tags:g=[],category:p,author:u,draft:d=!1,metadata:m={}}=o,f=cleanSlug(e),y=new Date(r),h=s?new Date(s):void 0,_=p?{slug:cleanSlug(p),title:p}:void 0,E=g.map((t=>({slug:cleanSlug(t),title:t})));return{id:e,slug:f,permalink:await generatePermalink({id:e,slug:f,publishDate:y,category:_?.slug}),publishDate:y,updateDate:h,title:i,excerpt:l,image:c,category:_,tags:E,author:u,draft:d,metadata:m,Content:a,readingTime:n?.readingTime,tableOfContents:n?.tableOfContents}},load=async function(){const t=(await getCollection("post")).map((async t=>await getNormalizedPost(t)));return(await Promise.all(t)).sort(((t,e)=>e.publishDate.valueOf()-t.publishDate.valueOf())).filter((t=>!t.draft))};let _posts;const blogListRobots=APP_BLOG.list.robots,blogPostRobots=APP_BLOG.post.robots,blogCategoryRobots=APP_BLOG.category.robots,blogTagRobots=APP_BLOG.tag.robots,blogPostsPerPage=APP_BLOG?.postsPerPage,fetchPosts=async()=>(_posts||(_posts=await load()),_posts),findPostsByIds=async t=>{if(!Array.isArray(t))return[];const e=await fetchPosts();return t.reduce((function(t,o){return e.some((function(e){return o===e.id&&t.push(e)})),t}),[])},getStaticPathsBlogList=async({paginate:t})=>t(await fetchPosts(),{params:{blog:BLOG_BASE||void 0},pageSize:blogPostsPerPage}),getStaticPathsBlogPost=async()=>(await fetchPosts()).flatMap((t=>({params:{blog:t.permalink},props:{post:t}}))),getStaticPathsBlogCategory=async({paginate:t})=>{const e=await fetchPosts(),o={};return e.map((t=>{t.category?.slug&&(o[t.category?.slug]=t.category)})),Array.from(Object.keys(o)).flatMap((a=>t(e.filter((t=>t.category?.slug&&a===t.category?.slug)),{params:{category:a,blog:CATEGORY_BASE||void 0},pageSize:blogPostsPerPage,props:{category:o[a]}})))},getStaticPathsBlogTag=async({paginate:t})=>{const e=await fetchPosts(),o={};return e.map((t=>{Array.isArray(t.tags)&&t.tags.map((t=>{o[t?.slug]=t}))})),Array.from(Object.keys(o)).flatMap((a=>t(e.filter((t=>Array.isArray(t.tags)&&t.tags.find((t=>t.slug===a)))),{params:{tag:a,blog:TAG_BASE},pageSize:blogPostsPerPage,props:{tag:o[a]}})))};async function getRelatedPosts(t,e=4){const o=await fetchPosts(),a=new Set(t.tags?t.tags.map((t=>t.slug)):[]),n=o.reduce(((e,o)=>{if(o.slug===t.slug)return e;let n=0;return o.category&&t.category&&o.category.slug===t.category.slug&&(n+=5),o.tags&&o.tags.forEach((t=>{a.has(t.slug)&&(n+=1)})),e.push({post:o,score:n}),e}),[]);n.sort(((t,e)=>e.score-t.score));const r=[];let s=0;for(;r.length<e&&s<n.length;)r.push(n[s].post),s++;return r}export{getStaticPathsBlogTag as a,blogCategoryRobots as b,blogTagRobots as c,getStaticPathsBlogList as d,blogListRobots as e,fetchPosts as f,getStaticPathsBlogCategory as g,findPostsByIds as h,getRelatedPosts as i,blogPostRobots as j,getStaticPathsBlogPost as k};