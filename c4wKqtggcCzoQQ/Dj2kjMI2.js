import{s as t,d as e,p as s,D as o,a as i,b as r,S as a,c as n}from"./Yl74W1_V.js";import{G as d}from"./BhOqtWUN.js";import{s as c}from"./C3PoQbqi.js";import{l,g as p,u as g,d as b,j as h}from"./D9S2e7_F.js";import{r as m}from"./Cp0AaYFY.js";import"./pX-UiV6d.js";import"./BQYx6Aqu.js";import"./Cat91CNq.js";import"./D65aD4AJ.js";import"./eTeDo-nv.js";import"./DL3ZsMA_.js";import"./Dry_ln9w.js";import"./DmjLdZ15.js";import"./Du7MN9qP.js";import"./Ct-_TUOu.js";const u="rect",y="rectWithTitle",f="statediagram",x=`${f}-state`,w="transition",$=`${w} note-edge`,j=`${f}-note`,T=`${f}-cluster`,S=`${f}-cluster-alt`,A="parent",D="note",k="----",B=`${k}${D}`,v=`${k}${A}`,R="fill:none",E="fill: #333",V="text",N="normal";let C={},L=0;function M(t="",e=0,s="",o=k){return`state-${t}${null!==s&&s.length>0?`${o}${s}`:""}-${e}`}const P=(t,e,s,o,a,n)=>{const d=s.id,c=function(t){return null==t?"":t.classes?t.classes.join(" "):""}(o[d]);if("root"!==d){let e=u;!0===s.start&&(e="start"),!1===s.start&&(e="end"),s.type!==i&&(e=s.type),C[d]||(C[d]={id:d,shape:e,description:h.sanitizeText(d,p()),classes:`${c} ${x}`});const o=C[d];s.description&&(Array.isArray(o.description)?(o.shape=y,o.description.push(s.description)):o.description.length>0?(o.shape=y,o.description===d?o.description=[s.description]:o.description=[o.description,s.description]):(o.shape=u,o.description=s.description),o.description=h.sanitizeTextOrArray(o.description,p())),1===o.description.length&&o.shape===y&&(o.shape=u),!o.type&&s.doc&&(l.info("Setting cluster for ",d,z(s)),o.type="group",o.dir=z(s),o.shape=s.type===r?"divider":"roundedWithTitle",o.classes=o.classes+" "+T+" "+(n?S:""));const a={labelStyle:"",shape:o.shape,labelText:o.description,classes:o.classes,style:"",id:d,dir:o.dir,domId:M(d,L),type:o.type,padding:15,centerLabel:!0};if(s.note){const e={labelStyle:"",shape:"note",labelText:s.note.text,classes:j,style:"",id:d+B+"-"+L,domId:M(d,L,D),type:o.type,padding:15},i={labelStyle:"",shape:"noteGroup",labelText:s.note.text,classes:o.classes,style:"",id:d+v,domId:M(d,L,A),type:"group",padding:0};L++;const r=d+v;t.setNode(r,i),t.setNode(e.id,e),t.setNode(d,a),t.setParent(d,r),t.setParent(e.id,r);let n=d,l=e.id;"left of"===s.note.position&&(n=e.id,l=d),t.setEdge(n,l,{arrowhead:"none",arrowType:"",style:R,labelStyle:"",classes:$,arrowheadStyle:E,labelpos:"c",labelType:V,thickness:N})}else t.setNode(d,a)}e&&"root"!==e.id&&(l.trace("Setting node ",d," to be child of its parent ",e.id),t.setParent(d,e.id)),s.doc&&(l.trace("Adding nodes children "),W(t,s,s.doc,o,a,!n))},W=(t,e,s,o,r,d)=>{l.trace("items",s),s.forEach((s=>{switch(s.stmt){case n:case i:P(t,e,s,o,r,d);break;case a:{P(t,e,s.state1,o,r,d),P(t,e,s.state2,o,r,d);const i={id:"edge"+L,arrowhead:"normal",arrowTypeEnd:"arrow_barb",style:R,labelStyle:"",label:h.sanitizeText(s.description,p()),arrowheadStyle:E,labelpos:"c",labelType:V,thickness:N,classes:w};t.setEdge(s.state1.id,s.state2.id,i,L),L++}}}))},z=(t,e=o)=>{let s=e;if(t.doc)for(let e=0;e<t.doc.length;e++){const o=t.doc[e];"dir"===o.stmt&&(s=o.value)}return s},G={parser:s,db:e,renderer:{setConf:function(t){const e=Object.keys(t);for(const s of e)t[s]},getClasses:function(t,e){return e.db.extract(e.db.getRootDocV2()),e.db.getClasses()},draw:async function(t,e,s,o){l.info("Drawing state diagram (v2)",e),C={},o.db.getDirection();const{securityLevel:i,state:r}=p(),a=r.nodeSpacing||50,n=r.rankSpacing||50;l.info(o.db.getRootDocV2()),o.db.extract(o.db.getRootDocV2()),l.info(o.db.getRootDocV2());const h=o.db.getStates(),y=new d({multigraph:!0,compound:!0}).setGraph({rankdir:z(o.db.getRootDocV2()),nodesep:a,ranksep:n,marginx:8,marginy:8}).setDefaultEdgeLabel((function(){return{}}));let w;P(y,void 0,o.db.getRootDocV2(),h,o.db,!0),"sandbox"===i&&(w=c("#i"+e));const x=c("sandbox"===i?w.nodes()[0].contentDocument.body:"body"),$=x.select(`[id="${e}"]`),D=x.select("#"+e+" g");await m(D,y,["barb"],f,e),g.insertTitle($,"statediagramTitleText",r.titleTopMargin,o.db.getDiagramTitle());const j=$.node().getBBox(),T=j.width+16,A=j.height+16;$.attr("class",f);const S=$.node().getBBox();b($,A,T,r.useMaxWidth);const L=`${S.x-8} ${S.y-8} ${T} ${A}`;l.debug(`viewBox ${L}`),$.attr("viewBox",L);const k=document.querySelectorAll('[id="'+e+'"] .edgeLabel .label');for(const t of k){const e=t.getBBox(),s=document.createElementNS("http://www.w3.org/2000/svg",u);s.setAttribute("rx",0),s.setAttribute("ry",0),s.setAttribute("width",e.width),s.setAttribute("height",e.height),t.insertBefore(s,t.firstChild)}}},styles:t,init:t=>{t.state||(t.state={}),t.state.arrowMarkerAbsolute=t.arrowMarkerAbsolute,e.clear()}};export{G as diagram};