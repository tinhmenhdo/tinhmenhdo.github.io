import{j as e}from"./CY20i357.js";import{r as t,R as React}from"./Csf0KwDX.js";import{K as n}from"./DjM8UK5G.js";import{I as a,a as s}from"./D4g8n9Nk.js";import"./CVVDEXDJ.js";const xacDinhQue=e=>{const t=[...e].sort(((e,t)=>e.vi_tri-t.vi_tri)).reverse().map((e=>e.isYang?"1":"0")).join("");return s.findIndex((e=>e===t))},gieoQueKinhDich=()=>{const e=Array(6).fill(null).map(((e,t)=>(e=>{const t=Array(3).fill(null).map((()=>(()=>{const e=new Uint8Array(1);return crypto.getRandomValues(e),e[0]<128?"N":"S"})())).filter((e=>"N"===e)).length;let n;return n=3===t?"laoAm":0===t?"laoDuong":2===t?"thieuDuong":"thieuAm",{type:n,vi_tri:e,isYang:0===t||2===t}})(6-t))),t=xacDinhQue(e),n=(e=>{if(!e.some((e=>"laoAm"===e.type||"laoDuong"===e.type)))return null;const t=e.map((e=>({type:"laoAm"===e.type?"thieuDuong":"laoDuong"===e.type?"thieuAm":e.type,vi_tri:e.vi_tri,isYang:"laoAm"===e.type||"laoDuong"!==e.type&&e.isYang}))),n=xacDinhQue(t);return-1===n?null:{queIcon:a[n][0],queTen:a[n][1],queMeaning:a[n][2]}})(e),i=e.filter((e=>"laoAm"===e.type||"laoDuong"===e.type)).sort(((e,t)=>t.vi_tri-e.vi_tri)),s=[...e].sort(((e,t)=>t.vi_tri-e.vi_tri));return{queIcon:a[t][0],queTen:a[t][1],queMeaning:a[t][2],haoResults:s,haoDong:i,queBien:n,queGocIndex:t}},i={CANVAS_WIDTH:850,CANVAS_HEIGHT:850,BASE_RADIUS_RATIO:.4,CIRCLE_RATIOS:{OUTER_MOST:1.12,OUTER:.95,HAO_6:.77,HAO_5:.685,HAO_4:.602,HAO_3:.52,HAO_2:.44,HAO_1:.36,INNER:.2},HAO_CONFIG:{CIRCLES:{HAO_6:{LINE_COLOR:"#000",LINE_WIDTH:1.5,DASH:[]},HAO_5:{LINE_COLOR:"#000",LINE_WIDTH:1.2,DASH:[]},HAO_4:{LINE_COLOR:"#000",LINE_WIDTH:1,DASH:[]},HAO_3:{LINE_COLOR:"#000",LINE_WIDTH:.8,DASH:[]},HAO_2:{LINE_COLOR:"#000",LINE_WIDTH:.6,DASH:[]},HAO_1:{LINE_COLOR:"#000",LINE_WIDTH:.5,DASH:[]}},ARC_CONFIG:{ANGLE_SPAN:5.625,HAO_6:{LAO_AM:{FILL:"#444",TEXT_COLOR:"white"},THIEU_DUONG:{FILL:"#f5f5f5",TEXT_COLOR:"transparent"},LAO_DUONG:{FILL:"#fff",TEXT_COLOR:"black"},THIEU_AM:{FILL:"#e0e0e0",TEXT_COLOR:"transparent"}},HAO_5:{LAO_AM:{FILL:"#444",TEXT_COLOR:"white"},THIEU_DUONG:{FILL:"#f5f5f5",TEXT_COLOR:"transparent"},LAO_DUONG:{FILL:"#fff",TEXT_COLOR:"black"},THIEU_AM:{FILL:"#e0e0e0",TEXT_COLOR:"transparent"}},HAO_4:{LAO_AM:{FILL:"#444",TEXT_COLOR:"white"},THIEU_DUONG:{FILL:"#f5f5f5",TEXT_COLOR:"transparent"},LAO_DUONG:{FILL:"#fff",TEXT_COLOR:"black"},THIEU_AM:{FILL:"#e0e0e0",TEXT_COLOR:"transparent"}},HAO_3:{LAO_AM:{FILL:"#444",TEXT_COLOR:"white"},THIEU_DUONG:{FILL:"#f5f5f5",TEXT_COLOR:"transparent"},LAO_DUONG:{FILL:"#fff",TEXT_COLOR:"black"},THIEU_AM:{FILL:"#e0e0e0",TEXT_COLOR:"transparent"}},HAO_2:{LAO_AM:{FILL:"#444",TEXT_COLOR:"white"},THIEU_DUONG:{FILL:"#f5f5f5",TEXT_COLOR:"transparent"},LAO_DUONG:{FILL:"#fff",TEXT_COLOR:"black"},THIEU_AM:{FILL:"#e0e0e0",TEXT_COLOR:"transparent"}},HAO_1:{LAO_AM:{FILL:"#444",TEXT_COLOR:"white"},THIEU_DUONG:{FILL:"#f5f5f5",TEXT_COLOR:"transparent"},LAO_DUONG:{FILL:"#fff",TEXT_COLOR:"black"},THIEU_AM:{FILL:"#e0e0e0",TEXT_COLOR:"transparent"}}},TEXT_CONFIG:{FONT_SIZE:{HAO_6:13,HAO_5:12,HAO_4:11,HAO_3:10,HAO_2:9,HAO_1:8},FONT_FAMILY:"Arial",OFFSET_RATIO:1/3},SPACING:{ANGLE_OFFSET:0,ROTATION_OFFSET:90}},TEXT_POSITIONS:{OUTER_HEXAGRAM:1.05,OUTER_NUMBER:.985,HEXAGRAM:.88,NUMBER:.81},FONT_SIZES:{OUTER_HEXAGRAM:29,OUTER_NUMBER:15,INNER_HEXAGRAM:27,INNER_NUMBER:14,HAO_NUMBER:12},ARROW:{LENGTH:.8,POINTER_LENGTH:21,POINTER_WIDTH:7,STROKE_WIDTH:2}},calculateCanvasSize=e=>{let t;return t=e<640?Math.min(e-32,400):e<1024?Math.min(e-64,600):850,{width:t,height:t}},calculateFontSizes=e=>{const t=e/850;return{OUTER_HEXAGRAM:Math.max(20,Math.floor(31*t)),OUTER_NUMBER:Math.max(12,Math.floor(15*t)),INNER_HEXAGRAM:Math.max(18,Math.floor(27*t)),INNER_NUMBER:Math.max(10,Math.floor(14*t)),HAO_NUMBER:Math.max(8,Math.floor(12*t))}},calculateTargetAngle=e=>360-(5.625*e+2.8125)+3600,createHaoWheel=({centerX:e,centerY:t,baseRadius:a,haoNumber:s})=>{const r=new n.Group,o=i.CIRCLE_RATIOS[`HAO_${s}`],l=i.HAO_CONFIG.CIRCLES[`HAO_${s}`],c=s>1?i.CIRCLE_RATIOS["HAO_"+(s-1)]:i.CIRCLE_RATIOS.INNER;for(let e=0;e<64;e++){const t=5.625*e;let l,O=!1;switch(e%4){case 0:l=i.HAO_CONFIG.ARC_CONFIG[`HAO_${s}`].LAO_AM,O=!0;break;case 1:l=i.HAO_CONFIG.ARC_CONFIG[`HAO_${s}`].THIEU_DUONG;break;case 2:l=i.HAO_CONFIG.ARC_CONFIG[`HAO_${s}`].LAO_DUONG,O=!0;break;case 3:l=i.HAO_CONFIG.ARC_CONFIG[`HAO_${s}`].THIEU_AM}const _=new n.Arc({innerRadius:a*c+1,outerRadius:a*o,angle:i.HAO_CONFIG.ARC_CONFIG.ANGLE_SPAN,rotation:t,fill:l.FILL});if(r.add(_),O){const e=1===s?a*(.85*o+.15*c):a*(o+c)/2,O=new n.Group({x:Math.cos((t+2.8125)*Math.PI/180)*e,y:Math.sin((t+2.8125)*Math.PI/180)*e,rotation:t+i.HAO_CONFIG.SPACING.ROTATION_OFFSET}),_=new n.Text({text:s.toString(),fontSize:i.HAO_CONFIG.TEXT_CONFIG.FONT_SIZE[`HAO_${s}`],fontFamily:i.HAO_CONFIG.TEXT_CONFIG.FONT_FAMILY,fill:l.TEXT_COLOR,align:"center",verticalAlign:"middle",x:-i.HAO_CONFIG.TEXT_CONFIG.FONT_SIZE[`HAO_${s}`]*i.HAO_CONFIG.TEXT_CONFIG.OFFSET_RATIO,y:-i.HAO_CONFIG.TEXT_CONFIG.FONT_SIZE[`HAO_${s}`]*i.HAO_CONFIG.TEXT_CONFIG.OFFSET_RATIO});O.add(_),r.add(O)}}if(s>1)for(let e=0;e<64;e++){const t=5.625*e*Math.PI/180,i=Math.cos(t)*a*o,s=Math.sin(t)*a*o,l=Math.cos(t)*a*c,O=Math.sin(t)*a*c,_=new n.Line({points:[i,s,l,O],stroke:"#000",strokeWidth:.5});r.add(_)}else{const e=i.CIRCLE_RATIOS.INNER;for(let t=0;t<64;t++){const i=5.625*t*Math.PI/180,s=Math.cos(i)*a*o,l=Math.sin(i)*a*o,c=Math.cos(i)*a*e,O=Math.sin(i)*a*e,_=new n.Line({points:[s,l,c,O],stroke:"#000",strokeWidth:.5});r.add(_)}}const O=new n.Circle({radius:a*o,stroke:l.LINE_COLOR,strokeWidth:l.LINE_WIDTH,dash:l.DASH,listening:!1});return r.add(O),r},getRandomNumber=(e,t)=>Math.random()*(t-e)+e,ResultDisplay=({showResult:t,isSpinning:n,result:i})=>e.jsx("div",{className:"w-full mt-8 md:mt-16",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-center min-h-[400px] bg-white rounded-lg shadow-lg",children:[e.jsx("div",{className:"border-r border-gray-300 p-8",children:e.jsx("div",{className:"min-h-[400px]",children:t&&i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xl mb-4",children:"Quẻ Chủ"}),e.jsxs("div",{className:"text-lg mb-2 text-blue-600",children:["Quẻ số ",i.queGocIndex+1]}),e.jsx("div",{className:"text-7xl mb-4",children:i.queIcon}),e.jsx("div",{className:"text-2xl font-bold mb-4",children:i.queTen}),e.jsx("div",{className:"text-base",children:i.queMeaning})]}):e.jsx("div",{className:"text-xl text-gray-500",children:n?"Đang xoay...":"Chưa có kết quả"})})}),e.jsx("div",{className:"p-8",children:e.jsxs("div",{className:"min-h-[400px]",children:[e.jsx("div",{className:"text-xl mb-6",children:"Hào Động"}),t&&i&&i.haoDong.length>0?i.haoDong.map((t=>e.jsxs("div",{className:"text-lg mb-2 text-left w-52 mx-auto",children:[e.jsxs("span",{className:"w-14 inline-block mr-2",children:["Hào ",t.vi_tri," :"]}),"laoAm"===t.type?e.jsx("span",{className:"text-black-500",children:"Âm Động"}):e.jsx("span",{className:"text-red-700",children:"Dương Động"})]},t.vi_tri))):e.jsx("div",{className:"text-lg text-gray-500",children:n?"Đang xoay...":"Không có hào động"})]})}),e.jsx("div",{className:"border-l border-gray-300 p-8",children:e.jsx("div",{className:"min-h-[400px]",children:t&&i?.queBien?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xl mb-4",children:"Quẻ Biến"}),e.jsxs("div",{className:"text-lg mb-2 text-blue-600",children:["Quẻ số ",a.findIndex((e=>e[0]===i.queBien?.queIcon))+1]}),e.jsx("div",{className:"text-7xl mb-4",children:i.queBien.queIcon}),e.jsx("div",{className:"text-2xl font-bold mb-4",children:i.queBien.queTen}),e.jsx("div",{className:"text-base",children:i.queBien.queMeaning})]}):e.jsx("div",{className:"text-lg text-gray-500",children:n?"Đang xoay...":"Không có quẻ biến"})})})]})}),IChingDiagram=()=>{const s=t.useRef(null),{width:r}=(()=>{const[e,n]=t.useState({width:"undefined"!=typeof window?window.innerWidth:0,height:"undefined"!=typeof window?window.innerHeight:0});return t.useEffect((()=>{const e=()=>{n({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),e})(),[o,l]=t.useState(calculateCanvasSize(r)),[c,O]=t.useState(calculateFontSizes(o.width)),[_,h]=t.useState(!1),[d,A]=t.useState(null),[T,I]=t.useState(null),[u,R]=t.useState(null),[E,N]=t.useState(null),[m,f]=t.useState(!1),[L,x]=t.useState(null),C=t.useRef([]),M=t.useRef([]),g=t.useRef(null);return React.useEffect((()=>{const e=calculateCanvasSize(r);l(e),O(calculateFontSizes(e.width))}),[r]),React.useEffect((()=>{if(!s.current)return;C.current=[],M.current=[];const e=o.width,t=o.height,r=e/2,l=t/2,O=e*i.BASE_RADIUS_RATIO,_=new n.Stage({container:"canvas-container",width:e,height:t}),h=new n.Layer,d=new n.Arrow({points:[r,l,r,l-O*i.ARROW.LENGTH],pointerLength:i.ARROW.POINTER_LENGTH,pointerWidth:i.ARROW.POINTER_WIDTH,fill:"#FF0000",stroke:"#FF0000",strokeWidth:i.ARROW.STROKE_WIDTH,opacity:.7,listening:!1});h.add(d);const T=(({centerX:e,centerY:t,baseRadius:s,fontSizes:r})=>{const o=new n.Group({x:e,y:t,offset:{x:0,y:0},rotation:0}),l=new n.Circle({radius:s*i.CIRCLE_RATIOS.OUTER,stroke:"#000",strokeWidth:1});o.add(l);for(let e=0;e<64;e++){const t=5.625*e*Math.PI/180,a=Math.cos(t)*s*i.CIRCLE_RATIOS.OUTER,r=Math.sin(t)*s*i.CIRCLE_RATIOS.OUTER,l=Math.cos(t)*s*i.CIRCLE_RATIOS.HAO_6,c=Math.sin(t)*s*i.CIRCLE_RATIOS.HAO_6,O=new n.Line({points:[a,r,l,c],stroke:"#000",strokeWidth:1});o.add(O)}return a.map(((e,t)=>({symbol:e[0],number:t+1}))).forEach(((e,t)=>{const a=(5.625*t-90+2.8125)*Math.PI/180,l=(5.625*t-90+2.8125)*Math.PI/180,c=s*i.TEXT_POSITIONS.HEXAGRAM,O=Math.cos(a)*c,_=Math.sin(a)*c,h=s*i.TEXT_POSITIONS.NUMBER,d=Math.cos(l)*h,A=Math.sin(l)*h,T=new n.Group({x:O,y:_,rotation:5.625*t+2.8125}),I=new n.Text({text:e.symbol,fontSize:r.INNER_HEXAGRAM,fontFamily:"Arial",fill:"black",align:"center",offsetX:r.INNER_HEXAGRAM/2,offsetY:r.INNER_HEXAGRAM/2}),u=new n.Group({x:d,y:A,rotation:5.625*t+2.8125}),R=new n.Text({text:e.number.toString(),fontSize:r.INNER_NUMBER,fontFamily:"Arial",fill:"black",align:"center",offsetX:r.INNER_NUMBER/2,offsetY:r.INNER_NUMBER/2});T.add(I),u.add(R),o.add(T,u)})),o})({centerX:r,centerY:l,baseRadius:O,fontSizes:c});for(let e=1;e<=6;e++){const t=new n.Group({x:r,y:l}),a=createHaoWheel({centerX:r,centerY:l,baseRadius:O,haoNumber:e});t.add(a),h.add(t),C.current.push(t),M.current.push(a)}const u=new n.Circle({x:r,y:l,radius:O*i.CIRCLE_RATIOS.INNER,stroke:"#000",strokeWidth:1,listening:!1});g.current=u,h.add(u);const E=(({centerX:e,centerY:t,baseRadius:s,fontSizes:r})=>{const o=new n.Group({x:e,y:t,offset:{x:0,y:0},rotation:0}),l=new n.Circle({radius:s*i.CIRCLE_RATIOS.OUTER_MOST,stroke:"#000",strokeWidth:1});o.add(l);for(let e=0;e<64;e++){const t=5.625*e*Math.PI/180,a=Math.cos(t)*s*i.CIRCLE_RATIOS.OUTER_MOST,r=Math.sin(t)*s*i.CIRCLE_RATIOS.OUTER_MOST,l=Math.cos(t)*s*i.CIRCLE_RATIOS.OUTER,c=Math.sin(t)*s*i.CIRCLE_RATIOS.OUTER,O=new n.Line({points:[a,r,l,c],stroke:"#000",strokeWidth:1});o.add(O)}return a.map(((e,t)=>({symbol:e[0],number:t+1}))).forEach(((e,t)=>{const a=(5.625*t-90+2.8125)*Math.PI/180,l=(5.625*t-90+2.8125)*Math.PI/180,c=s*i.TEXT_POSITIONS.OUTER_HEXAGRAM,O=Math.cos(a)*c,_=Math.sin(a)*c,h=s*i.TEXT_POSITIONS.OUTER_NUMBER,d=Math.cos(l)*h,A=Math.sin(l)*h,T=new n.Group({x:O,y:_,rotation:5.625*t+2.8125}),I=new n.Text({text:e.symbol,fontSize:r.OUTER_HEXAGRAM,fontFamily:"Arial",fill:"black",align:"center",offsetX:r.OUTER_HEXAGRAM/2,offsetY:r.OUTER_HEXAGRAM/2}),u=new n.Group({x:d,y:A,rotation:5.625*t+2.8125}),R=new n.Text({text:e.number.toString(),fontSize:r.OUTER_NUMBER,fontFamily:"Arial",fill:"black",align:"center",offsetX:r.OUTER_NUMBER/2,offsetY:r.OUTER_NUMBER/2});T.add(I),u.add(R),o.add(T,u)})),o})({centerX:r,centerY:l,baseRadius:O,fontSizes:c});return h.add(T),h.add(E),d.remove(),h.add(d),_.add(h),A(_),R(h),I(T),x(E),()=>{_.destroy()}}),[o,c]),e.jsx("div",{className:"flex flex-col items-center min-h-screen",children:e.jsxs("div",{className:"w-full max-w-[1200px] min-h-[calc(100vh-4rem)] flex flex-col items-center justify-start p-4 md:p-8 max-md:p-0",children:[e.jsxs("div",{className:"relative",style:{width:o.width,height:o.height},children:[e.jsx("div",{ref:s,id:"canvas-container",className:"w-full h-full bg-white rounded-lg shadow-lg"}),e.jsx("button",{onClick:()=>{if(_||!T||!u||!L)return;h(!0),f(!1);const e=gieoQueKinhDich(),t=calculateTargetAngle(e.queGocIndex),i=e.queBien?calculateTargetAngle(a.findIndex((t=>t[0]===e.queBien?.queIcon))):null;(e=>{const t=M.current;t&&t.length&&u&&e.map((e=>({type:e.type||"không động",viTri:e.viTri||e.vi_tri}))).forEach((e=>{const a=Number(e.viTri)-1,i=t[a];i&&((e,t,a,i=getRandomNumber(4500,5500))=>{const s=a.type,r=a.viTri??a.vi_tri??0,o=r%2==0,l=((e,t=!1,n=0)=>{const a=5.625,i=4*Math.floor(n/4)*a;let s;switch(e){case"laoAm":s=0;break;case"thieuDuong":s=1;break;case"laoDuong":s=2;break;case"thieuAm":s=3}const r=i+s*a+2.8125-a,o="laoAm"===e||"laoDuong"===e?360:0,l=r+(t?-o:o);let c;return c=t?-3600+l:3600+l,{position:n,angle:r,extraAngle:o,targetRotation:c,normalizedAngle:(l%360+360)%360,isReverse:t}})(s,o,r);let c=0,O=e.rotation(),_=0;const h=getRandomNumber(2800,3200),d=l.targetRotation,A=new n.Animation((n=>{if(!n)return;const a=Math.min(n.time/i,1),s=n.time-c;let r;if(c=n.time,a<.3){const e=a/.3;r=h*Math.pow(e,2)}else if(a<.7)r=h;else{const e=(a-.7)/.3,t=1-Math.pow(1-e,3);r=h*(1-t)}_=.95*_+.05*r;const T=_*s/1e3;O+=o?-T:T;const I=(O%360+360)%360;if(e.rotation(I),a>=.95){const t=d-O;if(Math.abs(t)<.1){const t=l.normalizedAngle,n=Math.min((a-.95)/.05,1),i=O*(1-n)+t*n;e.rotation(i),a>=.999&&(e.rotation(t),A.stop())}else{const n=.15*Math.pow(1-20*(1-a),3);O+=t*n;const i=(O%360+360)%360;e.rotation(i)}}t.batchDraw()}),t);return A})(i,u,e).start()}))})(e.haoResults);const s=((e,t,n,a=6e3,i)=>{const{wheelGroup:s,trigramGroup:r,outerWheelGroup:o,layer:l}=e;s.cache(),r.cache(),o.cache();const c=s.rotation();let O=0,_=c,h=0,d=0;const A=e=>{o.opacity(e)},T=o.opacity()??1;A(T);const I=null!==n?n:0;let u,R=0,E=null;const N=e=>1-Math.pow(1-e,4),m=e=>{E||(E=e);const c=e-E,f=Math.min(c/a,1),L=e-O;let x;if(O=e,f<.4)x=3600;else if(f<.8)x=3600*(1-N((f-.4)/.4));else{const e=t-_,n=N(1-(f-.8)/.2);x=e/a*1e3*n*5}const C=N(f);let M;if(h=h*(1-.02*C)+x*(.02*C),_+=h*L/1e3,s.rotation(_),r.rotation(-_),f<.4)M=-3600;else if(f<.8)M=-3600*(1-N((f-.4)/.4));else{const e=I-R,t=N(1-(f-.8)/.2);M=e/a*1e3*t*3}if(d=d*(1-.02*C)+M*(.02*C),R+=d*L/1e3,o.rotation(R),f>.4)if(null===n){const e=Math.min((f-.4)/.4,1),t=N(e);A(Math.max(0,T*(1-t)))}else{const e=Math.min((f-.4)/.4,1),t=N(e);A(Math.min(1,T+t))}if(l.batchDraw(),f<1)u=requestAnimationFrame(m);else{const e=t-_,n=I-R;Math.abs(e)>.01||Math.abs(n)>.01?(_+=.1*e,R+=.1*n,s.rotation(_),r.rotation(-_),o.rotation(R),l.batchDraw(),u=requestAnimationFrame(m)):(s.clearCache(),r.clearCache(),o.clearCache(),i())}};return u=requestAnimationFrame(m),{stop:()=>{u&&(cancelAnimationFrame(u),s.clearCache(),r.clearCache(),o.clearCache())}}})({wheelGroup:T,trigramGroup:new n.Group,outerWheelGroup:L,layer:u},t,i,6e3,(()=>{h(!1),setTimeout((()=>{f(!0)}),10)}));s&&N(e)},disabled:_,className:"absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 w-32 h-32 md:w-48 md:h-48 rounded-full border-2 border-gray-300 shadow-lg flex items-center justify-center transition-all disabled:cursor-not-allowed max-md:size-20 "+(_?"bg-black":"bg-white hover:bg-gray-50"),children:e.jsx("span",{className:"font-bold text-lg md:text-2xl "+(_?"text-white":"text-gray-800"),children:"XOAY"})})]}),e.jsx(ResultDisplay,{showResult:m,isSpinning:_,result:E})]})})};export{IChingDiagram as default};