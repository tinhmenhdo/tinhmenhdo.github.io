import{s as t,d as e,p as s,D as o,a as i,b as r,S as a,c as n}from"./C2E2tGfU.js";import{G as d}from"./DXsOrjqw.js";import{s as c}from"./YNytrViW.js";import{l,g as p,u as g,d as b,i as m}from"./EJQIl0cW.js";import{r as h}from"./D6MvS-cg.js";import"./pX-UiV6d.js";import"./DpyCxe6S.js";import"./DHCmnciC.js";import"./Cat91CNq.js";import"./DTM1MnlC.js";import"./DQE3TW1K.js";import"./ZCp-Frqv.js";import"./CALNBksi.js";import"./DmjLdZ15.js";import"./Du7MN9qP.js";import"./Ct-_TUOu.js";import"./Bq1fMrfD.js";import"./DJoO2p0P.js";const u="rect",y="rectWithTitle",f="statediagram",x=`${f}-state`,w="transition",$=`${w} note-edge`,j=`${f}-note`,T=`${f}-cluster`,S=`${f}-cluster-alt`,D="parent",A="note",B="----",k=`${B}${A}`,v=`${B}${D}`,E="fill:none",R="fill: #333",V="text",C="normal";let L={},N=0;function G(t="",e=0,s="",o=B){return`state-${t}${null!==s&&s.length>0?`${o}${s}`:""}-${e}`}const I=(t,e,s,o,a,n)=>{const d=s.id,c=function(t){return null==t?"":t.classes?t.classes.join(" "):""}(o[d]);if("root"!==d){let e=u;!0===s.start&&(e="start"),!1===s.start&&(e="end"),s.type!==i&&(e=s.type),L[d]||(L[d]={id:d,shape:e,description:m.sanitizeText(d,p()),classes:`${c} ${x}`});const o=L[d];s.description&&(Array.isArray(o.description)?(o.shape=y,o.description.push(s.description)):o.description.length>0?(o.shape=y,o.description===d?o.description=[s.description]:o.description=[o.description,s.description]):(o.shape=u,o.description=s.description),o.description=m.sanitizeTextOrArray(o.description,p())),1===o.description.length&&o.shape===y&&(o.shape=u),!o.type&&s.doc&&(l.info("Setting cluster for ",d,P(s)),o.type="group",o.dir=P(s),o.shape=s.type===r?"divider":"roundedWithTitle",o.classes=o.classes+" "+T+" "+(n?S:""));const a={labelStyle:"",shape:o.shape,labelText:o.description,classes:o.classes,style:"",id:d,dir:o.dir,domId:G(d,N),type:o.type,padding:15,centerLabel:!0};if(s.note){const e={labelStyle:"",shape:"note",labelText:s.note.text,classes:j,style:"",id:d+k+"-"+N,domId:G(d,N,A),type:o.type,padding:15},i={labelStyle:"",shape:"noteGroup",labelText:s.note.text,classes:o.classes,style:"",id:d+v,domId:G(d,N,D),type:"group",padding:0};N++;const r=d+v;t.setNode(r,i),t.setNode(e.id,e),t.setNode(d,a),t.setParent(d,r),t.setParent(e.id,r);let n=d,l=e.id;"left of"===s.note.position&&(n=e.id,l=d),t.setEdge(n,l,{arrowhead:"none",arrowType:"",style:E,labelStyle:"",classes:$,arrowheadStyle:R,labelpos:"c",labelType:V,thickness:C})}else t.setNode(d,a)}e&&"root"!==e.id&&(l.trace("Setting node ",d," to be child of its parent ",e.id),t.setParent(d,e.id)),s.doc&&(l.trace("Adding nodes children "),M(t,s,s.doc,o,a,!n))},M=(t,e,s,o,r,d)=>{l.trace("items",s),s.forEach((s=>{switch(s.stmt){case n:case i:I(t,e,s,o,r,d);break;case a:{I(t,e,s.state1,o,r,d),I(t,e,s.state2,o,r,d);const i={id:"edge"+N,arrowhead:"normal",arrowTypeEnd:"arrow_barb",style:E,labelStyle:"",label:m.sanitizeText(s.description,p()),arrowheadStyle:R,labelpos:"c",labelType:V,thickness:C,classes:w};t.setEdge(s.state1.id,s.state2.id,i,N),N++}}}))},P=(t,e=o)=>{let s=e;if(t.doc)for(let e=0;e<t.doc.length;e++){const o=t.doc[e];"dir"===o.stmt&&(s=o.value)}return s},z={parser:s,db:e,renderer:{setConf:function(t){const e=Object.keys(t);for(const s of e)t[s]},getClasses:function(t,e){return e.db.extract(e.db.getRootDocV2()),e.db.getClasses()},draw:async function(t,e,s,o){l.info("Drawing state diagram (v2)",e),L={},o.db.getDirection();const{securityLevel:i,state:r}=p(),a=r.nodeSpacing||50,n=r.rankSpacing||50;l.info(o.db.getRootDocV2()),o.db.extract(o.db.getRootDocV2()),l.info(o.db.getRootDocV2());const m=o.db.getStates(),y=new d({multigraph:!0,compound:!0}).setGraph({rankdir:P(o.db.getRootDocV2()),nodesep:a,ranksep:n,marginx:8,marginy:8}).setDefaultEdgeLabel((function(){return{}}));let w;I(y,void 0,o.db.getRootDocV2(),m,o.db,!0),"sandbox"===i&&(w=c("#i"+e));const x=c("sandbox"===i?w.nodes()[0].contentDocument.body:"body"),D=x.select(`[id="${e}"]`),j=x.select("#"+e+" g");await h(j,y,["barb"],f,e),g.insertTitle(D,"statediagramTitleText",r.titleTopMargin,o.db.getDiagramTitle());const $=D.node().getBBox(),T=$.width+16,S=$.height+16;D.attr("class",f);const N=D.node().getBBox();b(D,S,T,r.useMaxWidth);const C=`${N.x-8} ${N.y-8} ${T} ${S}`;l.debug(`viewBox ${C}`),D.attr("viewBox",C);const A=document.querySelectorAll('[id="'+e+'"] .edgeLabel .label');for(const t of A){const e=t.getBBox(),s=document.createElementNS("http://www.w3.org/2000/svg",u);s.setAttribute("rx",0),s.setAttribute("ry",0),s.setAttribute("width",e.width),s.setAttribute("height",e.height),t.insertBefore(s,t.firstChild)}}},styles:t,init:t=>{t.state||(t.state={}),t.state.arrowMarkerAbsolute=t.arrowMarkerAbsolute,e.clear()}};export{z as diagram};