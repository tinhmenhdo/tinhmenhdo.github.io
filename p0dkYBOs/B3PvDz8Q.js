import dayjs from"dayjs";import{b as CAN,C as CHI,A as AREA_NAME,c as ADTN,d as SKB,H as HH,L as LTHG_HH,S as SM,e as HH_THAP,f as CAN_HH,g as CAN_TSTB,a as ICHING_NUMBER,h as CAN_AD,i as LTHG,j as CHI_AD,x as xtngl,k as CAN_HOA,l as buildDateInfo,G as GETHOA,m as StarToHoaCan,n as StarUseHoa,o as STARSTRONG,p as STAR_SIGN,q as CR_TS,F as FAILURE6,r as CHI_CAN}from"./3qCOaK8U.js";import{c as convertSolar2Lunar}from"./tv8_ghms.js";const configDefault=Object.freeze([1,2,3,0,0,0,1,1,0,0,0,0,0,1,0,1,1,0,0,0,2,0,0]);var CfgValue=(t=>(t[t.lsCanType=0]="lsCanType",t[t.typeLs=1]="typeLs",t[t.typePhiHoa=2]="typePhiHoa",t[t.showHideStar=3]="showHideStar",t[t.currentStar=4]="currentStar",t[t.dvTuHoa=5]="dvTuHoa",t[t.locKiToanDo=6]="locKiToanDo",t[t.tuanHoanZone=7]="tuanHoanZone",t[t.lnTuHoa=8]="lnTuHoa",t[t.lnDHCQH=9]="lnDHCQH",t[t.lnKVXK=10]="lnKVXK",t[t.lnTuTr=11]="lnTuTr",t[t.isADSat=12]="isADSat",t[t.batTuCenter=13]="batTuCenter",t[t.batTuCung=14]="batTuCung",t[t.isNapAmCung=15]="isNapAmCung",t[t.showSun=16]="showSun",t[t.shortStar=17]="shortStar",t[t.rotateZone=18]="rotateZone",t[t.drawByZone=19]="drawByZone",t[t.showHoaIcon=20]="showHoaIcon",t[t.tcpb=21]="tcpb",t[t.dvStar=22]="dvStar",t))(CfgValue||{});const LsTypeSlug=["la-so-tu-vi-viet-nam","luong-phai-nam-phai","kham-thien-tu-hoa-nam-phai","tu-vi-nam-phai","tu-vi-phi-tinh-luong-phai","tu-vi-kham-thien-tu-hoa","tu-vi-trung-chau-phai","tu-vi-trung-chau-phai-kham-thien","tu-vi-trung-chau-luong-phai"];var StlkName=(t=>(t[t.numLoc=0]="numLoc",t[t.numKi=1]="numKi",t[t.currentLoc=2]="currentLoc",t[t.isMoveLoc=3]="isMoveLoc",t[t.isMoveKi=4]="isMoveKi",t[t.isTruyLoc=5]="isTruyLoc",t[t.isTruyKi=6]="isTruyKi",t))(StlkName||{}),ZolkName=(t=>(t[t.isMoveLoc=0]="isMoveLoc",t[t.totalLoc=1]="totalLoc",t[t.currentLoc=2]="currentLoc",t[t.isMoveAllLoc=3]="isMoveAllLoc",t[t.locKeep=4]="locKeep",t[t.isMoveNienLoc=5]="isMoveNienLoc",t[t.isMoveKi=0]="isMoveKi",t[t.totalKi=1]="totalKi",t[t.currentKi=2]="currentKi",t))(ZolkName||{}),TH=(t=>(t[t.L=0]="L",t[t.Q=1]="Q",t[t.Z=2]="Z",t[t.K=3]="K",t))(TH||{});function getSexText(t){return 1===t.sx?"Nam":"Nữ"}function getLunaBornText(t){return{y:`${CAN[t.dtb.bs.y[0]]} ${CHI[t.dtb.bs.y[1]]}`,m:`${CAN[t.dtb.bs.m[0]]} ${CHI[t.dtb.bs.m[1]]}`,d:`${CAN[t.dtb.bs.d[0]]} ${CHI[t.dtb.bs.d[1]]}`,h:`${CAN[t.dtb.bs.h[0]]} ${CHI[t.dtb.bs.h[1]]}`}}function getBaseText(t){let s=AREA_NAME[t.ars[t.at].ai];return s===AREA_NAME[10]&&(s=t.sx>0?"THÊ":"PHU"),{ad:`${t.ad>0?ADTN[1]:ADTN[0]}`,adage:`${t.adye>0?"Dương":"Âm"} ${getSexText(t)}`,sk:`${SKB[t.sks]}`,hmenh:`${HH[LTHG_HH[t.dtb.bs.y[2]]]}`,cuc:`${HH[t.cid]}`,tcu:s,mchu:`${SM[t.mctc[0]].name}`,tchu:`${SM[t.mctc[1]].name}`}}function hoa2IchingIdx(t){const s=[[1,1],[0,1],[1,0],[0,0]];let i=[];i=i.concat(s[t[0]],s[t[1]],s[t[2]]);return ICHING_NUMBER.indexOf(i.join(""))}function sameAD(t,s){return CAN_AD[t]===CAN_AD[s]?1:0}function idxTHAP(t,s){return HH_THAP[CAN_HH[t]][CAN_HH[s]][sameAD(t,s)]}function idxTSTutru(t,s){return CAN_TSTB[t][s]}const VERSION_HORO="2024.09.13";class CalculationHelper{jumpDown(t){return(t+11)%12}jumpUp(t){return(t+1)%12}idxAfterMove(t,s,i=!0){let h=i?this.jumpDown(t):this.jumpUp(t);for(let t=1;t<=s;t++)h=i?this.jumpUp(h):this.jumpDown(h);return h}canJumpDown(t){return(t-1+10)%10}canJumpUp(t){return(t+1)%10}}const CIRCLE_LENGTH=12,TRUONG_SINH_START=40,BAC_SI_START=28,THAI_TUE_START=15,MT_TRUONG=new Map([[2,8],[3,11],[4,5],[5,8],[6,2]]),MT_BS=new Map([[0,8],[1,9],[2,11],[3,0],[4,2],[5,3],[6,5],[7,6],[8,5],[9,6]]);class CirclePlacer{hsc;constructor(t){this.hsc=t}fillGrowCircle(){let t=MT_TRUONG.get(this.hsc.cid)??0,s=40;for(let i=0;i<12;i+=1)this.hsc.addStar(t,s,PrefixArea.SmallStar),t=this.hsc.jumbByYinBoyYanGirl(t),s+=1}fillDoctorCircle(t,s){let i=MT_BS.get(t)??0,h=28;for(let t=0;t<12;t+=1)this.hsc.addStar(i,h,s),28===h&&this.hsc.addStar(i,27,s),i=this.hsc.jumbByYinBoyYanGirl(i),h+=1}fillKingCircle(t,s){let i=t,h=15;for(let t=0;t<12;t+=1)this.hsc.addStar(i,h,s),16===h&&this.hsc.addStar(i,14,s),i=this.hsc.jumbUp(i),h+=1}fillCircleSmallTime(){this.setAilPositions(),this.setMonthCanChi(),this.setLuuNguyetPositions(),this.setLuuNienPositions(),this.setLuuNguyetNPPositions()}setAilPositions(){const{dtv:t,ars:s,aIdx:i}=this.hsc;let h=t.bs.y[1],a=0;for(let t=0;t<12;t+=1)s[h].ail=a,i[`ail${a}`]=h,a=this.hsc.jumbDown(a),h=this.hsc.jumbUp(h)}setMonthCanChi(){const{dtv:t,ars:s}=this.hsc;let i=2,h=this.getNguHoDon(t.bs.y[0]);for(let t=0;t<12;t+=1)s[i].lmpt=[t+1,0,h,i,LTHG.indexOf(`${CAN[h]} ${CHI[i]}`)],h=this.hsc.canJumpUp(h),i=this.hsc.jumbUp(i)}setLuuNguyetPositions(){const{dtv:t,dtb:s,ars:i,aIdx:h}=this.hsc;let a=t.bs.y[1];a=this.hsc.idxAfterMove(a,s.ln.m,!1),a=this.hsc.idxAfterMove(a,s.ln.h+1,!0);for(let t=0;t<12;t+=1)i[a].lmpt[1]=[t+1,t],h[`lmpt${t}`]=a,a=this.hsc.jumbUp(a)}setLuuNienPositions(){const{dtv:t,dtb:s,ars:i,aIdx:h}=this.hsc,a=t.bs.y[1];let e={8:10,0:10,4:10,2:4,6:4,10:4,5:7,9:7,1:7,11:1,3:1,7:1}[s.bs.y[1]],r=s.bs.y[1];const c=this.hsc.sx>0;for(let t=0;t<12;t+=1)a===r&&(h.lynpc=e),i[e].lynp=r,r=this.hsc.jumbUp(r),e=c?this.hsc.jumbUp(e):this.hsc.jumbDown(e)}setLuuNguyetNPPositions(){const{dtv:t,dtb:s,ars:i,aIdx:h}=this.hsc;let a=h.lynpc;a=this.hsc.idxAfterMove(a,s.ln.m,!1),a=this.hsc.idxAfterMove(a,s.ln.h+1,!0);let e=this.getNguHoDon(t.bs.y[0]),r=2;for(let s=0;s<12;s+=1)i[a].lmnp=[s+1,e,r,LTHG.indexOf(`${CAN[e]} ${CHI[r]}`)],t.ln.m-1===s&&(h.lmnpc=a),a=this.hsc.jumbUp(a),e=this.hsc.canJumpUp(e),r=this.hsc.jumbUp(r)}getNguHoDon(t){return{4:6,5:8,6:0,7:2,8:4,9:6,0:8,1:0,2:2,3:4}[t]}fillCircleBigTime(){const{ars:t,aIdx:s}=this.hsc;let i=s.am;const h=this.hsc.cid;let a=this.hsc.cid;for(let e=0;e<12;e+=1){t[i].dv=a;const e=a,r=i;i=this.hsc.jumbByYinBoyYanGirl(i),a+=10,this.hsc.yeo>=e&&this.hsc.yeo<a&&(t[r].dvc=!0,this.hsc.dvidx=r),this.hsc.yeo<=h&&(t[s.am].dvc=!0,this.hsc.dvidx=s.am)}let e=this.hsc.dvidx,r=0;for(let i=0;i<AREA_NAME.length;i+=1)t[e].aid=r,s[`aid${r}`]=e,r=this.hsc.jumbDown(r),e=this.hsc.jumbUp(e)}}class StarPlacer{hsc;constructor(t){this.hsc=t}fillBigStar(){const t=[0,1,2,3,4,5];let s=0,i=0;for(let h=0;h<t.length;h+=1)if((this.hsc.dtb.ln.d+h)%this.hsc.cid==0){s=(this.hsc.dtb.ln.d+h)/this.hsc.cid,i=h;break}let h=this.hsc.idxAfterMove(2,s);h=this.hsc.idxAfterMove(h,i+1,i%2==0);const a=(t,s,i)=>{let h=t;return s.forEach((t=>{Number(t)>=0&&this.hsc.addStar(h,Number(t),PrefixArea.BigStar),h=i(h)})),h};a(h,[0,1,-1,2,3,4,-1,-1,5,-1,-1,-1],this.hsc.jumbDown.bind(this.hsc)),a({0:4,1:3,2:2,3:1,4:0,5:11,6:10,7:9,8:8,9:7,10:6,11:5}[h],[6,7,8,9,10,11,12,-1,-1,-1,13],this.hsc.jumbUp.bind(this.hsc))}fillSixAssassin(t,s){if(this.hsc.addStar(this.hsc.jumbUp(t),56,s),this.hsc.addStar(this.hsc.jumbDown(t),57,s),s!==PrefixArea.SmallStar)return;this.hsc.addStar(this.hsc.idxAfterMove(11,this.hsc.dtb.ln.h+1,!1),52,PrefixArea.SmallStar),this.hsc.addStar(this.hsc.idxAfterMove(11,this.hsc.dtb.ln.h+1,!0),53,PrefixArea.SmallStar);let i={2:1,6:1,10:1,8:2,0:2,4:2,5:3,9:3,1:3,11:9,3:9,7:9}[this.hsc.dtb.bs.y[1]],h={2:3,6:3,10:3,8:10,0:10,4:10,5:10,9:10,1:10,11:10,3:10,7:10}[this.hsc.dtb.bs.y[1]];this.hsc.istc?(i=this.hsc.idxAfterMove(i,this.hsc.dtb.ln.h+1,!0),h=this.hsc.idxAfterMove(h,this.hsc.dtb.ln.h+1,!0)):(i=this.hsc.idxAfterMove(i,this.hsc.dtb.ln.h+1,this.hsc.sx===this.hsc.adye),h=this.hsc.idxAfterMove(h,this.hsc.dtb.ln.h+1,!(this.hsc.sx===this.hsc.adye))),this.hsc.addStar(i,54,PrefixArea.SmallStar),this.hsc.addStar(h,55,PrefixArea.SmallStar)}fillSixBuffer(t,s,i=0){if(this.hsc.addStar({4:1,5:0,6:11,7:11,8:1,9:0,0:6,1:6,2:3,3:3}[t],58,s),this.hsc.addStar({4:7,5:8,6:9,7:9,8:7,9:8,0:2,1:2,2:5,3:5}[t],59,s),s!==PrefixArea.SmallStar){const i={0:[5,9],1:[6,8],2:[8,6],3:[9,5],4:[8,6],5:[9,5],6:[11,3],7:[0,2],8:[2,0],9:[3,11]};return this.hsc.addStar(i[t][0],62,s),void this.hsc.addStar(i[t][1],63,s)}const h=this.hsc.idxAfterMove(10,i+1,!1),a=this.hsc.idxAfterMove(4,i+1,!0);this.hsc.addStar(h,62,s),this.hsc.addStar(a,63,s);const e=this.hsc.idxAfterMove(4,this.hsc.dtb.ln.m,!0),r=this.hsc.idxAfterMove(10,this.hsc.dtb.ln.m,!1);this.hsc.addStar(e,60,s),this.hsc.addStar(r,61,s)}fillBig4(t,s){const i=this.hsc.HOA[t];this.hsc.addStar(this.hsc.aIdx[`s${i[TH.L]}`],64,s),this.hsc.addStar(this.hsc.aIdx[`s${i[TH.Q]}`],65,s),this.hsc.addStar(this.hsc.aIdx[`s${i[TH.Z]}`],66,s),this.hsc.addStar(this.hsc.aIdx[`s${i[TH.K]}`],67,s)}fillTuanTriet(t,s,i=PrefixArea.SmallStar){const h={4:[8,9],5:[6,7],6:[4,5],7:[2,3],8:[0,1],9:[8,9],0:[6,7],1:[4,5],2:[2,3],3:[0,1]};let a=t,e=s;for(let t=0;t<10&&4!==a;t+=1)a=this.hsc.canJumpDown(a),e=this.hsc.jumbDown(e);const r={0:[10,11],10:[8,9],8:[6,7],6:[4,5],4:[2,3],2:[0,1]}[e],c=[];c[0]=[r[0],r[1]],this.hsc.aIdx.tu=r,c[1]=h[t],this.hsc.aIdx.tr=h[t];const o=i===PrefixArea.SmallStar?0:i===PrefixArea.TenYearStar?1:2;this.hsc.ttr[o]=c}fillDargon(t=this.hsc.dtb.bs.y[1],s=PrefixArea.SmallStar){this.hsc.addStar(this.hsc.idxAfterMove(4,t+1,!0),76,s),this.hsc.addStar(this.hsc.idxAfterMove(10,t+1,!1),77,s);this.hsc.addStar({5:1,9:1,1:1,11:7,3:7,7:7,2:10,6:10,10:10,8:4,0:4,4:4}[t],78,s)}fillTangMaKhocHu(t,s){const i={5:11,9:11,1:11,11:5,3:5,7:5,2:8,6:8,10:8,8:2,0:2,4:2}[t];this.hsc.addStar(i,79,s);const h=this.hsc.idxAfterMove(6,t+1,!1);this.hsc.addStar(h,80,s);const a=this.hsc.idxAfterMove(6,t+1,!0);this.hsc.addStar(a,81,s)}fillHinhRieuHaSatToai(t=this.hsc.dtb.bs.y[0],s=this.hsc.dtb.bs.y[1],i=PrefixArea.SmallStar){this.hsc.addStar({4:9,5:10,6:7,7:8,8:5,9:6,0:4,1:3,2:11,3:2}[t],90,i);this.hsc.addStar({5:2,9:2,1:2,11:8,3:8,7:8,2:11,6:11,10:11,8:5,0:5,4:5}[s],91,i);const h={0:5,6:5,3:5,9:5,2:9,8:9,5:9,11:9,4:1,10:1,1:1,7:1}[s];if(this.hsc.addStar(h,92,i),i!==PrefixArea.SmallStar)return;this.hsc.addStar(this.hsc.idxAfterMove(9,this.hsc.dtb.ln.m,!0),87,PrefixArea.SmallStar);const a=this.hsc.idxAfterMove(1,this.hsc.dtb.ln.m,!0);this.hsc.addStar(a,88,PrefixArea.SmallStar),this.hsc.addStar(a,89,PrefixArea.SmallStar)}fillDaoHongHiCoQua(t,s){const i={5:6,9:6,1:6,11:0,3:0,7:0,2:3,6:3,10:3,8:9,0:9,4:9}[t];this.hsc.addStar(i,82,s);const h=this.hsc.idxAfterMove(3,t+1,!1);this.hsc.addStar(h,83,s);const a=this.hsc.idxAfterMove(h,7,!0);if(this.hsc.addStar(a,84,s),s!==PrefixArea.SmallStar)return;const e={11:[2,10],0:[2,10],1:[2,10],2:[5,1],3:[5,1],4:[5,1],5:[8,4],6:[8,4],7:[8,4],8:[11,7],9:[11,7],10:[11,7]},r=e[t][0];this.hsc.addStar(r,85,s);const c=e[t][1];this.hsc.addStar(c,86,s)}fillThaiCaoAnDuong(){const t=this.hsc.idxAfterMove(6,this.hsc.dtb.ln.h+1,!0);this.hsc.addStar(t,72,PrefixArea.SmallStar);const s=this.hsc.idxAfterMove(2,this.hsc.dtb.ln.h+1,!0);this.hsc.addStar(s,73,PrefixArea.SmallStar);const i=this.hsc.idxAfterMove(this.hsc.aIdx.s27,9,!0),h=this.hsc.idxAfterMove(this.hsc.aIdx.s27,8,!1);this.hsc.addStar(i,74,PrefixArea.SmallStar),this.hsc.addStar(h,75,PrefixArea.SmallStar)}fillQuangQuyThaiToa(){const t=this.hsc.dtb.ln.d;this.hsc.addStar(this.hsc.jumbDown(this.hsc.idxAfterMove(this.hsc.aIdx.s62,t,!0)),68,PrefixArea.SmallStar),this.hsc.addStar(this.hsc.jumbUp(this.hsc.idxAfterMove(this.hsc.aIdx.s63,t,!1)),69,PrefixArea.SmallStar),this.hsc.addStar(this.hsc.idxAfterMove(this.hsc.aIdx.s60,t,!0),70,PrefixArea.SmallStar),this.hsc.addStar(this.hsc.idxAfterMove(this.hsc.aIdx.s61,t,!1),71,PrefixArea.SmallStar)}fillQuanPhucNienTru(t,s){const i={4:[7,9,5,5],5:[4,8,6,6],6:[5,0,8,0],7:[2,11,9,5],8:[3,3,8,6],9:[9,2,9,8],0:[11,6,11,2],1:[9,5,0,6],2:[10,6,2,9],3:[6,5,3,10]},h=i[t][0],a=i[t][1],e=i[t][2],r=i[t][3];this.hsc.addStar(h,93,s),this.hsc.addStar(a,94,s),this.hsc.addStar(e,95,s),this.hsc.addStar(r,96,s)}fillThienNguyetDiaThanTaiTho(){this.hsc.istc||this.hsc.addStar(this.hsc.aIdx.s77,101,PrefixArea.SmallStar);const t=this.hsc.idxAfterMove(7,this.hsc.dtb.ln.m,!0);this.hsc.addStar(t,100,PrefixArea.SmallStar);const s=this.hsc.idxAfterMove(8,this.hsc.dtb.ln.m,!0);this.hsc.addStar(s,99,PrefixArea.SmallStar);const i=this.hsc.idxAfterMove(9,this.hsc.dtb.bs.y[1]+1,!0);this.hsc.addStar(i,97,PrefixArea.SmallStar);const h=this.hsc.idxAfterMove(5,this.hsc.dtb.bs.y[1]+1,!0);this.hsc.addStar(h,98,PrefixArea.SmallStar);const a=this.hsc.idxAfterMove(this.hsc.aIdx.am,this.hsc.dtb.bs.y[1]+1,!0);this.hsc.addStar(a,102,PrefixArea.SmallStar);const e=this.hsc.idxAfterMove(this.hsc.aIdx.at,this.hsc.dtb.bs.y[1]+1,!0);this.hsc.addStar(e,103,PrefixArea.SmallStar)}fillDauThuongSuLaVong(){let t=this.hsc.idxAfterMove(this.hsc.aIdx.s15,this.hsc.dtb.ln.m,!1);t=this.hsc.idxAfterMove(t,this.hsc.dtb.ln.h+1,!0),this.hsc.addStar(t,104,PrefixArea.SmallStar),this.hsc.addStar(this.hsc.aIdx.ai5,106,PrefixArea.SmallStar),this.hsc.addStar(this.hsc.aIdx.ai7,105,PrefixArea.SmallStar),this.hsc.addStar(4,107,PrefixArea.SmallStar),this.hsc.addStar(10,108,PrefixArea.SmallStar);const s={1:[2,6,9,10],2:[0,8,7,0],3:[10,10,5,2],4:[8,0,3,4],5:[6,2,1,6],6:[4,4,11,8],7:[2,6,9,10],8:[0,8,7,0],9:[10,10,5,2],10:[8,0,3,4],11:[6,2,1,6],12:[4,4,11,8]};this.hsc.addStar(s[this.hsc.dtb.ln.m][0],122,PrefixArea.SmallStar),this.hsc.addStar(s[this.hsc.dtb.ln.m][1],123,PrefixArea.SmallStar),this.hsc.addStar(s[this.hsc.dtb.ln.m][2],124,PrefixArea.SmallStar),this.hsc.addStar(s[this.hsc.dtb.ln.m][3],125,PrefixArea.SmallStar)}fillTuViTrungChauPhai(){const t=this.hsc.idxAfterMove(10,this.hsc.dtb.bs.y[1]+1,!1);this.hsc.addStar(t,118,PrefixArea.SmallStar);const s={1:8,2:8,3:10,4:10,5:0,6:0,7:2,8:2,9:4,10:4,11:6,12:6}[this.hsc.dtb.ln.m];this.hsc.addStar(s,119,PrefixArea.SmallStar);const i={1:5,5:5,9:5,2:8,6:8,10:8,3:2,7:2,11:2,4:11,8:11,12:11}[this.hsc.dtb.ln.m];this.hsc.addStar(i,120,PrefixArea.SmallStar);const h={1:10,2:5,3:4,4:2,5:7,6:3,7:11,8:7,9:2,10:6,11:10,12:2}[this.hsc.dtb.ln.m];this.hsc.addStar(h,121,PrefixArea.SmallStar);let a={8:0,0:0,4:0,2:6,6:6,10:6,11:3,3:3,7:3,5:9,9:9,1:9}[this.hsc.dtb.bs.y[1]];const e=[109,110,111,112,-1,-1,113,114,115,-1,116,117];for(let t=0;t<e.length;t+=1)e[t]>0&&this.hsc.addStar(a,e[t],PrefixArea.SmallStar),a=this.hsc.jumbUp(a)}}class ZoneBuilder{hsc;constructor(t){this.hsc=t}buildZoneName(){let t=this.hsc.idxAfterMove(2,this.hsc.dtb.ln.m);const s=this.hsc.idxAfterMove(t,this.hsc.dtb.ln.h+1);this.hsc.aIdx.at=s,t=this.hsc.idxAfterMove(t,this.hsc.dtb.ln.h+1,!1),this.hsc.aIdx.am=t;let i=0;for(let s=0;s<12;s+=1){const s={ai:i,ci:t,cn:-1,na:-1,sb:[],ss:[],sv:[],sy:[],sm:[],sd:[],lmnp:[],lynp:0,lmpt:[],aid:0,dv:0,cni:[[],[],[],[]],cnw:[[],[],[],[]],cno:[],th1:[[0,0,0],[],[],[0,0]],ys:[],que:[],stlk:[],zolk:[]};this.hsc.ars[t]=s,this.hsc.aIdx[`ai${i}`]=t,i=this.hsc.jumbDown(i),t=this.hsc.jumbUp(t)}let h=0,a=2;for(;h<12;){const t=this.hsc.dtb.m12[h][0];this.hsc.ars[a].cn=t,this.hsc.ars[a].na=LTHG.indexOf(`${CAN[t]} ${CHI[a]}`),h+=1,a=this.hsc.jumbUp(a)}this.hsc.am=this.hsc.aIdx.am,this.hsc.at=this.hsc.aIdx.at,this.hsc.cid=LTHG_HH[this.hsc.ars[this.hsc.aIdx.am].na],1===this.hsc.cfg[CfgValue.tcpb]&&(this.hsc.cid=LTHG_HH[this.hsc.ars[this.hsc.aIdx.at].na]),2===this.hsc.cfg[CfgValue.tcpb]&&(this.hsc.cid=LTHG_HH[this.hsc.ars[this.hsc.aIdx.ai10].na]),this.hsc.adme=CHI_AD[this.hsc.ars[this.hsc.aIdx.am].ci];const e=1===this.hsc.adme?1:-1;this.hsc.adye=CHI_AD[this.hsc.dtb.bs.y[1]],this.hsc.adyetk=CHI_AD[this.hsc.dtb.tk.y[1]];const r=1===this.hsc.adye?1:-1;this.hsc.ad=e*r>0?1:0}fillBaseMenhThan(){this.hsc.mctc={0:[8,55],1:[9,10],2:[27,11],3:[63,4],4:[5,62],5:[3,1],6:[13,54],7:[3,10],8:[5,11],9:[63,4],10:[27,62],11:[9,1]}[this.hsc.dtb.bs.y[1]]}fillPhiHoa(){for(let t=0;t<=11;t+=1){const s=this.hsc.HOA[this.hsc.ars[t].cn];this.hsc.ars[t].cno=[this.hsc.aIdx[`s${s[TH.L]}`],this.hsc.aIdx[`s${s[TH.Q]}`],this.hsc.aIdx[`s${s[TH.Z]}`],this.hsc.aIdx[`s${s[TH.K]}`]];for(let s=0;s<=11;s+=1){const i=this.hsc.HOA[this.hsc.ars[s].cn];for(let h=0;h<4;h+=1)this.hsc.aIdx[`s${i[h]}`]===t&&(this.hsc.ars[t].cni[h].push(s),this.hsc.ars[t].cnw[h].push(i[h]))}}this.setLocKiStatic();const t=[[],[],[],[],[],[],[],[],[],[],[],[]],s=[[],[],[],[],[],[],[],[],[],[],[],[]],i=[[[],[],[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[],[],[]]];for(let h=0;h<12;h+=1){this.hsc.countLoop=0,this.countMoveKi(h),this.hsc.countLoop=0,this.countMoveLoc(h),this.hsc.countLoop=0;const a=this.checkTuanHoan(3,h);this.checkPeriodicRepetition(a)&&(t[h]=this.getUniquePeriodicElements(a)),this.hsc.countLoop=0;const e=this.checkTuanHoan(0,h);this.checkPeriodicRepetition(e)&&(s[h]=this.getUniquePeriodicElements(e));for(let t=0;t<4;t++){this.hsc.countLoop=0;const s=this.checkTuanHoanPT(t,h);this.checkPeriodicRepetition(s)&&(i[t][h]=this.getUniquePeriodicElements(s))}}this.hsc.loopLP[TH.L]=this.getUniqueRepresentatives(s),this.hsc.loopLP[TH.K]=this.getUniqueRepresentatives(t);for(let t=0;t<4;t++)this.hsc.loopPT[t]=this.getUniqueRepresentatives(i[t]);this.hsc.loopLP[TH.L].length>0&&this.hsc.loopLP[TH.L].forEach(((t,s)=>{t.length>0&&!this.isTuanHoanLocLuongPhai(t)&&(this.hsc.loopLP[TH.L][s]=[])})),this.addBatQuai()}isTuanHoanLocLuongPhai(t){let s=!0;return t.forEach(((i,h)=>{const a=i;let e=h+1;e>t.length-1&&(e=0);const r=t[e];if(this.hsc.ars[a].cno[TH.K]!==r)return s=!1,!1;const c=this.hsc.HOA[this.hsc.ars[a].cn][3];return 0===this.hsc.ars[r].stlk[c][StlkName.isMoveLoc]?(s=!1,!1):void 0})),s}arraysEqual(t,s){return JSON.stringify(t)===JSON.stringify(s)}rotateArray(t,s){return[...t.slice(s,t.length),...t.slice(0,s)]}getUniqueRepresentatives(t){const s=[],i=Array(t.length).fill(!1);for(let h=0;h<t.length;h++){if(i[h]||0===t[h].length)continue;const a=t[h];i[h]=!0;for(let s=h+1;s<t.length;s++)if(0!==t[s].length)for(let h=0;h<t[s].length;h++)if(this.arraysEqual(this.rotateArray(t[s],h),a)){i[s]=!0;break}s.push(a)}return s}listStarHoaInZone(t){const s=[],i=this.hsc.ars[t],h=i.ss.filter((t=>[60,61,62,63].includes(t)));return i.sb.concat(h).forEach((t=>{this.hsc.str2u.includes(t)&&s.push({ids:t,vl:this.hsc.str2hc[t]})})),s}isNienLoc(t){return this.hsc.aIdx.s64===t}isNienKi(t){return this.hsc.aIdx.s67===t}isMenhLocNienLoc(t){const s=this.hsc.aIdx.s64,i=this.hsc.ars[this.hsc.am].cno[TH.L];return s===t||i===t}isMenhKiNienKi(t){const s=this.hsc.aIdx.s67,i=this.hsc.ars[this.hsc.am].cno[TH.K];return s===t||i===t}isMenhKi(t){return this.hsc.ars[this.hsc.am].cno[TH.K]===t}setLocKiStatic(){for(let t=0;t<12;t+=1){let s=0,i=0,h=0;s+=this.isNienLoc(t)?1:0,h+=this.isNienKi(t)?1:0;let a=this.isMenhLocNienLoc(t)?1:0,e=this.isMenhLocNienLoc(t)?1:0,r=this.isMenhKiNienKi(t)?1:0;const c=this.hsc.ars[t].cno[TH.K]===t,o=this.hsc.ars[t].cno[TH.L]===t,n=this.listStarHoaInZone(t);n.length<=0?(this.hsc.ars[t].zolk[TH.L]=[0,-1,0,0,0,0],this.hsc.ars[t].zolk[TH.K]=[0,-1,0]):(n.forEach((a=>{const e=this.hsc.ars[t].cnw,r=e[TH.L].filter((t=>t===a.ids)).length,o=e[TH.K].filter((t=>t===a.ids)).length;if(r>0||o>0){let e=0;this.hsc.ars[t].stlk[a.ids]=[0,0,0,0,0,0,0],this.hsc.ars[t].stlk[a.ids][StlkName.numLoc]=r,this.hsc.ars[t].stlk[a.ids][StlkName.numKi]=o,this.hsc.ars[t].stlk[a.ids][StlkName.currentLoc]=r,this.hsc.ars[t].stlk[a.ids][StlkName.isMoveLoc]=c?0:r>=2?1:0,this.hsc.ars[t].stlk[a.ids][StlkName.isMoveKi]=c?0:o>=2?1:0,this.hsc.ars[t].stlk[a.ids][StlkName.isTruyLoc]=0,this.hsc.ars[t].stlk[a.ids][StlkName.isTruyKi]=0,e=c?r:r>=2?0:r,i+=e,s+=r,h+=o}})),a=o?1:a,e=o?1:e,a=this.checkMoveLoc(a,s,t),e=this.checkMoveAll(e,t,a),r=this.checkMoveKi(r,h),a=c?0:a,e=c?0:e,r=c?0:r,this.updateZoneLocKi(t,a,s,i,e,r,h))}this.truyLocKi(),this.countKiStatic()}checkMoveLoc(t,s,i){if(0===t){const h=this.hsc.ars[i].stlk.some((t=>1===t[StlkName.isMoveLoc]));t=s>=2&&h?1:t}return t}checkMoveAll(t,s,i){return 0===t&&1===this.hsc.ars[s].stlk.length&&1===i&&(t=1),t}checkMoveKi(t,s){return 0===t&&s>=2?1:t}updateZoneLocKi(t,s,i,h,a,e,r){this.hsc.ars[t].zolk[TH.L]=[0,0,0,0,0,0,0],this.hsc.ars[t].zolk[TH.L][ZolkName.isMoveLoc]=s,this.hsc.ars[t].zolk[TH.L][ZolkName.totalLoc]=i,this.hsc.ars[t].zolk[TH.L][ZolkName.currentLoc]=i,this.hsc.ars[t].zolk[TH.L][ZolkName.isMoveAllLoc]=a,this.hsc.ars[t].zolk[TH.L][ZolkName.locKeep]=1===a?0:h,this.hsc.ars[t].zolk[TH.L][ZolkName.isMoveNienLoc]=this.isNienLoc(t)?1:0,this.hsc.ars[t].zolk[TH.K]=[0,0,0,0,0,0,0],this.hsc.ars[t].zolk[TH.K][ZolkName.isMoveKi]=e,this.hsc.ars[t].zolk[TH.K][ZolkName.totalKi]=r,this.hsc.ars[t].zolk[TH.K][ZolkName.currentKi]=0}checkZoneTruyLoc(t){const s=this.hsc.ars[t].cno[TH.K]===t;if(!s){const s=this.hsc.ars[t].zolk[TH.L][ZolkName.isMoveAllLoc];let i=0;this.hsc.ars[t].stlk.forEach(((h,a)=>{1===s&&h[StlkName.currentLoc]>0&&0===h[StlkName.isMoveLoc]?(this.hsc.ars[t].stlk[a][StlkName.isMoveLoc]=1,this.hsc.ars[t].zolk[TH.L][ZolkName.isMoveLoc]=1):h[StlkName.currentLoc]>0&&0===h[StlkName.isMoveLoc]&&h[StlkName.numKi]>0&&h[StlkName.numLoc]>0&&this.hsc.ars[t].cni[3].forEach(((s,i)=>{if(this.hsc.ars[t].cnw[3][i]===a){this.hsc.ars[s].zolk[TH.L][ZolkName.isMoveLoc]>0&&(this.hsc.ars[t].zolk[TH.L][ZolkName.isMoveLoc]=1,this.hsc.ars[t].stlk[a][StlkName.isMoveLoc]=1,this.hsc.ars[t].stlk[a][StlkName.isTruyLoc]=1)}})),i+=h[StlkName.currentLoc]})),this.hsc.ars[t].zolk[TH.L][ZolkName.currentLoc]=i}s||1!==this.hsc.ars[t].stlk.length||1!==this.hsc.ars[t].zolk[TH.L][ZolkName.isMoveLoc]||(this.hsc.ars[t].zolk[TH.L][ZolkName.isMoveAllLoc]=1)}checkZoneTruyKi(t){const s=this.hsc.ars[t].cno[TH.K]===t;let i=0;this.hsc.ars[t].cni[TH.K].forEach((t=>{1!==this.hsc.ars[t].zolk[TH.K][ZolkName.isMoveKi]||s||(i+=1)})),1!==this.hsc.ars[t].zolk[TH.K][ZolkName.isMoveKi]||i!==this.hsc.ars[t].cni[TH.K].length||this.isMenhKiNienKi(t)||(this.hsc.ars[t].zolk[TH.K][ZolkName.isMoveKi]=0),0===this.hsc.ars[t].zolk[TH.K][ZolkName.isMoveKi]&&this.hsc.ars[t].cni[TH.K].length>1&&i<this.hsc.ars[t].cni[TH.K].length&&!s&&(this.hsc.ars[t].zolk[TH.K][ZolkName.isMoveKi]=1)}truyLocKi(){for(let t=0;t<12;t+=1)this.checkZoneTruyLoc(t),this.checkZoneTruyKi(t)}countKiStatic(){for(let t=0;t<12;t++){let s=0;this.isNienKi(t)&&s++,this.hsc.ars[t].cni[TH.K].forEach((i=>{(0===this.hsc.ars[i].zolk[TH.K][ZolkName.isMoveKi]||this.isMenhKi(t)&&1===this.hsc.ars[i].zolk[TH.K][ZolkName.isMoveKi])&&s++})),this.hsc.ars[t].zolk[TH.K][ZolkName.currentKi]=s}}countMoveKi(t){if(this.hsc.countLoop>=11)return;const s=this.hsc.ars[t].zolk[TH.K];if(this.hsc.ars[t].cno[TH.K]!==t&&-1!==s[ZolkName.totalKi]&&(this.hsc.countLoop+=1,this.isZoneMove2(t))){const i=this.hsc.ars[t].cno[TH.K],h=this.hsc.ars[i].zolk[TH.K],a=s[ZolkName.currentKi],e=h[ZolkName.currentKi];h[ZolkName.currentKi]=e+a,s[ZolkName.currentKi]=0,this.isZoneMove2(i)&&this.countMoveKi(i)}}countMoveLoc(t){if(this.hsc.countLoop>=11)return;const s=this.hsc.ars[t].zolk[TH.L];if(-1===s[ZolkName.totalLoc])return;if(this.hsc.ars[t].cno[TH.K]===t)return;this.hsc.countLoop+=1;const i=this.hsc.ars[t].stlk;let h=0;i.forEach(((i,a)=>{const e=i[StlkName.currentLoc],r=i[StlkName.isMoveLoc];(1===s[ZolkName.isMoveAllLoc]&&e>0||e>0&&1===r)&&(h+=e,s[ZolkName.currentLoc]-=e,this.hsc.ars[t].stlk[a][StlkName.currentLoc]=0)})),this.isNienLoc(t)&&1===s[ZolkName.isMoveNienLoc]&&(h+=1,s[ZolkName.isMoveNienLoc]=0);const a=this.hsc.ars[t].cno[TH.K],e=this.hsc.ars[t].cn,r=this.hsc.HOA[e][TH.K],c=this.hsc.ars[a].zolk[TH.L],o=this.hsc.ars[a].stlk[r];c[ZolkName.currentLoc]+=h,o[StlkName.currentLoc]+=h,this.checkZoneTruyLoc(a),this.isZoneMove2(a,0)&&this.countMoveLoc(a)}checkTuanHoan(t,s,i=[]){let h=i;if(this.hsc.countLoop>=24)return h;if(this.hsc.countLoop+=1,this.isZoneMove2(s,t)){h.push(s);const i=this.hsc.ars[s].cno[TH.K];this.isZoneMove2(i,t)?h=this.checkTuanHoan(t,i,h):h.push(i)}return h}checkTuanHoanPT(t,s,i=[]){let h=i;if(this.hsc.countLoop>=12||this.hsc.ars[s].cno[t]===s)return h;this.hsc.countLoop+=1,h.push(s);const a=this.hsc.ars[s].cno[t];return a===s?(h.push(s),h):(h=this.checkTuanHoanPT(t,a,h),h)}isZoneMove2(t,s=3){return 0===s?1===this.hsc.ars[t].zolk[TH.L][ZolkName.isMoveLoc]:1===this.hsc.ars[t].zolk[TH.K][ZolkName.isMoveKi]}checkPeriodicRepetition(t){const s=t.length;for(let i=1;i<=s/2;i++){let h=!0;for(let a=0;a<s;a++)if(t[a]!==t[a%i]){h=!1;break}if(h)return!0}return!1}getUniquePeriodicElements(t){for(let s=1;s<=t.length/2;s++){const i=t.slice(0,s),h=Array(Math.ceil(t.length/s)).fill(i).flat().slice(0,t.length);if(JSON.stringify(h)===JSON.stringify(t))return[...new Set(i)]}return[]}isExitQueByCung(t,s){const i=this.hsc.ars[t].que;let h=!1;return i.forEach((t=>{if(s===t[0])return h=!0,h})),h}addBatQuai(){const t=[this.hsc.aIdx.s64,this.hsc.aIdx.s65,this.hsc.aIdx.s66,this.hsc.aIdx.s67];for(let s=0;s<4;s+=1){const i=s,h=t[s],a=this.hsc.ars[h];a.cno.forEach(((t,e)=>{if(t===h){const t=e;a.cni.forEach(((a,r)=>{for(let c=0;c<a.length;c+=1){const o=a[c];if(o===h&&r===e)continue;const n=hoa2IchingIdx([i,t,r]);this.isExitQueByCung(o,n)||this.hsc.ars[o].que.push([n,[s,e,r],[h,h,o]])}}))}}));const e=xtngl[h].x;a.cno.forEach(((t,r)=>{if(t===e){const t=r;this.hsc.ars[e].cni.forEach(((a,c)=>{for(let o=0;o<a.length;o+=1){const n=a[o];if(n===h&&c===r)continue;const l=hoa2IchingIdx([i,t,c]);this.isExitQueByCung(n,l)||this.hsc.ars[n].que.push([l,[s,r,c],[h,e,n]])}})),a.cni.forEach(((a,e)=>{for(let c=0;c<a.length;c+=1){const o=a[c];if(o===h)continue;const n=hoa2IchingIdx([i,t,e]);this.isExitQueByCung(o,n)||this.hsc.ars[o].que.push([n,[s,r,e],[h,h,o]])}}))}}));this.hsc.ars[e].cno.forEach(((t,r)=>{if(t===h){const t=r;this.hsc.ars[e].cni.forEach(((a,c)=>{for(let o=0;o<a.length;o+=1){const n=a[o],l=hoa2IchingIdx([i,t,c]);this.isExitQueByCung(n,l)||this.hsc.ars[n].que.push([l,[s,r,c],[h,e,n]])}})),a.cni.forEach(((a,c)=>{for(let o=0;o<a.length;o+=1){const n=a[o];if(n===e&&c===r)continue;if(n===h)continue;const l=hoa2IchingIdx([i,t,c]);this.isExitQueByCung(n,l)||this.hsc.ars[n].que.push([l,[s,r,c],[h,h,n]])}}))}}))}}}var PrefixArea=(t=>(t.BigStar="sb",t.SmallStar="ss",t.YearStar="sy",t.MonthStar="sm",t.DayStar="sd",t.TenYearStar="sv",t))(PrefixArea||{});class HoroscopeBuild{search;cid=2;at=1;am=1;yeo=1;dtb;dtv;dtc;aIdx={};adye=1;adyetk=1;adme=1;ad=1;sx=1;ttr={0:[],1:[],2:[]};ars=[];sks=5;istc=!1;tpCan=0;cfg=[...configDefault];dvidx=0;idxCheckZone=0;mctc=[];cach={};rad=0;tutru={cot:[{cht:-1,cn:-1,ci:-1,ctg:[],pht:[],tsctg:[],ts:-1,na:-1},{cht:-1,cn:-1,ci:-1,ctg:[],pht:[],tsctg:[],ts:-1,na:-1},{cht:-1,cn:-1,ci:-1,ctg:[],pht:[],tsctg:[],ts:-1,na:-1},{cht:-1,cn:-1,ci:-1,ctg:[],pht:[],tsctg:[],ts:-1,na:-1}],dv:[],dvt:[]};starPlacer;circlePlacer;zoneBuilder;calculationHelper;arrIdxChuyenLoc=[];str2hc={};str2u=[];arrCkZone=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]];loopLP=[[],[],[],[]];loopPT=[[],[],[],[]];countLoop=0;HOA=CAN_HOA;numberStarCol1=[0,0,0,0,0,0,0,0,0,0,0,0];numberStarCol2=[0,0,0,0,0,0,0,0,0,0,0,0];css=0;constructor(t){t&&t.cfg&&Object.assign(this.cfg,t.cfg);const s=dayjs(),i=convertSolar2Lunar(s.year(),s.month()+1,s.date(),s.hour(),s.minute());this.dtc=buildDateInfo(i);const h=convertSolar2Lunar(t.born.year(),t.born.month()+1,t.born.date(),t.born.hour(),t.born.minute());this.dtb=buildDateInfo(h),this.dtv=this.dtc,void 0!==t.view&&(this.dtv=buildDateInfo(convertSolar2Lunar(t.view.year(),t.view.month()+1,t.view.date(),t.view.hour(),t.view.minute()))),this.yeo=this.dtv.sn.y-this.dtb.sn.y+1,this.sx=t.sex,this.istc=[6,7,8].includes(this.cfg[CfgValue.typeLs]),this.HOA=GETHOA(this.cfg[CfgValue.lsCanType]),this.istc||(this.cfg[CfgValue.tcpb]=0),this.str2hc=StarToHoaCan(this.HOA),this.str2u=StarUseHoa(this.HOA),this.starPlacer=new StarPlacer(this),this.circlePlacer=new CirclePlacer(this),this.zoneBuilder=new ZoneBuilder(this),this.calculationHelper=new CalculationHelper,this.initializeHoroscope()}removePrivateProperties(){delete this.starPlacer,delete this.circlePlacer,delete this.zoneBuilder,delete this.calculationHelper,this.arrIdxChuyenLoc=[],this.str2hc={},this.str2u=[],this.arrCkZone=[],this.countLoop=0,this.HOA={},this.numberStarCol1=[],this.numberStarCol2=[],this.idxCheckZone=0,this.tpCan=0,this.adyetk=1,delete this.dtc}initializeHoroscope(){this.zoneBuilder.buildZoneName(),this.starPlacer.fillBigStar();const t=this.dtb.bs.y[0];this.starPlacer.fillSixAssassin([8,9,11,0,2,3,5,6,5,6][t],"ss"),this.starPlacer.fillSixBuffer(this.dtb.bs.y[0],"ss",this.dtb.ln.h),this.starPlacer.fillBig4(this.dtb.bs.y[0],"ss"),this.circlePlacer.fillKingCircle(this.dtb.bs.y[1],"ss"),this.circlePlacer.fillDoctorCircle(this.dtb.bs.y[0],"ss"),this.circlePlacer.fillGrowCircle(),this.starPlacer.fillTuanTriet(this.dtb.bs.y[0],this.dtb.bs.y[1]),this.starPlacer.fillQuangQuyThaiToa(),this.starPlacer.fillThaiCaoAnDuong(),this.starPlacer.fillDargon(),this.starPlacer.fillTangMaKhocHu(this.dtb.bs.y[1],"ss"),this.starPlacer.fillHinhRieuHaSatToai(),this.starPlacer.fillDaoHongHiCoQua(this.dtb.bs.y[1],"ss"),this.starPlacer.fillQuanPhucNienTru(this.dtb.bs.y[0],"ss"),this.starPlacer.fillThienNguyetDiaThanTaiTho(),this.starPlacer.fillDauThuongSuLaVong(),this.skyAreaSK(),this.istc&&this.starPlacer.fillTuViTrungChauPhai(),this.circlePlacer.fillCircleBigTime(),this.circlePlacer.fillCircleSmallTime(),this.fillStarRepeatByLoop(),this.addAgeToAreas(),this.zoneBuilder.fillBaseMenhThan(),this.zoneBuilder.fillPhiHoa(),this.tuTruBuildBigTime(),this.tuTruBuildCot(0,this.dtb.tk.y,this.dtb.tk.d),this.tuTruBuildCot(1,this.dtb.tk.m,this.dtb.tk.d),this.tuTruBuildCot(2,this.dtb.tk.d,this.dtb.tk.d,!0),this.tuTruBuildCot(3,this.dtb.tk.h,this.dtb.tk.d),this.css=Math.max(Math.max(...this.numberStarCol1),Math.max(...this.numberStarCol2))}addStar(t,s,i){if("sb"!==i&&"ss"!==i&&void 0!==SM[s][`is${i}`]&&!1===SM[s][`is${i}`])return;this.ars[t][i].push(s);const h=this.ars[t][i];switch(h.sort(((t,s)=>1===SM[t].zone&&1!==SM[s].zone||3===SM[t].zone&&1!==SM[s].zone&&3!==SM[s].zone?-1:1)),this.ars[t][i]=h,i){case"sb":case"ss":this.aIdx[`s${s}`]=t;break;default:this.aIdx[`${i}${s}`]=t}const a="sb"!==i&&"ss"!==i;if(("ss"===i||"sv"===i&&1===this.cfg[CfgValue.dvStar]&&![64,65,66,67].includes(s)||"sy"===i&&this.cfg[CfgValue.currentStar]>0&&![64,65,66,67].includes(s))&&s>13){const h=SM[s];if(void 0===h.cir||"vts"!==h.cir){const e=this.cfg[CfgValue.showHideStar];if(e>0&&!a){if(1===e&&!STARSTRONG.includes(s))return;if(2===e&&!STARSTRONG.includes(s)&&!STAR_SIGN.includes(s))return;if(3===e&&!STARSTRONG.includes(s)&&!STAR_SIGN.includes(s)&&!CR_TS.includes(s))return;if(!(4!==e||STARSTRONG.includes(s)||STAR_SIGN.includes(s)||CR_TS.includes(s)||FAILURE6.includes(s)))return}const r=1===this.cfg[CfgValue.dvStar],c=this.cfg[CfgValue.currentStar]>0;if("sv"===i&&!r||"sy"===i&&!c)return;1===h.typ&&(this.numberStarCol1[t]+=1),2===h.typ&&(this.numberStarCol2[t]+=1)}}}jumbDown(t){return this.calculationHelper.jumpDown(t)}jumbUp(t){return this.calculationHelper.jumpUp(t)}jumbByYinBoyYanGirl(t){return this.sx===this.adye?this.jumbUp(t):this.jumbDown(t)}jumbByYinBoyYanGirlTietKhi(t){return this.sx===this.adyetk?this.jumbUp(t):this.jumbDown(t)}idxAfterMove(t,s,i=!0){return this.calculationHelper.idxAfterMove(t,s,i)}canJumpDown(t){return this.calculationHelper.canJumpDown(t)}canJumpUp(t){return this.calculationHelper.canJumpUp(t)}canJumbByYinBoyYanGirl(t){return this.sx===this.adye?this.canJumpUp(t):this.canJumpDown(t)}canJumbByYinBoyYanGirlTietKhi(t){return this.sx===this.adyetk?this.canJumpUp(t):this.canJumpDown(t)}skyAreaSK(){this.sks={2:{2:5,3:4,4:3,6:6,5:7},3:{3:5,6:4,2:3,5:6,4:7},4:{4:5,2:4,5:3,3:6,6:7},5:{5:5,4:4,6:3,2:6,3:7},6:{6:5,5:4,3:3,4:6,2:7}}[LTHG_HH[this.dtb.bs.y[2]]][LTHG_HH[this.ars[this.aIdx.am].na]]}fillStarRepeatByLoop(){const t=this.aIdx[`aid${this.idxCheckZone}`],s=this.ars[t].cn;this.addStar([8,9,11,0,2,3,5,6,5,6][s],27,"sv"),this.starPlacer.fillSixAssassin(this.aIdx.sv27,"sv"),this.starPlacer.fillSixBuffer(s,"sv"),this.starPlacer.fillBig4(s,"sv"),this.circlePlacer.fillKingCircle(this.dtv.bs.y[1],"sy"),this.circlePlacer.fillDoctorCircle(this.dtv.bs.y[0],"sy"),this.starPlacer.fillSixAssassin(this.aIdx.sy27,"sy"),this.starPlacer.fillSixBuffer(this.dtv.bs.y[0],"sy"),this.starPlacer.fillBig4(this.dtv.bs.y[0],"sy"),this.starPlacer.fillTangMaKhocHu(this.dtv.bs.y[1],"sy"),this.starPlacer.fillHinhRieuHaSatToai(this.dtv.bs.y[0],this.dtv.bs.y[1],"sy"),this.starPlacer.fillDaoHongHiCoQua(this.dtv.bs.y[1],"sy"),this.starPlacer.fillDargon(this.dtv.bs.y[1],"sy"),this.starPlacer.fillTuanTriet(this.dtv.bs.y[0],this.dtv.bs.y[1],"sy")}addAgeToAreas(){let t=this.dtb.bs.y[1],s=0;for(let i=1;i<=84;i+=1){const i=s+this.dtb.ln.y;if(i>2099)break;const h=buildDateInfo(convertSolar2Lunar(i,6,6,6,6));this.ars[t].ys.push([s+1,i,h.bs.y[2],h.bs.y[0]]),t=this.jumbUp(t),s+=1}}tuTruBuildBigTime(){const t=dayjs(this.dtb.sn.y+"-"+this.dtb.sn.m+"-"+this.dtb.sn.d+" "+this.dtb.sn.h+":"+this.dtb.sn.i),s=this.dtb.tki,i=this.sx===this.adyetk;let h,a;i?(h=dayjs(s[4]),a=h.diff(t,"day",!0)):(h=dayjs(s[3]),a=t.diff(h,"day",!0));const e=Number(a.toFixed(10)),r=Math.floor(e),c=24*(e-r),o=Math.ceil(c),n=e/3,l=Math.floor(n),u=365*(n-l)/30,d=Math.floor(u),S=30*(u-d),f=Math.floor(S);let m=t.add(l,"year").add(d,"month").add(f,"day"),T=this.dtb.tk.m[0],H=this.dtb.tk.m[1];for(let t=0;t<10;t++)T=this.canJumbByYinBoyYanGirlTietKhi(T),H=this.jumbByYinBoyYanGirlTietKhi(H),this.tutru.dv.push([T,H,m.unix()]),m=m.add(10,"year");this.tutru.dvt=[i,r,o,l,d,f]}tuTruBuildCot(t,s,i,h=!1){const a=i[0];this.tutru.cot[t].cht=h?-1:idxTHAP(a,s[0]),this.tutru.cot[t].cn=s[0],this.tutru.cot[t].ci=s[1];const e=CHI_CAN[s[1]];this.tutru.cot[t].ctg=e;const r=[];e.forEach(((t,s)=>{r[s]=idxTHAP(a,t)})),this.tutru.cot[t].pht=r,this.tutru.cot[t].ts=idxTSTutru(i[0],s[1]),this.tutru.cot[t].na=s[2]}}class HoroHelp{ls;aIdx;mIdx;diaban;constructor(t){this.ls=t,this.diaban=t.ars,this.aIdx=t.aIdx,this.mIdx=t.am}tuChinh(t){return[t,xtngl[t].x,xtngl[t].t[0],xtngl[t].t[1]]}tamPhuong(t){return[t,xtngl[t].t[0],xtngl[t].t[1]]}xungChieu(t){return[xtngl[t].x]}giapCung(t){return[xtngl[t].g[0],xtngl[t].g[1]]}isGiap(t,s){return this.giapCung(s).includes(this.aIdx[`s${t}`])}isXung(t,s){return this.xungChieu(s).includes(this.aIdx[`s${t}`])}isStar4(t,s){return this.tuChinh(s).includes(this.aIdx[`s${t}`])}isStar3(t,s){return this.tamPhuong(s).includes(this.aIdx[`s${t}`])}isStar(t,s){return this.aIdx[`s${t}`]===s}isKo(t,s=0){return 3===s?this.isStar3(52,t):4===s?this.isStar4(52,t):this.isStar(52,t)}isKiep(t,s=0){return 3===s?this.isStar3(53,t):4===s?this.isStar4(53,t):this.isStar(53,t)}isKoKiep(t,s=0){return this.isKo(t,s)||this.isKiep(t,s)}isHoa(t,s=0){return 3===s?this.isStar3(54,t):4===s?this.isStar4(54,t):this.isStar(54,t)}isLinh(t,s=0){return 3===s?this.isStar3(55,t):4===s?this.isStar4(55,t):this.isStar(55,t)}isHoaLinh(t,s=0){return this.isHoa(t,s)||this.isLinh(t,s)}isKinh(t,s=0){return 3===s?this.isStar3(56,t):4===s?this.isStar4(56,t):this.isStar(56,t)}isDa(t,s=0){return 3===s?this.isStar3(57,t):4===s?this.isStar4(57,t):this.isStar(57,t)}isKinhDa(t,s=0){return this.isKinh(t,s)||this.isDa(t,s)}isLucSatTinh(t,s=0){return this.isKoKiep(t,s)||this.isKinhDa(t,s)||this.isHoaLinh(t,s)}isKhoi(t,s=0){return 3===s?this.isStar3(58,t):4===s?this.isStar4(58,t):this.isStar(58,t)}isViet(t,s=0){return 3===s?this.isStar3(59,t):4===s?this.isStar4(59,t):this.isStar(59,t)}isKhoiViet(t,s=0){return this.isKhoi(t,s)||this.isViet(t,s)}isTa(t,s=0){return 3===s?this.isStar3(60,t):4===s?this.isStar4(60,t):this.isStar(60,t)}isHuu(t,s=0){return 3===s?this.isStar3(61,t):4===s?this.isStar4(61,t):this.isStar(61,t)}isTaHuu(t,s=0){return this.isTa(t,s)||this.isHuu(t,s)}isXuong(t,s=0){return 3===s?this.isStar3(62,t):4===s?this.isStar4(62,t):this.isStar(62,t)}isKhuc(t,s=0){return 3===s?this.isStar3(63,t):4===s?this.isStar4(63,t):this.isStar(63,t)}isXuongKhuc(t,s=0){return this.isXuong(t,s)||this.isKhuc(t,s)}isGiapKhoi(t){return this.isGiap(58,t)}isGiapViet(t){return this.isGiap(59,t)}isGiapTa(t){return this.isGiap(60,t)}isGiapHuu(t){return this.isGiap(61,t)}isGiapXuong(t){return this.isGiap(62,t)}isGiapKhuc(t){return this.isGiap(63,t)}isTangTueDieu(t){return this.isStar(17,t)||this.isStar(21,t)||this.isStar(25,t)}isThaiTueCircle(t){return this.isStar(15,t)||this.isStar(23,t)||this.isStar(19,t)}isLocTonCircle(t){return this.isStar(27,t)||this.isStar(32,t)||this.isStar(74,t)}isTruongSinhCircle(t){return this.isStar(40,t)||this.isStar(44,t)||this.isStar(48,t)}isTuanChieu(t){return this.isTuan(this.xungChieu(t)[0])}isTrietChieu(t){return this.isTriet(this.xungChieu(t)[0])}isTuan(t){return this.ls.ttr[0].includes(t)}isTriet(t){return this.ls.ttr[1].includes(t)}}let horoHelp;function checkCachCuc(t){const s=t.am,i=t.ars[s];if(horoHelp.isStar3(0,s)&&[0,2,4,6,8,10].includes(s))return 2;if(horoHelp.isStar3(12,s)&&horoHelp.isStar3(13,s)&&horoHelp.isStar3(8,s))return 3;if(0===i.sb.length)return 4;if(horoHelp.isStar4(2,s)||horoHelp.isStar4(7,s))return 5;return[5,9,1,11,3,7].includes(s)&&horoHelp.isStar3(6,s)&&horoHelp.isStar3(10,s)?6:horoHelp.isStar3(1,s)&&horoHelp.isStar3(4,s)&&horoHelp.isStar3(9,s)?7:1}async function getInfoCach(t){const s=checkCachCuc(t),i={};return i.name={1:"Mặc định",2:"Tử Phủ Vũ Tướng",3:"Sát Phá Tham",4:"Vô Chính Diệu",5:"Nhật Nguyệt",6:"Phủ Tướng",7:"Cơ Đồng Cự"}[s],i.good=[],i.bad=[],i}function buildLsData(t,s=new Date,i=1,h=[...configDefault]){const a=h,e=new HoroscopeBuild({sex:i,born:dayjs(t),view:dayjs(s),cfg:a});return delete e.starPlacer,delete e.circlePlacer,delete e.zoneBuilder,delete e.calculationHelper,delete e.arrIdxChuyenLoc,delete e.str2hc,delete e.str2u,delete e.arrCkZone,delete e.countLoop,delete e.HOA,delete e.numberStarCol1,delete e.numberStarCol2,delete e.idxCheckZone,delete e.tpCan,delete e.adyetk,delete e.dtc,e}async function getLsDataServer(t,s=new Date,i=1,h=[...configDefault]){const a=buildLsData(t,s,i,h);try{horoHelp=new HoroHelp(a),a.cach.base=await getInfoCach(a)}catch(t){a.cach.base={}}return a}async function getHoroDataServerFromApi(t,s=new Date,i=1,h=[...configDefault]){return await getLsDataServer(t,s,i,h)}const getDefaultInfo=()=>({sex:1,dtBorn:new Date,strBorn:dayjs().format("YYYY-MM-DDTHH:mm:ss"),tkccBorn:"giap-thin-tan-mui-mau-ty-nham-tuat",dtView:new Date,strView:dayjs().format("YYYY-MM-DDTHH:mm:ss"),cfg:[...configDefault],key:"err",keyUrl:"err"});export{CfgValue as C,LsTypeSlug as L,VERSION_HORO as V,getHoroDataServerFromApi as a,getSexText as b,configDefault as c,getLunaBornText as d,getBaseText as e,getDefaultInfo as g};