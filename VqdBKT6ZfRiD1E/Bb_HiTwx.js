import{s as t,d as e,p as a}from"./DpXhXujS.js";import{s as r}from"./YNytrViW.js";import{G as i}from"./B4f24lDr.js";import{l as n}from"./SQR5eaLe.js";import{g as d,l as o,d as s,q as p,u as l,W as c}from"./6vJHmaDh.js";import"./pX-UiV6d.js";import"./vK_PB4cR.js";import{l as g}from"./DzW4iAJ_.js";import"./Cat91CNq.js";import"./Ct-_TUOu.js";import"./Bq1fMrfD.js";import"./DJoO2p0P.js";import"./DmjLdZ15.js";import"./Du7MN9qP.js";let h=0;const f=function(t,e,a,r){const{displayText:i,cssStyle:n}=e.getDisplayDetails(),d=t.append("tspan").attr("x",r.padding).text(i);""!==n&&d.attr("style",e.cssStyle),a||d.attr("dy",r.textHeight)},x=function(t,e,a,r){o.debug("Rendering class ",e,a);const i=e.id,n={id:i,label:e.id,width:0,height:0},d=t.append("g").attr("id",r.db.lookUpDomId(i)).attr("class","classGroup");let s;s=e.link?d.append("svg:a").attr("xlink:href",e.link).attr("target",e.linkTarget).append("text").attr("y",a.textHeight+a.padding).attr("x",0):d.append("text").attr("y",a.textHeight+a.padding).attr("x",0);let p=!0;e.annotations.forEach((function(t){const e=s.append("tspan").text("«"+t+"»");p||e.attr("dy",a.textHeight),p=!1}));let l=function(t){let e=t.id;return t.type&&(e+="<"+c(t.type)+">"),e}(e);const g=s.append("tspan").text(l).attr("class","title");p||g.attr("dy",a.textHeight);const h=s.node().getBBox().height;let x,y,u;if(e.members.length>0){x=d.append("line").attr("x1",0).attr("y1",a.padding+h+a.dividerMargin/2).attr("y2",a.padding+h+a.dividerMargin/2);const t=d.append("text").attr("x",a.padding).attr("y",h+a.dividerMargin+a.textHeight).attr("fill","white").attr("class","classText");p=!0,e.members.forEach((function(e){f(t,e,p,a),p=!1})),y=t.node().getBBox()}if(e.methods.length>0){u=d.append("line").attr("x1",0).attr("y1",a.padding+h+a.dividerMargin+y.height).attr("y2",a.padding+h+a.dividerMargin+y.height);const t=d.append("text").attr("x",a.padding).attr("y",h+2*a.dividerMargin+y.height+a.textHeight).attr("fill","white").attr("class","classText");p=!0,e.methods.forEach((function(e){f(t,e,p,a),p=!1}))}const m=d.node().getBBox();var b=" ";e.cssClasses.length>0&&(b+=e.cssClasses.join(" "));const k=d.insert("rect",":first-child").attr("x",0).attr("y",0).attr("width",m.width+2*a.padding).attr("height",m.height+a.padding+.5*a.dividerMargin).attr("class",b).node().getBBox().width;return s.node().childNodes.forEach((function(t){t.setAttribute("x",(k-t.getBBox().width)/2)})),e.tooltip&&s.insert("title").text(e.tooltip),x&&x.attr("x2",k),u&&u.attr("x2",k),n.width=k,n.height=m.height+a.padding+.5*a.dividerMargin,n};let y={};const u=function(t){const e=Object.entries(y).find((e=>e[1].label===t));if(e)return e[0]},m={parser:a,db:e,renderer:{draw:function(t,e,a,c){const f=d().class;y={},o.info("Rendering diagram "+t);const m=d().securityLevel;let b;"sandbox"===m&&(b=r("#i"+e));const k=r("sandbox"===m?b.nodes()[0].contentDocument.body:"body"),w=k.select(`[id='${e}']`);!function(t){t.append("defs").append("marker").attr("id","extensionStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 1,7 L18,13 V 1 Z"),t.append("defs").append("marker").attr("id","extensionEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 1,1 V 13 L18,7 Z"),t.append("defs").append("marker").attr("id","compositionStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","compositionEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","aggregationStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","aggregationEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","dependencyStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 5,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","dependencyEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L14,7 L9,1 Z")}(w);const L=new i({multigraph:!0});L.setGraph({isMultiGraph:!0}),L.setDefaultEdgeLabel((function(){return{}}));const E=c.db.getClasses(),v=Object.keys(E);for(const t of v){const e=E[t],a=x(w,e,f,c);y[a.id]=a,L.setNode(a.id,a),o.info("Org height: "+a.height)}c.db.getRelations().forEach((function(t){o.info("tjoho"+u(t.id1)+u(t.id2)+JSON.stringify(t)),L.setEdge(u(t.id1),u(t.id2),{relation:t},t.title||"DEFAULT")})),c.db.getNotes().forEach((function(t){o.debug(`Adding note: ${JSON.stringify(t)}`);const e=function(t,e,a){o.debug("Rendering note ",e,a);const r=e.id,i={id:r,text:e.text,width:0,height:0},n=t.append("g").attr("id",r).attr("class","classGroup");let d=n.append("text").attr("y",a.textHeight+a.padding).attr("x",0);const s=JSON.parse(`"${e.text}"`).split("\n");s.forEach((function(t){o.debug(`Adding line: ${t}`),d.append("tspan").text(t).attr("class","title").attr("dy",a.textHeight)}));const p=n.node().getBBox(),l=n.insert("rect",":first-child").attr("x",0).attr("y",0).attr("width",p.width+2*a.padding).attr("height",p.height+s.length*a.textHeight+a.padding+.5*a.dividerMargin).node().getBBox().width;return d.node().childNodes.forEach((function(t){t.setAttribute("x",(l-t.getBBox().width)/2)})),i.width=l,i.height=p.height+s.length*a.textHeight+a.padding+.5*a.dividerMargin,i}(w,t,f);y[e.id]=e,L.setNode(e.id,e),t.class&&t.class in E&&L.setEdge(t.id,u(t.class),{relation:{id1:t.id,id2:t.class,relation:{type1:"none",type2:"none",lineType:10}}},"DEFAULT")})),n(L),L.nodes().forEach((function(t){void 0!==t&&void 0!==L.node(t)&&(o.debug("Node "+t+": "+JSON.stringify(L.node(t))),k.select("#"+(c.db.lookUpDomId(t)||t)).attr("transform","translate("+(L.node(t).x-L.node(t).width/2)+","+(L.node(t).y-L.node(t).height/2)+" )"))})),L.edges().forEach((function(t){void 0!==t&&void 0!==L.edge(t)&&(o.debug("Edge "+t.v+" -> "+t.w+": "+JSON.stringify(L.edge(t))),function(t,e,a,r,i){const n=function(t){switch(t){case i.db.relationType.AGGREGATION:return"aggregation";case i.db.relationType.EXTENSION:return"extension";case i.db.relationType.COMPOSITION:return"composition";case i.db.relationType.DEPENDENCY:return"dependency";case i.db.relationType.LOLLIPOP:return"lollipop"}};e.points=e.points.filter((t=>!Number.isNaN(t.y)));const d=e.points,s=g().x((function(t){return t.x})).y((function(t){return t.y})).curve(p),c=t.append("path").attr("d",s(d)).attr("id","edge"+h).attr("class","relation");let f,x,y="";r.arrowMarkerAbsolute&&(y=window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search,y=y.replace(/\(/g,"\\("),y=y.replace(/\)/g,"\\)")),1==a.relation.lineType&&c.attr("class","relation dashed-line"),10==a.relation.lineType&&c.attr("class","relation dotted-line"),"none"!==a.relation.type1&&c.attr("marker-start","url("+y+"#"+n(a.relation.type1)+"Start)"),"none"!==a.relation.type2&&c.attr("marker-end","url("+y+"#"+n(a.relation.type2)+"End)");const u=e.points.length;let m,b,k,w,L=l.calcLabelPosition(e.points);if(f=L.x,x=L.y,u%2!=0&&u>1){let t=l.calcCardinalityPosition("none"!==a.relation.type1,e.points,e.points[0]),r=l.calcCardinalityPosition("none"!==a.relation.type2,e.points,e.points[u-1]);o.debug("cardinality_1_point "+JSON.stringify(t)),o.debug("cardinality_2_point "+JSON.stringify(r)),m=t.x,b=t.y,k=r.x,w=r.y}if(void 0!==a.title){const e=t.append("g").attr("class","classLabel"),i=e.append("text").attr("class","label").attr("x",f).attr("y",x).attr("fill","red").attr("text-anchor","middle").text(a.title);window.label=i;const n=i.node().getBBox();e.insert("rect",":first-child").attr("class","box").attr("x",n.x-r.padding/2).attr("y",n.y-r.padding/2).attr("width",n.width+r.padding).attr("height",n.height+r.padding)}o.info("Rendering relation "+JSON.stringify(a)),void 0!==a.relationTitle1&&"none"!==a.relationTitle1&&t.append("g").attr("class","cardinality").append("text").attr("class","type1").attr("x",m).attr("y",b).attr("fill","black").attr("font-size","6").text(a.relationTitle1),void 0!==a.relationTitle2&&"none"!==a.relationTitle2&&t.append("g").attr("class","cardinality").append("text").attr("class","type2").attr("x",k).attr("y",w).attr("fill","black").attr("font-size","6").text(a.relationTitle2),h++}(w,L.edge(t),L.edge(t).relation,f,c))}));const M=w.node().getBBox(),N=M.width+40,B=M.height+40;s(w,B,N,f.useMaxWidth);const T=`${M.x-20} ${M.y-20} ${N} ${B}`;o.debug(`viewBox ${T}`),w.attr("viewBox",T)}},styles:t,init:t=>{t.class||(t.class={}),t.class.arrowMarkerAbsolute=t.arrowMarkerAbsolute,e.clear()}};export{m as diagram};