import{j as q}from"./C_T6GK2G.js";import{r as yt}from"./DAImuvsF.js";import{C as F,Z as ct,c as Wt,i as Yt,v as Pt,w as no,S as io}from"./dzh8LiiG.js";import{A as ut,h as Gt,L as Q,a as et,c as tt,b as Bt,i as Lt,H as ro,C as St,j as jt,S as st,k as vt,l as Ft,m as Zt,F as ao,n as Ut,o as zt,p as Et,q as to,T as Mt,r as so,g as Xt,s as lo,d as co,G as fo}from"./Dseo2fP7.js";import{g as ho}from"./Cpj98o6Y.js";import{_ as Jt,R as xo,L as yo,C as uo,T as po,A as wo,a as bo,K as Qt}from"./CNuNv4A4.js";import{d as mt}from"./CV2G76of.js";import"./PaUSXiTs.js";import"./CMjsBGMX.js";var Rt={exports:{}};!function(t,o){Object.defineProperty(o,"__esModule",{value:!0}),o.Konva=void 0;var e=Jt;Object.defineProperty(o,"Konva",{enumerable:!0,get:function(){return e.Konva}});const n=Jt;t.exports=n.Konva}(Rt,Rt.exports);var go=Rt.exports;const Nt=ho(go),lt=new xo({x:0,y:0,width:100,height:100,hitStrokeWidth:0,shadowForStrokeEnabled:!1});lt.cache();const oo=new yo({points:[0,0,-100,-100],stroke:"#fff",strokeWidth:1.5,opacity:1});oo.cache();const Ht=new uo({x:-100,y:-100,radius:10,fill:"#000",stroke:"#000",strokeWidth:.2,opacity:.4,perfectDrawEnabled:!0,hitStrokeWidth:0,shadowForStrokeEnabled:!1,width:100,height:100});Ht.cache();let dt=new po({x:500,y:500,text:"",fontStyle:"normal",fontSize:14,fontFamily:"Arial",fill:"#000",strokeWidth:0,perfectDrawEnabled:!0,textDecoration:"",shadowColor:"black",shadowBlur:0,shadowOffset:{x:0,y:0},shadowOpacity:0,hitStrokeWidth:0,shadowForStrokeEnabled:!1,width:10,height:10});dt.cache(),dt=dt.clone({width:"auto",height:"auto"});const At=new wo({x:0,y:0,points:[0,0,250,250],pointerLength:12,pointerWidth:6,fill:"black",stroke:"black",strokeWidth:2.5,opacity:1,perfectDrawEnabled:!0,lineJoin:"round",hitStrokeWidth:0,shadowForStrokeEnabled:!1,width:5,height:5});function G(t,o,e,n,i=!0){let s={x:500,y:500,text:"",fontStyle:"normal",fontSize:o,fontFamily:e,fill:"#000",strokeWidth:0,perfectDrawEnabled:!0,textDecoration:"",shadowColor:"black",shadowBlur:0,shadowOffset:{x:0,y:0},shadowOpacity:0,hitStrokeWidth:0,shadowForStrokeEnabled:!1};s={...s,...t};const r=dt.clone(s);return i&&typeof n<"u"&&(n.add(r),null!==r&&r.moveToTop()),r}function Kt(t,o,e,n,i,s,r,l,a,c){const d=o[e];let f=!1;const x={fontSize:l+2,shadowEnabled:!0,shadowOpacity:0,shadowForStrokeEnabled:!0,align:"left",perfectDrawEnabled:!0,fontStyle:"bold"};x.x=i,x.y=s+7;let h,y=0;const p=["A","B","C","D"];for(let o=0;o<=3;o+=1)if(d[o]===n){f=!0;const e=c[o],n=a[o],i={x:x.x,y:x.y,radius:8.5,fill:e,stroke:n,strokeWidth:1.5,opacity:.7,hitStrokeWidth:0,shadowForStrokeEnabled:!1};x.text=`${p[o]}`,x.fill=a[o],h=G(x,l+2,r,t,!1),h.x(h.x()-4.7),h.y(h.y()-6),x.x+=y,x.y+=0;const s=Ht.clone(i);t.add(s),t.add(h),0===y&&(y=h.getTextWidth()+13)}return f}function It(t,o,e,n,i,s,r,l,a,c,d,f,x,h){let y=!1;const p=o[e.cn].indexOf(a);if(p>=0){y=!0;const o=e.ci,c={opacity:.8,points:[r,l,r,l],fill:f[Number(p)],stroke:f[Number(p)],strokeWidth:1.5,pointerLength:15,pointerWidth:8},d=c.points,u=-1!==e.sb.indexOf(a),b=11===o||0===o||1===o||2===o,m=5===o||6===o||7===o||8===o,S=3===o||4===o,g=9===o||10===o,w=x[e.ci],k=e.cno.filter((t=>t===e.ci)).length,W=63===a&&1===k,T=4===h.cfg[F.typeLs]||5===h.cfg[F.typeLs];if(b||m){let t=0;const e=Number(h.ars[o].zolk[0][ct.currentLoc]),r=Number(h.ars[o].zolk[3][ct.currentKi]);t=r>9||e>9?13:r>0||e>0?5:0,t=1===h.cfg[F.locKiToanDo]?t:0,d[0]=n.x+(u?i/2+(b?t:0):i/2-(W?23:2===k?10:6))-15*w,d[1]=d[1]+(u?6:3),d[2]=d[0],d[3]=m?5:b?n.y+s+23:d[3]}S&&(d[0]=n.x+(u||T?45:10),d[1]=d[1]+(u?6:5),d[2]=5,d[3]=d[1]),g&&(d[0]=n.x+i/2+(u?35:T?45:-15),d[1]=d[1]+(u?6:5),d[2]=n.x+i+23,d[3]=d[1]),t.add(At.clone(c))}return y}function Vt(t,o,e,n,i,s,r,l,a,c){if(r.cfg[F.showHoaIcon]<1)return!1;let d=!1;const f=o[r.ars[r.dvidx].cn].indexOf(s);return f>=0&&(d=!0,t.add(lt.clone({x:n,y:i,width:9,height:9,fill:c[Number(f)],stroke:c[Number(f)],strokeWidth:0,draggable:!1,opacity:.8,perfectDrawEnabled:!0,cornerRadius:0,hitStrokeWidth:0,shadowForStrokeEnabled:!1})),t.add(G({text:"2",x:n+1.8,y:i+.5,fontSize:l-4,fill:"#fff",shadowBlur:0,shadowOpacity:1,opacity:.9},l,a,t))),d}function _t(t,o,e,n,i,s,r,l,a,c){if(r.cfg[F.showHoaIcon]<2)return!1;const d=i+4.3;let f=!1;const x=o[r.dtv.bs.y[0]].indexOf(s);return x>=0&&(f=!0,t.add(Ht.clone({x:n+2.8,y:d,radius:5,fill:c[x],strokeWidth:0,opacity:.8,hitStrokeWidth:0,shadowForStrokeEnabled:!1})),t.add(G({text:"3",x:Number(n+1),y:Number(d-3.8),fontSize:Number(l-4),fill:"#fff",shadowBlur:0,shadowOpacity:1,opacity:.9},l,a,t))),f}function qt(t,o,e,n,i,s,r,l,a,c){if(r.cfg[F.showHoaIcon]<3)return!1;const d=i+4.1;let f=!1;const x=o[r.dtv.bs.m[0]].indexOf(s);return x>=0&&(f=!0,t.add(Ht.clone({x:n+2.8,y:d,radius:5,fill:c[x],strokeWidth:0,opacity:.8,hitStrokeWidth:0,shadowForStrokeEnabled:!1})),t.add(G({text:"4",x:Number(n+.7),y:Number(d-3.8),fontSize:Number(l-4),fill:"#fff",shadowBlur:0,shadowOpacity:1,opacity:.9},l,a,t))),f}function eo(t,o,e,n,i,s,r,l,a,c){if(r.cfg[F.showHoaIcon]<4)return!1;const d=i+4.1;let f=!1;const x=o[r.dtv.bs.d[0]].indexOf(s);return x>=0&&(f=!0,t.add(Ht.clone({x:n+2.8,y:d,radius:5,fill:c[x],strokeWidth:0,opacity:.8,hitStrokeWidth:0,shadowForStrokeEnabled:!1})),t.add(G({text:"5",x:Number(n+.7),y:Number(d-3.8),fontSize:Number(l-4),fill:"#fff",shadowBlur:0,shadowOpacity:1,opacity:.9},l,a,t))),f}function mo(t){const{color:o,colorHoa:e,colorHoaFill:n,fontPhuTinh:i,idx:s,cung:r,fontDV:l,fontFamilySet:a,typeLs:c,pos:d,hafWSquare:f,padContentTop:x,padContentBottom:h,padContent:y,wSquare:p,hSquare:u,cfgLs:b}=t,{ls:m}=t,S=new Nt.Group({});function g(t,o,e=.2,n=0){const i=lt.clone({x:t.x()-n/2-2,y:t.y()-n/2-1.8,fill:o,width:t.width()+n+4,height:t.height()+n,perfectDrawEnabled:!0,strokeWidth:0,opacity:e,cornerRadius:4,hitStrokeWidth:0,shadowForStrokeEnabled:!1});return S.add(i),null!==i&&i.moveToTop(),null!==t&&t.moveToTop(),i}function w(t,o){return Lt[ro[St[t]][St[o]][function(t,o){return jt[t]===jt[o]?1:0}(t,o)]]}return function(){let t=ut[r.ai];t=`${ut[r.ai]}`,3===c&&G({text:r.dv.toString(),fill:"#000",x:-1e4,y:-1e4,fontStyle:"bold"},l,a,S,!1).destroy();let e=m.at===s?`${t}(T)`:t;(4===c||5===c)&&(e=t);const n={text:e,fill:"#000",x:Number(d.x)+f,y:Number(d.y)+x,fontStyle:"bold",align:"left"},i=G(n,l-1,a,S);if(i.x(i.x()-i.getTextWidth()/2),S.add(dt.clone({x:i.x()-14,y:i.y()-.3,text:"▲",fontStyle:"normal",fontSize:l-1,fontFamily:"Arial",fill:o[Gt[s]],perfectDrawEnabled:!0,opacity:2===Gt[s]?.8:.6,hitStrokeWidth:0,shadowForStrokeEnabled:!1})),0===r.ai||4===r.ai||r.ai,0===r.ai){const t=lt.clone({x:d.x+1,y:d.y+1,width:p-1,height:u-1,fill:"#f0e9de",hitStrokeWidth:0,shadowForStrokeEnabled:!1,opacity:.6});S.add(t)}m.am===s&&g(i,n.fill,.3),n.text=r.dv,n.fill=o[Q[r.na]];const h=G(n,l-1,a,S);h.x(i.x()+i.width()+5);const y=g(h,o[Q[r.na]],.1);let b=!1;if(r.cn===m.dtb.bs.y[0]&&0!==s&&1!==s&&(n.fontStyle="bold",n.text=`${n.text}`,b=!0),b){n.fill="#555",n.text="☸",n.x=i.x()+i.getTextWidth()+2,n.y=i.y(),n.fontSize=l-2,n.shadowBlur=0,n.shadowEnabled=!1;const t=G(n,l,a,S);h.x(t.x()+t.getTextWidth()+2),y.x(h.x()-2)}}(),1===Number(b[F.rotateZone])&&function(){if(3===c)return;const t={text:`${ut[r.aid]}2`,fill:"#555",x:d.x+y,y:d.y+x,fontStyle:"bold",opacity:.8,fontSize:l-2},o=G(t,l-3,a,S);r.dvc&&g(o,t.fill,.2)}(),function(){if(4!==c)return;let t=21;1===b[F.batTuCung]&&1==b[F.showSun]&&(t=33),0===Number(b[F.showSun])&&0===b[F.batTuCung]&&(t=12),0===b[F.isNapAmCung]&&(t=2);let o=!1;if(r.ci===m.ars[m.am].cno[0]){o=!0;const i=18,s=18,r=lt.clone({x:d.x+y,y:d.y+h-t-4,width:15,height:15,fill:n[0],stroke:e[0],strokeWidth:1,opacity:.7,hitStrokeWidth:0,shadowForStrokeEnabled:!1,cornerRadius:2});S.add(r);const c=G({text:"A",fill:e[0],x:r.x(),y:r.y(),fontSize:l-2},l-2,a,S);c.x(r.x()+i/2-c.getTextWidth()/2-1),c.y(r.y()+s/2-c.getTextWidth()/2-1.3)}if(r.ci===m.ars[m.am].cno[3]){const i=lt.clone({x:d.x+y,y:d.y+h-t-4,width:15,height:15,fill:n[3],stroke:e[3],strokeWidth:1,opacity:.7,hitStrokeWidth:0,shadowForStrokeEnabled:!1,cornerRadius:2});S.add(i);const s=G({text:"D",fill:e[3],x:i.x(),y:i.y(),fontSize:l-2},l-2,a,S);s.x(i.x()+9-s.getTextWidth()/2-1),s.y(i.y()+9-s.getTextWidth()/2-1.3),o&&(i.x(i.x()+18),s.x(s.x()+18))}}(),function(){if(3===c)return;const t=G({text:`${ut[r.ail??0]}3`,fill:"#888",x:d.x+p-y,y:d.y+x,fontStyle:"bold",opacity:1},l-2,a,S);if(t.absolutePosition({x:t.x()-t.getTextWidth(),y:d.y+x}),0===b[F.rotateZone]&&t.destroy(),4!==c){const e=G({text:`${et[r.lmpt[2]].charAt(0)} T${r.lmpt[0]}`,fill:o[Q[r.lmpt[4]]],x:d.x+p-y,y:t.y()+16.5,fontSize:1===b[F.rotateZone]?l-3:l-1,opacity:1},l,a,S);e.x(e.x()-e.getTextWidth()),0===b[F.rotateZone]?e.y(e.y()-16.5):(0===r.ail&&g(t,"#444"),m.dtv.ln.m===r.lmpt[0]&&g(e,"#555"))}}(),function(){const t=`${et[r.cn].charAt(0)}.${tt[r.ci]}`,e=1===b[F.rotateZone]?l-3:l-1;let n=x;1===Number(b[F.rotateZone])&&(n=x+16);const i=G({text:t,fill:o[Q[r.na]],x:-1e3,y:-1e3,fontSize:e},l,a,S,!1),s={text:t,fill:o[Q[r.na]],x:d.x+y,y:d.y+n,fontSize:e};3===c&&(s.y=d.y+y),G(s,e,a,S),i.destroy()}(),function(){let t={},e=21;if(1===b[F.batTuCung]&&1==b[F.showSun]&&(e=33),0===Number(b[F.showSun])&&0===b[F.batTuCung]&&(e=12),0===b[F.isNapAmCung]&&(e=2),4!==c&&5!==c){t={text:`V${r.lmnp[0]}`,fill:"#444",x:d.x+y-2,y:d.y+h-e,fontSize:l-2};const n=G(t,l,a,S);t={},t.x=d.x+y,t.y=d.y+h-e,t.text=`${tt[r.lynp].toUpperCase()}`,t.fill=o[Bt[r.lynp]],t.align="left",t.fontSize=l-3,t.fontStyle="bold";const i=G(t,l,a,S);m.dtv.bs.y[1]===r.lynp&&g(i,t.fill),n.x(i.x()+i.getTextWidth()+2),m.dtv.ln.m===r.lmnp[0]&&g(n,"#555")}const n=(r.lmpt[1][0]-1+2)%12,i=m.ars[n],s=G({text:`${et[i.lmpt[2]].charAt(0)}.${tt[i.lmpt[3]]} P${r.lmpt[1][0]}`,fill:o[Q[i.lmpt[4]]],x:d.x+p-y,y:d.y+h-e,fontSize:l-2,opacity:1},l,a,S);s.x(s.x()-s.getTextWidth()),m.dtv.ln.m===r.lmpt[1][0]&&g(s,"#555")}(),1===Number(b[F.isNapAmCung])&&function(){let t=d.y+h;(4===c||5===c)&&(t=d.y+h+7);const e={text:"",fill:o[4],x:d.x+y,y:t,fontSize:i-6,opacity:.7};r.ys.forEach((n=>{const i=e;i.text=n[1],i.fill=o[Q[n[2]]];const r=G(i,l,a,S);n[1]===m.dtv.sn.y&&1===Number(b[F.showSun])&&g(r,i.fill,.2);const c=r.x()+r.getTextWidth()+4.5;i.text=`${et[n[3]].charAt(0)}`,i.x=r.x(),i.y=r.y()-9;const f=G(i,l,a,S);i.text=`.${n[0]}`,i.x=f.x()+f.getTextWidth();const x=G(i,l,a,S);if(n[1]===m.dtv.sn.y&&1===Number(b[F.showSun])&&(g(f,f.fill(),.2),g(x,x.fill(),.2)),0===Number(b[F.showSun])&&(r.destroy(),f.y(i.y+10),x.y(f.y()),n[1]===m.dtv.sn.y&&(g(f,f.fill(),.2),g(x,x.fill(),.2))),1===b[F.batTuCung]){const t=w(m.dtb.bs.d[0],n[3]);i.text="Thương"===t?"Thg":t,i.fill="#444",i.x=r.x(),1===b[F.showSun]?i.y=r.y()-20:i.y=r.y()-10,G(i,l,a,S)}let h=m.cid;if(m.yeo>=m.cid)for(let t=0;t<120&&!(h+10>=m.yeo+1);t+=10)h+=10;m.yeo>=m.cid&&n[0]>=h&&n[0]<h+10&&S.add(dt.clone({x:f.x()+3,y:3===s||4===s||9===s||10===s?d.y+u-5:d.y+u-5.5,text:"▲",fontStyle:"normal",fontSize:l-5,fontFamily:"Arial",fill:"#555",perfectDrawEnabled:!0,opacity:1,hitStrokeWidth:0,shadowForStrokeEnabled:!1})),i.align="left",i.x=c,i.y=t}))}(),t.layer.add(S),t.layer}function So(t){const{ls:o,color:e,colorHoa:n,colorHoaFill:i,fontPhuTinh:s,cung:r,fontDV:l,fontFamilySet:a,typeLs:c,pos:d,hafWSquare:f,fontChinhTinh:x,hSquare:h,wSquare:y,canHoa:p,thdraw:u}=t,b=new Nt.Group({});function m(t,o=!0){let e={x:500,y:500,text:"",fontStyle:"normal",fontSize:l,fontFamily:a,fill:"#000",strokeWidth:0,perfectDrawEnabled:!0,textDecoration:"",shadowColor:"#fff",shadowBlur:0,shadowOffset:{x:0,y:0},shadowOpacity:0,hitStrokeWidth:0,shadowForStrokeEnabled:!1};e={...e,...t};const n=dt.clone(e);return o&&b.add(n),n}return function(){const t=d.x;let S=d.y+38,g=17;const w={fontSize:x,fontStyle:"normal"};(4===c||5===c)&&(g=25,w.fontSize=x+4,S=d.y+70);const k=typeof r.tu<"u"||typeof r.tu<"u";for(let W=0;W<r.sb.length;W+=1){const T=r.sb[W],F=st[T];if(F.name.length>0){w.text=F.name.toUpperCase(),w.fill=e[F.hh],w.fontStyle="bold";const $=m(w,!1);if(w.x=t+f-$.getTextWidth()/2,w.y=S,4===c){const t={...w,fontSize:x-6,fontStyle:"normal"};if(t.x=w.x,t.y=w.y-9,r.stlk.length>0&&typeof r.stlk[T]<"u"){const o=r.stlk[T];t.text=`${o[0]}A`,t.fill=n[0];const e=m(t);t.text=`${o[1]}D`,t.fill=n[3];const i=m(t),s=e.getTextWidth()+i.getTextWidth()+4;e.x(d.x+f-s/2),i.x(e.x()+e.getTextWidth()+4),0===o[0]&&e.destroy(),0===o[1]&&(i.destroy(),o[0]>0&&e.x(e.x()+e.getTextWidth()+4))}}const v=F.lvl;let B=!1,N="";void 0!==v&&Object.entries(v).forEach((([t,o],e)=>{Number(t)===r.ci+1&&("M"===o||"V"===o)&&(B=!0,N=o),Number(t)===r.ci+1&&"H"===o&&(N=o),Number(t)===r.ci+1&&(N=o)})),4!==c&&5!==c&&B&&!k&&(w.shadowColor=e[F.hh],w.shadowBlur=0,w.shadowOpacity=0,w.shadowOffset={x:0,y:0});let z=m(w);if(!(4===c||5===c)&&N.length>0&&m({text:`(${N})`,fill:e[F.hh],fontSize:s-6,x:w.x+z.getTextWidth()+1,y:w.y-1,fontStyle:w.fontStyle}),3!==c&&void 0!==F.nn){const t=w.x-11,c=w.y;Kt(b,p,o.dtb.bs.y[0],r.sb[W],t,c,a,l,n,i);const f=z.x()+z.getTextWidth();It(b,p,r,d,y,h,z.x(),z.y(),r.sb[W],l,a,n,u,o)&&(u[r.ci]+=1);const x=f+14,S=z.y()+1.5,g=Vt(b,p,r,x,S,r.sb[W],o,l,a,n),k=g?x+12:x,T=_t(b,p,r,k,S,r.sb[W],o,l,a,n),$=T?k+10:g?x+12:x,v=qt(b,p,r,$,S,r.sb[W],o,l,a,n)?$+10:T?k+10:g?x+12:x;eo(b,p,r,v,S,r.sb[W],o,l,a,n),m({text:""+(F.nn[1]>0?"+":"-"),fill:e[F.hh],fontSize:s-3,x:z.x()+z.getTextWidth()+4,y:z.y()+5,fontStyle:w.fontStyle})}z=dt.clone({}),S+=g}}}(),t.layer.add(b),t.layer}function To(t){const{colorHoaFill60:o,fontPhuTinh:e,idx:n,cung:i,fontDV:s,fontFamilySet:r,typeLs:l,pos:a,hafWSquare:c,hafHSquare:d,colorHoa:f,padContent:x,xBox12:h,yBox34:y,yBox14:p,yBox12:u,xBox34:b,xBox14:m,getGradient:S,typePhiHoa:g,ls:w,countHt:k}=t,W=new Nt.Group({});function T(){const t=[];return t[0]=[{pos:[h+c,y,m+c,p]},{pos:[m+c,y,h+c,p]},{pos:[m,y,b,p]},{pos:[m,u+d,b,p+d]},{pos:[m,p+d,b,u+d]},{pos:[m,p,b,y]},{pos:[m+c,p,h+c,y]},{pos:[h+c,p,m+c,y]},{pos:[b,p,m,y]},{pos:[b,p+d,m,u+d]},{pos:[b,u+d,m,p+d]},{pos:[b,y,m,p]}],t[1]=[{pos:[t[0][0].pos[0]-17,t[0][0].pos[1],t[0][0].pos[2]+17,t[0][0].pos[3]]},{pos:[t[0][1].pos[0]-17,t[0][1].pos[1],t[0][1].pos[2]+17,t[0][1].pos[3]]},{pos:[t[0][2].pos[0]-17,t[0][2].pos[1],t[0][2].pos[2]+17,t[0][2].pos[3]]},{pos:[t[0][3].pos[0],t[0][3].pos[1]-17,t[0][3].pos[2],t[0][3].pos[3]+17]},{pos:[t[0][4].pos[0],t[0][4].pos[1]-17,t[0][4].pos[2],t[0][4].pos[3]+17]},{pos:[t[0][5].pos[0],t[0][5].pos[1]-17,t[0][5].pos[2],t[0][5].pos[3]+17]},{pos:[t[0][6].pos[0]+17,t[0][6].pos[1],t[0][6].pos[2]-17,t[0][6].pos[3]]},{pos:[t[0][7].pos[0]+17,t[0][7].pos[1],t[0][7].pos[2]-17,t[0][7].pos[3]]},{pos:[t[0][8].pos[0]+17,t[0][8].pos[1],t[0][8].pos[2]-17,t[0][8].pos[3]]},{pos:[t[0][9].pos[0],t[0][9].pos[1]+17,t[0][9].pos[2],t[0][9].pos[3]-17]},{pos:[t[0][10].pos[0],t[0][10].pos[1]+17,t[0][10].pos[2],t[0][10].pos[3]-17]},{pos:[t[0][11].pos[0],t[0][11].pos[1]+17,t[0][11].pos[2],t[0][11].pos[3]-17]}],t[2]=[{pos:[t[0][0].pos[0]+17,t[0][0].pos[1],t[0][0].pos[2]-17,t[0][0].pos[3]]},{pos:[t[0][1].pos[0]+17,t[0][1].pos[1],t[0][1].pos[2]-17,t[0][1].pos[3]]},{pos:[t[0][2].pos[0],t[0][2].pos[1]+17,t[0][2].pos[2],t[0][2].pos[3]-17]},{pos:[t[0][3].pos[0],t[0][3].pos[1]+17,t[0][3].pos[2],t[0][3].pos[3]-17]},{pos:[t[0][4].pos[0],t[0][4].pos[1]+17,t[0][4].pos[2],t[0][4].pos[3]-17]},{pos:[t[0][5].pos[0]-17,t[0][5].pos[1],t[0][5].pos[2]+17,t[0][5].pos[3]]},{pos:[t[0][6].pos[0]-17,t[0][6].pos[1],t[0][6].pos[2]+17,t[0][6].pos[3]]},{pos:[t[0][7].pos[0]-17,t[0][7].pos[1],t[0][7].pos[2]+17,t[0][7].pos[3]]},{pos:[t[0][8].pos[0],t[0][8].pos[1]-17,t[0][8].pos[2],t[0][8].pos[3]+17]},{pos:[t[0][9].pos[0],t[0][9].pos[1]-17,t[0][9].pos[2],t[0][9].pos[3]+17]},{pos:[t[0][10].pos[0],t[0][10].pos[1]-17,t[0][10].pos[2],t[0][10].pos[3]+17]},{pos:[t[0][11].pos[0]+17,t[0][11].pos[1],t[0][11].pos[2]-17,t[0][11].pos[3]]}],t[3]=[{pos:[t[0][0].pos[0]-34,t[0][0].pos[1],t[0][0].pos[2]+34,t[0][0].pos[3]]},{pos:[t[0][1].pos[0]-34,t[0][1].pos[1],t[0][1].pos[2]+34,t[0][1].pos[3]]},{pos:[t[0][2].pos[0]-34,t[0][2].pos[1],t[0][2].pos[2]+34,t[0][2].pos[3]]},{pos:[t[0][3].pos[0],t[0][3].pos[1]-34,t[0][3].pos[2],t[0][3].pos[3]+34]},{pos:[t[0][4].pos[0],t[0][4].pos[1]-34,t[0][4].pos[2],t[0][4].pos[3]+34]},{pos:[t[0][5].pos[0],t[0][5].pos[1]-34,t[0][5].pos[2],t[0][5].pos[3]+34]},{pos:[t[0][6].pos[0]+34,t[0][6].pos[1],t[0][6].pos[2]-34,t[0][6].pos[3]]},{pos:[t[0][7].pos[0]+34,t[0][7].pos[1],t[0][7].pos[2]-34,t[0][7].pos[3]]},{pos:[t[0][8].pos[0]+34,t[0][8].pos[1],t[0][8].pos[2]-34,t[0][8].pos[3]]},{pos:[t[0][9].pos[0],t[0][9].pos[1]+34,t[0][9].pos[2],t[0][9].pos[3]-34]},{pos:[t[0][10].pos[0],t[0][10].pos[1]+34,t[0][10].pos[2],t[0][10].pos[3]-34]},{pos:[t[0][11].pos[0],t[0][11].pos[1]+34,t[0][11].pos[2],t[0][11].pos[3]-34]}],t}function $(t){const o=[!0,!1];return[o[0],o[1],o[0],o[0],o[0],o[1],o[1],o[0],o[0],o[1],o[1],o[1]][w.ars[t].ai]}function v(t){return t.charAt(0).toUpperCase()+t.slice(1)}function B(t){return function(t){let o=Number(t);return o>11&&(o-=12),o}(t+6)}function N(t,o,e=!1){const i=[[],[],[],[],[],[]];if(n===t||t===B(n))return[-2e3,-2e3,-2e3,-2e3,-2e3,-2e3];const s=T(),r=s[0][n],l=s[3][t];i[0]=r.pos[0],i[1]=r.pos[1],i[4]=l.pos[0],i[5]=l.pos[1],(6===t||7===t)&&(i[4]+=15);const a=(i[4]-i[0])/2,c=(i[5]-i[1])/2,d=i[0]+a,f=i[1]+c,x=[];return x[0]=[[-2e3,-2e3],[d,f-30],[d-10,f-50],[d+10,f-30],[d+30,f-30],[d+30,f-50],[d-10,f-80],[d-50,f],[d-40,f-30],[d-30,f-15],[d-10,f-15],[d,f-30]],x[1]=[[d,f-25],[-2e3,-2e3],[d,f-30],[d+15,f-15],[d+30,f-10],[d+30,f-30],[d+30,f],[d-10,f-80],[d-50,f-50],[d-30,f-30],[d-10,f-40],[d-10,f-40]],x[2]=[[d,f-45],[d,f-25],[-2e3,-2e3],[d+20,f],[d+30,f-10],[d+80,f],[d+40,f-40],[d+10,f+75],[d-10,f-80],[d-10,f-50],[d-30,f-30],[d,f-80]],x[3]=[[d+15,f-40],[d+20,f-20],[d+30,f],[-2e3,-2e3],[d+30,f-10],[d+40,f-10],[d+40,f-10],[d+10,f+60],[d+30,f+50],[d-10,f-80],[d,f-30],[d+30,f-35]],x[4]=[[d+30,f-30],[d+25,f-10],[d+40,f+20],[d+30,f],[-2e3,-2e3],[d+30,f],[d+15,f+15],[d+10,f+35],[d+20,f+50],[d,f+40],[d-10,f-80],[d-10,f-80]],x[5]=[[d+40,f-10],[d+25,f-5],[d+80,f],[d+50,f-5],[d+20,f-10],[-2e3,-2e3],[d,f+25],[d+10,f+30],[d,f+80],[d+10,f+50],[d-30,f+40],[d-10,f-80]],x[6]=[[d-30,f-30],[d+30,f],[d+30,f+20],[d+30,f+25],[d+20,f+20],[d-10,f+25],[-2e3,-2e3],[d,f+25],[d-10,f+40],[d-10,f+30],[d-40,f+40],[d-50,f+40]],x[7]=[[d-30,f-30],[d-30,f-30],[d+40,f+20],[d+40,f+40],[d+10,f+30],[d+10,f+40],[d+10,f+25],[-2e3,-2e3],[d,f+25],[d-20,f+20],[d-30,f-10],[d-35,f]],x[8]=[[d-30,f-30],[d-50,f-10],[d-40,f-20],[d+20,f+60],[d-10,f+40],[d+10,f+80],[d,f+30],[d,f+20],[-2e3,-2e3],[d-25,f],[d-40,f],[d-50,f-10]],x[9]=[[d-30,f-30],[d-30,f-30],[d-20,f-90],[d-40,f-20],[d,f+60],[d-10,f+40],[d-10,f+40],[d-15,f+15],[d-25,f-10],[-2e3,-2e3],[d-30,f-10],[d-50,f-10]],x[10]=[[d-20,f-20],[d-10,f-35],[d-5,f-40],[d,f-50],[d-10,f-80],[d-30,f+40],[d-10,f+40],[d-25,f+10],[d-60,f],[d-30,f-10],[-2e3,-2e3],[d-25,f]],x[11]=[[d,f-25],[d-30,f-30],[d,f-80],[d+10,f-50],[d+30,f-30],[d-10,f-80],[d-50,f-20],[d-25,f+5],[d-80,f],[d-40,f-10],[d-20,f],[-2e3,-2e3]],i[2]=x[n][t][0],i[3]=x[n][t][1],e&&(i[2]=i[2]+Math.floor(30*Math.random())+10,i[3]=i[3]+Math.floor(30*Math.random())+10),i}function z(t){const o=f[3],e=i.cno[3],n={fill:o,stroke:o,pointerLength:11,pointerWidth:4,tension:.5,opacity:.5,strokeWidth:1,dash:[8,4]};n.points=N(e),$(e)&&(n.strokeWidth=1.7,n.opacity=.7),(4===l||5===l)&&(n.opacity=.7,n.strokeWidth=1.5,$(e)&&(n.opacity=.9,n.strokeWidth=2)),n.stroke=S(n.points,o,o),W.add(At.clone(n))}return 3!==l&&(function(){const t={text:"T.HÓA",fill:f[3],x:a.x,y:a.y+x+s+2.7,fontSize:e-4,opacity:.7,fontStyle:"normal"},o=[],l=[];let d=0;for(let l=0;l<=3;l+=1)t.text=`${v(ut[w.ars[i.cno[l]].ai].toLowerCase())}`,t.fill=f[l],t.fontStyle=$(i.cno[l])?"bold":"normal",t.opacity=.8,o[l]=G(t,s,r,W),t.x=t.x+o[l].getTextWidth()+2.3,d=d+o[l].getTextWidth()+2.3,i.cno[l]===n&&(o[l].text("✱"),o[l].fontSize(e-3));let h=a.x+c-d/2+4;for(let i=0;i<=3;i+=1)o[i].absolutePosition({x:h,y:t.y}),h=o[i].x()+o[i].getTextWidth()+2.3,1===w.cfg[F.tuanHoanZone]&&w.loopPT[i].forEach(((t,c)=>{if(t.includes(n)){const t={text:["⇄","⇅","⟳","⟲","⇊"][c],fill:f[i],x:o[i].x()+o[i].getTextWidth()/2-3.5,y:a.y+x+s+(0===c?10:12),fontSize:e-5,opacity:1,fontStyle:"normal"};void 0===l[i]&&(l[i]=[]),l[i][c]=G(t,s,r,W)}}))}(),1===w.cfg[F.locKiToanDo]&&function(){const t=i.zolk[0][ct.currentLoc],o=i.zolk[3][ct.currentKi];let x=null,h=null,y=null;const p="∞",u={text:"",fill:"",x:a.x+c,y:a.y+2*d-48,fontSize:4===l?e+2:e-2,opacity:4===l?1:.8,fontStyle:"bold"},b=4===l||5===l?"A":"",m=4===l||5===l?"D":"";if(t>0)if(Wt(w.loopLP[0],n))if(0===i.zolk[0][ct.locKeep])u.text=t.toString()+b+p,u.fill=f[0],x=G(u,s,r,W),x.x(x.x()-x.getTextWidth()/2);else{const o=t-i.zolk[0][ct.locKeep];u.text=o>0?i.zolk[0][ct.locKeep].toString()+b:t.toString()+b,u.fill=f[0],x=G(u,s,r,W),x.x(x.x()-x.getTextWidth()/2),o>0&&(u.text=o+p,h=G(u,s,r,W),h.x(h.x()-h.getTextWidth()/2))}else u.text=t.toString()+b,u.fill=f[0],x=G(u,s,r,W),x.x(x.x()-x.getTextWidth()/2);else Wt(w.loopLP[0],n)&&0===t&&(u.text=p,u.fill=f[0],u.fontSize=e,x=G(u,s,r,W),x.x(x.x()-x.getTextWidth()/2));o>0||Wt(w.loopLP[3],n)?(x&&x.y(x.y()-15),h&&h.y(h.y()-30)):h&&h.y(h.y()-15),o>0?(u.text=o.toString()+m+(Wt(w.loopLP[3],n)?p:""),u.fill=f[3],y=G(u,s,r,W),y.x(y.x()-y.getTextWidth()/2)):Wt(w.loopLP[3],n)&&0===o&&(u.text=p,u.fill=f[3],u.fontSize=e,y=G(u,s,r,W),y.x(y.x()-y.getTextWidth()/2)),x&&W.add(x),h&&W.add(h),y&&W.add(y),x&&x.moveToTop(),h&&h.moveToTop(),y&&y.moveToTop()}(),(0===l||1===l||4===l||6===l||8===l)&&function(t){const e=f[t],n=i.cno[t];let s=!1;(0===t||3===t)&&(s=1===i.zolk[t][0===t?ct.isMoveLoc:3===t?ct.isMoveKi:3]);const r={fill:e,stroke:e,pointerLength:11,pointerWidth:5,tension:.6,opacity:.6,strokeWidth:.4};switch(t){case 0:case 1:case 2:s&&z()}if(n<0||n===i.ci)return;r.points=N(n);const a=i.cno[3];3!==t&&n===a&&(r.points=N(n,0,!0));const c=$(n),d=s&&3===t;c&&(r.strokeWidth=1.5,r.opacity=.7),d&&(r.dash=[7,3],r.opacity=.8,r.strokeWidth=2),d&&c&&(r.opacity=.9),(4===l||5===l)&&(r.strokeWidth=1.7,r.opacity=r.opacity+.2),r.stroke=S(r.points,e,o[t]),W.add(At.clone(r))}(g),function(){const t=T();for(let o=0;o<=3;o+=1){const e=B(n),s=i.cno[o]===e,r=1===i.zolk[0][ct.isMoveLoc],a=1===i.zolk[3][ct.isMoveKi];if(s&&4!==l||4===l&&g===o&&s||1===l&&g===o&&s||8===l&&g===o&&s||s&&r&&3===o&&1!==g&&2!==g){const i=k[e]??0,s=k[n]??0;let c=s;i>s&&(k[n]=i,c=i);const d=t[c][n];if(g===o||1!==l&&8!==l||r&&3===o){const t=f[o],e={opacity:.8,points:d.pos,fill:t,stroke:t,strokeWidth:2.5,pointerLength:20,pointerWidth:8};(a&&3===g||r&&0===g&&3===o)&&(0===l||1===l||4===l||8===l)&&3===o&&(e.dash=[12,3]),4===l&&(e.strokeWidth=3),W.add(At.clone(e))}k[n]=c+1,k[e]=k[n]}}}()),t.layer.add(W),t.layer}function Co(t){const{ls:o,color:e,colorHoa:n,colorHoaFill:i,fontChinhTinh:s,fontPhuTinh:r,cung:l,fontDV:a,fontFamilySet:c,typeLs:d,pos:f,padContentBottom:x,padContent:h,wSquare:y,hafWSquare:p,hSquare:u,cfgLs:b,canHoa:m,thdraw:S}=t,g=new Nt.Group({});function w(t,o=!0){let e={x:500,y:500,text:"",fontStyle:"normal",fontSize:a,fontFamily:c,fill:"#000",shadowForStrokeEnabled:!1,strokeWidth:0,perfectDrawEnabled:!0,textDecoration:"",shadowColor:"black",shadowBlur:0,shadowOffset:{x:0,y:0},shadowOpacity:0};e={...e,...t};const n=dt.clone(e);return o&&g.add(n),n}function k(t,x,h,k,W=!1,T=r){if(4===d||5===d)return 1===h.zone&&0===k?function(t,r,x){if(![60,61,62,63].includes(x.id-1))return r;const h={fontSize:s+4,fontStyle:"normal"};h.x=t+p,h.y=r,h.text=x.name.toUpperCase(),h.fill=e[x.hh],h.fontStyle="bold";let b=w(h),k=b.y();b.x(b.x()-b.getTextWidth()/2);const W=x.id-1;if(4===d){let t={...h,fontSize:s-6,fontStyle:"normal"};if(t.x=h.x,t.y=h.y-9,l.stlk.length>0&&typeof l.stlk[W]<"u"){const o=l.stlk[W];t.text=`${o[0]}A`,t.fill=n[0];const e=w(t);t.text=`${o[1]}D`,t.fill=n[3];const i=w(t),s=e.getTextWidth()+i.getTextWidth()+4;e.x(f.x+p-s/2),i.x(e.x()+e.getTextWidth()+4),0===o[0]&&e.destroy(),0===o[1]&&(i.destroy(),o[0]>0&&e.x(e.x()+e.getTextWidth()+4))}}if([60,61,62,63].indexOf(W)>-1){const t=b.x()-11,e=b.y();Kt(g,m,o.dtb.bs.y[0],W,t,e,c,a,n,i);const s=b.x()+b.getTextWidth()+5,r=b.y()-.5;It(g,m,l,f,y,u,s,r,W,a,c,n,S,o)&&(S[l.ci]+=1);const d=b.x()+b.getTextWidth()+3,x=b.y()+4,h=Vt(g,m,l,d,x,W,o,a,c,n)?d+12:d,p=_t(g,m,l,h,x,W,o,a,c,n)?h+10:h+3;qt(g,m,l,p,x,W,o,a,c,n)}return k+25}(t,x,h):x;const $=k>0,v=h.id-1,B=b[F.showHideStar];if(B>0&&!$&&(1===B&&!vt.includes(v)||2===B&&!vt.includes(v)&&!Ft.includes(v)||3===B&&!vt.includes(v)&&!Ft.includes(v)&&!Zt.includes(v)||4===B&&!vt.includes(v)&&!Ft.includes(v)&&!Zt.includes(v)&&!ao.includes(v)))return x;const N=T-1;if([64,65,66,67].includes(v)&&$)return x;const z=void 0!==h.cir,E=h.iptt,C={text:h.name,x:t,y:x,fontSize:T-1,fill:e[h.hh],width:z&&"vts"===h.cir?y:"auto",opacity:1,align:"center",shadowEnabled:!1,shadowOpacity:0,shadowForStrokeEnabled:!1,textDecoration:""};Number(b[F.shortStar]),$?(C.fontStyle="italic",C.opacity=.9):(1===Number(b[F.shortStar])&&(C.text=h.sht),E?(C.fontStyle="bold",C.shadowColor=e[h.hh],C.shadowBlur=0,C.shadowOffset={x:0,y:0},C.shadowOpacity=.8):(C.shadowOpacity=0,C.fontStyle="normal",C.textDecoration="",z&&("vbs"===h.cir||h.cir)));const q=w(C,!1);W&&(C.x=t-q.getTextWidth());const G=typeof l.tu<"u"||typeof l.tr<"u",D=h.lvl;let j="",L=0,H=!1;void 0!==D&&Object.entries(D).forEach((([t,o],e)=>{Number(t)===l.ci+1&&(j=o,L=5.5,H=!0)})),void 0!==h.lvl&&"Đ"===j&&!G&&!$&&(C.shadowColor=e[h.hh],C.shadowBlur=0,C.shadowOffset={x:0,y:0},C.shadowOpacity=.8,w(C)),h.lvl;let O=w(C);if(k>0){let t={...C};switch(k){case 1:t.text="◆";break;case 2:t.text="◇";break;case 3:t.text="T."}t.fontSize=t.fontSize-2,2===h.typ?(O.x(O.x()-7),t.x=O.x()+O.getTextWidth()-.2,t.y=O.y()+1):(O.x(O.x()+8),t.x=O.x()-9.5,t.y=O.y()+1),t.fill="#888",w(t)}const P=h.id-1;if(!$&&[60,61,62,63].indexOf(P)>-1&&3!==d){L=0===L?L+3:L;let t=O.x()+O.getTextWidth()+L+9,e=O.y()-1;const s=Kt(g,m,o.dtb.bs.y[0],P,t,e,c,a,n,i),r=O.x()+O.getTextWidth()+L+(s?22:5),d=O.y()+1;It(g,m,l,f,y,u,r,d,P,a,c,n,S,o)&&(S[l.ci]+=1);const x=O.x()+O.getTextWidth()+L+(s?20:2),h=O.y()+2,p=Vt(g,m,l,x,h,P,o,a,c,n),b=p?x+12:x,w=_t(g,m,l,b,h,P,o,a,c,n),k=w?b+11:p?x+12:x,W=qt(g,m,l,k,h,P,o,a,c,n)?k+11:w?b+11:p?x+12:x;eo(g,m,l,W,h,P,o,a,c,n)}return H&&!$&&(C.x+=O.getTextWidth(),C.y-=1,C.text=j,C.fontSize=r-6,C.fontStyle="normal",C.opacity=1,C.shadowOpacity=0,w(C)),q.destroy(),x+N}function W(t,e,n,i,s,r=0){const l=[27,56,57,58,59,62,63];let a=1===b[F.dvStar],c=b[F.currentStar];for(let d=0;d<t.length;d+=1){if(r>0){let e=!1;!o.istc&&a&&l.includes(t[d])&&(e=!0);let n=o.istc?[...Ut,58,59,62,63]:Ut;if(n=1===c?n:2===c?[...n,25,37,82,83,85,86]:[],n.length>0&&!n.includes(t[d])&&(e=!0),!o.istc&&[62,63].includes(t[d])&&(e=!0),e)continue}if(0===Number(b[F.isADSat])&&(123===t[d]||124===t[d]||125===t[d]))continue;const f=st[t[d]];void 0!==f.cir&&"vts"===f.cir||(1===f.typ&&(n=k(e,n,f,r)),2===f.typ&&(s=k(i,s,f,r,!0)))}return[n,s]}return function(){let t=f.x+h,e=f.y+73,n=e;const i=f.x+y-h-2;let s=n;if(4===d||5===d){let o=l.sb.length;const n=25,i=f.y+70,r=[i,i+n,i+2*n];t=f.x,e=r[o],s=e}const r=f.x;let a=f.y+x-21;if(1===b[F.batTuCung]&&1===b[F.showSun]&&(a=f.y+x-35),0===b[F.batTuCung]&&0===b[F.showSun]&&(a=f.y+x-10),4!==d&&5!==d)for(let t=0;t<l.ss.length;t+=1){const o=st[l.ss[t]];void 0!==o.cir&&"vts"===o.cir&&(a=k(r,a,o,0,!1,13))}const c=W(l.ss,t,e,i,s,0);let p=c;1===b[F.dvStar]&&o.istc&&(p=W(l.sv,t,c[0],i,c[1],1)),b[F.currentStar]>0&&W(l.sy,t,p[0],i,p[1],2)}(),t.layer.add(g),t.layer}function ko(t){let o=t.layer;const e=new Nt.Group({}),n=[{x:Number(t.xBox12),y:Number(t.yBox34)},{x:Number(t.xBox14),y:Number(t.yBox34)},{x:Number(t.xBox),y:Number(t.yBox34)},{x:Number(t.xBox),y:Number(t.yBox12)},{x:Number(t.xBox),y:Number(t.yBox14)},{x:Number(t.xBox),y:Number(t.yBox)},{x:Number(t.xBox14),y:Number(t.yBox)},{x:Number(t.xBox12),y:Number(t.yBox)},{x:Number(t.xBox34),y:Number(t.yBox)},{x:Number(t.xBox34),y:Number(t.yBox14)},{x:Number(t.xBox34),y:Number(t.yBox12)},{x:Number(t.xBox34),y:Number(t.yBox34)}];let i,s;const r=[0,0,0,0,0,0,0,0,0,0,0,0,0],l=[0,0,0,0,0,0,0,0,0,0,0,0,0];for(let e=0;e<12;e+=1)i=n[e],s={idx:Number(e),cung:t.ls.ars[e],pos:i,thdraw:l},o=mo({...s,...t}),o=So({...s,...t}),o=Co({...s,...t}),o=To({countHt:r,...s,...t});function a(o,n,i,s,r="#fff",l="#666",a=!1){let c=a?50:43;n>0&&(c=a?33:17);const d={x:Number(i[0])-c/2+(n>0?35:0),y:Number(i[1])-4.5,text:o,fill:r,width:c,align:"center",fontSize:9,perfectDrawEnabled:!0,opacity:1,shadowColor:"#000",shadowBlur:0,shadowOpacity:0,shadowOffset:{x:0,y:0}},f=G(d,t.fontDV,t.fontFamilySet,e),x=lt.clone({x:f.x()-5,y:f.y()-0,fill:l,width:f.width()+10,height:f.height()+0,perfectDrawEnabled:!0,strokeWidth:0,opacity:1,cornerRadius:6,stroke:"#222",hitStrokeWidth:0,shadowForStrokeEnabled:!1});e.add(x),null!==x&&x.moveToTop(),null!==f&&f.moveToTop(),(6==s||0==s)&&(0===n&&!a&&(f.absolutePosition({x:d.x+17,y:d.y+18}),x.absolutePosition({x:f.x(),y:f.y()+5})),0===n&&a&&(f.absolutePosition({x:d.x+21,y:d.y+18}),x.absolutePosition({x:f.x(),y:f.y()+5})),2===n&&!a&&(f.absolutePosition({x:d.x-31,y:d.y-50}),x.absolutePosition({x:f.x(),y:f.y()+5})),2===n&&a&&(f.absolutePosition({x:d.x-23,y:d.y-50}),x.absolutePosition({x:f.x(),y:f.y()+5})),f.rotation(-90),x.rotation(-90))}return 5===t.typeLs||6===t.typeLs||function(){const i=t.ls.ttr[0],s=t.ls.ttr[2];if(0!==i.length||0!==s.length){const r=[[n[0].x,n[0].y+t.hafHSquare],[n[2].x+t.hafWSquare,n[2].y],[n[4].x+t.hafWSquare,n[4].y],[n[7].x,n[7].y+t.hafHSquare],[n[9].x+t.hafWSquare,n[9].y],[n[11].x+t.hafWSquare,n[11].y]];if(0!==i.length){const t=i[0],o=i[1];t[0]===o[0]?a("Tuần-Triệt",0,r[t[0]/2],o[0],"#fff","#111",!0):(a("Tuần",0,r[t[0]/2],t[0],"#fff","#777",!1),a("Triệt",0,r[o[0]/2],o[0],"#fff","#333",!1))}if(0!==s.length&&1===t.ls.cfg[F.lnTuTr]){const t=s[0],o=s[1];t[0]===o[0]?a("⊙-⊠",2,r[t[0]/2],o[0],"#fff","rgba(17, 17, 17, 1)",!0):(a("⊙",2,r[t[0]/2],t[0],"#fff","rgba(119, 119, 119, 1)",!1),a("⊠",2,r[o[0]/2],o[0],"#fff","rgba(51, 51, 51, 1)",!1))}o.add(e)}}(),o}function Wo(t){const{ls:o,xBox:e,borderOutWith:n,hafBorderOut:i,yBox:s,xBox14:r,yBox14:l,xBox12:a,yBox12:c,xBox34:d,yBox34:f,xBox4:x,yBox4:h,hafBorderIn:y,borderInnerWith:p}=t;return function(){const t=["#000000","#000000","#000000"][o.cfg[F.tcpb]];return[{points:[r+y,s-y,r+y,h+i],color:t,strokeWidth:p},{points:[a+y,s-y,a+y,l+y],color:t,strokeWidth:p},{points:[a+y,f+y,a+y,h+i],color:t,strokeWidth:p},{points:[d+y,s-y,d+y,h+i],color:t,strokeWidth:p},{points:[e,l+y,x+i,l+y],color:t,strokeWidth:p},{points:[e,c+y,r+y,c+y],color:t,strokeWidth:p},{points:[d+y,c+y,x+i,c+y],color:t,strokeWidth:p},{points:[e,f+y,x+i,f+y],color:t,strokeWidth:p}].concat([{points:[e-i,s-i,a+y,s-i],color:t,strokeWidth:n},{points:[a,s-i,d+y,s-i],color:t,strokeWidth:n},{points:[d+y,s-i,x+i,s-i],color:t,strokeWidth:n},{points:[x+i,s-i,x+i,c+y],color:t,strokeWidth:n},{points:[x+i,c+y,x+i,f+y],color:t,strokeWidth:n},{points:[x+i,f+y,x+i,h+i],color:t,strokeWidth:n},{points:[x+i,h+i,a+y,h+i],color:t,strokeWidth:n},{points:[a,h+i,r+y,h+i],color:t,strokeWidth:n},{points:[r+y,h+i,e-i,h+i],color:t,strokeWidth:n},{points:[e-i,h+i,e-i,c+y],color:t,strokeWidth:n},{points:[e-i,c+y,e-i,l+y],color:t,strokeWidth:n},{points:[e-i,l+y,e-i,s-i],color:t,strokeWidth:n}])}().forEach((o=>{t.layer.add(oo.clone({points:o.points,stroke:o.color,strokeWidth:1.5,opacity:1}))})),t.layer}function Ao(t){const{wSquare:o,xBox12:e,xBox14:n,yBox14:i,yBox34:s,borderInnerWith:r,ls:l,fontCenter:a,fontFamilySet:c,color:d,fontDV:f,cfgLs:x}=t,h=new bo.Group({}),y=1===Number(x[F.batTuCenter]);function p(t){let o={x:500,y:500,text:"",fontStyle:"normal",fontSize:f,fontFamily:c,fill:"#000",strokeWidth:0,textDecoration:"",shadowColor:"black",shadowBlur:0,shadowOffset:{x:0,y:0},shadowOpacity:0,hitStrokeWidth:0,shadowForStrokeEnabled:!1,perfectDrawEnabled:!0};o={...o,...t};const e=dt.clone(o);return h.add(e),e}function u(t){return p({...t,fontStyle:"normal",width:2*o+r,align:"center"})}function b(t,e,n,i){return function(t,e,n,i){const s=o/2-2.5,r=o/10,c=s+t,f={x:t,y:e,fill:"rgba(0, 0, 0, 0.07)",width:s,height:y?2.1*s:1.35*s,perfectDrawEnabled:!0,strokeWidth:1,opacity:1,cornerRadius:6,hitStrokeWidth:1,shadowForStrokeEnabled:!1},x=lt.clone(f);h.add(x),p({text:jt[n.cn]>0?"+":"-",x:x.x(),y:x.y()+2,fill:"#777",fontSize:a+1,width:s,align:"center",fontStyle:"normal",fontFamily:"Arial"});const u=p({text:`${i}`,x:x.x(),y:x.y()+r,fontSize:a,width:s,align:"center",fontStyle:"bold"});let b=u.x(),m=u.y();if(y){const t=p({text:`${-1===n.cht?"Nhật chủ":Lt[n.cht]}`,x:u.x(),y:u.y()+r+3,fontSize:a,width:s,align:"center"});b=t.x(),m=t.y()}const S=p({text:`${et[n.cn].toUpperCase()}`,x:b,y:m+r+6,fill:d[St[n.cn]],fontSize:a+1,fontStyle:"bold",width:s,align:"center"}),g=p({text:`${tt[n.ci].toUpperCase()}`,x:S.x(),y:S.y()+r,fill:d[Bt[n.ci]],fontSize:a+1,fontStyle:"bold",width:s,align:"center"});if(b=g.x(),m=g.y(),y){const t=s/n.ctg.length,o=a-2;let e=0,i=g.y();n.ctg.forEach((n=>{const s=p({text:`${et[n]}`,x:0===e?g.x():e,y:g.y()+r,fill:d[St[n]],fontSize:o,width:t,align:"center"}),c=Lt[Yt(l.dtb.bs.d[0],n)],f=t-2,x=p({text:c,x:s.x(),y:s.y()+r+2,fontSize:a-2,width:"Thương"===c?f+8:f,align:"center",fill:"#000"});e=s.x()+t,i=x.y()}));const c=r+3,f=p({text:`${lo[n.ts]}`,x:g.x(),y:i+c,fontSize:a-2,width:s,align:"center"});b=f.x(),m=f.y()}const w=r+5,k=a-2;return p({text:`${co[n.na]}`,x:b,y:m+w,fill:d[Q[n.na]],fontSize:k,width:s,align:"center"}),c}(t,e,n,1===x[F.showSun]?i:"")}return function(){if(void 0===l)return[];h.destroyChildren(),p({text:`Ver ${t.version}`,x:n+10,y:s-48,fill:"#000",align:"center",width:2*o-20,fontSize:a-4,opacity:.3,fontVariant:"normal"}),function(){const t="VGluaE1lbmhEby5jb20=",e=(()=>{try{return window.atob(t)}catch{return""}})();p({text:e,x:n,y:s-36,fill:"#b06200",align:"center",width:2*o,fontSize:a-1,opacity:.8,fontVariant:"normal"})}(),function(){const t="TG_FpIHPz";let e=`Loại lá số ${x[F.typeLs]+1}`;if([6,7,8].includes(x[F.typeLs])){const o=["1","2","3"];e+=` - ${t.substring(0,3)}${o[x[F.tcpb]]}`}p({text:e+" - Can Hóa "+(l.cfg[F.lsCanType]+1)+` - lập lúc ${mt().format("YYYY/MM/DD HH:mm")}`,x:n,y:s-20,fill:"#000",align:"center",width:2*o,fontSize:a-2,opacity:.8,fontVariant:"normal"})}();const c=a-1;let f=ut[l.ars[l.at].ai];f=f.charAt(0)+f.slice(1).toLowerCase();const m=l.dtv.bs,S=a-1.5,g=[[{text:`${l.adye>0?"Dương":"Âm"} ${l.sx>0?"Nam":"Nữ"}`,fontStyle:"normal"},{text:`${l.yeo} tuổi`,fontStyle:"bold",align:"center"},{text:"âm lịch",fontStyle:"normal"},{text:"giờ",fontStyle:"normal"},{text:`${tt[l.dtb.bs.h[1]]}`,fontStyle:"bold"},{text:"ngày",fontStyle:"normal"},{text:`${l.dtb.ln.d}`,fontStyle:"bold"},{text:"tháng",fontStyle:"normal"},{text:`${l.dtb.ln.m}`,fontStyle:"bold"},{text:"năm",fontStyle:"normal"},{text:et[l.dtb.bs.y[0]],fontStyle:"bold",fill:d[St[l.dtb.bs.y[0]]]},{text:tt[l.dtb.bs.y[1]],fontStyle:"bold",fill:d[Bt[l.dtb.bs.y[1]]]}],[{text:"Mệnh",fontStyle:"normal"},{text:zt[Q[l.dtb.bs.y[2]]],fontStyle:"bold",fill:d[Q[l.dtb.bs.y[2]]]},{text:"cục"},{text:zt[l.cid],fontStyle:"bold",fill:d[l.cid]},{text:`- ${l.ad>0?Et[1]:Et[0]} - ${to[l.sks]}`}],[{text:"Thân cư",fontStyle:"normal"},{text:`${f}`,fontStyle:"bold"},{text:"- Mệnh chủ"},{text:st[l.mctc[0]].name,fontStyle:"bold",fill:d[st[l.mctc[0]].hh]},{text:"- Thân chủ"},{text:st[l.mctc[1]].name,fontStyle:"bold",fill:d[st[l.mctc[1]].hh]}],[{text:"Năm xem "+l.dtv.sn.y+" ÂL: ",x:n+10,fontSize:S},{text:`${et[m.y[0]]} ${tt[m.y[1]]} - `,fill:d[Q[m.y[2]]],fontSize:S},{text:`${et[m.m[0]]} ${tt[m.m[1]]}(${l.dtv.ln.m}) - `,fill:d[Q[m.m[2]]],fontSize:S},{text:`${et[m.d[0]]} ${tt[m.d[1]]}(${l.dtv.ln.d}) - `,fill:d[Q[m.d[2]]],fontSize:S},{text:`${et[m.h[0]]} ${tt[m.h[1]]}`,fill:d[Q[m.h[2]]],fontSize:S}]],w=function(t,o,e){return Array.from({length:e},((e,n)=>t+n*o))}(i+15,16,4);(function(t,o,n){t.forEach(((t,i)=>{!function(t,o,n){let i=0;t.forEach((t=>{i+=function({text:t,fontSize:o,fontStyle:e}){return dt.clone({text:t,fontSize:o,fontStyle:e}).width()}({...t,fontSize:n})+3}));let s=e-i/2;t.forEach(((t,e)=>{const{txt:i,width:r}=function({text:t,y:o,fontSize:e,fontStyle:n,fill:i}){const s=p({text:t,y:o,fontSize:e,fontStyle:n,fill:i});return{txt:s,width:s.getTextWidth()}}({...t,y:o,fontSize:n});i.x(s),s+=r+3}))}(t,o[i],n)}))})(g,w,c),function(){const{dtb:t,tutru:e}=l,s=t.tki,c=u({text:`Tứ Trụ - Sinh vào tiết ${Mt[s[0]]}`,x:n,y:i+95,fontSize:a});s[1]&&u({text:`Tháng ${so[s[0]]}tk từ ${Mt[Xt[s[0]][0]]} (${1===x[F.showSun]?mt(s[3]).format("YYYY/MM/DD HH:mm"):mt(s[3]).format("----/MM/DD HH:mm")}) đến ${Mt[Xt[s[0]][1]]} (${1===x[F.showSun]?mt(s[4]).format("YYYY/MM/DD HH:mm"):mt(s[4]).format("----/MM/DD HH:mm")})`,x:n,y:c.y()+16,fontSize:a-3});const f=b(n+3,c.y()+33,e.cot[0],`${t.sn.y}`),m=t.ln.mt===t.ln.m?"("+t.ln.mt+")":"("+t.ln.m+")("+t.ln.mt+"tk)",S=b(f+3,c.y()+33,e.cot[1],`${t.sn.m} ${m}`),g=b(S+3,c.y()+33,e.cot[2],`${t.sn.d} (${t.ln.d})`);if(b(g+3,c.y()+33,e.cot[3],`${t.sn.h}h${t.sn.i}`),y){const t=l.tutru.dvt,e=p({text:`${t[0]?"Thuận":"Nghịch"} đến tk cách ${t[1]} ngày ${t[2]} giờ quy đổi thành ${t[3]} năm ${t[4]} tháng ${t[5]} ngày`,x:n,y:c.y()+235,fontStyle:"normal",width:2*o+r,align:"center",fontSize:a-2.5}),i=15,s=l.tutru.dv,f=34;let y=0;s.forEach(((t,o)=>{const s=mt.unix(t[2]),r=l.yeo>=s.year()-l.dtb.sn.y+1&&l.yeo<=s.year()-l.dtb.sn.y+10,c={x:0===y?n+3:y,y:e.y()+i,fill:r?"rgba(255, 224, 191, 0.7)":"rgba(0, 0, 0, 0.07)",width:f,height:75,perfectDrawEnabled:!0,strokeWidth:1,opacity:1,cornerRadius:6,hitStrokeWidth:1,shadowForStrokeEnabled:!1};h.add(lt.clone(c));const u=p({text:`${Lt[Yt(l.dtb.bs.d[0],t[0])]}`,x:0===y?n+3:y,y:e.y()+i+5,fill:"#333",fontSize:a-4,width:f,align:"center"}),b=p({text:`${et[t[0]]}`,x:0===y?n+3:y,y:u.y()+i,fill:d[St[t[0]]],fontSize:a-2,width:f,align:"center"}),m=p({text:`${tt[t[1]]}`,x:b.x(),y:b.y()+i,fill:d[Bt[t[1]]],fontSize:a-2,width:f,align:"center"});let S=`${s.year()-l.dtb.sn.y+1}-${s.year()-l.dtb.sn.y+10}t${1===x[F.showSun]?" "+s.format("YYYY"):""}`;0===o&&(S=`${s.year()-l.dtb.sn.y+1}t${1===x[F.showSun]?" "+s.format("DD/MM   YYYY"):""}`),p({text:`${S}`,x:b.x(),y:m.y()+i+2,fill:"#333",fontSize:a-5,width:f,align:"center"}),y=b.x()+f+3.5}))}}()}(),t.layer.add(h),t.layer}At.cache();const Ot=no(io),Po=t=>{const o=t.ls,e=o.cfg,n=75*(o.css<=11?0:o.css-11),i=960+n,s=e[F.typeLs],r=e[F.typePhiHoa],l=185.5,a=i/4,c=i+2+1+1,d=["","","#031640","#067b11","#8b8380","#e39e25","#cf233b"],f=["","","#123e65","#04973c","#919191","#e39e25","#e73827"];let x=5;(4===s||5===s)&&(x=8);const h=["rgb(3 140 0)","rgb(110 8 136)","rgb(14 124 202)","rgb(217 4 4)"],y=["rgb(3 140 0 / 75%)","rgb(110 8 136 / 75%)","rgb(14 124 202 / 75%)","rgb(217 4 4 / 75%)"],p=["rgba(114,250,112,0.9)","rgba(227,100,255,0.9)","rgba(77,182,255,0.9)","rgba(246,66,66,0.9)"],u=["rgba(114,250,112,0.5)","rgba(227,100,255,0.5)","rgba(77,182,255,0.5)","rgba(246,66,66,0.5)"],b="Roboto Slab",m=54,S=l/2,g=a/2;let w=1,k=w+l,W=k+1+l,T=W+1+l,$=T+1+l,v=1,B=v+a,N=B+1+a,z=N+1+a,E=z+1+a;w+=27,k+=27,W+=27,T+=27,$+=27,v+=27,B+=27,N+=27,z+=27,E+=27;const C=a-2.3*x,G=x;function D(t,o,e="#dcd3aaa8"){if(typeof window<"u"){const n=window.document.createElement("canvas").getContext("2d"),i=void 0!==t[4]?t[4]:t[2],s=void 0!==t[5]?t[5]:t[3],r=n.createLinearGradient(t[0],t[1],i,s);return r.addColorStop(0,e),r.addColorStop(1,o),r}return o}const j=yt.useRef(null);let L;const[H,O]=yt.useState(!1),[P,M]=yt.useState(!1);function A(t){let e="VCD";return o.ars[t].sb.length>0&&(e="",o.ars[t].sb.forEach((t=>{e.length>0&&(e+="-"),e+=st[t].sht}))),Pt(e)}yt.useEffect((()=>{if(typeof window<"u")try{if(L&&L.destroy(),j.current&&j.current.destroy(),!document.getElementById("cv"))return void console.error("Container not found");const n=new Qt.Stage({container:"cv",width:800,height:c+m,fill:"#fefefe",font:b});j.current=n,L=new Qt.Layer;const q=fo(e[F.lsCanType]);L.add(lt.clone({x:0,y:0,width:800,height:c+m,hitStrokeWidth:0,shadowForStrokeEnabled:!1,fillRadialGradientStartPoint:{x:W,y:N},fillRadialGradientStartRadius:0,fillRadialGradientEndPoint:{x:W,y:N},fillRadialGradientEndRadius:1e3,fillRadialGradientColorStops:[0,"#FFF",1,"#ddd"]})),L.add(lt.clone({x:k+1,y:B+1,width:372,height:2*a+1,fillRadialGradientStartPoint:{x:k,y:B},fillRadialGradientStartRadius:0,fillRadialGradientEndPoint:{x:k,y:B},fillRadialGradientEndRadius:555,fillRadialGradientColorStops:[0,"#fff",1,"#ddd"],hitStrokeWidth:0,shadowForStrokeEnabled:!1})),L=Wo({ls:o,layer:L,lsWidth:742,lsHeight:i,xBox:w,borderOutWith:1,hafBorderOut:.5,yBox:v,xBox12:W,yBox12:N,xBox14:k,yBox14:B,xBox34:T,yBox34:z,xBox4:$,yBox4:E,hafBorderIn:.5,borderInnerWith:1,bColor:f}),L=ko({layer:L,bColor:f,colorHoaStart:y,colorHoa:h,colorHoaFill:p,colorHoaFill60:u,color:d,xBox12:W,yBox34:z,xBox14:k,xBox:w,yBox12:N,yBox14:B,yBox:v,xBox4:$,yBox4:E,xBox34:T,ls:o,hafWSquare:S,hafHSquare:g,fontFamilySet:b,borderOutWith:1,hafBorderOut:.5,fontDV:13,padContentBottom:C,padContentTop:G,padContent:x,wSquare:l,hSquare:a,fontPhuTinh:14,fontChinhTinh:15,getGradient:D,typePhiHoa:r,typeLs:s,cfgLs:e,canHoa:q}),L=Ao({layer:L,wSquare:l,xBox12:W,xBox14:k,yBox14:B,yBox34:z,borderInnerWith:1,ls:o,fontCenter:12,hafWSquare:S,fontFamilySet:b,color:d,fontDV:13,cfgLs:e,getGradient:D,version:t.version}),L.add(lt.clone({x:0,y:c+m,width:800,height:c+m,fill:"rgb(233 233 233)"})),n.add(L),M(!0),O(!0)}catch(t){console.error("Error initializing stage:",t),O(!1),M(!1)}return()=>{L&&L.destroy(),j.current&&(j.current.destroy(),j.current=null),O(!1),M(!1)}}),[t.ls]),yt.useEffect((()=>{0!==t.fnDownloadCall&&V(),0!==t.fnCopyLs&&Y()}),[t.fnDownloadCall,t.fnCopyLs]);const R=()=>{const t=ut[o.ars[o.at].ai],e=o.dtv.bs;return q.jsxs("div",{className:"text-[14px] [&_div]:mb-1",children:[q.jsxs("div",{children:["Thời gian sinh dương lịch:"," ",q.jsxs("b",{children:[o.dtb.sn.d,"/",o.dtb.sn.m,"/",o.dtb.sn.y," lúc ",o.dtb.sn.h,"h",o.dtb.sn.m]})]}),q.jsxs("div",{children:[q.jsx("b",{children:`${o.adye>0?"Dương":"Âm"} ${o.sx>0?"Nam":"Nữ"}`})," tuổi âm lịch ",q.jsxs("b",{children:[o.yeo," tuổi"]})]}),q.jsxs("div",{children:["Âm lịch giờ ",q.jsx("b",{children:tt[o.dtb.bs.h[1]]})," ngày ",q.jsx("b",{children:o.dtb.ln.d})," tháng ",q.jsx("b",{children:o.dtb.ln.m})," năm"," ",q.jsxs("b",{className:`color${Q[o.dtb.bs.y[2]]}`,children:[et[o.dtb.bs.y[0]]," ",tt[o.dtb.bs.y[1]]]})]}),q.jsxs("div",{children:["Mệnh ",q.jsxs("b",{className:`color${Q[o.dtb.bs.y[2]]}`,children:[" ",zt[Q[o.dtb.bs.y[2]]]]})," cục"," ",q.jsx("b",{className:`color${o.cid}`,children:zt[o.cid]})," - ",`${o.ad>0?Et[1]:Et[0]} - ${to[o.sks]}`," "]}),q.jsxs("div",{children:["Thân cư ",q.jsx("b",{children:t.charAt(0)+t.slice(1).toLowerCase()})," - Mệnh chủ"," ",q.jsx("b",{className:`color${st[o.mctc[0]].hh}`,children:st[o.mctc[0]].name})," - Thân chủ"," ",q.jsx("b",{className:`color${st[o.mctc[1]].hh}`,children:st[o.mctc[1]].name})," "]}),q.jsxs("div",{className:"!text-[12px] !mt-3",children:["Năm xem ",q.jsx("b",{children:o.dtv.sn.y})," ÂL:"," ",q.jsxs("span",{className:`color${Q[e.y[2]]}`,children:[et[e.y[0]]," ",tt[e.y[1]]]})," ","-"," ",q.jsxs("span",{className:`color${Q[e.m[2]]}`,children:[et[e.m[0]]," ",tt[e.m[1]],"(",o.dtv.ln.m,")"]})," ","-"," ",q.jsxs("span",{className:`color${Q[e.d[2]]}`,children:[et[e.d[0]]," ",tt[e.d[1]],"(",o.dtv.ln.d,")"]})," ","-"," ",q.jsxs("span",{className:`color${Q[e.h[2]]}`,children:[et[e.h[0]]," ",tt[e.h[1]]]})]})]})},Y=async()=>{try{if(!j.current)throw new Error("Stage chưa được khởi tạo");if(!P||!H)throw new Error("Lá số đang được tải, vui lòng đợi trong giây lát");if(!document.getElementById("cv"))throw new Error("Không tìm thấy container chứa lá số");await new Promise((t=>setTimeout(t,500)));let t,o=0;const e=3;for(;!t&&o<e;)try{t=j.current.toDataURL({pixelRatio:2,quality:1,mimeType:"image/png"})}catch(t){if(console.error(`Attempt ${o+1} failed:`,t),o++,o===e)throw new Error("Không thể tạo ảnh từ lá số sau nhiều lần thử");await new Promise((t=>setTimeout(t,300)))}const n=await(await fetch(t)).blob();await navigator.clipboard.write([new ClipboardItem({[n.type]:n})]),Ot.fire({title:"Thông báo",html:q.jsxs("div",{children:[q.jsx("div",{children:"Tinh Mệnh Đồ đã copy xong:"}),q.jsxs("div",{className:"text-orange-600",children:["Check lại thông tin ",q.jsx("b",{children:"1 lần nữa"})," cho dù bạn đã chắc chắn."]}),q.jsx("br",{}),q.jsx("div",{children:R()}),q.jsx("br",{})]}),icon:"success"})}catch(t){console.error("Error copying image:",t),Ot.fire({title:"Lỗi",text:t instanceof Error?t.message:"Có lỗi xảy ra khi copy lá số",icon:"error"})}},V=()=>{try{if(!j.current||!H)throw new Error("Vui lòng đợi lá số được tải xong");const t=o.am,e=A(t),n=o.at,i=A(n);!function(t,o){if(typeof window<"u"){const e=window.document.createElement("a");e.download=o,e.href=t,window.document.body.appendChild(e),e.click(),window.document.body.removeChild(e)}}(j.current.toDataURL({pixelRatio:2,quality:100}),`${1===o.sx?"nam":"nu"}-Menh-${e}-${Pt(tt[t])}-Than-${i}-${Pt(tt[n])}--${o.dtb.sn.y}.${o.dtb.sn.m}.${o.dtb.sn.d}-${o.dtb.sn.h}h.${o.dtb.sn.m}-TinhMenhDo.com-${Math.floor(1e4*Math.random())}.png`)}catch(t){console.error("Error exporting image:",t),Ot.fire({title:"Lỗi",text:t instanceof Error?t.message:"Có lỗi xảy ra khi lưu lá số",icon:"error"})}},[K,I]=yt.useState(!0);return yt.useEffect((()=>{typeof window<"u"&&K&&I(!1)})),q.jsxs(q.Fragment,{children:[q.jsx("div",{id:"cv",className:"flex justify-center"}),q.jsx("div",{className:"absolute top-0 left-0 hidden size-full max-lg:block"})]})};export{Po as default};