import{j as e}from"./Bq1fMrfD.js";import{r as t,a as n,b as a,c as s,K as r,L as i,C as o,T as l,A as c}from"./H1lITHM6.js";import{r as d,R as React}from"./Ct-_TUOu.js";import{I as O,h}from"./C7a9ZG1V.js";var u=t(),m=n(),_=a();function I(e){const t=[...e].sort(((e,t)=>e.vi_tri-t.vi_tri)).reverse().map((e=>e.isYang?"1":"0")).join("");return h.findIndex((e=>e===t))}const T={BASE_RADIUS_RATIO:.4,CIRCLE_RATIOS:{OUTER_MOST:1.12,OUTER:.95,HAO_6:.77,HAO_5:.685,HAO_4:.602,HAO_3:.52,HAO_2:.44,HAO_1:.36,INNER:.2},HAO_CONFIG:{CIRCLES:{HAO_6:{LINE_COLOR:"#000",LINE_WIDTH:1.5,DASH:[]},HAO_5:{LINE_COLOR:"#000",LINE_WIDTH:1.2,DASH:[]},HAO_4:{LINE_COLOR:"#000",LINE_WIDTH:1,DASH:[]},HAO_3:{LINE_COLOR:"#000",LINE_WIDTH:.8,DASH:[]},HAO_2:{LINE_COLOR:"#000",LINE_WIDTH:.6,DASH:[]},HAO_1:{LINE_COLOR:"#000",LINE_WIDTH:.5,DASH:[]}},ARC_CONFIG:{ANGLE_SPAN:5.625,HAO_6:{LAO_AM:{FILL:"#444",TEXT_COLOR:"white"},THIEU_DUONG:{FILL:"#f5f5f5",TEXT_COLOR:"transparent"},LAO_DUONG:{FILL:"#fff",TEXT_COLOR:"black"},THIEU_AM:{FILL:"#e0e0e0",TEXT_COLOR:"transparent"}},HAO_5:{LAO_AM:{FILL:"#444",TEXT_COLOR:"white"},THIEU_DUONG:{FILL:"#f5f5f5",TEXT_COLOR:"transparent"},LAO_DUONG:{FILL:"#fff",TEXT_COLOR:"black"},THIEU_AM:{FILL:"#e0e0e0",TEXT_COLOR:"transparent"}},HAO_4:{LAO_AM:{FILL:"#444",TEXT_COLOR:"white"},THIEU_DUONG:{FILL:"#f5f5f5",TEXT_COLOR:"transparent"},LAO_DUONG:{FILL:"#fff",TEXT_COLOR:"black"},THIEU_AM:{FILL:"#e0e0e0",TEXT_COLOR:"transparent"}},HAO_3:{LAO_AM:{FILL:"#444",TEXT_COLOR:"white"},THIEU_DUONG:{FILL:"#f5f5f5",TEXT_COLOR:"transparent"},LAO_DUONG:{FILL:"#fff",TEXT_COLOR:"black"},THIEU_AM:{FILL:"#e0e0e0",TEXT_COLOR:"transparent"}},HAO_2:{LAO_AM:{FILL:"#444",TEXT_COLOR:"white"},THIEU_DUONG:{FILL:"#f5f5f5",TEXT_COLOR:"transparent"},LAO_DUONG:{FILL:"#fff",TEXT_COLOR:"black"},THIEU_AM:{FILL:"#e0e0e0",TEXT_COLOR:"transparent"}},HAO_1:{LAO_AM:{FILL:"#444",TEXT_COLOR:"white"},THIEU_DUONG:{FILL:"#f5f5f5",TEXT_COLOR:"transparent"},LAO_DUONG:{FILL:"#fff",TEXT_COLOR:"black"},THIEU_AM:{FILL:"#e0e0e0",TEXT_COLOR:"transparent"}}},TEXT_CONFIG:{FONT_SIZE:{HAO_6:13,HAO_5:12,HAO_4:11,HAO_3:10,HAO_2:9,HAO_1:8},FONT_FAMILY:"Arial",OFFSET_RATIO:1/3},SPACING:{ROTATION_OFFSET:90}},TEXT_POSITIONS:{OUTER_HEXAGRAM:1.05,OUTER_NUMBER:.985,HEXAGRAM:.88,NUMBER:.81},ARROW:{LENGTH:.8,POINTER_LENGTH:21,POINTER_WIDTH:7,STROKE_WIDTH:2}};function x(e){let t;return t=e<640?Math.min(e-32,400):e<1024?Math.min(e-64,600):850,{width:t,height:t}}function A(e){const t=e/850;return{OUTER_HEXAGRAM:Math.max(20,Math.floor(31*t)),OUTER_NUMBER:Math.max(12,Math.floor(15*t)),INNER_HEXAGRAM:Math.max(18,Math.floor(27*t)),INNER_NUMBER:Math.max(10,Math.floor(14*t)),HAO_NUMBER:Math.max(8,Math.floor(12*t))}}function f(e){return 360-(5.625*e+2.8125)+3600}function R(e,t){return Math.random()*(t-e)+e}var E=s();function N({baseRadius:e,haoNumber:t}){const n=new r.Group,a=T.CIRCLE_RATIOS[`HAO_${t}`],s=T.HAO_CONFIG.CIRCLES[`HAO_${t}`],l=t>1?T.CIRCLE_RATIOS["HAO_"+(t-1)]:T.CIRCLE_RATIOS.INNER;for(let s=0;s<64;s++){const i=s%4,o=5.625*s;let d=T.HAO_CONFIG.ARC_CONFIG[`HAO_${t}`].THIEU_AM,c=!1;switch(i){case 0:d=T.HAO_CONFIG.ARC_CONFIG[`HAO_${t}`].LAO_AM,c=!0;break;case 1:d=T.HAO_CONFIG.ARC_CONFIG[`HAO_${t}`].THIEU_DUONG;break;case 2:d=T.HAO_CONFIG.ARC_CONFIG[`HAO_${t}`].LAO_DUONG,c=!0;break;default:d=T.HAO_CONFIG.ARC_CONFIG[`HAO_${t}`].THIEU_AM}const O=new E.Arc({innerRadius:e*l+1,outerRadius:e*a,angle:T.HAO_CONFIG.ARC_CONFIG.ANGLE_SPAN,rotation:o,fill:d.FILL,clockwise:!1});if(n.add(O),c){const s=1===t?e*(.85*a+.15*l):e*(a+l)/2,i=new r.Group({x:Math.cos((o+2.8125)*Math.PI/180)*s,y:Math.sin((o+2.8125)*Math.PI/180)*s,rotation:o+T.HAO_CONFIG.SPACING.ROTATION_OFFSET}),c=new r.Text({text:t.toString(),fontSize:T.HAO_CONFIG.TEXT_CONFIG.FONT_SIZE[`HAO_${t}`],fontFamily:T.HAO_CONFIG.TEXT_CONFIG.FONT_FAMILY,fill:d.TEXT_COLOR,align:"center",verticalAlign:"middle",x:-T.HAO_CONFIG.TEXT_CONFIG.FONT_SIZE[`HAO_${t}`]*T.HAO_CONFIG.TEXT_CONFIG.OFFSET_RATIO,y:-T.HAO_CONFIG.TEXT_CONFIG.FONT_SIZE[`HAO_${t}`]*T.HAO_CONFIG.TEXT_CONFIG.OFFSET_RATIO});i.add(c),n.add(i)}}if(t>1)for(let t=0;t<64;t++){const s=5.625*t*Math.PI/180,r=Math.cos(s)*e*a,o=Math.sin(s)*e*a,d=Math.cos(s)*e*l,c=Math.sin(s)*e*l,O=new i.Line({points:[r,o,d,c],stroke:"#000",strokeWidth:.5});n.add(O)}else{const t=T.CIRCLE_RATIOS.INNER;for(let s=0;s<64;s++){const r=5.625*s*Math.PI/180,o=Math.cos(r)*e*a,l=Math.sin(r)*e*a,d=Math.cos(r)*e*t,c=Math.sin(r)*e*t,O=new i.Line({points:[o,l,d,c],stroke:"#000",strokeWidth:.5});n.add(O)}}const d=new o.Circle({radius:e*a,stroke:s.LINE_COLOR,strokeWidth:s.LINE_WIDTH,dash:s.DASH,listening:!1});return n.add(d),n}const g=({title:t,content:n,btnId:a,onCopy:s})=>e.jsx("div",{className:"mt-4 md:mt-6",children:e.jsxs("div",{className:"rounded-md border-[0.5px] border-gray-300 bg-gray-100 dark:bg-gray-950",children:[e.jsxs("div",{className:"flex items-center text-black/85 px-4 py-2 text-xs font-sans justify-between rounded-t-md h-9 bg-gray-200 dark:bg-gray-800 select-none",children:[e.jsx("span",{children:t}),e.jsxs("button",{className:"flex items-center gap-1",onClick:()=>s(n,a),children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:20,height:20,fill:"none",viewBox:"0 0 24 24",className:"icon-sm",children:e.jsx("path",{fill:"currentColor",fillRule:"evenodd",d:"M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z",clipRule:"evenodd"})}),e.jsx("span",{id:a,className:"pl-2 cursor-pointer font-sans text-sm",children:"Click Copy - Lấy Text"})]})]}),e.jsx("div",{children:e.jsx("textarea",{className:"overflow-y-auto p-4 bg-gray-100 dark:bg-gray-900 text-gray-600 dark:text-gray-400 text-xs font-mono focus:outline-none focus:bg-yellow-100 dark:focus:bg-yellow-900 leading-normal text-left w-full border-none h-[120px] md:h-[140px] resize-none",readOnly:!0,value:n})})]})}),L=({showResult:t,isSpinning:n,result:a})=>{const[s,r]=d.useState("");return d.useEffect((()=>{if(t&&a){let e="";if(e+="=== QUẺ CHỦ ===\n",e+=`Quẻ số: ${a.queGocIndex+1}\n`,e+=`Tên quẻ: ${a.queTen}\n`,e+=`Biểu tượng: ${a.queIcon}\n`,e+=`Ý nghĩa: ${a.queMeaning}\n\n`,e+="=== HÀO ĐỘNG ===\n",a.haoDong.length>0?a.haoDong.forEach((t=>{const n="laoAm"===t.type?"Âm Động":"Dương Động";e+=`Hào ${t.vi_tri}: ${n}\n`})):e+="Không có hào động\n",e+="\n",e+="=== QUẺ BIẾN ===\n",a.queBien){const t=O.findIndex((e=>e[0]===a.queBien?.queIcon));e+=`Quẻ số: ${t+1}\n`,e+=`Tên quẻ: ${a.queBien.queTen}\n`,e+=`Biểu tượng: ${a.queBien.queIcon}\n`,e+=`Ý nghĩa: ${a.queBien.queMeaning}\n`}else e+="Không có quẻ biến\n";r(e)}else r("")}),[t,a]),e.jsxs("div",{className:"w-full mt-4 md:mt-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 md:gap-4 text-center min-h-[250px] md:min-h-[400px] bg-white dark:bg-gray-800 rounded-lg shadow-lg",children:[e.jsx("div",{className:"border-b md:border-b-0 md:border-r border-gray-300 p-4 md:p-8",children:e.jsx("div",{className:"min-h-[200px] md:min-h-[400px]",children:t&&a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-lg md:text-xl mb-2 md:mb-4",children:"Quẻ Chủ"}),e.jsxs("div",{className:"text-base md:text-lg mb-2 text-blue-600",children:["Quẻ số ",a.queGocIndex+1]}),e.jsx("div",{className:"text-4xl md:text-7xl mb-2 md:mb-4",children:a.queIcon}),e.jsx("div",{className:"text-lg md:text-2xl font-bold mb-2 md:mb-4",children:a.queTen}),e.jsx("div",{className:"text-sm md:text-base px-2 md:px-0",children:a.queMeaning})]}):e.jsx("div",{className:"text-lg md:text-xl text-gray-500",children:n?"Đang xoay...":"Chưa có kết quả"})})}),e.jsx("div",{className:"border-b md:border-b-0 p-4 md:p-8",children:e.jsxs("div",{className:"min-h-[120px] md:min-h-[400px]",children:[e.jsx("div",{className:"text-lg md:text-xl mb-3 md:mb-6",children:"Hào Động"}),t&&a&&a.haoDong.length>0?e.jsx("div",{className:"space-y-1 md:space-y-2",children:a.haoDong.map((t=>e.jsxs("div",{className:"text-base md:text-lg text-left max-w-[200px] md:w-52 mx-auto",children:[e.jsxs("span",{className:"w-12 md:w-14 inline-block mr-2 text-sm md:text-base",children:["Hào ",t.vi_tri,":"]}),"laoAm"===t.type?e.jsx("span",{className:"text-gray-700 text-sm md:text-base",children:"Âm Động"}):e.jsx("span",{className:"text-red-700 text-sm md:text-base",children:"Dương Động"})]},t.vi_tri)))}):e.jsx("div",{className:"text-base md:text-lg text-gray-500",children:n?"Đang xoay...":"Không có hào động"})]})}),e.jsx("div",{className:"md:border-l border-gray-300 p-4 md:p-8",children:e.jsx("div",{className:"min-h-[200px] md:min-h-[400px]",children:t&&a?.queBien?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-lg md:text-xl mb-2 md:mb-4",children:"Quẻ Biến"}),e.jsxs("div",{className:"text-base md:text-lg mb-2 text-blue-600",children:["Quẻ số ",O.findIndex((e=>e[0]===a.queBien?.queIcon))+1]}),e.jsx("div",{className:"text-4xl md:text-7xl mb-2 md:mb-4",children:a.queBien.queIcon}),e.jsx("div",{className:"text-lg md:text-2xl font-bold mb-2 md:mb-4",children:a.queBien.queTen}),e.jsx("div",{className:"text-sm md:text-base px-2 md:px-0",children:a.queBien.queMeaning})]}):e.jsx("div",{className:"text-base md:text-lg text-gray-500",children:n?"Đang xoay...":"Không có quẻ biến"})})})]}),t&&a&&e.jsx(g,{title:"Kết quả Gieo Quẻ dùng cho AI",content:s,btnId:"btnCopyResult",onCopy:(e,t)=>{const n=document.getElementById(t);if(!n)return;const a=n.textContent;navigator.clipboard.writeText(e).then((()=>{n.textContent="Đã copy",setTimeout((()=>{n.textContent=a}),2e3)}))}})]})},C=()=>{const t=d.useRef(null),{width:n}=function(){const[e,t]=d.useState({width:850,height:850});return d.useEffect((()=>{if("undefined"==typeof window)return;const e=()=>{t({width:window.innerWidth,height:window.innerHeight})};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),e}(),[a,s]=d.useState(x(n)),[r,h]=d.useState(A(a.width)),[E,g]=d.useState(!1),[C,p]=d.useState(null),[b,M]=d.useState(null),[H,w]=d.useState(null),[y,F]=d.useState(null),[G,S]=d.useState(!1),[v,U]=d.useState(null),X=d.useRef([]),j=d.useRef([]),D=d.useRef(null);return React.useEffect((()=>{if("undefined"==typeof window)return;const e=x(n);s(e),h(A(e.width))}),[n]),React.useEffect((()=>{if("undefined"==typeof window)return;if(!t.current)return;X.current=[],j.current=[];const e=a.width,n=a.height,s=e/2,d=n/2,h=e*T.BASE_RADIUS_RATIO,I=new _.Stage({container:"canvas-container",width:e,height:n}),x=new m.Layer,f=new c.Arrow({points:[s,d,s,d-h*T.ARROW.LENGTH],pointerLength:T.ARROW.POINTER_LENGTH,pointerWidth:T.ARROW.POINTER_WIDTH,fill:"#FF0000",stroke:"#FF0000",strokeWidth:T.ARROW.STROKE_WIDTH,opacity:.7,listening:!1});x.add(f);const A=function({centerX:e,centerY:t,baseRadius:n,fontSizes:a}){const s=new u.Group({x:e,y:t,offset:{x:0,y:0},rotation:0}),r=new o.Circle({radius:n*T.CIRCLE_RATIOS.OUTER,stroke:"#000",strokeWidth:1});s.add(r);for(let e=0;e<64;e++){const t=5.625*e*Math.PI/180,a=Math.cos(t)*n*T.CIRCLE_RATIOS.OUTER,r=Math.sin(t)*n*T.CIRCLE_RATIOS.OUTER,o=Math.cos(t)*n*T.CIRCLE_RATIOS.HAO_6,l=Math.sin(t)*n*T.CIRCLE_RATIOS.HAO_6,d=new i.Line({points:[a,r,o,l],stroke:"#000",strokeWidth:1});s.add(d)}return O.map(((e,t)=>({symbol:e[0],number:t+1}))).forEach(((e,t)=>{const r=(5.625*t-90+2.8125)*Math.PI/180,i=(5.625*t-90+2.8125)*Math.PI/180,o=n*T.TEXT_POSITIONS.HEXAGRAM,d=Math.cos(r)*o,c=Math.sin(r)*o,O=n*T.TEXT_POSITIONS.NUMBER,h=Math.cos(i)*O,m=Math.sin(i)*O,_=new u.Group({x:d,y:c,rotation:5.625*t+2.8125}),I=new l.Text({text:e.symbol,fontSize:a.INNER_HEXAGRAM,fontFamily:"Arial",fill:"black",align:"center",offsetX:a.INNER_HEXAGRAM/2,offsetY:a.INNER_HEXAGRAM/2}),x=new u.Group({x:h,y:m,rotation:5.625*t+2.8125}),f=new l.Text({text:e.number.toString(),fontSize:a.INNER_NUMBER,fontFamily:"Arial",fill:"black",align:"center",offsetX:a.INNER_NUMBER/2,offsetY:a.INNER_NUMBER/2});_.add(I),x.add(f),s.add(_,x)})),s}({centerX:s,centerY:d,baseRadius:h,fontSizes:r});for(let e=1;e<=6;e++){const t=new u.Group({x:s,y:d}),n=N({baseRadius:h,haoNumber:e});t.add(n),x.add(t),X.current.push(t),j.current.push(n)}const R=new o.Circle({x:s,y:d,radius:h*T.CIRCLE_RATIOS.INNER,stroke:"#000",strokeWidth:1,listening:!1});D.current=R,x.add(R);const E=function({centerX:e,centerY:t,baseRadius:n,fontSizes:a}){const s=new u.Group({x:e,y:t,offset:{x:0,y:0},rotation:0}),r=new o.Circle({radius:n*T.CIRCLE_RATIOS.OUTER_MOST,stroke:"#000",strokeWidth:1});s.add(r);for(let e=0;e<64;e++){const t=5.625*e*Math.PI/180,a=Math.cos(t)*n*T.CIRCLE_RATIOS.OUTER_MOST,r=Math.sin(t)*n*T.CIRCLE_RATIOS.OUTER_MOST,o=Math.cos(t)*n*T.CIRCLE_RATIOS.OUTER,l=Math.sin(t)*n*T.CIRCLE_RATIOS.OUTER,d=new i.Line({points:[a,r,o,l],stroke:"#000",strokeWidth:1});s.add(d)}return O.map(((e,t)=>({symbol:e[0],number:t+1}))).forEach(((e,t)=>{const r=(5.625*t-90+2.8125)*Math.PI/180,i=(5.625*t-90+2.8125)*Math.PI/180,o=n*T.TEXT_POSITIONS.OUTER_HEXAGRAM,d=Math.cos(r)*o,c=Math.sin(r)*o,O=n*T.TEXT_POSITIONS.OUTER_NUMBER,h=Math.cos(i)*O,m=Math.sin(i)*O,_=new u.Group({x:d,y:c,rotation:5.625*t+2.8125}),I=new l.Text({text:e.symbol,fontSize:a.OUTER_HEXAGRAM,fontFamily:"Arial",fill:"black",align:"center",offsetX:a.OUTER_HEXAGRAM/2,offsetY:a.OUTER_HEXAGRAM/2}),x=new u.Group({x:h,y:m,rotation:5.625*t+2.8125}),f=new l.Text({text:e.number.toString(),fontSize:a.OUTER_NUMBER,fontFamily:"Arial",fill:"black",align:"center",offsetX:a.OUTER_NUMBER/2,offsetY:a.OUTER_NUMBER/2});_.add(I),x.add(f),s.add(_,x)})),s}({centerX:s,centerY:d,baseRadius:h,fontSizes:r});return x.add(A),x.add(E),f.remove(),x.add(f),I.add(x),p(I),w(x),M(A),U(E),()=>{I.destroy()}}),[a,r]),e.jsx("div",{className:"flex flex-col items-center min-h-screen",children:e.jsxs("div",{className:"w-full max-w-[1200px] min-h-[calc(100vh-4rem)] flex flex-col items-center justify-start p-4 md:p-8 max-md:p-0",children:[e.jsxs("div",{className:"relative",style:{width:a.width,height:a.height},children:[e.jsx("div",{ref:t,id:"canvas-container",className:"w-full h-full bg-white rounded-lg shadow-lg"}),e.jsx("button",{onClick:()=>{if(E||!b||!H||!v)return;g(!0),S(!1);const e=function(){const e=Array.from({length:6}).fill(null).map(((e,t)=>function(e){const t=Array.from({length:3}).fill(null).map((()=>(()=>{const e=new Uint8Array(1);return crypto.getRandomValues(e),e[0]<128?"N":"S"})())).filter((e=>"N"===e)).length;let n;return n=3===t?"laoAm":0===t?"laoDuong":2===t?"thieuDuong":"thieuAm",{type:n,vi_tri:e,isYang:0===t||2===t}}(6-t))),t=I(e),n=function(e){if(!e.some((e=>"laoAm"===e.type||"laoDuong"===e.type)))return null;const t=I(e.map((e=>({type:"laoAm"===e.type?"thieuDuong":"laoDuong"===e.type?"thieuAm":e.type,vi_tri:e.vi_tri,isYang:"laoAm"===e.type||"laoDuong"!==e.type&&e.isYang}))));return-1===t?null:{queIcon:O[t][0],queTen:O[t][1],queMeaning:O[t][2]}}(e),a=e.filter((e=>"laoAm"===e.type||"laoDuong"===e.type)).sort(((e,t)=>t.vi_tri-e.vi_tri)),s=[...e].sort(((e,t)=>t.vi_tri-e.vi_tri));return{queIcon:O[t][0],queTen:O[t][1],queMeaning:O[t][2],haoResults:s,haoDong:a,queBien:n,queGocIndex:t}}(),t=f(e.queGocIndex),n=e.queBien?f(O.findIndex((t=>t[0]===e.queBien?.queIcon))):null;(e=>{const t=j.current;t&&t.length&&H&&e.map((e=>({type:e.type||"không động",viTri:e.viTri||e.vi_tri}))).forEach((e=>{const n=Number(e.viTri)-1,a=t[n];a&&function(e,t,n,a=R(4500,5500)){const s=n.type,r=n.viTri??n.vi_tri??0,i=r%2==0,o=function(e,t=!1,n=0){const a=5.625,s=4*Math.floor(n/4)*a;let r;switch(e){case"laoAm":r=0;break;case"thieuDuong":r=1;break;case"laoDuong":r=2;break;case"thieuAm":r=3}const i=s+r*a+2.8125-a,o="laoAm"===e||"laoDuong"===e?360:0,l=i+(t?-o:o);let d;return d=t?-3600+l:3600+l,{position:n,angle:i,extraAngle:o,targetRotation:d,normalizedAngle:(l%360+360)%360,isReverse:t}}(s,i,r);let l=0,d=e.rotation(),c=0;const O=R(2800,3200),u=o.targetRotation,h=new Konva.Animation((n=>{if(!n)return;const s=Math.min(n.time/a,1),r=n.time-l;let m;l=n.time,m=s<.3?O*(s/.3)**2:s<.7?O:O*(1-(1-(1-(s-.7)/.3)**3)),c=.95*c+.05*m;const T=c*r/1e3;d+=i?-T:T;const _=(d%360+360)%360;if(e.rotation(_),s>=.95){const t=u-d;if(Math.abs(t)<.1){const t=o.normalizedAngle,n=Math.min((s-.95)/.05,1),a=d*(1-n)+t*n;e.rotation(a),s>=.999&&(e.rotation(t),h.stop())}else{d+=t*((1-20*(1-s))**3*.15);const n=(d%360+360)%360;e.rotation(n)}}t.batchDraw()}),t);return h}(a,H,e).start()}))})(e.haoResults);const a=function(e,t,n,a=6e3,s){const{wheelGroup:r,trigramGroup:i,outerWheelGroup:o,layer:l}=e;r.cache(),i.cache(),o.cache();const d=r.rotation();let c=0,O=d,u=0,h=0;const m=e=>{o.opacity(e)},T=o.opacity()??1;m(T);const _=null!==n?n:0;let I,x=0,f=null;const A=e=>1-(1-e)**4,R=e=>{f||(f=e);const d=e-f,E=Math.min(d/a,1),N=e-c;let g;c=e,g=E<.4?3600:3600*A(1-(E-.4)/.6);const L=A(E);let C;if(u=u*(1-.02*L)+g*(.02*L),O+=u*N/1e3,r.rotation(O),i.rotation(-O),C=E<.4?-3600:-3600*A(1-(E-.4)/.6),h=h*(1-.02*L)+C*(.02*L),x+=h*N/1e3,o.rotation(x),E>.4)if(null===n){const e=Math.min((E-.4)/.4,1),t=A(e);m(Math.max(0,T*(1-t)))}else{const e=Math.min((E-.4)/.4,1),t=A(e);m(Math.min(1,T+t))}if(l.batchDraw(),E<1)I=requestAnimationFrame(R);else{const e=t-O,n=_-x;Math.abs(e)>.01||Math.abs(n)>.01?(O+=.1*e,x+=.1*n,r.rotation(O),i.rotation(-O),o.rotation(x),l.batchDraw(),I=requestAnimationFrame(R)):(r.clearCache(),i.clearCache(),o.clearCache(),s())}};return I=requestAnimationFrame(R),{stop:()=>{I&&(cancelAnimationFrame(I),r.clearCache(),i.clearCache(),o.clearCache())}}}({wheelGroup:b,trigramGroup:new u.Group,outerWheelGroup:v,layer:H},t,n,6e3,(()=>{g(!1),setTimeout((()=>{S(!0)}),10)}));a&&F(e)},disabled:E,className:"absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 w-32 h-32 md:w-48 md:h-48 rounded-full border-2 border-gray-300 shadow-lg flex items-center justify-center transition-all disabled:cursor-not-allowed max-md:size-20 "+(E?"bg-black":"bg-white hover:bg-gray-50"),children:e.jsx("span",{className:"font-bold text-lg md:text-2xl "+(E?"text-white":"text-gray-800"),children:"XOAY"})})]}),e.jsx(L,{showResult:G,isSpinning:E,result:y})]})})};export{C as default};