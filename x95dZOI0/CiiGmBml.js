import{jsxs,jsx,Fragment}from"react/jsx-runtime";import{useRef,useState,useEffect}from"react";import{C as CfgValue,Z as ZolkName,c as containsNumber,i as idxTHAP,v as vi2en,w as withReactContent,S as Swal}from"./D7YNdq_b.js";import{A as AREA_NAME,z as CHI_3HH,L as LTHG_HH,c as CAN,d as CHI,B as CHI_HH,D as THAP,H as HH_THAP,C as CAN_HH,b as CAN_AD,g as SM,t as STARSTRONG,u as STAR_SIGN,v as CR_TS,F as FAILURE6,E as STARLOOP1,f as HH,e as ADTN,S as SKB,T as TKN,J as TKN_MONTH,y as TKN_PN,K as TSNAME,M as LTHG_NA,G as GETHOA}from"./DswsusNp.js";import Konva from"konva/lib/Core.js";import{Arrow}from"konva/lib/shapes/Arrow.js";import{Circle}from"konva/lib/shapes/Circle.js";import{Line}from"konva/lib/shapes/Line.js";import{Rect}from"konva/lib/shapes/Rect.js";import{Text}from"konva/lib/shapes/Text.js";import dayjs from"dayjs";import Konva$1 from"konva/lib/_CoreInternals.js";import Konva$2 from"konva";const rectCache=new Rect({x:0,y:0,width:100,height:100,hitStrokeWidth:0,shadowForStrokeEnabled:!1});rectCache.cache();const lineCache=new Line({points:[0,0,-100,-100],stroke:"#fff",strokeWidth:1.5,opacity:1});lineCache.cache();const cricleCache=new Circle({x:-100,y:-100,radius:10,fill:"#000",stroke:"#000",strokeWidth:.2,opacity:.4,perfectDrawEnabled:!0,hitStrokeWidth:0,shadowForStrokeEnabled:!1,width:100,height:100});cricleCache.cache();let textCache=new Text({x:500,y:500,text:"",fontStyle:"normal",fontSize:14,fontFamily:"Arial",fill:"#000",strokeWidth:0,perfectDrawEnabled:!0,textDecoration:"",shadowColor:"black",shadowBlur:0,shadowOffset:{x:0,y:0},shadowOpacity:0,hitStrokeWidth:0,shadowForStrokeEnabled:!1,width:10,height:10});textCache.cache(),textCache=textCache.clone({width:"auto",height:"auto"});const arrowCache=new Arrow({x:0,y:0,points:[0,0,250,250],pointerLength:12,pointerWidth:6,fill:"black",stroke:"black",strokeWidth:2.5,opacity:1,perfectDrawEnabled:!0,lineJoin:"round",hitStrokeWidth:0,shadowForStrokeEnabled:!1,width:5,height:5});function drawText(t,o,e,n,i=!0){let a={x:500,y:500,text:"",fontStyle:"normal",fontSize:o,fontFamily:e,fill:"#000",strokeWidth:0,perfectDrawEnabled:!0,textDecoration:"",shadowColor:"black",shadowBlur:0,shadowOffset:{x:0,y:0},shadowOpacity:0,hitStrokeWidth:0,shadowForStrokeEnabled:!1};a={...a,...t};const r=textCache.clone(a);return i&&void 0!==n&&(n.add(r),null!==r&&r.moveToTop()),r}function drawHoaTienThien(t,o,e,n,i,a,r,s,l,c){const d=o[e];let f=!1;const x={fontSize:s+2,shadowEnabled:!0,shadowOpacity:0,shadowForStrokeEnabled:!0,align:"left",perfectDrawEnabled:!0,fontStyle:"bold"};x.x=i,x.y=a+7;let h,y=0;const u=["A","B","C","D"];for(let o=0;o<=3;o+=1){if(d[o]===n){f=!0;const e=c[o],n=l[o],i={x:x.x,y:x.y,radius:8.5,fill:e,stroke:n,strokeWidth:1.5,opacity:.7,hitStrokeWidth:0,shadowForStrokeEnabled:!1};x.text=`${u[o]}`,x.fill=l[o],h=drawText(x,s+2,r,t,!1),h.x(h.x()-4.7),h.y(h.y()-6),x.x+=y,x.y+=0;const a=cricleCache.clone(i);t.add(a),t.add(h),0===y&&(y=h.getTextWidth()+13)}}return f}function drawTuHoa(t,o,e,n,i,a,r,s,l,c,d,f,x,h){let y=!1;const u=o[e.cn].indexOf(l);if(u>=0){y=!0;const o=e.ci,c={opacity:.8,points:[r,s,r,s],fill:f[Number(u)],stroke:f[Number(u)],strokeWidth:1.5,pointerLength:15,pointerWidth:8},d=c.points,p=-1!==e.sb.indexOf(l),S=11===o||0===o||1===o||2===o,b=5===o||6===o||7===o||8===o,m=3===o||4===o,g=9===o||10===o,w=x[e.ci],C=e.cno.filter((t=>t===e.ci)).length,T=63===l&&1===C,H=4===h.cfg[CfgValue.typeLs]||5===h.cfg[CfgValue.typeLs];if(S||b){let t=0;const e=Number(h.ars[o].zolk[0][ZolkName.currentLoc]),r=Number(h.ars[o].zolk[3][ZolkName.currentKi]);t=r>9||e>9?13:r>0||e>0?5:0,t=1===h.cfg[CfgValue.locKiToanDo]?t:0,d[0]=n.x+(p?i/2+(S?t:0):i/2-(T?23:2===C?10:6))-15*w,d[1]=d[1]+(p?6:3),d[2]=d[0],d[3]=b?5:S?n.y+a+23:d[3]}m&&(d[0]=n.x+(p||H?45:10),d[1]=d[1]+(p?6:5),d[2]=5,d[3]=d[1]),g&&(d[0]=n.x+i/2+(p?35:H?45:-15),d[1]=d[1]+(p?6:5),d[2]=n.x+i+23,d[3]=d[1]),t.add(arrowCache.clone(c))}return y}function drawHoaDaiVan(t,o,e,n,i,a,r,s,l,c){if(r.cfg[CfgValue.showHoaIcon]<1)return!1;let d=!1;const f=o[r.ars[r.dvidx].cn].indexOf(a);return f>=0&&(d=!0,t.add(rectCache.clone({x:n,y:i,width:9,height:9,fill:c[Number(f)],stroke:c[Number(f)],strokeWidth:0,draggable:!1,opacity:.8,perfectDrawEnabled:!0,cornerRadius:0,hitStrokeWidth:0,shadowForStrokeEnabled:!1})),t.add(drawText({text:"2",x:n+1.8,y:i+.5,fontSize:s-4,fill:"#fff",shadowBlur:0,shadowOpacity:1,opacity:.9},s,l,t))),d}function drawHoaLuuNien(t,o,e,n,i,a,r,s,l,c){if(r.cfg[CfgValue.showHoaIcon]<2)return!1;const d=i+4.3;let f=!1;const x=o[r.dtv.bs.y[0]].indexOf(a);return x>=0&&(f=!0,t.add(cricleCache.clone({x:n+2.8,y:d,radius:5,fill:c[x],strokeWidth:0,opacity:.8,hitStrokeWidth:0,shadowForStrokeEnabled:!1})),t.add(drawText({text:"3",x:Number(n+1),y:Number(d-3.8),fontSize:Number(s-4),fill:"#fff",shadowBlur:0,shadowOpacity:1,opacity:.9},s,l,t))),f}function drawHoaCanThang(t,o,e,n,i,a,r,s,l,c){if(r.cfg[CfgValue.showHoaIcon]<3)return!1;const d=i+4.1;let f=!1;const x=o[r.dtv.bs.m[0]].indexOf(a);return x>=0&&(f=!0,t.add(cricleCache.clone({x:n+2.8,y:d,radius:5,fill:c[x],strokeWidth:0,opacity:.8,hitStrokeWidth:0,shadowForStrokeEnabled:!1})),t.add(drawText({text:"4",x:Number(n+.7),y:Number(d-3.8),fontSize:Number(s-4),fill:"#fff",shadowBlur:0,shadowOpacity:1,opacity:.9},s,l,t))),f}function drawHoaCanNgay(t,o,e,n,i,a,r,s,l,c){if(r.cfg[CfgValue.showHoaIcon]<4)return!1;const d=i+4.1;let f=!1;const x=o[r.dtv.bs.d[0]].indexOf(a);return x>=0&&(f=!0,t.add(cricleCache.clone({x:n+2.8,y:d,radius:5,fill:c[x],strokeWidth:0,opacity:.8,hitStrokeWidth:0,shadowForStrokeEnabled:!1})),t.add(drawText({text:"5",x:Number(n+.7),y:Number(d-3.8),fontSize:Number(s-4),fill:"#fff",shadowBlur:0,shadowOpacity:1,opacity:.9},s,l,t))),f}function ZoneBase(t){const{color:o,colorHoa:e,colorHoaFill:n,fontPhuTinh:i,idx:a,cung:r,fontDV:s,fontFamilySet:l,typeLs:c,pos:d,hafWSquare:f,padContentTop:x,padContentBottom:h,padContent:y,wSquare:u,hSquare:p,cfgLs:S}=t,{ls:b}=t,m=new Konva.Group({});function g(t,o,e=.2,n=0){const i=rectCache.clone({x:t.x()-n/2-2,y:t.y()-n/2-1.8,fill:o,width:t.width()+n+4,height:t.height()+n,perfectDrawEnabled:!0,strokeWidth:0,opacity:e,cornerRadius:4,hitStrokeWidth:0,shadowForStrokeEnabled:!1});return m.add(i),null!==i&&i.moveToTop(),null!==t&&t.moveToTop(),i}function w(t,o){return THAP[HH_THAP[CAN_HH[t]][CAN_HH[o]][function(t,o){return CAN_AD[t]===CAN_AD[o]?1:0}(t,o)]]}return function(){let t=AREA_NAME[r.ai];if(t=`${AREA_NAME[r.ai]}`,3===c){drawText({text:r.dv.toString(),fill:"#000",x:-1e4,y:-1e4,fontStyle:"bold"},s,l,m,!1).destroy()}let e=b.at===a?`${t}(T)`:t;4!==c&&5!==c||(e=t);const n={text:e,fill:"#000",x:Number(d.x)+f,y:Number(d.y)+x,fontStyle:"bold",align:"left"},i=drawText(n,s-1,l,m);if(i.x(i.x()-i.getTextWidth()/2),m.add(textCache.clone({x:i.x()-14,y:i.y()-.3,text:"▲",fontStyle:"normal",fontSize:s-1,fontFamily:"Arial",fill:o[CHI_3HH[a]],perfectDrawEnabled:!0,opacity:2===CHI_3HH[a]?.8:.6,hitStrokeWidth:0,shadowForStrokeEnabled:!1})),0===r.ai||4===r.ai||r.ai,0===r.ai){const t=rectCache.clone({x:d.x+1,y:d.y+1,width:u-1,height:p-1,fill:"#f0e9de",hitStrokeWidth:0,shadowForStrokeEnabled:!1,opacity:.6});m.add(t)}b.am===a&&g(i,n.fill,.3),n.text=r.dv,n.fill=o[LTHG_HH[r.na]];const h=drawText(n,s-1,l,m);h.x(i.x()+i.width()+5);const y=g(h,o[LTHG_HH[r.na]],.1);let S=!1;if(r.cn===b.dtb.bs.y[0]&&0!==a&&1!==a&&(n.fontStyle="bold",n.text=`${n.text}`,S=!0),S){n.fill="#555",n.text="☸",n.x=i.x()+i.getTextWidth()+2,n.y=i.y(),n.fontSize=s-2,n.shadowBlur=0,n.shadowEnabled=!1;const t=drawText(n,s,l,m);h.x(t.x()+t.getTextWidth()+2),y.x(h.x()-2)}}(),1===Number(S[CfgValue.rotateZone])&&function(){if(3===c)return;const t={text:`${AREA_NAME[r.aid]}2`,fill:"#555",x:d.x+y,y:d.y+x,fontStyle:"bold",opacity:.8,fontSize:s-2},o=drawText(t,s-3,l,m);r.dvc&&g(o,t.fill,.2)}(),function(){if(4!==c)return;let t=21;1===S[CfgValue.batTuCung]&&1==S[CfgValue.showSun]&&(t=33),0===Number(S[CfgValue.showSun])&&0===S[CfgValue.batTuCung]&&(t=12),0===S[CfgValue.isNapAmCung]&&(t=2);let o=!1;if(r.ci===b.ars[b.am].cno[0]){o=!0;const i=18,a=18,r=rectCache.clone({x:d.x+y,y:d.y+h-t-4,width:15,height:15,fill:n[0],stroke:e[0],strokeWidth:1,opacity:.7,hitStrokeWidth:0,shadowForStrokeEnabled:!1,cornerRadius:2});m.add(r);const c=drawText({text:"A",fill:e[0],x:r.x(),y:r.y(),fontSize:s-2},s-2,l,m);c.x(r.x()+i/2-c.getTextWidth()/2-1),c.y(r.y()+a/2-c.getTextWidth()/2-1.3)}if(r.ci===b.ars[b.am].cno[3]){const i=18,a=18,r=rectCache.clone({x:d.x+y,y:d.y+h-t-4,width:15,height:15,fill:n[3],stroke:e[3],strokeWidth:1,opacity:.7,hitStrokeWidth:0,shadowForStrokeEnabled:!1,cornerRadius:2});m.add(r);const c=drawText({text:"D",fill:e[3],x:r.x(),y:r.y(),fontSize:s-2},s-2,l,m);c.x(r.x()+i/2-c.getTextWidth()/2-1),c.y(r.y()+a/2-c.getTextWidth()/2-1.3),o&&(r.x(r.x()+18),c.x(c.x()+18))}}(),function(){if(3===c)return;const t=drawText({text:`${AREA_NAME[r.ail??0]}3`,fill:"#888",x:d.x+u-y,y:d.y+x,fontStyle:"bold",opacity:1},s-2,l,m);if(t.absolutePosition({x:t.x()-t.getTextWidth(),y:d.y+x}),0===S[CfgValue.rotateZone]&&t.destroy(),4!==c){const e=drawText({text:`${CAN[r.lmpt[2]].charAt(0)} T${r.lmpt[0]}`,fill:o[LTHG_HH[r.lmpt[4]]],x:d.x+u-y,y:t.y()+16.5,fontSize:1===S[CfgValue.rotateZone]?s-3:s-1,opacity:1},s,l,m);e.x(e.x()-e.getTextWidth()),0===S[CfgValue.rotateZone]?e.y(e.y()-16.5):(0===r.ail&&g(t,"#444"),b.dtv.ln.m===r.lmpt[0]&&g(e,"#555"))}}(),function(){const t=`${CAN[r.cn].charAt(0)}.${CHI[r.ci]}`,e=1===S[CfgValue.rotateZone]?s-3:s-1;let n=x;1===Number(S[CfgValue.rotateZone])&&(n=x+16);const i=drawText({text:t,fill:o[LTHG_HH[r.na]],x:-1e3,y:-1e3,fontSize:e},s,l,m,!1),a={text:t,fill:o[LTHG_HH[r.na]],x:d.x+y,y:d.y+n,fontSize:e};3===c&&(a.y=d.y+y),drawText(a,e,l,m),i.destroy()}(),function(){let t={},e=21;if(1===S[CfgValue.batTuCung]&&1==S[CfgValue.showSun]&&(e=33),0===Number(S[CfgValue.showSun])&&0===S[CfgValue.batTuCung]&&(e=12),0===S[CfgValue.isNapAmCung]&&(e=2),4!==c&&5!==c){t={text:`V${r.lmnp[0]}`,fill:"#444",x:d.x+y-2,y:d.y+h-e,fontSize:s-2};const n=drawText(t,s,l,m);t={},t.x=d.x+y,t.y=d.y+h-e,t.text=`${CHI[r.lynp].toUpperCase()}`,t.fill=o[CHI_HH[r.lynp]],t.align="left",t.fontSize=s-3,t.fontStyle="bold";const i=drawText(t,s,l,m);b.dtv.bs.y[1]===r.lynp&&g(i,t.fill),n.x(i.x()+i.getTextWidth()+2),b.dtv.ln.m===r.lmnp[0]&&g(n,"#555")}const n=(r.lmpt[1][0]-1+2)%12,i=b.ars[n],a=drawText({text:`${CAN[i.lmpt[2]].charAt(0)}.${CHI[i.lmpt[3]]} P${r.lmpt[1][0]}`,fill:o[LTHG_HH[i.lmpt[4]]],x:d.x+u-y,y:d.y+h-e,fontSize:s-2,opacity:1},s,l,m);a.x(a.x()-a.getTextWidth()),b.dtv.ln.m===r.lmpt[1][0]&&g(a,"#555")}(),1===Number(S[CfgValue.isNapAmCung])&&function(){let t=d.y+h;4!==c&&5!==c||(t=d.y+h+7);const e={text:"",fill:o[4],x:d.x+y,y:t,fontSize:i-6,opacity:.7};r.ys.forEach((n=>{const i=e;i.text=n[1],i.fill=o[LTHG_HH[n[2]]];const r=drawText(i,s,l,m);n[1]===b.dtv.sn.y&&1===Number(S[CfgValue.showSun])&&g(r,i.fill,.2);const c=r.x()+r.getTextWidth()+4.5;i.text=`${CAN[n[3]].charAt(0)}`,i.x=r.x(),i.y=r.y()-9;const f=drawText(i,s,l,m);i.text=`.${n[0]}`,i.x=f.x()+f.getTextWidth();const x=drawText(i,s,l,m);if(n[1]===b.dtv.sn.y&&1===Number(S[CfgValue.showSun])&&(g(f,f.fill(),.2),g(x,x.fill(),.2)),0===Number(S[CfgValue.showSun])&&(r.destroy(),f.y(i.y+10),x.y(f.y()),n[1]===b.dtv.sn.y&&(g(f,f.fill(),.2),g(x,x.fill(),.2))),1===S[CfgValue.batTuCung]){const t=w(b.dtb.bs.d[0],n[3]);i.text="Thương"===t?"Thg":t,i.fill="#444",i.x=r.x(),1===S[CfgValue.showSun]?i.y=r.y()-20:i.y=r.y()-10,drawText(i,s,l,m)}let h=b.cid;if(b.yeo>=b.cid)for(let t=0;t<120&&!(h+10>=b.yeo+1);t+=10)h+=10;b.yeo>=b.cid&&n[0]>=h&&n[0]<h+10&&m.add(textCache.clone({x:f.x()+3,y:3===a||4===a||9===a||10===a?d.y+p-5:d.y+p-5.5,text:"▲",fontStyle:"normal",fontSize:s-5,fontFamily:"Arial",fill:"#555",perfectDrawEnabled:!0,opacity:1,hitStrokeWidth:0,shadowForStrokeEnabled:!1})),i.align="left",i.x=c,i.y=t}))}(),t.layer.add(m),t.layer}function ZoneBigStar(t){const{ls:o,color:e,colorHoa:n,colorHoaFill:i,fontPhuTinh:a,cung:r,fontDV:s,fontFamilySet:l,typeLs:c,pos:d,hafWSquare:f,fontChinhTinh:x,hSquare:h,wSquare:y,canHoa:u,thdraw:p}=t,S=new Konva.Group({});function b(t,o=!0){let e={x:500,y:500,text:"",fontStyle:"normal",fontSize:s,fontFamily:l,fill:"#000",strokeWidth:0,perfectDrawEnabled:!0,textDecoration:"",shadowColor:"#fff",shadowBlur:0,shadowOffset:{x:0,y:0},shadowOpacity:0,hitStrokeWidth:0,shadowForStrokeEnabled:!1};e={...e,...t};const n=textCache.clone(e);return o&&S.add(n),n}return function(){const t=d.x;let m=d.y+38,g=17;const w={fontSize:x,fontStyle:"normal"};4!==c&&5!==c||(g=25,w.fontSize=x+4,m=d.y+70);const C=void 0!==r.tu||void 0!==r.tu;for(let T=0;T<r.sb.length;T+=1){const H=r.sb[T],N=SM[H];if(N.name.length>0){w.text=N.name.toUpperCase(),w.fill=e[N.hh],w.fontStyle="bold";const k=b(w,!1);if(w.x=t+f-k.getTextWidth()/2,w.y=m,4===c){const t={...w,fontSize:x-6,fontStyle:"normal"};if(t.x=w.x,t.y=w.y-9,r.stlk.length>0&&void 0!==r.stlk[H]){const o=r.stlk[H];t.text=`${o[0]}A`,t.fill=n[0];const e=b(t);t.text=`${o[1]}D`,t.fill=n[3];const i=b(t),a=e.getTextWidth()+i.getTextWidth()+4;e.x(d.x+f-a/2),i.x(e.x()+e.getTextWidth()+4),0===o[0]&&e.destroy(),0===o[1]&&(i.destroy(),o[0]>0&&e.x(e.x()+e.getTextWidth()+4))}}const W=N.lvl;let v=!1,A="";void 0!==W&&Object.entries(W).forEach((([t,o],e)=>{Number(t)!==r.ci+1||"M"!==o&&"V"!==o||(v=!0,A=o),Number(t)===r.ci+1&&"H"===o&&(A=o),Number(t)===r.ci+1&&(A=o)}));4!==c&&5!==c&&(v&&!C)&&(w.shadowColor=e[N.hh],w.shadowBlur=0,w.shadowOpacity=0,w.shadowOffset={x:0,y:0});let $=b(w);if(4!==c&&5!==c&&A.length>0&&b({text:`(${A})`,fill:e[N.hh],fontSize:a-6,x:w.x+$.getTextWidth()+1,y:w.y-1,fontStyle:w.fontStyle}),3!==c&&void 0!==N.nn){const t=w.x-11,c=w.y;drawHoaTienThien(S,u,o.dtb.bs.y[0],r.sb[T],t,c,l,s,n,i);const f=$.x()+$.getTextWidth();drawTuHoa(S,u,r,d,y,h,$.x(),$.y(),r.sb[T],s,l,n,p,o)&&(p[r.ci]+=1);const x=f+14,m=$.y()+1.5,g=drawHoaDaiVan(S,u,r,x,m,r.sb[T],o,s,l,n),C=g?x+12:x,H=drawHoaLuuNien(S,u,r,C,m,r.sb[T],o,s,l,n),k=H?C+10:g?x+12:x,W=drawHoaCanThang(S,u,r,k,m,r.sb[T],o,s,l,n);drawHoaCanNgay(S,u,r,W?k+10:H?C+10:g?x+12:x,m,r.sb[T],o,s,l,n),b({text:""+(N.nn[1]>0?"+":"-"),fill:e[N.hh],fontSize:a-3,x:$.x()+$.getTextWidth()+4,y:$.y()+5,fontStyle:w.fontStyle})}$=textCache.clone({}),m+=g}}}(),t.layer.add(S),t.layer}function ZoneFly(t){const{colorHoaFill60:o,fontPhuTinh:e,idx:n,cung:i,fontDV:a,fontFamilySet:r,typeLs:s,pos:l,hafWSquare:c,hafHSquare:d,colorHoa:f,padContent:x,xBox12:h,yBox34:y,yBox14:u,yBox12:p,xBox34:S,xBox14:b,getGradient:m,typePhiHoa:g,ls:w,countHt:C}=t,T=new Konva.Group({});function H(){const t=[],o=17;return t[0]=[{pos:[h+c,y,b+c,u]},{pos:[b+c,y,h+c,u]},{pos:[b,y,S,u]},{pos:[b,p+d,S,u+d]},{pos:[b,u+d,S,p+d]},{pos:[b,u,S,y]},{pos:[b+c,u,h+c,y]},{pos:[h+c,u,b+c,y]},{pos:[S,u,b,y]},{pos:[S,u+d,b,p+d]},{pos:[S,p+d,b,u+d]},{pos:[S,y,b,u]}],t[1]=[{pos:[t[0][0].pos[0]-o,t[0][0].pos[1],t[0][0].pos[2]+o,t[0][0].pos[3]]},{pos:[t[0][1].pos[0]-o,t[0][1].pos[1],t[0][1].pos[2]+o,t[0][1].pos[3]]},{pos:[t[0][2].pos[0]-o,t[0][2].pos[1],t[0][2].pos[2]+o,t[0][2].pos[3]]},{pos:[t[0][3].pos[0],t[0][3].pos[1]-o,t[0][3].pos[2],t[0][3].pos[3]+o]},{pos:[t[0][4].pos[0],t[0][4].pos[1]-o,t[0][4].pos[2],t[0][4].pos[3]+o]},{pos:[t[0][5].pos[0],t[0][5].pos[1]-o,t[0][5].pos[2],t[0][5].pos[3]+o]},{pos:[t[0][6].pos[0]+o,t[0][6].pos[1],t[0][6].pos[2]-o,t[0][6].pos[3]]},{pos:[t[0][7].pos[0]+o,t[0][7].pos[1],t[0][7].pos[2]-o,t[0][7].pos[3]]},{pos:[t[0][8].pos[0]+o,t[0][8].pos[1],t[0][8].pos[2]-o,t[0][8].pos[3]]},{pos:[t[0][9].pos[0],t[0][9].pos[1]+o,t[0][9].pos[2],t[0][9].pos[3]-o]},{pos:[t[0][10].pos[0],t[0][10].pos[1]+o,t[0][10].pos[2],t[0][10].pos[3]-o]},{pos:[t[0][11].pos[0],t[0][11].pos[1]+o,t[0][11].pos[2],t[0][11].pos[3]-o]}],t[2]=[{pos:[t[0][0].pos[0]+o,t[0][0].pos[1],t[0][0].pos[2]-o,t[0][0].pos[3]]},{pos:[t[0][1].pos[0]+o,t[0][1].pos[1],t[0][1].pos[2]-o,t[0][1].pos[3]]},{pos:[t[0][2].pos[0],t[0][2].pos[1]+o,t[0][2].pos[2],t[0][2].pos[3]-o]},{pos:[t[0][3].pos[0],t[0][3].pos[1]+o,t[0][3].pos[2],t[0][3].pos[3]-o]},{pos:[t[0][4].pos[0],t[0][4].pos[1]+o,t[0][4].pos[2],t[0][4].pos[3]-o]},{pos:[t[0][5].pos[0]-o,t[0][5].pos[1],t[0][5].pos[2]+o,t[0][5].pos[3]]},{pos:[t[0][6].pos[0]-o,t[0][6].pos[1],t[0][6].pos[2]+o,t[0][6].pos[3]]},{pos:[t[0][7].pos[0]-o,t[0][7].pos[1],t[0][7].pos[2]+o,t[0][7].pos[3]]},{pos:[t[0][8].pos[0],t[0][8].pos[1]-o,t[0][8].pos[2],t[0][8].pos[3]+o]},{pos:[t[0][9].pos[0],t[0][9].pos[1]-o,t[0][9].pos[2],t[0][9].pos[3]+o]},{pos:[t[0][10].pos[0],t[0][10].pos[1]-o,t[0][10].pos[2],t[0][10].pos[3]+o]},{pos:[t[0][11].pos[0]+o,t[0][11].pos[1],t[0][11].pos[2]-o,t[0][11].pos[3]]}],t[3]=[{pos:[t[0][0].pos[0]-34,t[0][0].pos[1],t[0][0].pos[2]+34,t[0][0].pos[3]]},{pos:[t[0][1].pos[0]-34,t[0][1].pos[1],t[0][1].pos[2]+34,t[0][1].pos[3]]},{pos:[t[0][2].pos[0]-34,t[0][2].pos[1],t[0][2].pos[2]+34,t[0][2].pos[3]]},{pos:[t[0][3].pos[0],t[0][3].pos[1]-34,t[0][3].pos[2],t[0][3].pos[3]+34]},{pos:[t[0][4].pos[0],t[0][4].pos[1]-34,t[0][4].pos[2],t[0][4].pos[3]+34]},{pos:[t[0][5].pos[0],t[0][5].pos[1]-34,t[0][5].pos[2],t[0][5].pos[3]+34]},{pos:[t[0][6].pos[0]+34,t[0][6].pos[1],t[0][6].pos[2]-34,t[0][6].pos[3]]},{pos:[t[0][7].pos[0]+34,t[0][7].pos[1],t[0][7].pos[2]-34,t[0][7].pos[3]]},{pos:[t[0][8].pos[0]+34,t[0][8].pos[1],t[0][8].pos[2]-34,t[0][8].pos[3]]},{pos:[t[0][9].pos[0],t[0][9].pos[1]+34,t[0][9].pos[2],t[0][9].pos[3]-34]},{pos:[t[0][10].pos[0],t[0][10].pos[1]+34,t[0][10].pos[2],t[0][10].pos[3]-34]},{pos:[t[0][11].pos[0],t[0][11].pos[1]+34,t[0][11].pos[2],t[0][11].pos[3]-34]}],t}function N(t){const o=[!0,!1];return[o[0],o[1],o[0],o[0],o[0],o[1],o[1],o[0],o[0],o[1],o[1],o[1]][w.ars[t].ai]}function k(t){return function(t){let o=Number(t);return o>11&&(o-=12),o}(t+6)}function W(t,o,e=!1){const i=[[],[],[],[],[],[]];if(n===t||t===k(n))return[-2e3,-2e3,-2e3,-2e3,-2e3,-2e3];const a=H(),r=a[0][n],s=a[3][t];i[0]=r.pos[0],i[1]=r.pos[1],i[4]=s.pos[0],i[5]=s.pos[1],6!==t&&7!==t||(i[4]+=15);const l=(i[4]-i[0])/2,c=(i[5]-i[1])/2,d=i[0]+l,f=i[1]+c,x=[];return x[0]=[[-2e3,-2e3],[d,f-30],[d-10,f-50],[d+10,f-30],[d+30,f-30],[d+30,f-50],[d-10,f-80],[d-50,f],[d-40,f-30],[d-30,f-15],[d-10,f-15],[d,f-30]],x[1]=[[d,f-25],[-2e3,-2e3],[d,f-30],[d+15,f-15],[d+30,f-10],[d+30,f-30],[d+30,f],[d-10,f-80],[d-50,f-50],[d-30,f-30],[d-10,f-40],[d-10,f-40]],x[2]=[[d,f-45],[d,f-25],[-2e3,-2e3],[d+20,f],[d+30,f-10],[d+80,f],[d+40,f-40],[d+10,f+75],[d-10,f-80],[d-10,f-50],[d-30,f-30],[d,f-80]],x[3]=[[d+15,f-40],[d+20,f-20],[d+30,f],[-2e3,-2e3],[d+30,f-10],[d+40,f-10],[d+40,f-10],[d+10,f+60],[d+30,f+50],[d-10,f-80],[d,f-30],[d+30,f-35]],x[4]=[[d+30,f-30],[d+25,f-10],[d+40,f+20],[d+30,f],[-2e3,-2e3],[d+30,f],[d+15,f+15],[d+10,f+35],[d+20,f+50],[d,f+40],[d-10,f-80],[d-10,f-80]],x[5]=[[d+40,f-10],[d+25,f-5],[d+80,f],[d+50,f-5],[d+20,f-10],[-2e3,-2e3],[d,f+25],[d+10,f+30],[d,f+80],[d+10,f+50],[d-30,f+40],[d-10,f-80]],x[6]=[[d-30,f-30],[d+30,f],[d+30,f+20],[d+30,f+25],[d+20,f+20],[d-10,f+25],[-2e3,-2e3],[d,f+25],[d-10,f+40],[d-10,f+30],[d-40,f+40],[d-50,f+40]],x[7]=[[d-30,f-30],[d-30,f-30],[d+40,f+20],[d+40,f+40],[d+10,f+30],[d+10,f+40],[d+10,f+25],[-2e3,-2e3],[d,f+25],[d-20,f+20],[d-30,f-10],[d-35,f]],x[8]=[[d-30,f-30],[d-50,f-10],[d-40,f-20],[d+20,f+60],[d-10,f+40],[d+10,f+80],[d,f+30],[d,f+20],[-2e3,-2e3],[d-25,f],[d-40,f],[d-50,f-10]],x[9]=[[d-30,f-30],[d-30,f-30],[d-20,f-90],[d-40,f-20],[d,f+60],[d-10,f+40],[d-10,f+40],[d-15,f+15],[d-25,f-10],[-2e3,-2e3],[d-30,f-10],[d-50,f-10]],x[10]=[[d-20,f-20],[d-10,f-35],[d-5,f-40],[d,f-50],[d-10,f-80],[d-30,f+40],[d-10,f+40],[d-25,f+10],[d-60,f],[d-30,f-10],[-2e3,-2e3],[d-25,f]],x[11]=[[d,f-25],[d-30,f-30],[d,f-80],[d+10,f-50],[d+30,f-30],[d-10,f-80],[d-50,f-20],[d-25,f+5],[d-80,f],[d-40,f-10],[d-20,f],[-2e3,-2e3]],i[2]=x[n][t][0],i[3]=x[n][t][1],e&&(i[2]=i[2]+Math.floor(30*Math.random())+10,i[3]=i[3]+Math.floor(30*Math.random())+10),i}function v(t){const o=f[3],e=i.cno[3],n={fill:o,stroke:o,pointerLength:11,pointerWidth:4,tension:.5,opacity:.5,strokeWidth:1,dash:[8,4]};n.points=W(e),N(e)&&(n.strokeWidth=1.7,n.opacity=.7),4!==s&&5!==s||(n.opacity=.7,n.strokeWidth=1.5,N(e)&&(n.opacity=.9,n.strokeWidth=2)),n.stroke=m(n.points,o,o),T.add(arrowCache.clone(n))}return 3!==s&&(function(){const t={text:"T.HÓA",fill:f[3],x:l.x,y:l.y+x+a+2.7,fontSize:e-4,opacity:.7,fontStyle:"normal"},o=[],s=[];let d=0;for(let s=0;s<=3;s+=1)t.text=`${h=AREA_NAME[w.ars[i.cno[s]].ai].toLowerCase(),h.charAt(0).toUpperCase()+h.slice(1)}`,t.fill=f[s],t.fontStyle=N(i.cno[s])?"bold":"normal",t.opacity=.8,o[s]=drawText(t,a,r,T),t.x=t.x+o[s].getTextWidth()+2.3,d=d+o[s].getTextWidth()+2.3,i.cno[s]===n&&(o[s].text("✱"),o[s].fontSize(e-3));var h;let y=l.x+c-d/2+4;for(let i=0;i<=3;i+=1)o[i].absolutePosition({x:y,y:t.y}),y=o[i].x()+o[i].getTextWidth()+2.3,1===w.cfg[CfgValue.tuanHoanZone]&&w.loopPT[i].forEach(((t,c)=>{if(t.includes(n)){const t={text:["⇄","⇅","⟳","⟲","⇊"][c],fill:f[i],x:o[i].x()+o[i].getTextWidth()/2-3.5,y:l.y+x+a+(0===c?10:12),fontSize:e-5,opacity:1,fontStyle:"normal"};void 0===s[i]&&(s[i]=[]),s[i][c]=drawText(t,a,r,T)}}))}(),1===w.cfg[CfgValue.locKiToanDo]&&function(){const t=i.zolk[0][ZolkName.currentLoc],o=i.zolk[3][ZolkName.currentKi];let x=null,h=null,y=null;const u="∞",p={text:"",fill:"",x:l.x+c,y:l.y+2*d-48,fontSize:4===s?e+2:e-2,opacity:4===s?1:.8,fontStyle:"bold"},S=4===s||5===s?"A":"",b=4===s||5===s?"D":"";if(t>0)if(containsNumber(w.loopLP[0],n))if(0===i.zolk[0][ZolkName.locKeep])p.text=t.toString()+S+u,p.fill=f[0],x=drawText(p,a,r,T),x.x(x.x()-x.getTextWidth()/2);else{const o=t-i.zolk[0][ZolkName.locKeep];p.text=o>0?i.zolk[0][ZolkName.locKeep].toString()+S:t.toString()+S,p.fill=f[0],x=drawText(p,a,r,T),x.x(x.x()-x.getTextWidth()/2),o>0&&(p.text=o+u,h=drawText(p,a,r,T),h.x(h.x()-h.getTextWidth()/2))}else p.text=t.toString()+S,p.fill=f[0],x=drawText(p,a,r,T),x.x(x.x()-x.getTextWidth()/2);else containsNumber(w.loopLP[0],n)&&0===t&&(p.text=u,p.fill=f[0],p.fontSize=e,x=drawText(p,a,r,T),x.x(x.x()-x.getTextWidth()/2));o>0||containsNumber(w.loopLP[3],n)?(x&&x.y(x.y()-15),h&&h.y(h.y()-30)):h&&h.y(h.y()-15),o>0?(p.text=o.toString()+b+(containsNumber(w.loopLP[3],n)?u:""),p.fill=f[3],y=drawText(p,a,r,T),y.x(y.x()-y.getTextWidth()/2)):containsNumber(w.loopLP[3],n)&&0===o&&(p.text=u,p.fill=f[3],p.fontSize=e,y=drawText(p,a,r,T),y.x(y.x()-y.getTextWidth()/2)),x&&T.add(x),h&&T.add(h),y&&T.add(y),x&&x.moveToTop(),h&&h.moveToTop(),y&&y.moveToTop()}(),0!==s&&1!==s&&4!==s&&6!==s&&8!==s||function(t){const e=f[t],n=i.cno[t];let a=!1;0!==t&&3!==t||(a=1===i.zolk[t][0===t?ZolkName.isMoveLoc:3===t?ZolkName.isMoveKi:3]);const r=[7,3],l={fill:e,stroke:e,pointerLength:11,pointerWidth:5,tension:.6,opacity:.6,strokeWidth:.4};switch(t){case 0:case 1:case 2:a&&v()}if(n<0||n===i.ci)return;l.points=W(n);const c=i.cno[3];3!==t&&n===c&&(l.points=W(n,0,!0));const d=N(n),x=a&&3===t;d&&(l.strokeWidth=1.5,l.opacity=.7),x&&(l.dash=r,l.opacity=.8,l.strokeWidth=2),x&&d&&(l.opacity=.9),4!==s&&5!==s||(l.strokeWidth=1.7,l.opacity=l.opacity+.2),l.stroke=m(l.points,e,o[t]),T.add(arrowCache.clone(l))}(g),function(){const t=H();for(let o=0;o<=3;o+=1){const e=k(n),a=i.cno[o]===e,r=1===i.zolk[0][ZolkName.isMoveLoc],l=1===i.zolk[3][ZolkName.isMoveKi];if(a&&4!==s||4===s&&g===o&&a||1===s&&g===o&&a||8===s&&g===o&&a||a&&r&&3===o&&1!==g&&2!==g){const i=C[e]??0,a=C[n]??0;let c=a;i>a&&(C[n]=i,c=i);const d=t[c][n];if(g===o||1!==s&&8!==s||r&&3===o){const t=f[o],e={opacity:.8,points:d.pos,fill:t,stroke:t,strokeWidth:2.5,pointerLength:20,pointerWidth:8};!(l&&3===g||r&&0===g&&3===o)||0!==s&&1!==s&&4!==s&&8!==s||3!==o||(e.dash=[12,3]),4===s&&(e.strokeWidth=3),T.add(arrowCache.clone(e))}C[n]=c+1,C[e]=C[n]}}}()),t.layer.add(T),t.layer}function ZoneSmallStar(t){const{ls:o,color:e,colorHoa:n,colorHoaFill:i,fontChinhTinh:a,fontPhuTinh:r,cung:s,fontDV:l,fontFamilySet:c,typeLs:d,pos:f,padContentBottom:x,padContent:h,wSquare:y,hafWSquare:u,hSquare:p,cfgLs:S,canHoa:b,thdraw:m}=t,g=new Konva.Group({});function w(t,o=!0){let e={x:500,y:500,text:"",fontStyle:"normal",fontSize:l,fontFamily:c,fill:"#000",shadowForStrokeEnabled:!1,strokeWidth:0,perfectDrawEnabled:!0,textDecoration:"",shadowColor:"black",shadowBlur:0,shadowOffset:{x:0,y:0},shadowOpacity:0};e={...e,...t};const n=textCache.clone(e);return o&&g.add(n),n}function C(t,x,C,T,H=!1,N=r){if(4===d||5===d)return 1===C.zone&&0===T?function(t,r,x){if(![60,61,62,63].includes(x.id-1))return r;const h={fontSize:a+4,fontStyle:"normal"};h.x=t+u,h.y=r,h.text=x.name.toUpperCase(),h.fill=e[x.hh],h.fontStyle="bold";const S=w(h),C=S.y();S.x(S.x()-S.getTextWidth()/2);const T=x.id-1;if(4===d){const t={...h,fontSize:a-6,fontStyle:"normal"};if(t.x=h.x,t.y=h.y-9,s.stlk.length>0&&void 0!==s.stlk[T]){const o=s.stlk[T];t.text=`${o[0]}A`,t.fill=n[0];const e=w(t);t.text=`${o[1]}D`,t.fill=n[3];const i=w(t),a=e.getTextWidth()+i.getTextWidth()+4;e.x(f.x+u-a/2),i.x(e.x()+e.getTextWidth()+4),0===o[0]&&e.destroy(),0===o[1]&&(i.destroy(),o[0]>0&&e.x(e.x()+e.getTextWidth()+4))}}if([60,61,62,63].indexOf(T)>-1){const t=S.x()-11,e=S.y();drawHoaTienThien(g,b,o.dtb.bs.y[0],T,t,e,c,l,n,i);const a=S.x()+S.getTextWidth()+5,r=S.y()-.5;drawTuHoa(g,b,s,f,y,p,a,r,T,l,c,n,m,o)&&(m[s.ci]+=1);const d=S.x()+S.getTextWidth()+3,x=S.y()+4,h=drawHoaDaiVan(g,b,s,d,x,T,o,l,c,n)?d+12:d,u=drawHoaLuuNien(g,b,s,h,x,T,o,l,c,n);drawHoaCanThang(g,b,s,u?h+10:h+3,x,T,o,l,c,n)}return C+25}(t,x,C):x;const k=T>0,W=C.id-1,v=S[CfgValue.showHideStar];if(v>0&&!k){if(1===v&&!STARSTRONG.includes(W))return x;if(2===v&&!STARSTRONG.includes(W)&&!STAR_SIGN.includes(W))return x;if(3===v&&!STARSTRONG.includes(W)&&!STAR_SIGN.includes(W)&&!CR_TS.includes(W))return x;if(!(4!==v||STARSTRONG.includes(W)||STAR_SIGN.includes(W)||CR_TS.includes(W)||FAILURE6.includes(W)))return x}const A=N-1;if([64,65,66,67].includes(W)&&k)return x;const $=void 0!==C.cir,B=C.iptt,E={text:C.name,x:t,y:x,fontSize:N-1,fill:e[C.hh],width:$&&"vts"===C.cir?y:"auto",opacity:1,align:"center",shadowEnabled:!1,shadowOpacity:0,shadowForStrokeEnabled:!1,textDecoration:""};T>0&&(E.fontSize=E.fontSize-2,E.y=E.y+1.6),k?(E.fontStyle="italic",E.opacity=.9):(1===Number(S[CfgValue.shortStar])&&(E.text=C.sht),B?(E.fontStyle="bold",E.shadowColor=e[C.hh],E.shadowBlur=0,E.shadowOffset={x:0,y:0},E.shadowOpacity=.8):(E.shadowOpacity=0,E.fontStyle="normal",E.textDecoration="",$&&("vbs"===C.cir||C.cir)));const z=w(E,!1);H&&(E.x=t-z.getTextWidth());const L=void 0!==s.tu||void 0!==s.tr,V=C.lvl;let D="",_=0,R=!1;void 0!==V&&Object.entries(V).forEach((([t,o],e)=>{Number(t)===s.ci+1&&(D=o,_=5.5,R=!0)})),void 0===C.lvl||"Đ"!==D||L||k||(E.shadowColor=e[C.hh],E.shadowBlur=0,E.shadowOffset={x:0,y:0},E.shadowOpacity=.8,w(E)),C.lvl;const M=w(E);if(T>0){const t={...E};switch(T){case 1:t.text="Đ.";break;case 2:t.text="L.";break;case 3:t.text="T."}t.fontSize=t.fontSize-2,2===C.typ?M.x(M.x()-h+3.5):M.x(M.x()+8),t.x=M.x()-8,t.y=M.y()+1.5,w(t)}const F=C.id-1;if(!k&&[60,61,62,63].indexOf(F)>-1&&3!==d){_=0===_?_+3:_;const t=M.x()+M.getTextWidth()+_+9,e=M.y()-1,a=drawHoaTienThien(g,b,o.dtb.bs.y[0],F,t,e,c,l,n,i),r=M.x()+M.getTextWidth()+_+(a?22:5),d=M.y()+1;drawTuHoa(g,b,s,f,y,p,r,d,F,l,c,n,m,o)&&(m[s.ci]+=1);const x=M.x()+M.getTextWidth()+_+(a?20:2),h=M.y()+2,u=drawHoaDaiVan(g,b,s,x,h,F,o,l,c,n),S=u?x+12:x,w=drawHoaLuuNien(g,b,s,S,h,F,o,l,c,n),C=w?S+11:u?x+12:x,T=drawHoaCanThang(g,b,s,C,h,F,o,l,c,n);drawHoaCanNgay(g,b,s,T?C+11:w?S+11:u?x+12:x,h,F,o,l,c,n)}return R&&!k&&(E.x+=M.getTextWidth(),E.y-=1,E.text=D,E.fontSize=r-6,E.fontStyle="normal",E.opacity=1,E.shadowOpacity=0,w(E)),z.destroy(),x+A}function T(t,e,n,i,a,r=0){const s=S[CfgValue.currentStar];for(let l=0;l<t.length;l+=1){if(r>0){let e=!1,n=o.istc?[...STARLOOP1,58,59,62,63]:STARLOOP1;if(n=1===s?n:2===s?[...n,25,37,82,83,85,86]:[],n.length>0&&!n.includes(t[l])&&(e=!0),!o.istc&&[62,63].includes(t[l])&&(e=!0),e)continue}if(0===Number(S[CfgValue.isADSat])&&(123===t[l]||124===t[l]||125===t[l]))continue;const c=SM[t[l]];void 0!==c.cir&&"vts"===c.cir||(1===c.typ&&(n=C(e,n,c,r)),2===c.typ&&(a=C(i,a,c,r,!0)))}return[n,a]}return function(){let t=f.x+h,o=f.y+73;const e=o,n=f.x+y-h-2;let i=e;if(4===d||5===d){const e=s.sb.length,n=25,a=f.y+70,r=[a,a+n,a+2*n];t=f.x,o=r[e],i=o}const a=f.x;let r=f.y+x-21;if(1===S[CfgValue.batTuCung]&&1===S[CfgValue.showSun]&&(r=f.y+x-35),0===S[CfgValue.batTuCung]&&0===S[CfgValue.showSun]&&(r=f.y+x-10),4!==d&&5!==d)for(let t=0;t<s.ss.length;t+=1){const o=SM[s.ss[t]];void 0!==o.cir&&"vts"===o.cir&&(r=C(a,r,o,0,!1,13))}const l=T(s.ss,t,o,n,i,0);let c=l;1===S[CfgValue.dvStar]&&(c=T(s.sv,t,l[0],n,l[1],1)),S[CfgValue.currentStar]>0&&T(s.sy,t,c[0],n,c[1],2)}(),t.layer.add(g),t.layer}function Earth(t){let o=t.layer;const e=new Konva.Group({}),n=[{x:Number(t.xBox12),y:Number(t.yBox34)},{x:Number(t.xBox14),y:Number(t.yBox34)},{x:Number(t.xBox),y:Number(t.yBox34)},{x:Number(t.xBox),y:Number(t.yBox12)},{x:Number(t.xBox),y:Number(t.yBox14)},{x:Number(t.xBox),y:Number(t.yBox)},{x:Number(t.xBox14),y:Number(t.yBox)},{x:Number(t.xBox12),y:Number(t.yBox)},{x:Number(t.xBox34),y:Number(t.yBox)},{x:Number(t.xBox34),y:Number(t.yBox14)},{x:Number(t.xBox34),y:Number(t.yBox12)},{x:Number(t.xBox34),y:Number(t.yBox34)}];let i,a;const r=[0,0,0,0,0,0,0,0,0,0,0,0,0],s=[0,0,0,0,0,0,0,0,0,0,0,0,0];for(let e=0;e<12;e+=1){i=n[e],a={idx:Number(e),cung:t.ls.ars[e],pos:i,thdraw:s},o=ZoneBase({...a,...t}),o=ZoneBigStar({...a,...t}),o=ZoneSmallStar({...a,...t});o=ZoneFly({...{countHt:r},...a,...t})}function l(o,n,i,a,r="#fff",s="#666",l=!1){let c=l?50:43;n>0&&(c=l?33:17);const d={x:Number(i[0])-c/2+(n>0?35:0),y:Number(i[1])-4.5,text:o,fill:r,width:c,align:"center",fontSize:9,perfectDrawEnabled:!0,opacity:1,shadowColor:"#000",shadowBlur:0,shadowOpacity:0,shadowOffset:{x:0,y:0}},f=drawText(d,t.fontDV,t.fontFamilySet,e),x=rectCache.clone({x:f.x()-5,y:f.y()-0,fill:s,width:f.width()+10,height:f.height()+0,perfectDrawEnabled:!0,strokeWidth:0,opacity:1,cornerRadius:6,stroke:"#222",hitStrokeWidth:0,shadowForStrokeEnabled:!1});e.add(x),null!==x&&x.moveToTop(),null!==f&&f.moveToTop(),6!=a&&0!=a||(0!==n||l||(f.absolutePosition({x:d.x+17,y:d.y+18}),x.absolutePosition({x:f.x(),y:f.y()+5})),0===n&&l&&(f.absolutePosition({x:d.x+21,y:d.y+18}),x.absolutePosition({x:f.x(),y:f.y()+5})),2!==n||l||(f.absolutePosition({x:d.x-31,y:d.y-50}),x.absolutePosition({x:f.x(),y:f.y()+5})),2===n&&l&&(f.absolutePosition({x:d.x-23,y:d.y-50}),x.absolutePosition({x:f.x(),y:f.y()+5})),f.rotation(-90),x.rotation(-90))}return 5!==t.typeLs&&6!==t.typeLs&&function(){const i=t.ls.ttr[0],a=t.ls.ttr[2];if(0!==i.length||0!==a.length){const r=[[n[0].x,n[0].y+t.hafHSquare],[n[2].x+t.hafWSquare,n[2].y],[n[4].x+t.hafWSquare,n[4].y],[n[7].x,n[7].y+t.hafHSquare],[n[9].x+t.hafWSquare,n[9].y],[n[11].x+t.hafWSquare,n[11].y]];if(0!==i.length){const t=i[0],o=i[1];t[0]===o[0]?l("Tuần-Triệt",0,r[t[0]/2],o[0],"#fff","#111",!0):(l("Tuần",0,r[t[0]/2],t[0],"#fff","#777",!1),l("Triệt",0,r[o[0]/2],o[0],"#fff","#333",!1))}if(0!==a.length&&1===t.ls.cfg[CfgValue.lnTuTr]){const t=a[0],o=a[1];t[0]===o[0]?l("⊙-⊠",2,r[t[0]/2],o[0],"#fff","rgba(17, 17, 17, 1)",!0):(l("⊙",2,r[t[0]/2],t[0],"#fff","rgba(119, 119, 119, 1)",!1),l("⊠",2,r[o[0]/2],o[0],"#fff","rgba(51, 51, 51, 1)",!1))}o.add(e)}}(),o}function LinesBorder(t){const{ls:o,xBox:e,borderOutWith:n,hafBorderOut:i,yBox:a,xBox14:r,yBox14:s,xBox12:l,yBox12:c,xBox34:d,yBox34:f,xBox4:x,yBox4:h,hafBorderIn:y,borderInnerWith:u}=t;return function(){const t=["#000000","#000000","#000000"][o.cfg[CfgValue.tcpb]];return[{points:[r+y,a-y,r+y,h+i],color:t,strokeWidth:u},{points:[l+y,a-y,l+y,s+y],color:t,strokeWidth:u},{points:[l+y,f+y,l+y,h+i],color:t,strokeWidth:u},{points:[d+y,a-y,d+y,h+i],color:t,strokeWidth:u},{points:[e,s+y,x+i,s+y],color:t,strokeWidth:u},{points:[e,c+y,r+y,c+y],color:t,strokeWidth:u},{points:[d+y,c+y,x+i,c+y],color:t,strokeWidth:u},{points:[e,f+y,x+i,f+y],color:t,strokeWidth:u}].concat([{points:[e-i,a-i,l+y,a-i],color:t,strokeWidth:n},{points:[l,a-i,d+y,a-i],color:t,strokeWidth:n},{points:[d+y,a-i,x+i,a-i],color:t,strokeWidth:n},{points:[x+i,a-i,x+i,c+y],color:t,strokeWidth:n},{points:[x+i,c+y,x+i,f+y],color:t,strokeWidth:n},{points:[x+i,f+y,x+i,h+i],color:t,strokeWidth:n},{points:[x+i,h+i,l+y,h+i],color:t,strokeWidth:n},{points:[l,h+i,r+y,h+i],color:t,strokeWidth:n},{points:[r+y,h+i,e-i,h+i],color:t,strokeWidth:n},{points:[e-i,h+i,e-i,c+y],color:t,strokeWidth:n},{points:[e-i,c+y,e-i,s+y],color:t,strokeWidth:n},{points:[e-i,s+y,e-i,a-i],color:t,strokeWidth:n}])}().forEach((o=>{t.layer.add(lineCache.clone({points:o.points,stroke:o.color,strokeWidth:1.5,opacity:1}))})),t.layer}function Sky(t){const{wSquare:o,xBox12:e,xBox14:n,yBox14:i,yBox34:a,borderInnerWith:r,ls:s,fontCenter:l,fontFamilySet:c,color:d,fontDV:f,cfgLs:x}=t,h=new Konva$1.Group({}),y=1===Number(x[CfgValue.batTuCenter]);function u(t){let o={x:500,y:500,text:"",fontStyle:"normal",fontSize:f,fontFamily:c,fill:"#000",strokeWidth:0,textDecoration:"",shadowColor:"black",shadowBlur:0,shadowOffset:{x:0,y:0},shadowOpacity:0,hitStrokeWidth:0,shadowForStrokeEnabled:!1,perfectDrawEnabled:!0};o={...o,...t};const e=textCache.clone(o);return h.add(e),e}function p(t){return u({...t,fontStyle:"normal",width:2*o+r,align:"center"})}function S(t,e,n,i){return function(t,e,n,i){const a=o/2-2.5,r=o/10,c=a+t,f={x:t,y:e,fill:"rgba(0, 0, 0, 0.07)",width:a,height:y?2.1*a:1.35*a,perfectDrawEnabled:!0,strokeWidth:1,opacity:1,cornerRadius:6,hitStrokeWidth:1,shadowForStrokeEnabled:!1},x=rectCache.clone(f);h.add(x),u({text:CAN_AD[n.cn]>0?"+":"-",x:x.x(),y:x.y()+2,fill:"#777",fontSize:l+1,width:a,align:"center",fontStyle:"normal",fontFamily:"Arial"});const p=u({text:`${i}`,x:x.x(),y:x.y()+r,fontSize:l,width:a,align:"center",fontStyle:"bold"});let S=p.x(),b=p.y();if(y){const t=u({text:`${-1===n.cht?"Nhật chủ":THAP[n.cht]}`,x:p.x(),y:p.y()+r+3,fontSize:l,width:a,align:"center"});S=t.x(),b=t.y()}const m=u({text:`${CAN[n.cn].toUpperCase()}`,x:S,y:b+r+6,fill:d[CAN_HH[n.cn]],fontSize:l+1,fontStyle:"bold",width:a,align:"center"}),g=u({text:`${CHI[n.ci].toUpperCase()}`,x:m.x(),y:m.y()+r,fill:d[CHI_HH[n.ci]],fontSize:l+1,fontStyle:"bold",width:a,align:"center"});if(S=g.x(),b=g.y(),y){const t=a/n.ctg.length,o=l-2;let e=0,i=g.y();n.ctg.forEach((n=>{const a=u({text:`${CAN[n]}`,x:0===e?g.x():e,y:g.y()+r,fill:d[CAN_HH[n]],fontSize:o,width:t,align:"center"}),c=THAP[idxTHAP(s.dtb.bs.d[0],n)],f=t-2,x=u({text:c,x:a.x(),y:a.y()+r+2,fontSize:l-2,width:"Thương"===c?f+8:f,align:"center",fill:"#000"});e=a.x()+t,i=x.y()}));const c=r+3,f=u({text:`${TSNAME[n.ts]}`,x:g.x(),y:i+c,fontSize:l-2,width:a,align:"center"});S=f.x(),b=f.y()}const w=r+5,C=l-2;return u({text:`${LTHG_NA[n.na]}`,x:S,y:b+w,fill:d[LTHG_HH[n.na]],fontSize:C,width:a,align:"center"}),c}(t,e,n,1===x[CfgValue.showSun]?i:"")}return function(){if(void 0===s)return[];h.destroyChildren(),u({text:`Ver ${t.version}`,x:n+10,y:a-48,fill:"#000",align:"center",width:2*o-20,fontSize:l-4,opacity:.3,fontVariant:"normal"}),function(){const t="VGluaE1lbmhEby5jb20=";u({text:(()=>{try{return window.atob(t)}catch{return""}})(),x:n,y:a-36,fill:"#b06200",align:"center",width:2*o,fontSize:l-1,opacity:.8,fontVariant:"normal"})}(),function(){const t="TG_FpIHPz";let e=`${String.fromCharCode(76)}oại ${String.fromCharCode(108)}á số ${x[CfgValue.typeLs]+1}`;if([6,7,8].includes(x[CfgValue.typeLs])){const o=["1","2","3"];e+=` - ${t.substring(0,3)}${o[x[CfgValue.tcpb]]}`}u({text:e+` - ${String.fromCharCode(67)}an ${String.fromCharCode(72)}óa `+(s.cfg[CfgValue.lsCanType]+1)+` - ${String.fromCharCode(108)}ập ${String.fromCharCode(108)}úc ${dayjs().format("YYYY/MM/DD HH:mm")}`,x:n,y:a-20,fill:"#000",align:"center",width:2*o,fontSize:l-2,opacity:.8,fontVariant:"normal"})}();const c=l-1;let f=AREA_NAME[s.ars[s.at].ai];f=f.charAt(0)+f.slice(1).toLowerCase();const b=s.dtv.bs,m=l-1.5;var g,w,C;!function(t,o,n){t.forEach(((t,i)=>{!function(t,o,n){let i=0;t.forEach((t=>{i+=function({text:t,fontSize:o,fontStyle:e}){return textCache.clone({text:t,fontSize:o,fontStyle:e}).width()}({...t,fontSize:n})+3}));let a=e-i/2;t.forEach(((t,e)=>{const{txt:i,width:r}=function({text:t,y:o,fontSize:e,fontStyle:n,fill:i}){const a=u({text:t,y:o,fontSize:e,fontStyle:n,fill:i});return{txt:a,width:a.getTextWidth()}}({...t,y:o,fontSize:n});i.x(a),a+=r+3}))}(t,o[i],n)}))}([[{text:`${s.adye>0?"Dương":"Âm"} ${s.sx>0?"Nam":"Nữ"}`,fontStyle:"normal"},{text:`${s.yeo} tuổi`,fontStyle:"bold",align:"center"},{text:"âm lịch",fontStyle:"normal"},{text:"giờ",fontStyle:"normal"},{text:`${CHI[s.dtb.bs.h[1]]}`,fontStyle:"bold"},{text:"ngày",fontStyle:"normal"},{text:`${s.dtb.ln.d}`,fontStyle:"bold"},{text:"tháng",fontStyle:"normal"},{text:`${s.dtb.ln.m}`,fontStyle:"bold"},{text:"năm",fontStyle:"normal"},{text:CAN[s.dtb.bs.y[0]],fontStyle:"bold",fill:d[CAN_HH[s.dtb.bs.y[0]]]},{text:CHI[s.dtb.bs.y[1]],fontStyle:"bold",fill:d[CHI_HH[s.dtb.bs.y[1]]]}],[{text:"Mệnh",fontStyle:"normal"},{text:HH[LTHG_HH[s.dtb.bs.y[2]]],fontStyle:"bold",fill:d[LTHG_HH[s.dtb.bs.y[2]]]},{text:"cục"},{text:HH[s.cid],fontStyle:"bold",fill:d[s.cid]},{text:`- ${s.ad>0?ADTN[1]:ADTN[0]} - ${SKB[s.sks]}`}],[{text:"Thân cư",fontStyle:"normal"},{text:`${f}`,fontStyle:"bold"},{text:"- Mệnh chủ"},{text:SM[s.mctc[0]].name,fontStyle:"bold",fill:d[SM[s.mctc[0]].hh]},{text:"- Thân chủ"},{text:SM[s.mctc[1]].name,fontStyle:"bold",fill:d[SM[s.mctc[1]].hh]}],[{text:"Năm xem "+s.dtv.sn.y+" ÂL: ",x:n+10,fontSize:m},{text:`${CAN[b.y[0]]} ${CHI[b.y[1]]} - `,fill:d[LTHG_HH[b.y[2]]],fontSize:m},{text:`${CAN[b.m[0]]} ${CHI[b.m[1]]}(${s.dtv.ln.m}) - `,fill:d[LTHG_HH[b.m[2]]],fontSize:m},{text:`${CAN[b.d[0]]} ${CHI[b.d[1]]}(${s.dtv.ln.d}) - `,fill:d[LTHG_HH[b.d[2]]],fontSize:m},{text:`${CAN[b.h[0]]} ${CHI[b.h[1]]}`,fill:d[LTHG_HH[b.h[2]]],fontSize:m}]],(g=i+15,w=16,C=4,Array.from({length:C},((t,o)=>g+o*w))),c),function(){const{dtb:t,tutru:e}=s,a=t.tki,c=p({text:`Tứ Trụ - Sinh vào tiết ${TKN[a[0]]}`,x:n,y:i+95,fontSize:l});a[1]&&p({text:`Tháng ${TKN_MONTH[a[0]]}tk từ ${TKN[TKN_PN[a[0]][0]]} (${1===x[CfgValue.showSun]?dayjs(a[3]).format("YYYY/MM/DD HH:mm"):dayjs(a[3]).format("----/MM/DD HH:mm")}) đến ${TKN[TKN_PN[a[0]][1]]} (${1===x[CfgValue.showSun]?dayjs(a[4]).format("YYYY/MM/DD HH:mm"):dayjs(a[4]).format("----/MM/DD HH:mm")})`,x:n,y:c.y()+16,fontSize:l-3});const f=S(n+3,c.y()+33,e.cot[0],`${t.sn.y}`),b=t.ln.mt===t.ln.m?"("+t.ln.mt+")":"("+t.ln.m+")("+t.ln.mt+"tk)",m=S(f+3,c.y()+33,e.cot[1],`${t.sn.m} ${b}`),g=S(m+3,c.y()+33,e.cot[2],`${t.sn.d} (${t.ln.d})`);if(S(g+3,c.y()+33,e.cot[3],`${t.sn.h}h${t.sn.i}`),y){const t=s.tutru.dvt,e=u({text:`${t[0]?"Thuận":"Nghịch"} đến tk cách ${t[1]} ngày ${t[2]} giờ quy đổi thành ${t[3]} năm ${t[4]} tháng ${t[5]} ngày`,x:n,y:c.y()+235,fontStyle:"normal",width:2*o+r,align:"center",fontSize:l-2.5}),i=15,a=s.tutru.dv,f=34;let y=0;a.forEach(((t,o)=>{const a=dayjs.unix(t[2]),r=s.yeo>=a.year()-s.dtb.sn.y+1&&s.yeo<=a.year()-s.dtb.sn.y+10,c={x:0===y?n+3:y,y:e.y()+i,fill:r?"rgba(255, 224, 191, 0.7)":"rgba(0, 0, 0, 0.07)",width:f,height:75,perfectDrawEnabled:!0,strokeWidth:1,opacity:1,cornerRadius:6,hitStrokeWidth:1,shadowForStrokeEnabled:!1};h.add(rectCache.clone(c));const p=u({text:`${THAP[idxTHAP(s.dtb.bs.d[0],t[0])]}`,x:0===y?n+3:y,y:e.y()+i+5,fill:"#333",fontSize:l-4,width:f,align:"center"}),S=u({text:`${CAN[t[0]]}`,x:0===y?n+3:y,y:p.y()+i,fill:d[CAN_HH[t[0]]],fontSize:l-2,width:f,align:"center"}),b=u({text:`${CHI[t[1]]}`,x:S.x(),y:S.y()+i,fill:d[CHI_HH[t[1]]],fontSize:l-2,width:f,align:"center"});let m=`${a.year()-s.dtb.sn.y+1}-${a.year()-s.dtb.sn.y+10}t${1===x[CfgValue.showSun]?" "+a.format("YYYY"):""}`;0===o&&(m=`${a.year()-s.dtb.sn.y+1}t${1===x[CfgValue.showSun]?" "+a.format("DD/MM   YYYY"):""}`),u({text:`${m}`,x:S.x(),y:b.y()+i+2,fill:"#333",fontSize:l-5,width:f,align:"center"}),y=S.x()+f+3.5}))}}()}(),t.layer.add(h),t.layer}arrowCache.cache();const MySwal=withReactContent(Swal),HoroscopeClient=t=>{const o=t.ls,e=o.cfg,n=75*(o.css<=11?0:o.css-11),i=960+n,a=e[CfgValue.typeLs],r=e[CfgValue.typePhiHoa],s=185.5,l=i/4,c=i+2+1+1,d=["","","#031640","#067b11","#8b8380","#e39e25","#cf233b"],f=["","","#123e65","#04973c","#919191","#e39e25","#e73827"];let x=5;4!==a&&5!==a||(x=8);const h=["rgb(3 140 0)","rgb(110 8 136)","rgb(14 124 202)","rgb(217 4 4)"],y=["rgb(3 140 0 / 75%)","rgb(110 8 136 / 75%)","rgb(14 124 202 / 75%)","rgb(217 4 4 / 75%)"],u=["rgba(114,250,112,0.9)","rgba(227,100,255,0.9)","rgba(77,182,255,0.9)","rgba(246,66,66,0.9)"],p=["rgba(114,250,112,0.5)","rgba(227,100,255,0.5)","rgba(77,182,255,0.5)","rgba(246,66,66,0.5)"],S="Roboto Slab",b=54,m=l/2;let g=1,w=g+s,C=w+1+s,T=C+1+s,H=T+1+s,N=1,k=N+l,W=k+1+l,v=W+1+l,A=v+1+l;g+=27,w+=27,C+=27,T+=27,H+=27,N+=27,k+=27,W+=27,v+=27,A+=27;const $=l-2.3*x,B=x;function E(t,o,e="#dcd3aaa8"){if("undefined"!=typeof window){const n=window.document.createElement("canvas").getContext("2d"),i=void 0!==t[4]?t[4]:t[2],a=void 0!==t[5]?t[5]:t[3],r=n.createLinearGradient(t[0],t[1],i,a);return r.addColorStop(0,e),r.addColorStop(1,o),r}return o}const z=useRef(null);let L;useState(!1),useState(!1),useState(null),useState(!1);const[V,D]=useState(null),_=()=>z.current?z.current.toDataURL({pixelRatio:2,quality:1,mimeType:"image/png"}):null;function R(t){let e="VCD";return o.ars[t].sb.length>0&&(e="",o.ars[t].sb.forEach((t=>{e.length>0&&(e+="-"),e+=SM[t].sht}))),vi2en(e)}useEffect((()=>{if("undefined"!=typeof window)try{L&&L.destroy(),z.current&&z.current.destroy();if(!document.getElementById("cv"))return void console.error("Container not found");const n=new Konva$2.Stage({container:"cv",width:800,height:c+b,fill:"#fefefe",font:S});z.current=n,L=new Konva$2.Layer;const V=GETHOA(e[CfgValue.lsCanType]);L.add(rectCache.clone({x:0,y:0,width:800,height:c+b,hitStrokeWidth:0,shadowForStrokeEnabled:!1,fillRadialGradientStartPoint:{x:C,y:W},fillRadialGradientStartRadius:0,fillRadialGradientEndPoint:{x:C,y:W},fillRadialGradientEndRadius:1e3,fillRadialGradientColorStops:[0,"#FFF",1,"#ddd"]})),L.add(rectCache.clone({x:w+1,y:k+1,width:372,height:2*l+1,fillRadialGradientStartPoint:{x:w,y:k},fillRadialGradientStartRadius:0,fillRadialGradientEndPoint:{x:w,y:k},fillRadialGradientEndRadius:555,fillRadialGradientColorStops:[0,"#fff",1,"#ddd"],hitStrokeWidth:0,shadowForStrokeEnabled:!1})),L=LinesBorder({ls:o,layer:L,lsWidth:742,lsHeight:i,xBox:g,borderOutWith:1,hafBorderOut:.5,yBox:N,xBox12:C,yBox12:W,xBox14:w,yBox14:k,xBox34:T,yBox34:v,xBox4:H,yBox4:A,hafBorderIn:.5,borderInnerWith:1,bColor:f}),L=Earth({layer:L,bColor:f,colorHoaStart:y,colorHoa:h,colorHoaFill:u,colorHoaFill60:p,color:d,xBox12:C,yBox34:v,xBox14:w,xBox:g,yBox12:W,yBox14:k,yBox:N,xBox4:H,yBox4:A,xBox34:T,ls:o,hafWSquare:92.75,hafHSquare:m,fontFamilySet:S,borderOutWith:1,hafBorderOut:.5,fontDV:13,padContentBottom:$,padContentTop:B,padContent:x,wSquare:s,hSquare:l,fontPhuTinh:14,fontChinhTinh:15,getGradient:E,typePhiHoa:r,typeLs:a,cfgLs:e,canHoa:V}),L=Sky({layer:L,wSquare:s,xBox12:C,xBox14:w,yBox14:k,yBox34:v,borderInnerWith:1,ls:o,fontCenter:12,hafWSquare:92.75,fontFamilySet:S,color:d,fontDV:13,cfgLs:e,getGradient:E,version:t.version}),L.add(rectCache.clone({x:0,y:c+b,width:800,height:c+b,fill:"rgb(233 233 233)"})),n.add(L);const R=_();R&&D(R)}catch(t){console.error("Error initializing stage:",t)}return()=>{L&&L.destroy(),z.current&&(z.current.destroy(),z.current=null),D(null)}}),[t.ls]),useEffect((()=>{0!==t.fnDownloadCall&&j(),0!==t.fnCopyLs&&F()}),[t.fnDownloadCall,t.fnCopyLs]);const M=()=>{const t=o.dtb.sn,e=o.dtb.ln,n=o.dtb.bs,i=AREA_NAME[o.ars[o.at].ai];return jsxs("div",{className:"text-[14px] [&_div]:mb-1",children:[jsxs("div",{children:["Thời gian sinh dương lịch:"," ",jsxs("b",{children:[t.d,"/",t.m,"/",t.y," lúc ",t.h,"h",t.i||0]})]}),jsxs("div",{children:[jsx("b",{children:`${o.adye>0?"Dương":"Âm"} ${o.sx>0?"Nam":"Nữ"}`})," tuổi âm lịch ",jsxs("b",{children:[o.yeo," tuổi"]})]}),jsxs("div",{children:["Âm lịch giờ ",jsx("b",{children:CHI[n.h[1]]})," ngày ",jsx("b",{children:e.d})," tháng ",jsx("b",{children:e.m})," năm"," ",jsxs("b",{className:`color${LTHG_HH[n.y[2]]}`,children:[CAN[n.y[0]]," ",CHI[n.y[1]]]})]}),jsxs("div",{children:["Mệnh ",jsxs("b",{className:`color${LTHG_HH[n.y[2]]}`,children:[" ",HH[LTHG_HH[n.y[2]]]]})," cục"," ",jsx("b",{className:`color${o.cid}`,children:HH[o.cid]})," - ",`${o.ad>0?ADTN[1]:ADTN[0]} - ${SKB[o.sks]}`," "]}),jsxs("div",{children:["Thân cư ",jsx("b",{children:i.charAt(0)+i.slice(1).toLowerCase()})," - Mệnh chủ"," ",jsx("b",{className:`color${SM[o.mctc[0]].hh}`,children:SM[o.mctc[0]].name})," - Thân chủ"," ",jsx("b",{className:`color${SM[o.mctc[1]].hh}`,children:SM[o.mctc[1]].name})," "]}),jsxs("div",{className:"!text-[12px] !mt-3",children:["Năm xem ",jsx("b",{children:o.dtv.sn.y})," ÂL:"," ",jsxs("span",{className:`color${LTHG_HH[o.dtv.bs.y[2]]}`,children:[CAN[o.dtv.bs.y[0]]," ",CHI[o.dtv.bs.y[1]]]})," ","-"," ",jsxs("span",{className:`color${LTHG_HH[o.dtv.bs.m[2]]}`,children:[CAN[o.dtv.bs.m[0]]," ",CHI[o.dtv.bs.m[1]],"(",o.dtv.ln.m,")"]})," ","-"," ",jsxs("span",{className:`color${LTHG_HH[o.dtv.bs.d[2]]}`,children:[CAN[o.dtv.bs.d[0]]," ",CHI[o.dtv.bs.d[1]],"(",o.dtv.ln.d,")"]})," ","-"," ",jsxs("span",{className:`color${LTHG_HH[o.dtv.bs.h[2]]}`,children:[CAN[o.dtv.bs.h[0]]," ",CHI[o.dtv.bs.h[1]]]})]})]})},F=async()=>{try{const t=V||_();if(!t)throw new Error("Không thể lấy được ảnh lá số");const o=await fetch(t),e=await o.blob();await navigator.clipboard.write([new ClipboardItem({[e.type]:e})]),MySwal.fire({title:"Thông báo",html:jsxs("div",{children:[jsx("div",{children:"Tinh Mệnh Đồ đã copy xong:"}),jsxs("div",{className:"text-orange-600",children:["Check lại thông tin ",jsx("b",{children:"1 lần nữa"})," cho dù bạn đã chắc chắn."]}),jsx("br",{}),jsx("div",{children:M()}),jsx("br",{})]}),icon:"success"})}catch(t){console.error("Error copying image:",t),MySwal.fire({title:"Lỗi",text:t instanceof Error?t.message:"Có lỗi xảy ra khi copy lá số",icon:"error"})}},j=()=>{try{const t=V||_();if(!t)throw new Error("Không thể lấy được ảnh lá số");const e=o.dtb.sn,n=o.am,i=R(n),a=o.at,r=R(a);!function(t,o){if("undefined"!=typeof window){const e=window.document.createElement("a");e.download=o,e.href=t,window.document.body.appendChild(e),e.click(),window.document.body.removeChild(e)}}(t,`${1===o.sx?"nam":"nu"}-Menh-${i}-${vi2en(CHI[n])}-Than-${r}-${vi2en(CHI[a])}--${e.d}.${e.m}.${e.y}-${e.h}h${e.i||0}-TinhMenhDo.com-${Math.floor(1e4*Math.random())}.png`)}catch(t){console.error("Error exporting image:",t),MySwal.fire({title:"Lỗi",text:t instanceof Error?t.message:"Có lỗi xảy ra khi lưu lá số",icon:"error"})}},[G,O]=useState(!0);return useEffect((()=>{"undefined"!=typeof window&&G&&O(!1)})),jsxs(Fragment,{children:[jsx("div",{id:"cv",className:"flex justify-center"}),jsx("div",{className:"absolute top-0 left-0 hidden size-full max-lg:block"})]})};export{HoroscopeClient as default};