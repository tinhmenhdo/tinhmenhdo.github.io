import{j as e}from"./CY20i357.js";import{e as t,f as n,g as a,h as s}from"./DeIKlM_Q.js";import{K as r,L as i,C as o,T as l,A as O}from"./DLAjs7QY.js";import{r as c,R as React}from"./DgTtEExD.js";import{I as _,h as d}from"./CPzYiWv8.js";import"./CVVDEXDJ.js";var h=t(),I=n(),A=a();const xacDinhQue=e=>{const t=[...e].sort(((e,t)=>e.vi_tri-t.vi_tri)).reverse().map((e=>e.isYang?"1":"0")).join("");return d.findIndex((e=>e===t))},gieoQueKinhDich=()=>{const e=Array(6).fill(null).map(((e,t)=>(e=>{const t=Array(3).fill(null).map((()=>(()=>{const e=new Uint8Array(1);return crypto.getRandomValues(e),e[0]<128?"N":"S"})())).filter((e=>"N"===e)).length;let a;return a=3===t?"laoAm":0===t?"laoDuong":2===t?"thieuDuong":"thieuAm",{type:a,vi_tri:e,isYang:0===t||2===t}})(6-t))),t=xacDinhQue(e),a=(e=>{if(!e.some((e=>"laoAm"===e.type||"laoDuong"===e.type)))return null;const t=e.map((e=>({type:"laoAm"===e.type?"thieuDuong":"laoDuong"===e.type?"thieuAm":e.type,vi_tri:e.vi_tri,isYang:"laoAm"===e.type||"laoDuong"!==e.type&&e.isYang}))),a=xacDinhQue(t);return-1===a?null:{queIcon:_[a][0],queTen:_[a][1],queMeaning:_[a][2]}})(e),n=e.filter((e=>"laoAm"===e.type||"laoDuong"===e.type)).sort(((e,t)=>t.vi_tri-e.vi_tri)),i=[...e].sort(((e,t)=>t.vi_tri-e.vi_tri));return{queIcon:_[t][0],queTen:_[t][1],queMeaning:_[t][2],haoResults:i,haoDong:n,queBien:a,queGocIndex:t}},T={BASE_RADIUS_RATIO:.4,CIRCLE_RATIOS:{OUTER_MOST:1.12,OUTER:.95,HAO_6:.77,HAO_5:.685,HAO_4:.602,HAO_3:.52,HAO_2:.44,HAO_1:.36,INNER:.2},HAO_CONFIG:{CIRCLES:{HAO_6:{LINE_COLOR:"#000",LINE_WIDTH:1.5,DASH:[]},HAO_5:{LINE_COLOR:"#000",LINE_WIDTH:1.2,DASH:[]},HAO_4:{LINE_COLOR:"#000",LINE_WIDTH:1,DASH:[]},HAO_3:{LINE_COLOR:"#000",LINE_WIDTH:.8,DASH:[]},HAO_2:{LINE_COLOR:"#000",LINE_WIDTH:.6,DASH:[]},HAO_1:{LINE_COLOR:"#000",LINE_WIDTH:.5,DASH:[]}},ARC_CONFIG:{ANGLE_SPAN:5.625,HAO_6:{LAO_AM:{FILL:"#444",TEXT_COLOR:"white"},THIEU_DUONG:{FILL:"#f5f5f5",TEXT_COLOR:"transparent"},LAO_DUONG:{FILL:"#fff",TEXT_COLOR:"black"},THIEU_AM:{FILL:"#e0e0e0",TEXT_COLOR:"transparent"}},HAO_5:{LAO_AM:{FILL:"#444",TEXT_COLOR:"white"},THIEU_DUONG:{FILL:"#f5f5f5",TEXT_COLOR:"transparent"},LAO_DUONG:{FILL:"#fff",TEXT_COLOR:"black"},THIEU_AM:{FILL:"#e0e0e0",TEXT_COLOR:"transparent"}},HAO_4:{LAO_AM:{FILL:"#444",TEXT_COLOR:"white"},THIEU_DUONG:{FILL:"#f5f5f5",TEXT_COLOR:"transparent"},LAO_DUONG:{FILL:"#fff",TEXT_COLOR:"black"},THIEU_AM:{FILL:"#e0e0e0",TEXT_COLOR:"transparent"}},HAO_3:{LAO_AM:{FILL:"#444",TEXT_COLOR:"white"},THIEU_DUONG:{FILL:"#f5f5f5",TEXT_COLOR:"transparent"},LAO_DUONG:{FILL:"#fff",TEXT_COLOR:"black"},THIEU_AM:{FILL:"#e0e0e0",TEXT_COLOR:"transparent"}},HAO_2:{LAO_AM:{FILL:"#444",TEXT_COLOR:"white"},THIEU_DUONG:{FILL:"#f5f5f5",TEXT_COLOR:"transparent"},LAO_DUONG:{FILL:"#fff",TEXT_COLOR:"black"},THIEU_AM:{FILL:"#e0e0e0",TEXT_COLOR:"transparent"}},HAO_1:{LAO_AM:{FILL:"#444",TEXT_COLOR:"white"},THIEU_DUONG:{FILL:"#f5f5f5",TEXT_COLOR:"transparent"},LAO_DUONG:{FILL:"#fff",TEXT_COLOR:"black"},THIEU_AM:{FILL:"#e0e0e0",TEXT_COLOR:"transparent"}}},TEXT_CONFIG:{FONT_SIZE:{HAO_6:13,HAO_5:12,HAO_4:11,HAO_3:10,HAO_2:9,HAO_1:8},FONT_FAMILY:"Arial",OFFSET_RATIO:1/3},SPACING:{ROTATION_OFFSET:90}},TEXT_POSITIONS:{OUTER_HEXAGRAM:1.05,OUTER_NUMBER:.985,HEXAGRAM:.88,NUMBER:.81},ARROW:{LENGTH:.8,POINTER_LENGTH:21,POINTER_WIDTH:7,STROKE_WIDTH:2}},calculateCanvasSize=e=>{let t;return t=e<640?Math.min(e-32,400):e<1024?Math.min(e-64,600):850,{width:t,height:t}},calculateFontSizes=e=>{const t=e/850;return{OUTER_HEXAGRAM:Math.max(20,Math.floor(31*t)),OUTER_NUMBER:Math.max(12,Math.floor(15*t)),INNER_HEXAGRAM:Math.max(18,Math.floor(27*t)),INNER_NUMBER:Math.max(10,Math.floor(14*t)),HAO_NUMBER:Math.max(8,Math.floor(12*t))}},calculateTargetAngle=e=>360-(5.625*e+2.8125)+3600,getRandomNumber=(e,t)=>Math.random()*(t-e)+e;var u=s();const createHaoWheel=({baseRadius:e,haoNumber:t})=>{const a=new r.Group,n=T.CIRCLE_RATIOS[`HAO_${t}`],s=T.HAO_CONFIG.CIRCLES[`HAO_${t}`],l=t>1?T.CIRCLE_RATIOS["HAO_"+(t-1)]:T.CIRCLE_RATIOS.INNER;for(let i=0;i<64;i++){const s=i%4,o=5.625*i;let c=T.HAO_CONFIG.ARC_CONFIG[`HAO_${t}`].THIEU_AM,O=!1;switch(s){case 0:c=T.HAO_CONFIG.ARC_CONFIG[`HAO_${t}`].LAO_AM,O=!0;break;case 1:c=T.HAO_CONFIG.ARC_CONFIG[`HAO_${t}`].THIEU_DUONG;break;case 2:c=T.HAO_CONFIG.ARC_CONFIG[`HAO_${t}`].LAO_DUONG,O=!0;break;default:c=T.HAO_CONFIG.ARC_CONFIG[`HAO_${t}`].THIEU_AM}const _=new u.Arc({innerRadius:e*l+1,outerRadius:e*n,angle:T.HAO_CONFIG.ARC_CONFIG.ANGLE_SPAN,rotation:o,fill:c.FILL,clockwise:!1});if(a.add(_),O){const i=1===t?e*(.85*n+.15*l):e*(n+l)/2,s=new r.Group({x:Math.cos((o+2.8125)*Math.PI/180)*i,y:Math.sin((o+2.8125)*Math.PI/180)*i,rotation:o+T.HAO_CONFIG.SPACING.ROTATION_OFFSET}),O=new r.Text({text:t.toString(),fontSize:T.HAO_CONFIG.TEXT_CONFIG.FONT_SIZE[`HAO_${t}`],fontFamily:T.HAO_CONFIG.TEXT_CONFIG.FONT_FAMILY,fill:c.TEXT_COLOR,align:"center",verticalAlign:"middle",x:-T.HAO_CONFIG.TEXT_CONFIG.FONT_SIZE[`HAO_${t}`]*T.HAO_CONFIG.TEXT_CONFIG.OFFSET_RATIO,y:-T.HAO_CONFIG.TEXT_CONFIG.FONT_SIZE[`HAO_${t}`]*T.HAO_CONFIG.TEXT_CONFIG.OFFSET_RATIO});s.add(O),a.add(s)}}if(t>1)for(let t=0;t<64;t++){const s=5.625*t*Math.PI/180,r=Math.cos(s)*e*n,o=Math.sin(s)*e*n,c=Math.cos(s)*e*l,O=Math.sin(s)*e*l,T=new i.Line({points:[r,o,c,O],stroke:"#000",strokeWidth:.5});a.add(T)}else{const t=T.CIRCLE_RATIOS.INNER;for(let s=0;s<64;s++){const r=5.625*s*Math.PI/180,o=Math.cos(r)*e*n,l=Math.sin(r)*e*n,c=Math.cos(r)*e*t,O=Math.sin(r)*e*t,T=new i.Line({points:[o,l,c,O],stroke:"#000",strokeWidth:.5});a.add(T)}}const c=new o.Circle({radius:e*n,stroke:s.LINE_COLOR,strokeWidth:s.LINE_WIDTH,dash:s.DASH,listening:!1});return a.add(c),a},ResultDisplay=({showResult:t,isSpinning:a,result:n})=>e.jsx("div",{className:"w-full mt-8 md:mt-16",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-center min-h-[400px] bg-white rounded-lg shadow-lg",children:[e.jsx("div",{className:"border-r border-gray-300 p-8",children:e.jsx("div",{className:"min-h-[400px]",children:t&&n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xl mb-4",children:"Quẻ Chủ"}),e.jsxs("div",{className:"text-lg mb-2 text-blue-600",children:["Quẻ số ",n.queGocIndex+1]}),e.jsx("div",{className:"text-7xl mb-4",children:n.queIcon}),e.jsx("div",{className:"text-2xl font-bold mb-4",children:n.queTen}),e.jsx("div",{className:"text-base",children:n.queMeaning})]}):e.jsx("div",{className:"text-xl text-gray-500",children:a?"Đang xoay...":"Chưa có kết quả"})})}),e.jsx("div",{className:"p-8",children:e.jsxs("div",{className:"min-h-[400px]",children:[e.jsx("div",{className:"text-xl mb-6",children:"Hào Động"}),t&&n&&n.haoDong.length>0?n.haoDong.map((t=>e.jsxs("div",{className:"text-lg mb-2 text-left w-52 mx-auto",children:[e.jsxs("span",{className:"w-14 inline-block mr-2",children:["Hào ",t.vi_tri," :"]}),"laoAm"===t.type?e.jsx("span",{className:"text-black-500",children:"Âm Động"}):e.jsx("span",{className:"text-red-700",children:"Dương Động"})]},t.vi_tri))):e.jsx("div",{className:"text-lg text-gray-500",children:a?"Đang xoay...":"Không có hào động"})]})}),e.jsx("div",{className:"border-l border-gray-300 p-8",children:e.jsx("div",{className:"min-h-[400px]",children:t&&n?.queBien?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xl mb-4",children:"Quẻ Biến"}),e.jsxs("div",{className:"text-lg mb-2 text-blue-600",children:["Quẻ số ",_.findIndex((e=>e[0]===n.queBien?.queIcon))+1]}),e.jsx("div",{className:"text-7xl mb-4",children:n.queBien.queIcon}),e.jsx("div",{className:"text-2xl font-bold mb-4",children:n.queBien.queTen}),e.jsx("div",{className:"text-base",children:n.queBien.queMeaning})]}):e.jsx("div",{className:"text-lg text-gray-500",children:a?"Đang xoay...":"Không có quẻ biến"})})})]})}),IChingDiagram=()=>{const t=c.useRef(null),{width:a}=(()=>{const[e,t]=c.useState({width:850,height:850});return c.useEffect((()=>{if("undefined"==typeof window)return;const e=()=>{t({width:window.innerWidth,height:window.innerHeight})};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),e})(),[n,s]=c.useState(calculateCanvasSize(a)),[r,d]=c.useState(calculateFontSizes(n.width)),[u,R]=c.useState(!1),[E,m]=c.useState(null),[N,f]=c.useState(null),[L,x]=c.useState(null),[C,g]=c.useState(null),[M,H]=c.useState(!1),[p,F]=c.useState(null),S=c.useRef([]),w=c.useRef([]),G=c.useRef(null);return React.useEffect((()=>{if("undefined"==typeof window)return;const e=calculateCanvasSize(a);s(e),d(calculateFontSizes(e.width))}),[a]),React.useEffect((()=>{if("undefined"==typeof window)return;if(!t.current)return;S.current=[],w.current=[];const e=n.width,a=n.height,s=e/2,c=a/2,d=e*T.BASE_RADIUS_RATIO,u=new h.Stage({container:"canvas-container",width:e,height:a}),R=new I.Layer,E=new O.Arrow({points:[s,c,s,c-d*T.ARROW.LENGTH],pointerLength:T.ARROW.POINTER_LENGTH,pointerWidth:T.ARROW.POINTER_WIDTH,fill:"#FF0000",stroke:"#FF0000",strokeWidth:T.ARROW.STROKE_WIDTH,opacity:.7,listening:!1});R.add(E);const N=(({centerX:e,centerY:t,baseRadius:a,fontSizes:n})=>{const s=new A.Group({x:e,y:t,offset:{x:0,y:0},rotation:0}),r=new o.Circle({radius:a*T.CIRCLE_RATIOS.OUTER,stroke:"#000",strokeWidth:1});s.add(r);for(let e=0;e<64;e++){const t=5.625*e*Math.PI/180,n=Math.cos(t)*a*T.CIRCLE_RATIOS.OUTER,r=Math.sin(t)*a*T.CIRCLE_RATIOS.OUTER,o=Math.cos(t)*a*T.CIRCLE_RATIOS.HAO_6,l=Math.sin(t)*a*T.CIRCLE_RATIOS.HAO_6,c=new i.Line({points:[n,r,o,l],stroke:"#000",strokeWidth:1});s.add(c)}return _.map(((e,t)=>({symbol:e[0],number:t+1}))).forEach(((e,t)=>{const i=(5.625*t-90+2.8125)*Math.PI/180,r=(5.625*t-90+2.8125)*Math.PI/180,o=a*T.TEXT_POSITIONS.HEXAGRAM,c=Math.cos(i)*o,O=Math.sin(i)*o,_=a*T.TEXT_POSITIONS.NUMBER,h=Math.cos(r)*_,d=Math.sin(r)*_,u=new A.Group({x:c,y:O,rotation:5.625*t+2.8125}),I=new l.Text({text:e.symbol,fontSize:n.INNER_HEXAGRAM,fontFamily:"Arial",fill:"black",align:"center",offsetX:n.INNER_HEXAGRAM/2,offsetY:n.INNER_HEXAGRAM/2}),R=new A.Group({x:h,y:d,rotation:5.625*t+2.8125}),E=new l.Text({text:e.number.toString(),fontSize:n.INNER_NUMBER,fontFamily:"Arial",fill:"black",align:"center",offsetX:n.INNER_NUMBER/2,offsetY:n.INNER_NUMBER/2});u.add(I),R.add(E),s.add(u,R)})),s})({centerX:s,centerY:c,baseRadius:d,fontSizes:r});for(let e=1;e<=6;e++){const t=new A.Group({x:s,y:c}),a=createHaoWheel({baseRadius:d,haoNumber:e});t.add(a),R.add(t),S.current.push(t),w.current.push(a)}const L=new o.Circle({x:s,y:c,radius:d*T.CIRCLE_RATIOS.INNER,stroke:"#000",strokeWidth:1,listening:!1});G.current=L,R.add(L);const C=(({centerX:e,centerY:t,baseRadius:a,fontSizes:n})=>{const s=new A.Group({x:e,y:t,offset:{x:0,y:0},rotation:0}),r=new o.Circle({radius:a*T.CIRCLE_RATIOS.OUTER_MOST,stroke:"#000",strokeWidth:1});s.add(r);for(let e=0;e<64;e++){const t=5.625*e*Math.PI/180,n=Math.cos(t)*a*T.CIRCLE_RATIOS.OUTER_MOST,r=Math.sin(t)*a*T.CIRCLE_RATIOS.OUTER_MOST,o=Math.cos(t)*a*T.CIRCLE_RATIOS.OUTER,l=Math.sin(t)*a*T.CIRCLE_RATIOS.OUTER,c=new i.Line({points:[n,r,o,l],stroke:"#000",strokeWidth:1});s.add(c)}return _.map(((e,t)=>({symbol:e[0],number:t+1}))).forEach(((e,t)=>{const i=(5.625*t-90+2.8125)*Math.PI/180,r=(5.625*t-90+2.8125)*Math.PI/180,o=a*T.TEXT_POSITIONS.OUTER_HEXAGRAM,c=Math.cos(i)*o,O=Math.sin(i)*o,_=a*T.TEXT_POSITIONS.OUTER_NUMBER,h=Math.cos(r)*_,d=Math.sin(r)*_,u=new A.Group({x:c,y:O,rotation:5.625*t+2.8125}),I=new l.Text({text:e.symbol,fontSize:n.OUTER_HEXAGRAM,fontFamily:"Arial",fill:"black",align:"center",offsetX:n.OUTER_HEXAGRAM/2,offsetY:n.OUTER_HEXAGRAM/2}),R=new A.Group({x:h,y:d,rotation:5.625*t+2.8125}),E=new l.Text({text:e.number.toString(),fontSize:n.OUTER_NUMBER,fontFamily:"Arial",fill:"black",align:"center",offsetX:n.OUTER_NUMBER/2,offsetY:n.OUTER_NUMBER/2});u.add(I),R.add(E),s.add(u,R)})),s})({centerX:s,centerY:c,baseRadius:d,fontSizes:r});return R.add(N),R.add(C),E.remove(),R.add(E),u.add(R),m(u),x(R),f(N),F(C),()=>{u.destroy()}}),[n,r]),e.jsx("div",{className:"flex flex-col items-center min-h-screen",children:e.jsxs("div",{className:"w-full max-w-[1200px] min-h-[calc(100vh-4rem)] flex flex-col items-center justify-start p-4 md:p-8 max-md:p-0",children:[e.jsxs("div",{className:"relative",style:{width:n.width,height:n.height},children:[e.jsx("div",{ref:t,id:"canvas-container",className:"w-full h-full bg-white rounded-lg shadow-lg"}),e.jsx("button",{onClick:()=>{if(u||!N||!L||!p)return;R(!0),H(!1);const e=gieoQueKinhDich(),t=calculateTargetAngle(e.queGocIndex),a=e.queBien?calculateTargetAngle(_.findIndex((t=>t[0]===e.queBien?.queIcon))):null;(e=>{const t=w.current;t&&t.length&&L&&e.map((e=>({type:e.type||"không động",viTri:e.viTri||e.vi_tri}))).forEach((e=>{const a=Number(e.viTri)-1,n=t[a];n&&((e,t,a,n=getRandomNumber(4500,5500))=>{const i=a.type,s=a.viTri??a.vi_tri??0,r=s%2==0,o=((e,t=!1,a=0)=>{const n=5.625,i=4*Math.floor(a/4)*n;let s;switch(e){case"laoAm":s=0;break;case"thieuDuong":s=1;break;case"laoDuong":s=2;break;case"thieuAm":s=3}const r=i+s*n+2.8125-n,o="laoAm"===e||"laoDuong"===e?360:0,l=r+(t?-o:o);let c;return c=t?-3600+l:3600+l,{position:a,angle:r,extraAngle:o,targetRotation:c,normalizedAngle:(l%360+360)%360,isReverse:t}})(i,r,s);let l=0,c=e.rotation(),O=0;const T=getRandomNumber(2800,3200),_=o.targetRotation,h=new Konva.Animation((a=>{if(!a)return;const i=Math.min(a.time/n,1),s=a.time-l;let d;l=a.time,d=i<.3?T*(i/.3)**2:i<.7?T:T*(1-(1-(1-(i-.7)/.3)**3)),O=.95*O+.05*d;const A=O*s/1e3;c+=r?-A:A;const u=(c%360+360)%360;if(e.rotation(u),i>=.95){const t=_-c;if(Math.abs(t)<.1){const t=o.normalizedAngle,a=Math.min((i-.95)/.05,1),n=c*(1-a)+t*a;e.rotation(n),i>=.999&&(e.rotation(t),h.stop())}else{c+=t*((1-20*(1-i))**3*.15);const a=(c%360+360)%360;e.rotation(a)}}t.batchDraw()}),t);return h})(n,L,e).start()}))})(e.haoResults);const n=((e,t,a,n=6e3,i)=>{const{wheelGroup:s,trigramGroup:r,outerWheelGroup:o,layer:l}=e;s.cache(),r.cache(),o.cache();const c=s.rotation();let O=0,T=c,_=0,h=0;const d=e=>{o.opacity(e)},A=o.opacity()??1;d(A);const u=null!==a?a:0;let I,R=0,E=null;const m=e=>1-(1-e)**4,N=e=>{E||(E=e);const c=e-E,f=Math.min(c/n,1),L=e-O;let x;O=e,x=f<.4?3600:3600*m(1-(f-.4)/.6);const C=m(f);let g;if(_=_*(1-.02*C)+x*(.02*C),T+=_*L/1e3,s.rotation(T),r.rotation(-T),g=f<.4?-3600:-3600*m(1-(f-.4)/.6),h=h*(1-.02*C)+g*(.02*C),R+=h*L/1e3,o.rotation(R),f>.4)if(null===a){const e=Math.min((f-.4)/.4,1),t=m(e);d(Math.max(0,A*(1-t)))}else{const e=Math.min((f-.4)/.4,1),t=m(e);d(Math.min(1,A+t))}if(l.batchDraw(),f<1)I=requestAnimationFrame(N);else{const e=t-T,a=u-R;Math.abs(e)>.01||Math.abs(a)>.01?(T+=.1*e,R+=.1*a,s.rotation(T),r.rotation(-T),o.rotation(R),l.batchDraw(),I=requestAnimationFrame(N)):(s.clearCache(),r.clearCache(),o.clearCache(),i())}};return I=requestAnimationFrame(N),{stop:()=>{I&&(cancelAnimationFrame(I),s.clearCache(),r.clearCache(),o.clearCache())}}})({wheelGroup:N,trigramGroup:new A.Group,outerWheelGroup:p,layer:L},t,a,6e3,(()=>{R(!1),setTimeout((()=>{H(!0)}),10)}));n&&g(e)},disabled:u,className:"absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 w-32 h-32 md:w-48 md:h-48 rounded-full border-2 border-gray-300 shadow-lg flex items-center justify-center transition-all disabled:cursor-not-allowed max-md:size-20 "+(u?"bg-black":"bg-white hover:bg-gray-50"),children:e.jsx("span",{className:"font-bold text-lg md:text-2xl "+(u?"text-white":"text-gray-800"),children:"XOAY"})})]}),e.jsx(ResultDisplay,{showResult:M,isSpinning:u,result:C})]})})};export{IChingDiagram as default};