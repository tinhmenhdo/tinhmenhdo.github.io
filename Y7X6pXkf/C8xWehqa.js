import{j as q}from"./C2QZIOQO.js";import{r as ht}from"./mSt8MfY5.js";import{C as F,Z as dt,c as Ct,i as Vt,v as Pt,w as eo,S as no}from"./DLZmOjrQ.js";import{A as ut,h as Yt,L as Q,a as et,c as tt,b as Dt,i as vt,H as io,C as St,j as Ot,S as at,k as Ht,l as Et,m as Gt,F as ro,n as Zt,o as $t,p as Bt,q as Qt,T as Ft,r as ao,g as Xt,s as so,d as lo,G as co}from"./Dseo2fP7.js";import{g as fo}from"./Cpj98o6Y.js";import{_ as Ut,R as ho,L as xo,C as yo,T as uo,A as po,a as wo,K as Jt}from"./CNuNv4A4.js";import{d as gt}from"./CV2G76of.js";import"./DxSTsMFM.js";import"./Bo2Z31qa.js";var jt={exports:{}};!function(t,o){Object.defineProperty(o,"__esModule",{value:!0}),o.Konva=void 0;var e=Ut;Object.defineProperty(o,"Konva",{enumerable:!0,get:function(){return e.Konva}});const n=Ut;t.exports=n.Konva}(jt,jt.exports);var bo=jt.exports;const Wt=fo(bo),st=new ho({x:0,y:0,width:100,height:100,hitStrokeWidth:0,shadowForStrokeEnabled:!1});st.cache();const to=new xo({points:[0,0,-100,-100],stroke:"#fff",strokeWidth:1.5,opacity:1});to.cache();const At=new yo({x:-100,y:-100,radius:10,fill:"#000",stroke:"#000",strokeWidth:.2,opacity:.4,perfectDrawEnabled:!0,hitStrokeWidth:0,shadowForStrokeEnabled:!1,width:100,height:100});At.cache();let ft=new uo({x:500,y:500,text:"",fontStyle:"normal",fontSize:14,fontFamily:"Arial",fill:"#000",strokeWidth:0,perfectDrawEnabled:!0,textDecoration:"",shadowColor:"black",shadowBlur:0,shadowOffset:{x:0,y:0},shadowOpacity:0,hitStrokeWidth:0,shadowForStrokeEnabled:!1,width:10,height:10});ft.cache(),ft=ft.clone({width:"auto",height:"auto"});const kt=new po({x:0,y:0,points:[0,0,250,250],pointerLength:12,pointerWidth:6,fill:"black",stroke:"black",strokeWidth:2.5,opacity:1,perfectDrawEnabled:!0,lineJoin:"round",hitStrokeWidth:0,shadowForStrokeEnabled:!1,width:5,height:5});function Y(t,o,e,n,i=!0){let s={x:500,y:500,text:"",fontStyle:"normal",fontSize:o,fontFamily:e,fill:"#000",strokeWidth:0,perfectDrawEnabled:!0,textDecoration:"",shadowColor:"black",shadowBlur:0,shadowOffset:{x:0,y:0},shadowOpacity:0,hitStrokeWidth:0,shadowForStrokeEnabled:!1};s={...s,...t};const r=ft.clone(s);return i&&typeof n<"u"&&(n.add(r),null!==r&&r.moveToTop()),r}function Kt(t,o,e,n,i,s,r,l,a,c){const d=o[e];let f=!1;const x={fontSize:l+2,shadowEnabled:!0,shadowOpacity:0,shadowForStrokeEnabled:!0,align:"left",perfectDrawEnabled:!0,fontStyle:"bold"};x.x=i,x.y=s+7;let h,y=0;const p=["A","B","C","D"];for(let o=0;o<=3;o+=1)if(d[o]===n){f=!0;const e=c[o],n=a[o],i={x:x.x,y:x.y,radius:8.5,fill:e,stroke:n,strokeWidth:1.5,opacity:.7,hitStrokeWidth:0,shadowForStrokeEnabled:!1};x.text=`${p[o]}`,x.fill=a[o],h=Y(x,l+2,r,t,!1),h.x(h.x()-4.7),h.y(h.y()-6),x.x+=y,x.y+=0;const s=At.clone(i);t.add(s),t.add(h),0===y&&(y=h.getTextWidth()+13)}return f}function Rt(t,o,e,n,i,s,r,l,a,c,d,f,x,h){let y=!1;const p=o[e.cn].indexOf(a);if(p>=0){y=!0;const o=e.ci,c={opacity:.8,points:[r,l,r,l],fill:f[Number(p)],stroke:f[Number(p)],strokeWidth:1.5,pointerLength:15,pointerWidth:8},d=c.points,u=-1!==e.sb.indexOf(a),b=11===o||0===o||1===o||2===o,S=5===o||6===o||7===o||8===o,m=3===o||4===o,g=9===o||10===o,w=x[e.ci],k=e.cno.filter((t=>t===e.ci)).length,W=63===a&&1===k,T=4===h.cfg[F.typeLs]||5===h.cfg[F.typeLs];if(b||S){let t=0;const e=Number(h.ars[o].zolk[0][dt.currentLoc]),r=Number(h.ars[o].zolk[3][dt.currentKi]);t=r>9||e>9?13:r>0||e>0?5:0,t=1===h.cfg[F.locKiToanDo]?t:0,d[0]=n.x+(u?i/2+(b?t:0):i/2-(W?23:2===k?10:6))-15*w,d[1]=d[1]+(u?6:3),d[2]=d[0],d[3]=S?5:b?n.y+s+23:d[3]}m&&(d[0]=n.x+(u||T?45:10),d[1]=d[1]+(u?6:5),d[2]=5,d[3]=d[1]),g&&(d[0]=n.x+i/2+(u?35:T?45:-15),d[1]=d[1]+(u?6:5),d[2]=n.x+i+23,d[3]=d[1]),t.add(kt.clone(c))}return y}function It(t,o,e,n,i,s,r,l,a,c){if(r.cfg[F.showHoaIcon]<1)return!1;let d=!1;const f=o[r.ars[r.dvidx].cn].indexOf(s);return f>=0&&(d=!0,t.add(st.clone({x:n,y:i,width:9,height:9,fill:c[Number(f)],stroke:c[Number(f)],strokeWidth:0,draggable:!1,opacity:.8,perfectDrawEnabled:!0,cornerRadius:0,hitStrokeWidth:0,shadowForStrokeEnabled:!1})),t.add(Y({text:"2",x:n+1.8,y:i+.5,fontSize:l-4,fill:"#fff",shadowBlur:0,shadowOpacity:1,opacity:.9},l,a,t))),d}function _t(t,o,e,n,i,s,r,l,a,c){if(r.cfg[F.showHoaIcon]<2)return!1;const d=i+4.3;let f=!1;const x=o[r.dtv.bs.y[0]].indexOf(s);return x>=0&&(f=!0,t.add(At.clone({x:n+2.8,y:d,radius:5,fill:c[x],strokeWidth:0,opacity:.8,hitStrokeWidth:0,shadowForStrokeEnabled:!1})),t.add(Y({text:"3",x:Number(n+1),y:Number(d-3.8),fontSize:Number(l-4),fill:"#fff",shadowBlur:0,shadowOpacity:1,opacity:.9},l,a,t))),f}function qt(t,o,e,n,i,s,r,l,a,c){if(r.cfg[F.showHoaIcon]<3)return!1;const d=i+4.1;let f=!1;const x=o[r.dtv.bs.m[0]].indexOf(s);return x>=0&&(f=!0,t.add(At.clone({x:n+2.8,y:d,radius:5,fill:c[x],strokeWidth:0,opacity:.8,hitStrokeWidth:0,shadowForStrokeEnabled:!1})),t.add(Y({text:"4",x:Number(n+.7),y:Number(d-3.8),fontSize:Number(l-4),fill:"#fff",shadowBlur:0,shadowOpacity:1,opacity:.9},l,a,t))),f}function oo(t,o,e,n,i,s,r,l,a,c){if(r.cfg[F.showHoaIcon]<4)return!1;const d=i+4.1;let f=!1;const x=o[r.dtv.bs.d[0]].indexOf(s);return x>=0&&(f=!0,t.add(At.clone({x:n+2.8,y:d,radius:5,fill:c[x],strokeWidth:0,opacity:.8,hitStrokeWidth:0,shadowForStrokeEnabled:!1})),t.add(Y({text:"5",x:Number(n+.7),y:Number(d-3.8),fontSize:Number(l-4),fill:"#fff",shadowBlur:0,shadowOpacity:1,opacity:.9},l,a,t))),f}function go(t){const{color:o,colorHoa:e,colorHoaFill:n,fontPhuTinh:i,idx:s,cung:r,fontDV:l,fontFamilySet:a,typeLs:c,pos:d,hafWSquare:f,padContentTop:x,padContentBottom:h,padContent:y,wSquare:p,hSquare:u,cfgLs:b}=t,{ls:S}=t,m=new Wt.Group({});function g(t,o,e=.2,n=0){const i=st.clone({x:t.x()-n/2-2,y:t.y()-n/2-1.8,fill:o,width:t.width()+n+4,height:t.height()+n,perfectDrawEnabled:!0,strokeWidth:0,opacity:e,cornerRadius:4,hitStrokeWidth:0,shadowForStrokeEnabled:!1});return m.add(i),null!==i&&i.moveToTop(),null!==t&&t.moveToTop(),i}function w(t,o){return vt[io[St[t]][St[o]][function(t,o){return Ot[t]===Ot[o]?1:0}(t,o)]]}return function(){let t=ut[r.ai];t=`${ut[r.ai]}`,3===c&&Y({text:r.dv.toString(),fill:"#000",x:-1e4,y:-1e4,fontStyle:"bold"},l,a,m,!1).destroy();let e=S.at===s?`${t}(T)`:t;(4===c||5===c)&&(e=t);const n={text:e,fill:"#000",x:Number(d.x)+f,y:Number(d.y)+x,fontStyle:"bold",align:"left"},i=Y(n,l-1,a,m);if(i.x(i.x()-i.getTextWidth()/2),m.add(ft.clone({x:i.x()-14,y:i.y()-.3,text:"▲",fontStyle:"normal",fontSize:l-1,fontFamily:"Arial",fill:o[Yt[s]],perfectDrawEnabled:!0,opacity:2===Yt[s]?.8:.6,hitStrokeWidth:0,shadowForStrokeEnabled:!1})),0===r.ai||4===r.ai||r.ai,0===r.ai){const t=st.clone({x:d.x+1,y:d.y+1,width:p-1,height:u-1,fill:"#f0e9de",hitStrokeWidth:0,shadowForStrokeEnabled:!1,opacity:.6});m.add(t)}S.am===s&&g(i,n.fill,.3),n.text=r.dv,n.fill=o[Q[r.na]];const h=Y(n,l-1,a,m);h.x(i.x()+i.width()+5);const y=g(h,o[Q[r.na]],.1);let b=!1;if(r.cn===S.dtb.bs.y[0]&&0!==s&&1!==s&&(n.fontStyle="bold",n.text=`${n.text}`,b=!0),b){n.fill="#555",n.text="☸",n.x=i.x()+i.getTextWidth()+2,n.y=i.y(),n.fontSize=l-2,n.shadowBlur=0,n.shadowEnabled=!1;const t=Y(n,l,a,m);h.x(t.x()+t.getTextWidth()+2),y.x(h.x()-2)}}(),1===Number(b[F.rotateZone])&&function(){if(3===c)return;const t={text:`${ut[r.aid]}2`,fill:"#555",x:d.x+y,y:d.y+x,fontStyle:"bold",opacity:.8,fontSize:l-2},o=Y(t,l-3,a,m);r.dvc&&g(o,t.fill,.2)}(),function(){if(4!==c)return;let t=21;1===b[F.batTuCung]&&1==b[F.showSun]&&(t=33),0===Number(b[F.showSun])&&0===b[F.batTuCung]&&(t=12),0===b[F.isNapAmCung]&&(t=2);let o=!1;if(r.ci===S.ars[S.am].cno[0]){o=!0;const i=18,s=18,r=st.clone({x:d.x+y,y:d.y+h-t-4,width:15,height:15,fill:n[0],stroke:e[0],strokeWidth:1,opacity:.7,hitStrokeWidth:0,shadowForStrokeEnabled:!1,cornerRadius:2});m.add(r);const c=Y({text:"A",fill:e[0],x:r.x(),y:r.y(),fontSize:l-2},l-2,a,m);c.x(r.x()+i/2-c.getTextWidth()/2-1),c.y(r.y()+s/2-c.getTextWidth()/2-1.3)}if(r.ci===S.ars[S.am].cno[3]){const i=st.clone({x:d.x+y,y:d.y+h-t-4,width:15,height:15,fill:n[3],stroke:e[3],strokeWidth:1,opacity:.7,hitStrokeWidth:0,shadowForStrokeEnabled:!1,cornerRadius:2});m.add(i);const s=Y({text:"D",fill:e[3],x:i.x(),y:i.y(),fontSize:l-2},l-2,a,m);s.x(i.x()+9-s.getTextWidth()/2-1),s.y(i.y()+9-s.getTextWidth()/2-1.3),o&&(i.x(i.x()+18),s.x(s.x()+18))}}(),function(){if(3===c)return;const t=Y({text:`${ut[r.ail??0]}3`,fill:"#888",x:d.x+p-y,y:d.y+x,fontStyle:"bold",opacity:1},l-2,a,m);if(t.absolutePosition({x:t.x()-t.getTextWidth(),y:d.y+x}),0===b[F.rotateZone]&&t.destroy(),4!==c){const e=Y({text:`${et[r.lmpt[2]].charAt(0)} T${r.lmpt[0]}`,fill:o[Q[r.lmpt[4]]],x:d.x+p-y,y:t.y()+16.5,fontSize:1===b[F.rotateZone]?l-3:l-1,opacity:1},l,a,m);e.x(e.x()-e.getTextWidth()),0===b[F.rotateZone]?e.y(e.y()-16.5):(0===r.ail&&g(t,"#444"),S.dtv.ln.m===r.lmpt[0]&&g(e,"#555"))}}(),function(){const t=`${et[r.cn].charAt(0)}.${tt[r.ci]}`,e=1===b[F.rotateZone]?l-3:l-1;let n=x;1===Number(b[F.rotateZone])&&(n=x+16);const i=Y({text:t,fill:o[Q[r.na]],x:-1e3,y:-1e3,fontSize:e},l,a,m,!1),s={text:t,fill:o[Q[r.na]],x:d.x+y,y:d.y+n,fontSize:e};3===c&&(s.y=d.y+y),Y(s,e,a,m),i.destroy()}(),function(){let t={},e=21;if(1===b[F.batTuCung]&&1==b[F.showSun]&&(e=33),0===Number(b[F.showSun])&&0===b[F.batTuCung]&&(e=12),0===b[F.isNapAmCung]&&(e=2),4!==c&&5!==c){t={text:`V${r.lmnp[0]}`,fill:"#444",x:d.x+y-2,y:d.y+h-e,fontSize:l-2};const n=Y(t,l,a,m);t={},t.x=d.x+y,t.y=d.y+h-e,t.text=`${tt[r.lynp].toUpperCase()}`,t.fill=o[Dt[r.lynp]],t.align="left",t.fontSize=l-3,t.fontStyle="bold";const i=Y(t,l,a,m);S.dtv.bs.y[1]===r.lynp&&g(i,t.fill),n.x(i.x()+i.getTextWidth()+2),S.dtv.ln.m===r.lmnp[0]&&g(n,"#555")}const n=(r.lmpt[1][0]-1+2)%12,i=S.ars[n],s=Y({text:`${et[i.lmpt[2]].charAt(0)}.${tt[i.lmpt[3]]} P${r.lmpt[1][0]}`,fill:o[Q[i.lmpt[4]]],x:d.x+p-y,y:d.y+h-e,fontSize:l-2,opacity:1},l,a,m);s.x(s.x()-s.getTextWidth()),S.dtv.ln.m===r.lmpt[1][0]&&g(s,"#555")}(),1===Number(b[F.isNapAmCung])&&function(){let t=d.y+h;(4===c||5===c)&&(t=d.y+h+7);const e={text:"",fill:o[4],x:d.x+y,y:t,fontSize:i-6,opacity:.7};r.ys.forEach((n=>{const i=e;i.text=n[1],i.fill=o[Q[n[2]]];const r=Y(i,l,a,m);n[1]===S.dtv.sn.y&&1===Number(b[F.showSun])&&g(r,i.fill,.2);const c=r.x()+r.getTextWidth()+4.5;i.text=`${et[n[3]].charAt(0)}`,i.x=r.x(),i.y=r.y()-9;const f=Y(i,l,a,m);i.text=`.${n[0]}`,i.x=f.x()+f.getTextWidth();const x=Y(i,l,a,m);if(n[1]===S.dtv.sn.y&&1===Number(b[F.showSun])&&(g(f,f.fill(),.2),g(x,x.fill(),.2)),0===Number(b[F.showSun])&&(r.destroy(),f.y(i.y+10),x.y(f.y()),n[1]===S.dtv.sn.y&&(g(f,f.fill(),.2),g(x,x.fill(),.2))),1===b[F.batTuCung]){const t=w(S.dtb.bs.d[0],n[3]);i.text="Thương"===t?"Thg":t,i.fill="#444",i.x=r.x(),1===b[F.showSun]?i.y=r.y()-20:i.y=r.y()-10,Y(i,l,a,m)}let h=S.cid;if(S.yeo>=S.cid)for(let t=0;t<120&&!(h+10>=S.yeo+1);t+=10)h+=10;S.yeo>=S.cid&&n[0]>=h&&n[0]<h+10&&m.add(ft.clone({x:f.x()+3,y:3===s||4===s||9===s||10===s?d.y+u-5:d.y+u-5.5,text:"▲",fontStyle:"normal",fontSize:l-5,fontFamily:"Arial",fill:"#555",perfectDrawEnabled:!0,opacity:1,hitStrokeWidth:0,shadowForStrokeEnabled:!1})),i.align="left",i.x=c,i.y=t}))}(),t.layer.add(m),t.layer}function So(t){const{ls:o,color:e,colorHoa:n,colorHoaFill:i,fontPhuTinh:s,cung:r,fontDV:l,fontFamilySet:a,typeLs:c,pos:d,hafWSquare:f,fontChinhTinh:x,hSquare:h,wSquare:y,canHoa:p,thdraw:u}=t,b=new Wt.Group({});function S(t,o=!0){let e={x:500,y:500,text:"",fontStyle:"normal",fontSize:l,fontFamily:a,fill:"#000",strokeWidth:0,perfectDrawEnabled:!0,textDecoration:"",shadowColor:"#fff",shadowBlur:0,shadowOffset:{x:0,y:0},shadowOpacity:0,hitStrokeWidth:0,shadowForStrokeEnabled:!1};e={...e,...t};const n=ft.clone(e);return o&&b.add(n),n}return function(){const t=d.x;let m=d.y+38,g=17;const w={fontSize:x,fontStyle:"normal"};(4===c||5===c)&&(g=25,w.fontSize=x+4,m=d.y+70);const k=typeof r.tu<"u"||typeof r.tu<"u";for(let W=0;W<r.sb.length;W+=1){const T=r.sb[W],F=at[T];if(F.name.length>0){w.text=F.name.toUpperCase(),w.fill=e[F.hh],w.fontStyle="bold";const $=S(w,!1);if(w.x=t+f-$.getTextWidth()/2,w.y=m,4===c){const t={...w,fontSize:x-6,fontStyle:"normal"};if(t.x=w.x,t.y=w.y-9,r.stlk.length>0&&typeof r.stlk[T]<"u"){const o=r.stlk[T];t.text=`${o[0]}A`,t.fill=n[0];const e=S(t);t.text=`${o[1]}D`,t.fill=n[3];const i=S(t),s=e.getTextWidth()+i.getTextWidth()+4;e.x(d.x+f-s/2),i.x(e.x()+e.getTextWidth()+4),0===o[0]&&e.destroy(),0===o[1]&&(i.destroy(),o[0]>0&&e.x(e.x()+e.getTextWidth()+4))}}const v=F.lvl;let B=!1,z="";void 0!==v&&Object.entries(v).forEach((([t,o],e)=>{Number(t)===r.ci+1&&("M"===o||"V"===o)&&(B=!0,z=o),Number(t)===r.ci+1&&"H"===o&&(z=o),Number(t)===r.ci+1&&(z=o)})),4!==c&&5!==c&&B&&!k&&(w.shadowColor=e[F.hh],w.shadowBlur=0,w.shadowOpacity=0,w.shadowOffset={x:0,y:0});let N=S(w);if(!(4===c||5===c)&&z.length>0&&S({text:`(${z})`,fill:e[F.hh],fontSize:s-6,x:w.x+N.getTextWidth()+1,y:w.y-1,fontStyle:w.fontStyle}),3!==c&&void 0!==F.nn){const t=w.x-11,c=w.y;Kt(b,p,o.dtb.bs.y[0],r.sb[W],t,c,a,l,n,i);const f=N.x()+N.getTextWidth();Rt(b,p,r,d,y,h,N.x(),N.y(),r.sb[W],l,a,n,u,o)&&(u[r.ci]+=1);const x=f+14,m=N.y()+1.5,g=It(b,p,r,x,m,r.sb[W],o,l,a,n),k=g?x+12:x,T=_t(b,p,r,k,m,r.sb[W],o,l,a,n),$=T?k+10:g?x+12:x,v=qt(b,p,r,$,m,r.sb[W],o,l,a,n)?$+10:T?k+10:g?x+12:x;oo(b,p,r,v,m,r.sb[W],o,l,a,n),S({text:""+(F.nn[1]>0?"+":"-"),fill:e[F.hh],fontSize:s-3,x:N.x()+N.getTextWidth()+4,y:N.y()+5,fontStyle:w.fontStyle})}N=ft.clone({}),m+=g}}}(),t.layer.add(b),t.layer}function mo(t){const{colorHoaFill60:o,fontPhuTinh:e,idx:n,cung:i,fontDV:s,fontFamilySet:r,typeLs:l,pos:a,hafWSquare:c,hafHSquare:d,colorHoa:f,padContent:x,xBox12:h,yBox34:y,yBox14:p,yBox12:u,xBox34:b,xBox14:S,getGradient:m,typePhiHoa:g,ls:w,countHt:k}=t,W=new Wt.Group({});function T(){const t=[];return t[0]=[{pos:[h+c,y,S+c,p]},{pos:[S+c,y,h+c,p]},{pos:[S,y,b,p]},{pos:[S,u+d,b,p+d]},{pos:[S,p+d,b,u+d]},{pos:[S,p,b,y]},{pos:[S+c,p,h+c,y]},{pos:[h+c,p,S+c,y]},{pos:[b,p,S,y]},{pos:[b,p+d,S,u+d]},{pos:[b,u+d,S,p+d]},{pos:[b,y,S,p]}],t[1]=[{pos:[t[0][0].pos[0]-17,t[0][0].pos[1],t[0][0].pos[2]+17,t[0][0].pos[3]]},{pos:[t[0][1].pos[0]-17,t[0][1].pos[1],t[0][1].pos[2]+17,t[0][1].pos[3]]},{pos:[t[0][2].pos[0]-17,t[0][2].pos[1],t[0][2].pos[2]+17,t[0][2].pos[3]]},{pos:[t[0][3].pos[0],t[0][3].pos[1]-17,t[0][3].pos[2],t[0][3].pos[3]+17]},{pos:[t[0][4].pos[0],t[0][4].pos[1]-17,t[0][4].pos[2],t[0][4].pos[3]+17]},{pos:[t[0][5].pos[0],t[0][5].pos[1]-17,t[0][5].pos[2],t[0][5].pos[3]+17]},{pos:[t[0][6].pos[0]+17,t[0][6].pos[1],t[0][6].pos[2]-17,t[0][6].pos[3]]},{pos:[t[0][7].pos[0]+17,t[0][7].pos[1],t[0][7].pos[2]-17,t[0][7].pos[3]]},{pos:[t[0][8].pos[0]+17,t[0][8].pos[1],t[0][8].pos[2]-17,t[0][8].pos[3]]},{pos:[t[0][9].pos[0],t[0][9].pos[1]+17,t[0][9].pos[2],t[0][9].pos[3]-17]},{pos:[t[0][10].pos[0],t[0][10].pos[1]+17,t[0][10].pos[2],t[0][10].pos[3]-17]},{pos:[t[0][11].pos[0],t[0][11].pos[1]+17,t[0][11].pos[2],t[0][11].pos[3]-17]}],t[2]=[{pos:[t[0][0].pos[0]+17,t[0][0].pos[1],t[0][0].pos[2]-17,t[0][0].pos[3]]},{pos:[t[0][1].pos[0]+17,t[0][1].pos[1],t[0][1].pos[2]-17,t[0][1].pos[3]]},{pos:[t[0][2].pos[0],t[0][2].pos[1]+17,t[0][2].pos[2],t[0][2].pos[3]-17]},{pos:[t[0][3].pos[0],t[0][3].pos[1]+17,t[0][3].pos[2],t[0][3].pos[3]-17]},{pos:[t[0][4].pos[0],t[0][4].pos[1]+17,t[0][4].pos[2],t[0][4].pos[3]-17]},{pos:[t[0][5].pos[0]-17,t[0][5].pos[1],t[0][5].pos[2]+17,t[0][5].pos[3]]},{pos:[t[0][6].pos[0]-17,t[0][6].pos[1],t[0][6].pos[2]+17,t[0][6].pos[3]]},{pos:[t[0][7].pos[0]-17,t[0][7].pos[1],t[0][7].pos[2]+17,t[0][7].pos[3]]},{pos:[t[0][8].pos[0],t[0][8].pos[1]-17,t[0][8].pos[2],t[0][8].pos[3]+17]},{pos:[t[0][9].pos[0],t[0][9].pos[1]-17,t[0][9].pos[2],t[0][9].pos[3]+17]},{pos:[t[0][10].pos[0],t[0][10].pos[1]-17,t[0][10].pos[2],t[0][10].pos[3]+17]},{pos:[t[0][11].pos[0]+17,t[0][11].pos[1],t[0][11].pos[2]-17,t[0][11].pos[3]]}],t[3]=[{pos:[t[0][0].pos[0]-34,t[0][0].pos[1],t[0][0].pos[2]+34,t[0][0].pos[3]]},{pos:[t[0][1].pos[0]-34,t[0][1].pos[1],t[0][1].pos[2]+34,t[0][1].pos[3]]},{pos:[t[0][2].pos[0]-34,t[0][2].pos[1],t[0][2].pos[2]+34,t[0][2].pos[3]]},{pos:[t[0][3].pos[0],t[0][3].pos[1]-34,t[0][3].pos[2],t[0][3].pos[3]+34]},{pos:[t[0][4].pos[0],t[0][4].pos[1]-34,t[0][4].pos[2],t[0][4].pos[3]+34]},{pos:[t[0][5].pos[0],t[0][5].pos[1]-34,t[0][5].pos[2],t[0][5].pos[3]+34]},{pos:[t[0][6].pos[0]+34,t[0][6].pos[1],t[0][6].pos[2]-34,t[0][6].pos[3]]},{pos:[t[0][7].pos[0]+34,t[0][7].pos[1],t[0][7].pos[2]-34,t[0][7].pos[3]]},{pos:[t[0][8].pos[0]+34,t[0][8].pos[1],t[0][8].pos[2]-34,t[0][8].pos[3]]},{pos:[t[0][9].pos[0],t[0][9].pos[1]+34,t[0][9].pos[2],t[0][9].pos[3]-34]},{pos:[t[0][10].pos[0],t[0][10].pos[1]+34,t[0][10].pos[2],t[0][10].pos[3]-34]},{pos:[t[0][11].pos[0],t[0][11].pos[1]+34,t[0][11].pos[2],t[0][11].pos[3]-34]}],t}function $(t){const o=[!0,!1];return[o[0],o[1],o[0],o[0],o[0],o[1],o[1],o[0],o[0],o[1],o[1],o[1]][w.ars[t].ai]}function v(t){return t.charAt(0).toUpperCase()+t.slice(1)}function B(t){return function(t){let o=Number(t);return o>11&&(o-=12),o}(t+6)}function z(t,o,e=!1){const i=[[],[],[],[],[],[]];if(n===t||t===B(n))return[-2e3,-2e3,-2e3,-2e3,-2e3,-2e3];const s=T(),r=s[0][n],l=s[3][t];i[0]=r.pos[0],i[1]=r.pos[1],i[4]=l.pos[0],i[5]=l.pos[1],(6===t||7===t)&&(i[4]+=15);const a=(i[4]-i[0])/2,c=(i[5]-i[1])/2,d=i[0]+a,f=i[1]+c,x=[];return x[0]=[[-2e3,-2e3],[d,f-30],[d-10,f-50],[d+10,f-30],[d+30,f-30],[d+30,f-50],[d-10,f-80],[d-50,f],[d-40,f-30],[d-30,f-15],[d-10,f-15],[d,f-30]],x[1]=[[d,f-25],[-2e3,-2e3],[d,f-30],[d+15,f-15],[d+30,f-10],[d+30,f-30],[d+30,f],[d-10,f-80],[d-50,f-50],[d-30,f-30],[d-10,f-40],[d-10,f-40]],x[2]=[[d,f-45],[d,f-25],[-2e3,-2e3],[d+20,f],[d+30,f-10],[d+80,f],[d+40,f-40],[d+10,f+75],[d-10,f-80],[d-10,f-50],[d-30,f-30],[d,f-80]],x[3]=[[d+15,f-40],[d+20,f-20],[d+30,f],[-2e3,-2e3],[d+30,f-10],[d+40,f-10],[d+40,f-10],[d+10,f+60],[d+30,f+50],[d-10,f-80],[d,f-30],[d+30,f-35]],x[4]=[[d+30,f-30],[d+25,f-10],[d+40,f+20],[d+30,f],[-2e3,-2e3],[d+30,f],[d+15,f+15],[d+10,f+35],[d+20,f+50],[d,f+40],[d-10,f-80],[d-10,f-80]],x[5]=[[d+40,f-10],[d+25,f-5],[d+80,f],[d+50,f-5],[d+20,f-10],[-2e3,-2e3],[d,f+25],[d+10,f+30],[d,f+80],[d+10,f+50],[d-30,f+40],[d-10,f-80]],x[6]=[[d-30,f-30],[d+30,f],[d+30,f+20],[d+30,f+25],[d+20,f+20],[d-10,f+25],[-2e3,-2e3],[d,f+25],[d-10,f+40],[d-10,f+30],[d-40,f+40],[d-50,f+40]],x[7]=[[d-30,f-30],[d-30,f-30],[d+40,f+20],[d+40,f+40],[d+10,f+30],[d+10,f+40],[d+10,f+25],[-2e3,-2e3],[d,f+25],[d-20,f+20],[d-30,f-10],[d-35,f]],x[8]=[[d-30,f-30],[d-50,f-10],[d-40,f-20],[d+20,f+60],[d-10,f+40],[d+10,f+80],[d,f+30],[d,f+20],[-2e3,-2e3],[d-25,f],[d-40,f],[d-50,f-10]],x[9]=[[d-30,f-30],[d-30,f-30],[d-20,f-90],[d-40,f-20],[d,f+60],[d-10,f+40],[d-10,f+40],[d-15,f+15],[d-25,f-10],[-2e3,-2e3],[d-30,f-10],[d-50,f-10]],x[10]=[[d-20,f-20],[d-10,f-35],[d-5,f-40],[d,f-50],[d-10,f-80],[d-30,f+40],[d-10,f+40],[d-25,f+10],[d-60,f],[d-30,f-10],[-2e3,-2e3],[d-25,f]],x[11]=[[d,f-25],[d-30,f-30],[d,f-80],[d+10,f-50],[d+30,f-30],[d-10,f-80],[d-50,f-20],[d-25,f+5],[d-80,f],[d-40,f-10],[d-20,f],[-2e3,-2e3]],i[2]=x[n][t][0],i[3]=x[n][t][1],e&&(i[2]=i[2]+Math.floor(30*Math.random())+10,i[3]=i[3]+Math.floor(30*Math.random())+10),i}function N(t){const o=f[3],e=i.cno[3],n={fill:o,stroke:o,pointerLength:11,pointerWidth:4,tension:.5,opacity:.5,strokeWidth:1,dash:[8,4]};n.points=z(e),$(e)&&(n.strokeWidth=1.7,n.opacity=.7),(4===l||5===l)&&(n.opacity=.7,n.strokeWidth=1.5,$(e)&&(n.opacity=.9,n.strokeWidth=2)),n.stroke=m(n.points,o,o),W.add(kt.clone(n))}return 3!==l&&(function(){const t={text:"T.HÓA",fill:f[3],x:a.x,y:a.y+x+s+2.7,fontSize:e-4,opacity:.7,fontStyle:"normal"},o=[],l=[];let d=0;for(let l=0;l<=3;l+=1)t.text=`${v(ut[w.ars[i.cno[l]].ai].toLowerCase())}`,t.fill=f[l],t.fontStyle=$(i.cno[l])?"bold":"normal",t.opacity=.8,o[l]=Y(t,s,r,W),t.x=t.x+o[l].getTextWidth()+2.3,d=d+o[l].getTextWidth()+2.3,i.cno[l]===n&&(o[l].text("✱"),o[l].fontSize(e-3));let h=a.x+c-d/2+4;for(let i=0;i<=3;i+=1)o[i].absolutePosition({x:h,y:t.y}),h=o[i].x()+o[i].getTextWidth()+2.3,1===w.cfg[F.tuanHoanZone]&&w.loopPT[i].forEach(((t,c)=>{if(t.includes(n)){const t={text:["⇄","⇅","⟳","⟲","⇊"][c],fill:f[i],x:o[i].x()+o[i].getTextWidth()/2-3.5,y:a.y+x+s+(0===c?10:12),fontSize:e-5,opacity:1,fontStyle:"normal"};void 0===l[i]&&(l[i]=[]),l[i][c]=Y(t,s,r,W)}}))}(),1===w.cfg[F.locKiToanDo]&&function(){const t=i.zolk[0][dt.currentLoc],o=i.zolk[3][dt.currentKi];let x=null,h=null,y=null;const p="∞",u={text:"",fill:"",x:a.x+c,y:a.y+2*d-48,fontSize:4===l?e+2:e-2,opacity:4===l?1:.8,fontStyle:"bold"},b=4===l||5===l?"A":"",S=4===l||5===l?"D":"";if(t>0)if(Ct(w.loopLP[0],n))if(0===i.zolk[0][dt.locKeep])u.text=t.toString()+b+p,u.fill=f[0],x=Y(u,s,r,W),x.x(x.x()-x.getTextWidth()/2);else{const o=t-i.zolk[0][dt.locKeep];u.text=o>0?i.zolk[0][dt.locKeep].toString()+b:t.toString()+b,u.fill=f[0],x=Y(u,s,r,W),x.x(x.x()-x.getTextWidth()/2),o>0&&(u.text=o+p,h=Y(u,s,r,W),h.x(h.x()-h.getTextWidth()/2))}else u.text=t.toString()+b,u.fill=f[0],x=Y(u,s,r,W),x.x(x.x()-x.getTextWidth()/2);else Ct(w.loopLP[0],n)&&0===t&&(u.text=p,u.fill=f[0],u.fontSize=e,x=Y(u,s,r,W),x.x(x.x()-x.getTextWidth()/2));o>0||Ct(w.loopLP[3],n)?(x&&x.y(x.y()-15),h&&h.y(h.y()-30)):h&&h.y(h.y()-15),o>0?(u.text=o.toString()+S+(Ct(w.loopLP[3],n)?p:""),u.fill=f[3],y=Y(u,s,r,W),y.x(y.x()-y.getTextWidth()/2)):Ct(w.loopLP[3],n)&&0===o&&(u.text=p,u.fill=f[3],u.fontSize=e,y=Y(u,s,r,W),y.x(y.x()-y.getTextWidth()/2)),x&&W.add(x),h&&W.add(h),y&&W.add(y),x&&x.moveToTop(),h&&h.moveToTop(),y&&y.moveToTop()}(),(0===l||1===l||4===l||6===l||8===l)&&function(t){const e=f[t],n=i.cno[t];let s=!1;(0===t||3===t)&&(s=1===i.zolk[t][0===t?dt.isMoveLoc:3===t?dt.isMoveKi:3]);const r={fill:e,stroke:e,pointerLength:11,pointerWidth:5,tension:.6,opacity:.6,strokeWidth:.4};switch(t){case 0:case 1:case 2:s&&N()}if(n<0||n===i.ci)return;r.points=z(n);const a=i.cno[3];3!==t&&n===a&&(r.points=z(n,0,!0));const c=$(n),d=s&&3===t;c&&(r.strokeWidth=1.5,r.opacity=.7),d&&(r.dash=[7,3],r.opacity=.8,r.strokeWidth=2),d&&c&&(r.opacity=.9),(4===l||5===l)&&(r.strokeWidth=1.7,r.opacity=r.opacity+.2),r.stroke=m(r.points,e,o[t]),W.add(kt.clone(r))}(g),function(){const t=T();for(let o=0;o<=3;o+=1){const e=B(n),s=i.cno[o]===e,r=1===i.zolk[0][dt.isMoveLoc],a=1===i.zolk[3][dt.isMoveKi];if(s&&4!==l||4===l&&g===o&&s||1===l&&g===o&&s||8===l&&g===o&&s||s&&r&&3===o&&1!==g&&2!==g){const i=k[e]??0,s=k[n]??0;let c=s;i>s&&(k[n]=i,c=i);const d=t[c][n];if(g===o||1!==l&&8!==l||r&&3===o){const t=f[o],e={opacity:.8,points:d.pos,fill:t,stroke:t,strokeWidth:2.5,pointerLength:20,pointerWidth:8};(a&&3===g||r&&0===g&&3===o)&&(0===l||1===l||4===l||8===l)&&3===o&&(e.dash=[12,3]),4===l&&(e.strokeWidth=3),W.add(kt.clone(e))}k[n]=c+1,k[e]=k[n]}}}()),t.layer.add(W),t.layer}function To(t){const{ls:o,color:e,colorHoa:n,colorHoaFill:i,fontChinhTinh:s,fontPhuTinh:r,cung:l,fontDV:a,fontFamilySet:c,typeLs:d,pos:f,padContentBottom:x,padContent:h,wSquare:y,hafWSquare:p,hSquare:u,cfgLs:b,canHoa:S,thdraw:m}=t,g=new Wt.Group({});function w(t,o=!0){let e={x:500,y:500,text:"",fontStyle:"normal",fontSize:a,fontFamily:c,fill:"#000",shadowForStrokeEnabled:!1,strokeWidth:0,perfectDrawEnabled:!0,textDecoration:"",shadowColor:"black",shadowBlur:0,shadowOffset:{x:0,y:0},shadowOpacity:0};e={...e,...t};const n=ft.clone(e);return o&&g.add(n),n}function k(t,x,k,W,T=!1,$=r){if(4===d||5===d)return 1===k.zone&&0===W?function(t,r,x){if(![60,61,62,63].includes(x.id-1))return r;const h={fontSize:s+4,fontStyle:"normal"};h.x=t+p,h.y=r,h.text=x.name.toUpperCase(),h.fill=e[x.hh],h.fontStyle="bold";const b=w(h),k=b.y();b.x(b.x()-b.getTextWidth()/2);const W=x.id-1;if(4===d){const t={...h,fontSize:s-6,fontStyle:"normal"};if(t.x=h.x,t.y=h.y-9,l.stlk.length>0&&typeof l.stlk[W]<"u"){const o=l.stlk[W];t.text=`${o[0]}A`,t.fill=n[0];const e=w(t);t.text=`${o[1]}D`,t.fill=n[3];const i=w(t),s=e.getTextWidth()+i.getTextWidth()+4;e.x(f.x+p-s/2),i.x(e.x()+e.getTextWidth()+4),0===o[0]&&e.destroy(),0===o[1]&&(i.destroy(),o[0]>0&&e.x(e.x()+e.getTextWidth()+4))}}if([60,61,62,63].indexOf(W)>-1){const t=b.x()-11,e=b.y();Kt(g,S,o.dtb.bs.y[0],W,t,e,c,a,n,i);const s=b.x()+b.getTextWidth()+5,r=b.y()-.5;Rt(g,S,l,f,y,u,s,r,W,a,c,n,m,o)&&(m[l.ci]+=1);const d=b.x()+b.getTextWidth()+3,x=b.y()+4,h=It(g,S,l,d,x,W,o,a,c,n)?d+12:d,p=_t(g,S,l,h,x,W,o,a,c,n)?h+10:h+3;qt(g,S,l,p,x,W,o,a,c,n)}return k+25}(t,x,k):x;const v=W>0,B=k.id-1,z=b[F.showHideStar];if(z>0&&!v&&(1===z&&!Ht.includes(B)||2===z&&!Ht.includes(B)&&!Et.includes(B)||3===z&&!Ht.includes(B)&&!Et.includes(B)&&!Gt.includes(B)||4===z&&!Ht.includes(B)&&!Et.includes(B)&&!Gt.includes(B)&&!ro.includes(B)))return x;const N=$-1;if([64,65,66,67].includes(B)&&v)return x;const C=void 0!==k.cir,E=k.iptt,q={text:k.name,x:t,y:x,fontSize:$-1,fill:e[k.hh],width:C&&"vts"===k.cir?y:"auto",opacity:1,align:"center",shadowEnabled:!1,shadowOpacity:0,shadowForStrokeEnabled:!1,textDecoration:""};W>0&&(q.fontSize=q.fontSize-2,q.y=q.y+1.6),v?(q.fontStyle="italic",q.opacity=.9):(1===Number(b[F.shortStar])&&(q.text=k.sht),E?(q.fontStyle="bold",q.shadowColor=e[k.hh],q.shadowBlur=0,q.shadowOffset={x:0,y:0},q.shadowOpacity=.8):(q.shadowOpacity=0,q.fontStyle="normal",q.textDecoration="",C&&("vbs"===k.cir||k.cir)));const D=w(q,!1);T&&(q.x=t-D.getTextWidth());const Y=typeof l.tu<"u"||typeof l.tr<"u",j=k.lvl;let H="",O=0,L=!1;void 0!==j&&Object.entries(j).forEach((([t,o],e)=>{Number(t)===l.ci+1&&(H=o,O=5.5,L=!0)})),void 0!==k.lvl&&"Đ"===H&&!Y&&!v&&(q.shadowColor=e[k.hh],q.shadowBlur=0,q.shadowOffset={x:0,y:0},q.shadowOpacity=.8,w(q)),k.lvl;const M=w(q);if(W>0){const t={...q};switch(W){case 1:t.text="Đ.";break;case 2:t.text="L.";break;case 3:t.text="T."}t.fontSize=t.fontSize-2,2===k.typ?M.x(M.x()-h+3.5):M.x(M.x()+8),t.x=M.x()-8,t.y=M.y()+1.5,w(t)}const P=k.id-1;if(!v&&[60,61,62,63].indexOf(P)>-1&&3!==d){O=0===O?O+3:O;const t=M.x()+M.getTextWidth()+O+9,e=M.y()-1,s=Kt(g,S,o.dtb.bs.y[0],P,t,e,c,a,n,i),r=M.x()+M.getTextWidth()+O+(s?22:5),d=M.y()+1;Rt(g,S,l,f,y,u,r,d,P,a,c,n,m,o)&&(m[l.ci]+=1);const x=M.x()+M.getTextWidth()+O+(s?20:2),h=M.y()+2,p=It(g,S,l,x,h,P,o,a,c,n),b=p?x+12:x,w=_t(g,S,l,b,h,P,o,a,c,n),k=w?b+11:p?x+12:x,W=qt(g,S,l,k,h,P,o,a,c,n)?k+11:w?b+11:p?x+12:x;oo(g,S,l,W,h,P,o,a,c,n)}return L&&!v&&(q.x+=M.getTextWidth(),q.y-=1,q.text=H,q.fontSize=r-6,q.fontStyle="normal",q.opacity=1,q.shadowOpacity=0,w(q)),D.destroy(),x+N}function W(t,e,n,i,s,r=0){const l=b[F.currentStar];for(let a=0;a<t.length;a+=1){if(r>0){let e=!1,n=o.istc?[...Zt,58,59,62,63]:Zt;if(n=1===l?n:2===l?[...n,25,37,82,83,85,86]:[],n.length>0&&!n.includes(t[a])&&(e=!0),!o.istc&&[62,63].includes(t[a])&&(e=!0),e)continue}if(0===Number(b[F.isADSat])&&(123===t[a]||124===t[a]||125===t[a]))continue;const c=at[t[a]];void 0!==c.cir&&"vts"===c.cir||(1===c.typ&&(n=k(e,n,c,r)),2===c.typ&&(s=k(i,s,c,r,!0)))}return[n,s]}return function(){let t=f.x+h,o=f.y+73;const e=o,n=f.x+y-h-2;let i=e;if(4===d||5===d){const e=l.sb.length,n=25,s=f.y+70,r=[s,s+n,s+2*n];t=f.x,o=r[e],i=o}const s=f.x;let r=f.y+x-21;if(1===b[F.batTuCung]&&1===b[F.showSun]&&(r=f.y+x-35),0===b[F.batTuCung]&&0===b[F.showSun]&&(r=f.y+x-10),4!==d&&5!==d)for(let t=0;t<l.ss.length;t+=1){const o=at[l.ss[t]];void 0!==o.cir&&"vts"===o.cir&&(r=k(s,r,o,0,!1,13))}const a=W(l.ss,t,o,n,i,0);let c=a;1===b[F.dvStar]&&(c=W(l.sv,t,a[0],n,a[1],1)),b[F.currentStar]>0&&W(l.sy,t,c[0],n,c[1],2)}(),t.layer.add(g),t.layer}function Co(t){let o=t.layer;const e=new Wt.Group({}),n=[{x:Number(t.xBox12),y:Number(t.yBox34)},{x:Number(t.xBox14),y:Number(t.yBox34)},{x:Number(t.xBox),y:Number(t.yBox34)},{x:Number(t.xBox),y:Number(t.yBox12)},{x:Number(t.xBox),y:Number(t.yBox14)},{x:Number(t.xBox),y:Number(t.yBox)},{x:Number(t.xBox14),y:Number(t.yBox)},{x:Number(t.xBox12),y:Number(t.yBox)},{x:Number(t.xBox34),y:Number(t.yBox)},{x:Number(t.xBox34),y:Number(t.yBox14)},{x:Number(t.xBox34),y:Number(t.yBox12)},{x:Number(t.xBox34),y:Number(t.yBox34)}];let i,s;const r=[0,0,0,0,0,0,0,0,0,0,0,0,0],l=[0,0,0,0,0,0,0,0,0,0,0,0,0];for(let e=0;e<12;e+=1)i=n[e],s={idx:Number(e),cung:t.ls.ars[e],pos:i,thdraw:l},o=go({...s,...t}),o=So({...s,...t}),o=To({...s,...t}),o=mo({countHt:r,...s,...t});function a(o,n,i,s,r="#fff",l="#666",a=!1){let c=a?50:43;n>0&&(c=a?33:17);const d={x:Number(i[0])-c/2+(n>0?35:0),y:Number(i[1])-4.5,text:o,fill:r,width:c,align:"center",fontSize:9,perfectDrawEnabled:!0,opacity:1,shadowColor:"#000",shadowBlur:0,shadowOpacity:0,shadowOffset:{x:0,y:0}},f=Y(d,t.fontDV,t.fontFamilySet,e),x=st.clone({x:f.x()-5,y:f.y()-0,fill:l,width:f.width()+10,height:f.height()+0,perfectDrawEnabled:!0,strokeWidth:0,opacity:1,cornerRadius:6,stroke:"#222",hitStrokeWidth:0,shadowForStrokeEnabled:!1});e.add(x),null!==x&&x.moveToTop(),null!==f&&f.moveToTop(),(6==s||0==s)&&(0===n&&!a&&(f.absolutePosition({x:d.x+17,y:d.y+18}),x.absolutePosition({x:f.x(),y:f.y()+5})),0===n&&a&&(f.absolutePosition({x:d.x+21,y:d.y+18}),x.absolutePosition({x:f.x(),y:f.y()+5})),2===n&&!a&&(f.absolutePosition({x:d.x-31,y:d.y-50}),x.absolutePosition({x:f.x(),y:f.y()+5})),2===n&&a&&(f.absolutePosition({x:d.x-23,y:d.y-50}),x.absolutePosition({x:f.x(),y:f.y()+5})),f.rotation(-90),x.rotation(-90))}return 5===t.typeLs||6===t.typeLs||function(){const i=t.ls.ttr[0],s=t.ls.ttr[2];if(0!==i.length||0!==s.length){const r=[[n[0].x,n[0].y+t.hafHSquare],[n[2].x+t.hafWSquare,n[2].y],[n[4].x+t.hafWSquare,n[4].y],[n[7].x,n[7].y+t.hafHSquare],[n[9].x+t.hafWSquare,n[9].y],[n[11].x+t.hafWSquare,n[11].y]];if(0!==i.length){const t=i[0],o=i[1];t[0]===o[0]?a("Tuần-Triệt",0,r[t[0]/2],o[0],"#fff","#111",!0):(a("Tuần",0,r[t[0]/2],t[0],"#fff","#777",!1),a("Triệt",0,r[o[0]/2],o[0],"#fff","#333",!1))}if(0!==s.length&&1===t.ls.cfg[F.lnTuTr]){const t=s[0],o=s[1];t[0]===o[0]?a("⊙-⊠",2,r[t[0]/2],o[0],"#fff","rgba(17, 17, 17, 1)",!0):(a("⊙",2,r[t[0]/2],t[0],"#fff","rgba(119, 119, 119, 1)",!1),a("⊠",2,r[o[0]/2],o[0],"#fff","rgba(51, 51, 51, 1)",!1))}o.add(e)}}(),o}function ko(t){const{ls:o,xBox:e,borderOutWith:n,hafBorderOut:i,yBox:s,xBox14:r,yBox14:l,xBox12:a,yBox12:c,xBox34:d,yBox34:f,xBox4:x,yBox4:h,hafBorderIn:y,borderInnerWith:p}=t;return function(){const t=["#000000","#000000","#000000"][o.cfg[F.tcpb]];return[{points:[r+y,s-y,r+y,h+i],color:t,strokeWidth:p},{points:[a+y,s-y,a+y,l+y],color:t,strokeWidth:p},{points:[a+y,f+y,a+y,h+i],color:t,strokeWidth:p},{points:[d+y,s-y,d+y,h+i],color:t,strokeWidth:p},{points:[e,l+y,x+i,l+y],color:t,strokeWidth:p},{points:[e,c+y,r+y,c+y],color:t,strokeWidth:p},{points:[d+y,c+y,x+i,c+y],color:t,strokeWidth:p},{points:[e,f+y,x+i,f+y],color:t,strokeWidth:p}].concat([{points:[e-i,s-i,a+y,s-i],color:t,strokeWidth:n},{points:[a,s-i,d+y,s-i],color:t,strokeWidth:n},{points:[d+y,s-i,x+i,s-i],color:t,strokeWidth:n},{points:[x+i,s-i,x+i,c+y],color:t,strokeWidth:n},{points:[x+i,c+y,x+i,f+y],color:t,strokeWidth:n},{points:[x+i,f+y,x+i,h+i],color:t,strokeWidth:n},{points:[x+i,h+i,a+y,h+i],color:t,strokeWidth:n},{points:[a,h+i,r+y,h+i],color:t,strokeWidth:n},{points:[r+y,h+i,e-i,h+i],color:t,strokeWidth:n},{points:[e-i,h+i,e-i,c+y],color:t,strokeWidth:n},{points:[e-i,c+y,e-i,l+y],color:t,strokeWidth:n},{points:[e-i,l+y,e-i,s-i],color:t,strokeWidth:n}])}().forEach((o=>{t.layer.add(to.clone({points:o.points,stroke:o.color,strokeWidth:1.5,opacity:1}))})),t.layer}function Wo(t){const{wSquare:o,xBox12:e,xBox14:n,yBox14:i,yBox34:s,borderInnerWith:r,ls:l,fontCenter:a,fontFamilySet:c,color:d,fontDV:f,cfgLs:x}=t,h=new wo.Group({}),y=1===Number(x[F.batTuCenter]);function p(t){let o={x:500,y:500,text:"",fontStyle:"normal",fontSize:f,fontFamily:c,fill:"#000",strokeWidth:0,textDecoration:"",shadowColor:"black",shadowBlur:0,shadowOffset:{x:0,y:0},shadowOpacity:0,hitStrokeWidth:0,shadowForStrokeEnabled:!1,perfectDrawEnabled:!0};o={...o,...t};const e=ft.clone(o);return h.add(e),e}function u(t){return p({...t,fontStyle:"normal",width:2*o+r,align:"center"})}function b(t,e,n,i){return function(t,e,n,i){const s=o/2-2.5,r=o/10,c=s+t,f={x:t,y:e,fill:"rgba(0, 0, 0, 0.07)",width:s,height:y?2.1*s:1.35*s,perfectDrawEnabled:!0,strokeWidth:1,opacity:1,cornerRadius:6,hitStrokeWidth:1,shadowForStrokeEnabled:!1},x=st.clone(f);h.add(x),p({text:Ot[n.cn]>0?"+":"-",x:x.x(),y:x.y()+2,fill:"#777",fontSize:a+1,width:s,align:"center",fontStyle:"normal",fontFamily:"Arial"});const u=p({text:`${i}`,x:x.x(),y:x.y()+r,fontSize:a,width:s,align:"center",fontStyle:"bold"});let b=u.x(),S=u.y();if(y){const t=p({text:`${-1===n.cht?"Nhật chủ":vt[n.cht]}`,x:u.x(),y:u.y()+r+3,fontSize:a,width:s,align:"center"});b=t.x(),S=t.y()}const m=p({text:`${et[n.cn].toUpperCase()}`,x:b,y:S+r+6,fill:d[St[n.cn]],fontSize:a+1,fontStyle:"bold",width:s,align:"center"}),g=p({text:`${tt[n.ci].toUpperCase()}`,x:m.x(),y:m.y()+r,fill:d[Dt[n.ci]],fontSize:a+1,fontStyle:"bold",width:s,align:"center"});if(b=g.x(),S=g.y(),y){const t=s/n.ctg.length,o=a-2;let e=0,i=g.y();n.ctg.forEach((n=>{const s=p({text:`${et[n]}`,x:0===e?g.x():e,y:g.y()+r,fill:d[St[n]],fontSize:o,width:t,align:"center"}),c=vt[Vt(l.dtb.bs.d[0],n)],f=t-2,x=p({text:c,x:s.x(),y:s.y()+r+2,fontSize:a-2,width:"Thương"===c?f+8:f,align:"center",fill:"#000"});e=s.x()+t,i=x.y()}));const c=r+3,f=p({text:`${so[n.ts]}`,x:g.x(),y:i+c,fontSize:a-2,width:s,align:"center"});b=f.x(),S=f.y()}const w=r+5,k=a-2;return p({text:`${lo[n.na]}`,x:b,y:S+w,fill:d[Q[n.na]],fontSize:k,width:s,align:"center"}),c}(t,e,n,1===x[F.showSun]?i:"")}return function(){if(void 0===l)return[];h.destroyChildren(),p({text:`Ver ${t.version}`,x:n+10,y:s-48,fill:"#000",align:"center",width:2*o-20,fontSize:a-4,opacity:.3,fontVariant:"normal"}),function(){const t="VGluaE1lbmhEby5jb20=",e=(()=>{try{return window.atob(t)}catch{return""}})();p({text:e,x:n,y:s-36,fill:"#b06200",align:"center",width:2*o,fontSize:a-1,opacity:.8,fontVariant:"normal"})}(),function(){const t="TG_FpIHPz";let e=`Loại lá số ${x[F.typeLs]+1}`;if([6,7,8].includes(x[F.typeLs])){const o=["1","2","3"];e+=` - ${t.substring(0,3)}${o[x[F.tcpb]]}`}p({text:e+" - Can Hóa "+(l.cfg[F.lsCanType]+1)+` - lập lúc ${gt().format("YYYY/MM/DD HH:mm")}`,x:n,y:s-20,fill:"#000",align:"center",width:2*o,fontSize:a-2,opacity:.8,fontVariant:"normal"})}();const c=a-1;let f=ut[l.ars[l.at].ai];f=f.charAt(0)+f.slice(1).toLowerCase();const S=l.dtv.bs,m=a-1.5,g=[[{text:`${l.adye>0?"Dương":"Âm"} ${l.sx>0?"Nam":"Nữ"}`,fontStyle:"normal"},{text:`${l.yeo} tuổi`,fontStyle:"bold",align:"center"},{text:"âm lịch",fontStyle:"normal"},{text:"giờ",fontStyle:"normal"},{text:`${tt[l.dtb.bs.h[1]]}`,fontStyle:"bold"},{text:"ngày",fontStyle:"normal"},{text:`${l.dtb.ln.d}`,fontStyle:"bold"},{text:"tháng",fontStyle:"normal"},{text:`${l.dtb.ln.m}`,fontStyle:"bold"},{text:"năm",fontStyle:"normal"},{text:et[l.dtb.bs.y[0]],fontStyle:"bold",fill:d[St[l.dtb.bs.y[0]]]},{text:tt[l.dtb.bs.y[1]],fontStyle:"bold",fill:d[Dt[l.dtb.bs.y[1]]]}],[{text:"Mệnh",fontStyle:"normal"},{text:$t[Q[l.dtb.bs.y[2]]],fontStyle:"bold",fill:d[Q[l.dtb.bs.y[2]]]},{text:"cục"},{text:$t[l.cid],fontStyle:"bold",fill:d[l.cid]},{text:`- ${l.ad>0?Bt[1]:Bt[0]} - ${Qt[l.sks]}`}],[{text:"Thân cư",fontStyle:"normal"},{text:`${f}`,fontStyle:"bold"},{text:"- Mệnh chủ"},{text:at[l.mctc[0]].name,fontStyle:"bold",fill:d[at[l.mctc[0]].hh]},{text:"- Thân chủ"},{text:at[l.mctc[1]].name,fontStyle:"bold",fill:d[at[l.mctc[1]].hh]}],[{text:"Năm xem "+l.dtv.sn.y+" ÂL: ",x:n+10,fontSize:m},{text:`${et[S.y[0]]} ${tt[S.y[1]]} - `,fill:d[Q[S.y[2]]],fontSize:m},{text:`${et[S.m[0]]} ${tt[S.m[1]]}(${l.dtv.ln.m}) - `,fill:d[Q[S.m[2]]],fontSize:m},{text:`${et[S.d[0]]} ${tt[S.d[1]]}(${l.dtv.ln.d}) - `,fill:d[Q[S.d[2]]],fontSize:m},{text:`${et[S.h[0]]} ${tt[S.h[1]]}`,fill:d[Q[S.h[2]]],fontSize:m}]],w=function(t,o,e){return Array.from({length:e},((e,n)=>t+n*o))}(i+15,16,4);(function(t,o,n){t.forEach(((t,i)=>{!function(t,o,n){let i=0;t.forEach((t=>{i+=function({text:t,fontSize:o,fontStyle:e}){return ft.clone({text:t,fontSize:o,fontStyle:e}).width()}({...t,fontSize:n})+3}));let s=e-i/2;t.forEach(((t,e)=>{const{txt:i,width:r}=function({text:t,y:o,fontSize:e,fontStyle:n,fill:i}){const s=p({text:t,y:o,fontSize:e,fontStyle:n,fill:i});return{txt:s,width:s.getTextWidth()}}({...t,y:o,fontSize:n});i.x(s),s+=r+3}))}(t,o[i],n)}))})(g,w,c),function(){const{dtb:t,tutru:e}=l,s=t.tki,c=u({text:`Tứ Trụ - Sinh vào tiết ${Ft[s[0]]}`,x:n,y:i+95,fontSize:a});s[1]&&u({text:`Tháng ${ao[s[0]]}tk từ ${Ft[Xt[s[0]][0]]} (${1===x[F.showSun]?gt(s[3]).format("YYYY/MM/DD HH:mm"):gt(s[3]).format("----/MM/DD HH:mm")}) đến ${Ft[Xt[s[0]][1]]} (${1===x[F.showSun]?gt(s[4]).format("YYYY/MM/DD HH:mm"):gt(s[4]).format("----/MM/DD HH:mm")})`,x:n,y:c.y()+16,fontSize:a-3});const f=b(n+3,c.y()+33,e.cot[0],`${t.sn.y}`),S=t.ln.mt===t.ln.m?"("+t.ln.mt+")":"("+t.ln.m+")("+t.ln.mt+"tk)",m=b(f+3,c.y()+33,e.cot[1],`${t.sn.m} ${S}`),g=b(m+3,c.y()+33,e.cot[2],`${t.sn.d} (${t.ln.d})`);if(b(g+3,c.y()+33,e.cot[3],`${t.sn.h}h${t.sn.i}`),y){const t=l.tutru.dvt,e=p({text:`${t[0]?"Thuận":"Nghịch"} đến tk cách ${t[1]} ngày ${t[2]} giờ quy đổi thành ${t[3]} năm ${t[4]} tháng ${t[5]} ngày`,x:n,y:c.y()+235,fontStyle:"normal",width:2*o+r,align:"center",fontSize:a-2.5}),i=15,s=l.tutru.dv,f=34;let y=0;s.forEach(((t,o)=>{const s=gt.unix(t[2]),r=l.yeo>=s.year()-l.dtb.sn.y+1&&l.yeo<=s.year()-l.dtb.sn.y+10,c={x:0===y?n+3:y,y:e.y()+i,fill:r?"rgba(255, 224, 191, 0.7)":"rgba(0, 0, 0, 0.07)",width:f,height:75,perfectDrawEnabled:!0,strokeWidth:1,opacity:1,cornerRadius:6,hitStrokeWidth:1,shadowForStrokeEnabled:!1};h.add(st.clone(c));const u=p({text:`${vt[Vt(l.dtb.bs.d[0],t[0])]}`,x:0===y?n+3:y,y:e.y()+i+5,fill:"#333",fontSize:a-4,width:f,align:"center"}),b=p({text:`${et[t[0]]}`,x:0===y?n+3:y,y:u.y()+i,fill:d[St[t[0]]],fontSize:a-2,width:f,align:"center"}),S=p({text:`${tt[t[1]]}`,x:b.x(),y:b.y()+i,fill:d[Dt[t[1]]],fontSize:a-2,width:f,align:"center"});let m=`${s.year()-l.dtb.sn.y+1}-${s.year()-l.dtb.sn.y+10}t${1===x[F.showSun]?" "+s.format("YYYY"):""}`;0===o&&(m=`${s.year()-l.dtb.sn.y+1}t${1===x[F.showSun]?" "+s.format("DD/MM   YYYY"):""}`),p({text:`${m}`,x:b.x(),y:S.y()+i+2,fill:"#333",fontSize:a-5,width:f,align:"center"}),y=b.x()+f+3.5}))}}()}(),t.layer.add(h),t.layer}kt.cache();const Mt=eo(no),Eo=t=>{const o=t.ls,e=o.cfg,n=75*(o.css<=11?0:o.css-11),i=960+n,s=e[F.typeLs],r=e[F.typePhiHoa],l=185.5,a=i/4,c=i+2+1+1,d=["","","#031640","#067b11","#8b8380","#e39e25","#cf233b"],f=["","","#123e65","#04973c","#919191","#e39e25","#e73827"];let x=5;(4===s||5===s)&&(x=8);const h=["rgb(3 140 0)","rgb(110 8 136)","rgb(14 124 202)","rgb(217 4 4)"],y=["rgb(3 140 0 / 75%)","rgb(110 8 136 / 75%)","rgb(14 124 202 / 75%)","rgb(217 4 4 / 75%)"],p=["rgba(114,250,112,0.9)","rgba(227,100,255,0.9)","rgba(77,182,255,0.9)","rgba(246,66,66,0.9)"],u=["rgba(114,250,112,0.5)","rgba(227,100,255,0.5)","rgba(77,182,255,0.5)","rgba(246,66,66,0.5)"],b="Roboto Slab",S=54,m=l/2,g=a/2;let w=1,k=w+l,W=k+1+l,T=W+1+l,$=T+1+l,v=1,B=v+a,z=B+1+a,N=z+1+a,C=N+1+a;w+=27,k+=27,W+=27,T+=27,$+=27,v+=27,B+=27,z+=27,N+=27,C+=27;const E=a-2.3*x,D=x;function Y(t,o,e="#dcd3aaa8"){if(typeof window<"u"){const n=window.document.createElement("canvas").getContext("2d"),i=void 0!==t[4]?t[4]:t[2],s=void 0!==t[5]?t[5]:t[3],r=n.createLinearGradient(t[0],t[1],i,s);return r.addColorStop(0,e),r.addColorStop(1,o),r}return o}const j=ht.useRef(null);let H;ht.useState(!1),ht.useState(!1),ht.useState(null),ht.useState(!1);const[O,L]=ht.useState(null),M=()=>j.current?j.current.toDataURL({pixelRatio:2,quality:1,mimeType:"image/png"}):null;function P(t){let e="VCD";return o.ars[t].sb.length>0&&(e="",o.ars[t].sb.forEach((t=>{e.length>0&&(e+="-"),e+=at[t].sht}))),Pt(e)}ht.useEffect((()=>{if(typeof window<"u")try{if(H&&H.destroy(),j.current&&j.current.destroy(),!document.getElementById("cv"))return void console.error("Container not found");const n=new Jt.Stage({container:"cv",width:800,height:c+S,fill:"#fefefe",font:b});j.current=n,H=new Jt.Layer;const q=co(e[F.lsCanType]);H.add(st.clone({x:0,y:0,width:800,height:c+S,hitStrokeWidth:0,shadowForStrokeEnabled:!1,fillRadialGradientStartPoint:{x:W,y:z},fillRadialGradientStartRadius:0,fillRadialGradientEndPoint:{x:W,y:z},fillRadialGradientEndRadius:1e3,fillRadialGradientColorStops:[0,"#FFF",1,"#ddd"]})),H.add(st.clone({x:k+1,y:B+1,width:372,height:2*a+1,fillRadialGradientStartPoint:{x:k,y:B},fillRadialGradientStartRadius:0,fillRadialGradientEndPoint:{x:k,y:B},fillRadialGradientEndRadius:555,fillRadialGradientColorStops:[0,"#fff",1,"#ddd"],hitStrokeWidth:0,shadowForStrokeEnabled:!1})),H=ko({ls:o,layer:H,lsWidth:742,lsHeight:i,xBox:w,borderOutWith:1,hafBorderOut:.5,yBox:v,xBox12:W,yBox12:z,xBox14:k,yBox14:B,xBox34:T,yBox34:N,xBox4:$,yBox4:C,hafBorderIn:.5,borderInnerWith:1,bColor:f}),H=Co({layer:H,bColor:f,colorHoaStart:y,colorHoa:h,colorHoaFill:p,colorHoaFill60:u,color:d,xBox12:W,yBox34:N,xBox14:k,xBox:w,yBox12:z,yBox14:B,yBox:v,xBox4:$,yBox4:C,xBox34:T,ls:o,hafWSquare:m,hafHSquare:g,fontFamilySet:b,borderOutWith:1,hafBorderOut:.5,fontDV:13,padContentBottom:E,padContentTop:D,padContent:x,wSquare:l,hSquare:a,fontPhuTinh:14,fontChinhTinh:15,getGradient:Y,typePhiHoa:r,typeLs:s,cfgLs:e,canHoa:q}),H=Wo({layer:H,wSquare:l,xBox12:W,xBox14:k,yBox14:B,yBox34:N,borderInnerWith:1,ls:o,fontCenter:12,hafWSquare:m,fontFamilySet:b,color:d,fontDV:13,cfgLs:e,getGradient:Y,version:t.version}),H.add(st.clone({x:0,y:c+S,width:800,height:c+S,fill:"rgb(233 233 233)"})),n.add(H);const O=M();O&&L(O)}catch(t){console.error("Error initializing stage:",t)}return()=>{H&&H.destroy(),j.current&&(j.current.destroy(),j.current=null),L(null)}}),[t.ls]),ht.useEffect((()=>{0!==t.fnDownloadCall&&G(),0!==t.fnCopyLs&&R()}),[t.fnDownloadCall,t.fnCopyLs]);const A=()=>{const t=o.dtb.sn,e=o.dtb.ln,n=o.dtb.bs,i=ut[o.ars[o.at].ai];return q.jsxs("div",{className:"text-[14px] [&_div]:mb-1",children:[q.jsxs("div",{children:["Thời gian sinh dương lịch:"," ",q.jsxs("b",{children:[t.d,"/",t.m,"/",t.y," lúc ",t.h,"h",t.i||0]})]}),q.jsxs("div",{children:[q.jsx("b",{children:`${o.adye>0?"Dương":"Âm"} ${o.sx>0?"Nam":"Nữ"}`})," tuổi âm lịch ",q.jsxs("b",{children:[o.yeo," tuổi"]})]}),q.jsxs("div",{children:["Âm lịch giờ ",q.jsx("b",{children:tt[n.h[1]]})," ngày ",q.jsx("b",{children:e.d})," tháng ",q.jsx("b",{children:e.m})," năm"," ",q.jsxs("b",{className:`color${Q[n.y[2]]}`,children:[et[n.y[0]]," ",tt[n.y[1]]]})]}),q.jsxs("div",{children:["Mệnh ",q.jsxs("b",{className:`color${Q[n.y[2]]}`,children:[" ",$t[Q[n.y[2]]]]})," cục"," ",q.jsx("b",{className:`color${o.cid}`,children:$t[o.cid]})," - ",`${o.ad>0?Bt[1]:Bt[0]} - ${Qt[o.sks]}`," "]}),q.jsxs("div",{children:["Thân cư ",q.jsx("b",{children:i.charAt(0)+i.slice(1).toLowerCase()})," - Mệnh chủ"," ",q.jsx("b",{className:`color${at[o.mctc[0]].hh}`,children:at[o.mctc[0]].name})," - Thân chủ"," ",q.jsx("b",{className:`color${at[o.mctc[1]].hh}`,children:at[o.mctc[1]].name})," "]}),q.jsxs("div",{className:"!text-[12px] !mt-3",children:["Năm xem ",q.jsx("b",{children:o.dtv.sn.y})," ÂL:"," ",q.jsxs("span",{className:`color${Q[o.dtv.bs.y[2]]}`,children:[et[o.dtv.bs.y[0]]," ",tt[o.dtv.bs.y[1]]]})," ","-"," ",q.jsxs("span",{className:`color${Q[o.dtv.bs.m[2]]}`,children:[et[o.dtv.bs.m[0]]," ",tt[o.dtv.bs.m[1]],"(",o.dtv.ln.m,")"]})," ","-"," ",q.jsxs("span",{className:`color${Q[o.dtv.bs.d[2]]}`,children:[et[o.dtv.bs.d[0]]," ",tt[o.dtv.bs.d[1]],"(",o.dtv.ln.d,")"]})," ","-"," ",q.jsxs("span",{className:`color${Q[o.dtv.bs.h[2]]}`,children:[et[o.dtv.bs.h[0]]," ",tt[o.dtv.bs.h[1]]]})]})]})},R=async()=>{try{const t=O||M();if(!t)throw new Error("Không thể lấy được ảnh lá số");const o=await(await fetch(t)).blob();await navigator.clipboard.write([new ClipboardItem({[o.type]:o})]),Mt.fire({title:"Thông báo",html:q.jsxs("div",{children:[q.jsx("div",{children:"Tinh Mệnh Đồ đã copy xong:"}),q.jsxs("div",{className:"text-orange-600",children:["Check lại thông tin ",q.jsx("b",{children:"1 lần nữa"})," cho dù bạn đã chắc chắn."]}),q.jsx("br",{}),q.jsx("div",{children:A()}),q.jsx("br",{})]}),icon:"success"})}catch(t){console.error("Error copying image:",t),Mt.fire({title:"Lỗi",text:t instanceof Error?t.message:"Có lỗi xảy ra khi copy lá số",icon:"error"})}},G=()=>{try{const t=O||M();if(!t)throw new Error("Không thể lấy được ảnh lá số");const e=o.dtb.sn,n=o.am,i=P(n),s=o.at,r=P(s);!function(t,o){if(typeof window<"u"){const e=window.document.createElement("a");e.download=o,e.href=t,window.document.body.appendChild(e),e.click(),window.document.body.removeChild(e)}}(t,`${1===o.sx?"nam":"nu"}-Menh-${i}-${Pt(tt[n])}-Than-${r}-${Pt(tt[s])}--${e.d}.${e.m}.${e.y}-${e.h}h${e.i||0}-TinhMenhDo.com-${Math.floor(1e4*Math.random())}.png`)}catch(t){console.error("Error exporting image:",t),Mt.fire({title:"Lỗi",text:t instanceof Error?t.message:"Có lỗi xảy ra khi lưu lá số",icon:"error"})}},[K,V]=ht.useState(!0);return ht.useEffect((()=>{typeof window<"u"&&K&&V(!1)})),q.jsxs(q.Fragment,{children:[q.jsx("div",{id:"cv",className:"flex justify-center"}),q.jsx("div",{className:"absolute top-0 left-0 hidden size-full max-lg:block"})]})};export{Eo as default};